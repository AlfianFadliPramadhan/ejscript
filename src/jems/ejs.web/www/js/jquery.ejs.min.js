(function(f){var c={updating:true,"toggle-updating":27};f.fn.extend({ejs:function(l){f.extend(c,l||{});f("[data-sort-order]").each(g);f("[data-refresh]").each(h);f("div[class~=-ejs-flash-inform]").animate({opacity:1},2000).hide("slow");f("[data-modal]").each(function(){f(this).modal({escClose:false,overlayId:"-ejs-modal-background",containerId:"-ejs-modal-foreground"})})}});f.fn.ejs.defaults=c;function b(m){var l=f(this),n=l.is("form")?l.serializeArray():[],o=l.attr("data-remote-method")||"GET";if(m===undefined){m=l.attr("action")||l.attr("href")||l.attr("data-remote");if(!m){throw"No URL specified for remote call"}}l.trigger("http:before");f.ajax({url:m,data:n,type:o.toUpperCase(),beforeSend:function(p){l.trigger("http:loading",p)},success:function(s,p,r){l.trigger("http:success",[s,p,r]);var q=l.attr("data-apply");if(q){f(q).html(s)}},complete:function(p){l.trigger("http:complete",p)},error:function(r,p,q){l.trigger("http:failure",[r,p,q])}});l.trigger("http:after")}function j(l){this.each(function(){var m=f(this);f.each(f(l)[0].attributes,function(o,n){if(n.name.indexOf("data-")==0){if(m.attr(n.name)==null){m.attr(n.name,n.value)}}})})}function a(m){var m=f(m);var l={};f.each(m[0].attributes,function(o,n){if(n.name.indexOf("data-")==0){l[n.name.substring(5)]=n.value}});return l}function e(l){if(window.console){console.debug(l)}else{alert(l)}}function d(){var n=f(this);var r=n.attr("data-click-method")||n.attr("data-method")||"GET";var l=n.attr("data-click")||n.attr("action")||n.attr("href");var q=n.attr("data-click-params");if(l===undefined){alert("No URL specified");return}r=r.toUpperCase();if(r=="GET"){window.location=l}else{var p=f("meta[name=SecurityTokenName]").attr("content");var m=f("meta[name="+p+"]").attr("content");if(m){var o=f('<form method="post" action="'+l+'"/>').append('<input name="-ejs-method-" value="'+r+'" type="hidden" />').append('<input name="'+p+'" value="'+m+'" type="hidden" />');if(q){for(k in q){param=q[k];pair=param.split("=");o.append('<input name="'+pair[0]+'" value="'+pair[1]+'" type="hidden" />')}}o.hide().appendTo("body").submit()}else{alert("Missing Security Token")}}}function g(p){var n=f(this);var r=f.extend({},c,p,n.data("ejs-options")||{},a(n));if(!r.sortConfig){if(r.sort!="false"){var m=f("th",n).filter(':contains("'+r.sort+'")');var q=f("th",n).filter(':contains("'+r.sort+'")').get(0);if(q){var l=(r["sort-order"].indexOf("asc")>=0)?0:1;r.sortConfig={sortList:[[q.cellIndex,l]]}}else{r.sortConfig={sortList:[[0,0]]}}}n.tablesorter(r.sortConfig)}n.data("ejs-options",r);return this}function h(n){function o(){var s=f(this);var t=s.data("ejs-options");var r=t.effects;if(r=="highlight"){s.fadeTo(0,0.3);s.fadeTo(750,1)}else{if(r=="fadein"){s.fadeTo(0,0);s.fadeTo(1000,1)}else{if(r=="fadeout"){s.fadeTo(0,1);s.fadeTo(1000,0)}else{if(r=="bold"){s.css("font-weight",100);s.animate({opacity:0.1,"font-weight":900},1000)}}}}}function p(w,B){var z,s,x,v,r=false;var s=this.attr("id");var C=this.attr("data-apply")||s;var y=(C)?f("#"+C):f(this);var t=y.data("ejs-options");var A=B.getResponseHeader("Content-Type")||"text/html";if(A=="text/html"){try{w=f(w);w.data("ejs-options",t);w.attr("id",s);j.call(w,y);r=true}catch(y){console.debug(y)}}if(r){if(y[0]&&y[0].tagName=="TABLE"){w.data("tablesorter",y.data("tablesorter"));var u=w[0].config=y[0].config;w.tablesorter({sortList:u.sortList})}y.replaceWith(w);y=w}else{z=y[0];if(z.type=="checkbox"){if(w==y.val()){y.attr("checked","yes")}else{y.removeAttr("checked")}}else{if(z.type=="radio"){if(w==y.val()){y.attr("checked","yes")}else{y.removeAttr("checked")}}else{if(z.type=="text"||z.type=="textarea"){y.val(w)}else{if(z.tagName=="IMG"){y.attr("src",w)}else{y.text(w)}}}}}o.call(y);return y}function q(s){var r=f(this);var t=f.extend({},s,r.data("ejs-options")||{},a(r));r.data("ejs-options",t);if(t.updating){var u=t["refresh-method"]||"GET";f.ajax({url:t.refresh,type:u,success:function(x,v,w){if(w.status==200){r=p.call(r,x,w)}else{if(w.status==0){e("Error updating control: can't connect to server")}else{e("Error updating control: "+w.statusText+" "+w.responseText)}}},complete:function(){setTimeout(function(v){q.call(v,t)},t["refresh-period"],r)},error:function(w,x,v){e("Error updating control: "+x)}})}else{setTimeout(function(v){q.call(v,t)},t["refresh-period"],r)}if(!t.bound){f(document).bind("keyup.refresh",function(v){if(v.keyCode==t["toggle-updating"]){f("[data-refresh]").each(i)}});t.bound=true}}var m=f(this);var l=f.extend({},c,n||{});q.call(m,l);return this}function i(){elt=f(this);var l=elt.data("ejs-options");if(l){l.updating=!l.updating}}f("a[data-confirm],input[data-confirm]").live("click",function(){var l=f(this);l.bind("confirm",function(m){return confirm(l.attr("data-confirm"))});l.trigger("confirm")});f("input[type=submit]").live("click",function(l){f(this).attr("checked",true)});f("a[data-method]:not([data-remote])").live("click",function(l){d.apply(this);l.preventDefault()});f("tr[data-remote]").live("click",function(n){var m=f(this).parents("table");var l=f(this).attr("data-remote");b.call(m,l);n.preventDefault()});f("button[data-remote]").live("click",function(l){b.apply(this);l.preventDefault()});f("form").live("submit",function(l){var m=f(this).attr("data-method");if(m){f(this).append('<input name="-ejs-method-" value="'+m+'" type="hidden" />')}});f("form[data-remote]").live("submit",function(l){var m=f(this).attr("data-method");if(m){f(this).append('<input name="-ejs-method-" value="'+m+'" type="hidden" />')}b.apply(this);l.preventDefault()});f("a[data-remote],input[data-remote]").live("click",function(l){b.apply(this);l.preventDefault()});f("li[data-toggle]").live("click",function(m){var l=f(this).attr("data-toggle");f("div[id|=pane]").hide();var n=f("div#"+l);n.fadeIn(500);n.addClass("-ejs-pane-visible");n.removeClass("-ejs-pane-hidden");m.preventDefault();return false});f("[data-click]").live("click",function(l){d.apply(this);l.preventDefault()});f("[data-click]").live("mouseover",function(n){var m=f(this).attr("data-click");if(m.indexOf("http://")==0){window.status=m}else{var l=window.location;window.status=l.protocol+"//"+l.host+m}});f("[data-click]").live("mouseout",function(l){window.status=""});f("[data-remote]").live("mouseover",function(n){var m=f(this).attr("data-remote");if(m.indexOf("http://")==0){window.status=m}else{var l=window.location;window.status=l.protocol+"//"+l.host+m}});f("[data-remote]").live("mouseout",function(l){window.status=""});f(document).ready(function(){f(document).ejs()})})(jQuery);