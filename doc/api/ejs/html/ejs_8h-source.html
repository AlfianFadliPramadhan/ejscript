<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ejs: ejs.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
  <div class="navpath"><a class="el" href="dir_6c83ff02c73eb756c5c8cef00ac2258c.html">staging</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_96444030321bf4fa6715e0c48c392252.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_bb0e06db19a9da65cffed4cab19991de.html">include</a>
  </div>
<div class="contents">
<h1>ejs.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">/******************************************************************************/</span>
<a name="l00003"></a>00003 <span class="comment">/* </span>
<a name="l00004"></a>00004 <span class="comment"> *  This file is an amalgamation of all the individual source code files for</span>
<a name="l00005"></a>00005 <span class="comment"> *  Embedthis Ejscript 2.0.0.</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> *  Catenating all the source into a single file makes embedding simpler and</span>
<a name="l00008"></a>00008 <span class="comment"> *  the resulting application faster, as many compilers can do whole file</span>
<a name="l00009"></a>00009 <span class="comment"> *  optimization.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *  If you want to modify ejs, you can still get the whole source</span>
<a name="l00012"></a>00012 <span class="comment"> *  as individual files if you need.</span>
<a name="l00013"></a>00013 <span class="comment"> */</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="comment">/************************************************************************/</span>
<a name="l00017"></a>00017 <span class="comment">/*</span>
<a name="l00018"></a>00018 <span class="comment"> *  Start of file "../../src/include/ejsTune.h"</span>
<a name="l00019"></a>00019 <span class="comment"> */</span>
<a name="l00020"></a>00020 <span class="comment">/************************************************************************/</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="comment">/*</span>
<a name="l00023"></a>00023 <span class="comment">    ejsTune.h - Tunable parameters for the C VM and compiler</span>
<a name="l00024"></a>00024 <span class="comment"></span>
<a name="l00025"></a>00025 <span class="comment">    Copyright (c) All Rights Reserved. See details at the end of the file.</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#ifndef _h_EJS_TUNE</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#define _h_EJS_TUNE 1</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include    "mpr.h"</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
<a name="l00036"></a>00036 <span class="preprocessor">#endif</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#define HEAP_OVERHEAD (MPR_ALLOC_HDR_SIZE + MPR_ALLOC_ALIGN(sizeof(MprRegion) + sizeof(MprHeap) + sizeof(MprDestructor)))</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>
<a name="l00041"></a>00041 <span class="comment">/*</span>
<a name="l00042"></a>00042 <span class="comment">    Tunable Constants</span>
<a name="l00043"></a>00043 <span class="comment">    TODO - consistency of names needs work</span>
<a name="l00044"></a>00044 <span class="comment"> */</span>
<a name="l00045"></a>00045 <span class="preprocessor">#if BLD_TUNE == MPR_TUNE_SIZE || DOXYGEN</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span>    <span class="comment">/*</span>
<a name="l00047"></a>00047 <span class="comment">     *  Tune for size</span>
<a name="l00048"></a>00048 <span class="comment">     */</span>
<a name="l00049"></a>00049 <span class="preprocessor">    #define EJS_ARENA_SIZE          ((1 * 1024 * 1024) - MPR_HEAP_OVERHEAD) </span><span class="comment">/* Initial virt memory for objects */</span>
<a name="l00050"></a>00050 <span class="preprocessor">    #define EJS_LOTSA_PROP          256             </span><span class="comment">/* Object with lots of properties. Grow by bigger chunks */</span>
<a name="l00051"></a>00051 <span class="preprocessor">    #define EJS_MAX_OBJ_POOL        512             </span><span class="comment">/* Maximum number of objects per type to cache */</span>
<a name="l00052"></a>00052 <span class="preprocessor">    #define EJS_MAX_RECURSION       10000           </span><span class="comment">/* Maximum recursion */</span>
<a name="l00053"></a>00053 <span class="preprocessor">    #define EJS_MAX_REGEX_MATCHES   32              </span><span class="comment">/* Maximum regular sub-expressions */</span>
<a name="l00054"></a>00054 <span class="preprocessor">    #define EJS_MAX_SQLITE_MEM      (2*1024*1024)   </span><span class="comment">/* Maximum buffering for Sqlite */</span>
<a name="l00055"></a>00055 <span class="preprocessor">    #define EJS_MAX_TYPE            256             </span><span class="comment">/* Maximum number of types */</span>
<a name="l00056"></a>00056 <span class="preprocessor">    #define EJS_MIN_FRAME_SLOTS     16              </span><span class="comment">/* Miniumum number of slots for function frames */</span>
<a name="l00057"></a>00057 <span class="preprocessor">    #define EJS_NUM_GLOBAL          256             </span><span class="comment">/* Number of globals slots to pre-create */</span>
<a name="l00058"></a>00058 <span class="preprocessor">    #define EJS_ROUND_PROP          16              </span><span class="comment">/* Rounding for growing properties */</span>
<a name="l00059"></a>00059 <span class="preprocessor">    #define EJS_WORK_QUOTA          1024            </span><span class="comment">/* Allocations required before garbage colllection */</span>
<a name="l00060"></a>00060 <span class="preprocessor">    #define EJS_XML_MAX_NODE_DEPTH  64              </span><span class="comment">/* Max nesting of tags */</span>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="preprocessor">#elif BLD_TUNE == MPR_TUNE_BALANCED</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>    <span class="comment">/*</span>
<a name="l00064"></a>00064 <span class="comment">        Tune balancing speed and size</span>
<a name="l00065"></a>00065 <span class="comment">     */</span>
<a name="l00066"></a>00066 <span class="preprocessor">    #define EJS_ARENA_SIZE          ((4 * 1024 * 1024) - MPR_HEAP_OVERHEAD)</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_LOTSA_PROP          256</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_MAX_OBJ_POOL        1024</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_MAX_SQLITE_MEM      (20*1024*1024)</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_MAX_RECURSION       (1000000)</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_MAX_REGEX_MATCHES   64</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_MIN_FRAME_SLOTS     24</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_NUM_GLOBAL          512</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_MAX_TYPE            512</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_ROUND_PROP          24</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_WORK_QUOTA          2048</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_XML_MAX_NODE_DEPTH  256</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span>
<a name="l00079"></a>00079 <span class="preprocessor">#else</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>    <span class="comment">/*</span>
<a name="l00081"></a>00081 <span class="comment">        Tune for speed</span>
<a name="l00082"></a>00082 <span class="comment">     */</span>
<a name="l00083"></a>00083 <span class="preprocessor">    #define EJS_ARENA_SIZE          ((8 * 1024 * 1024) - MPR_HEAP_OVERHEAD)</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_NUM_GLOBAL          1024</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_LOTSA_PROP          1024</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_MAX_OBJ_POOL        4096</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_MAX_RECURSION       (1000000)</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_MAX_REGEX_MATCHES   128</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_MAX_TYPE            1024</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_MAX_SQLITE_MEM      (20*1024*1024)</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_MIN_FRAME_SLOTS     32</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_ROUND_PROP          32</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_WORK_QUOTA          4096</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span><span class="preprocessor">    #define EJS_XML_MAX_NODE_DEPTH  1024</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00097"></a>00097 <span class="preprocessor">#define EJS_XML_BUF_MAX             (256 * 1024)    </span><span class="comment">/* Max XML document size */</span>
<a name="l00098"></a>00098 <span class="preprocessor">#define EJS_HASH_MIN_PROP           8               </span><span class="comment">/* Min props to hash */</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="preprocessor">#define EJS_SQLITE_TIMEOUT          30000           </span><span class="comment">/* Database busy timeout */</span>
<a name="l00101"></a>00101 <span class="preprocessor">#define EJS_SESSION_TIMEOUT         1800</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span><span class="preprocessor">#define EJS_TIMER_PERIOD            1000            </span><span class="comment">/* Timer checks ever 1 second */</span>
<a name="l00103"></a>00103 <span class="preprocessor">#define EJS_FILE_PERMS              0664            </span><span class="comment">/* Default file perms */</span>
<a name="l00104"></a>00104 <span class="preprocessor">#define EJS_DIR_PERMS               0775            </span><span class="comment">/* Default dir perms */</span>
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <span class="preprocessor">#if BLD_FEATURE_MMU</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span><span class="preprocessor">    #if BLD_TUNE == MPR_TUNE_SIZE</span>
<a name="l00109"></a>00109 <span class="preprocessor"></span><span class="preprocessor">        #define EJS_STACK_MAX       (1024 * 1024)   </span><span class="comment">/* Stack size on virtual memory systems */</span>
<a name="l00110"></a>00110 <span class="preprocessor">    #elif BLD_TUNE == MPR_TUNE_BALANCED</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span><span class="preprocessor">        #define EJS_STACK_MAX       (1024 * 1024 * 4)</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span><span class="preprocessor">    #else</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span><span class="preprocessor">        #define EJS_STACK_MAX       (1024 * 1024 * 16)</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span><span class="preprocessor">    #endif</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span>    <span class="comment">/*</span>
<a name="l00117"></a>00117 <span class="comment">        Highly recursive workloads may need to increase the stack values</span>
<a name="l00118"></a>00118 <span class="comment">     */</span>
<a name="l00119"></a>00119 <span class="preprocessor">    #if BLD_TUNE == MPR_TUNE_SIZE</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span><span class="preprocessor">        #define EJS_STACK_MAX       (1024 * 32)     </span><span class="comment">/* Stack size without MMU */</span>
<a name="l00121"></a>00121 <span class="preprocessor">    #elif BLD_TUNE == MPR_TUNE_BALANCED</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span><span class="preprocessor">        #define EJS_STACK_MAX       (1024 * 64)</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span><span class="preprocessor">    #else</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span><span class="preprocessor">        #define EJS_STACK_MAX       (1024 * 128)</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span><span class="preprocessor">    #endif</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00127"></a>00127 <span class="preprocessor"></span>
<a name="l00128"></a>00128 <span class="comment">/*</span>
<a name="l00129"></a>00129 <span class="comment">    Sanity constants. Only for sanity checking. Set large enough to never be a</span>
<a name="l00130"></a>00130 <span class="comment">    real limit but low enough to catch some errors in development.</span>
<a name="l00131"></a>00131 <span class="comment"> */</span>
<a name="l00132"></a>00132 <span class="preprocessor">#define EJS_MAX_POOL            (4*1024*1024)   </span><span class="comment">/* Size of constant pool */</span>
<a name="l00133"></a>00133 <span class="preprocessor">#define EJS_MAX_ARGS            (8192)          </span><span class="comment">/* Max number of args */</span>
<a name="l00134"></a>00134 <span class="preprocessor">#define EJS_MAX_LOCALS          (10*1024)       </span><span class="comment">/* Max number of locals */</span>
<a name="l00135"></a>00135 <span class="preprocessor">#define EJS_MAX_EXCEPTIONS      (8192)          </span><span class="comment">/* Max number of exceptions */</span>
<a name="l00136"></a>00136 <span class="preprocessor">#define EJS_MAX_TRAITS          (0x7fff)        </span><span class="comment">/* Max number of declared properties per block */</span>
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="comment">/*</span>
<a name="l00139"></a>00139 <span class="comment">    Should not need to change these</span>
<a name="l00140"></a>00140 <span class="comment"> */</span>
<a name="l00141"></a>00141 <span class="preprocessor">#define EJS_INC_ARGS            8               </span><span class="comment">/* Frame stack increment */</span>
<a name="l00142"></a>00142 <span class="preprocessor">#define EJS_MAX_BASE_CLASSES    256             </span><span class="comment">/* Max inheritance chain */</span>
<a name="l00143"></a>00143 <span class="preprocessor">#define EJS_DOC_HASH_SIZE       1007            </span><span class="comment">/* Hash for doc descriptions */</span>
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="comment">/*</span>
<a name="l00146"></a>00146 <span class="comment">    Compiler constants</span>
<a name="l00147"></a>00147 <span class="comment"> */</span>
<a name="l00148"></a>00148 <span class="preprocessor">#define EC_MAX_INCLUDE          32              </span><span class="comment">/* Max number of nested includes */</span>
<a name="l00149"></a>00149 <span class="preprocessor">#define EC_LINE_INCR            1024            </span><span class="comment">/* Growth increment for input lines */</span>
<a name="l00150"></a>00150 <span class="preprocessor">#define EC_TOKEN_INCR           256             </span><span class="comment">/* Growth increment for tokens */</span>
<a name="l00151"></a>00151 <span class="preprocessor">#define EC_MAX_LOOK_AHEAD       8</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span><span class="preprocessor">#define EC_BUFSIZE              4096            </span><span class="comment">/* General buffer size */</span>
<a name="l00153"></a>00153 <span class="preprocessor">#define EC_MAX_ERRORS           25              </span><span class="comment">/* Max compilation errors before giving up */</span>
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="preprocessor">#define EC_CODE_BUFSIZE         4096            </span><span class="comment">/* Initial size of code gen buffer */</span>
<a name="l00156"></a>00156 <span class="preprocessor">#define EC_NUM_PAK_PROP         32              </span><span class="comment">/* Initial number of properties */</span>
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="comment">/*</span>
<a name="l00159"></a>00159 <span class="comment">    File extensions</span>
<a name="l00160"></a>00160 <span class="comment">    MOB -- move these out of here </span>
<a name="l00161"></a>00161 <span class="comment"> */</span>
<a name="l00162"></a>00162 <span class="preprocessor">#define EJS_MODULE_EXT          ".mod"</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span><span class="preprocessor">#define EJS_SOURCE_EXT          ".es"</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span><span class="preprocessor">#define EJS_LISTING_EXT         ".lst"</span>
<a name="l00165"></a>00165 <span class="preprocessor"></span>
<a name="l00166"></a>00166 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>}
<a name="l00168"></a>00168 <span class="preprocessor">#endif</span>
<a name="l00169"></a>00169 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* _h_EJS_TUNE */</span>
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="comment">/*</span>
<a name="l00172"></a>00172 <span class="comment">    @copy   </span>
<a name="l00173"></a>00173 <span class="comment"></span>
<a name="l00174"></a>00174 <span class="comment">    Copyright (c) Embedthis Software LLC, 2003-2010. All Rights Reserved.</span>
<a name="l00175"></a>00175 <span class="comment">    Copyright (c) Michael O'Brien, 1993-2010. All Rights Reserved.</span>
<a name="l00176"></a>00176 <span class="comment"></span>
<a name="l00177"></a>00177 <span class="comment">    This software is distributed under commercial and open source licenses.</span>
<a name="l00178"></a>00178 <span class="comment">    You may use the GPL open source license described below or you may acquire</span>
<a name="l00179"></a>00179 <span class="comment">    a commercial license from Embedthis Software. You agree to be fully bound</span>
<a name="l00180"></a>00180 <span class="comment">    by the terms of either license. Consult the LICENSE.TXT distributed with</span>
<a name="l00181"></a>00181 <span class="comment">    this software for full details.</span>
<a name="l00182"></a>00182 <span class="comment"></span>
<a name="l00183"></a>00183 <span class="comment">    This software is open source; you can redistribute it and/or modify it</span>
<a name="l00184"></a>00184 <span class="comment">    under the terms of the GNU General Public License as published by the</span>
<a name="l00185"></a>00185 <span class="comment">    Free Software Foundation; either version 2 of the License, or (at your</span>
<a name="l00186"></a>00186 <span class="comment">    option) any later version. See the GNU General Public License for more</span>
<a name="l00187"></a>00187 <span class="comment">    details at: http://www.embedthis.com/downloads/gplLicense.html</span>
<a name="l00188"></a>00188 <span class="comment"></span>
<a name="l00189"></a>00189 <span class="comment">    This program is distributed WITHOUT ANY WARRANTY; without even the</span>
<a name="l00190"></a>00190 <span class="comment">    implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<a name="l00191"></a>00191 <span class="comment"></span>
<a name="l00192"></a>00192 <span class="comment">    This GPL license does NOT permit incorporating this software into</span>
<a name="l00193"></a>00193 <span class="comment">    proprietary programs. If you are unable to comply with the GPL, you must</span>
<a name="l00194"></a>00194 <span class="comment">    acquire a commercial license to use this software. Commercial licenses</span>
<a name="l00195"></a>00195 <span class="comment">    for this software and support services are available from Embedthis</span>
<a name="l00196"></a>00196 <span class="comment">    Software at http://www.embedthis.com</span>
<a name="l00197"></a>00197 <span class="comment"></span>
<a name="l00198"></a>00198 <span class="comment">    Local variables:
    tab-width: 4
    c-basic-offset: 4
    End:
    vim: sw=8 ts=8 expandtab

    @end</span>
<a name="l00199"></a>00199 <span class="comment"> */</span>
<a name="l00200"></a>00200 <span class="comment">/************************************************************************/</span>
<a name="l00201"></a>00201 <span class="comment">/*</span>
<a name="l00202"></a>00202 <span class="comment"> *  End of file "../../src/include/ejsTune.h"</span>
<a name="l00203"></a>00203 <span class="comment"> */</span>
<a name="l00204"></a>00204 <span class="comment">/************************************************************************/</span>
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 <span class="comment">/************************************************************************/</span>
<a name="l00209"></a>00209 <span class="comment">/*</span>
<a name="l00210"></a>00210 <span class="comment"> *  Start of file "../../src/include/ejsByteCode.h"</span>
<a name="l00211"></a>00211 <span class="comment"> */</span>
<a name="l00212"></a>00212 <span class="comment">/************************************************************************/</span>
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 <span class="comment">/*</span>
<a name="l00215"></a>00215 <span class="comment">    ejsByteCode.h - Ejscript VM Byte Code</span>
<a name="l00216"></a>00216 <span class="comment">  </span>
<a name="l00217"></a>00217 <span class="comment">    Copyright (c) All Rights Reserved. See details at the end of the file.</span>
<a name="l00218"></a>00218 <span class="comment"> */</span>
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="preprocessor">#ifndef _h_EJS_ejsByteCode</span>
<a name="l00221"></a>00221 <span class="preprocessor"></span><span class="preprocessor">#define _h_EJS_ejsByteCode 1</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span>
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 <span class="keyword">typedef</span> <span class="keyword">enum</span> EjsOpCode {
<a name="l00225"></a>00225     EJS_OP_ADD,
<a name="l00226"></a>00226     EJS_OP_ADD_NAMESPACE,
<a name="l00227"></a>00227     EJS_OP_ADD_NAMESPACE_REF,
<a name="l00228"></a>00228     EJS_OP_AND,
<a name="l00229"></a>00229     EJS_OP_ATTENTION,
<a name="l00230"></a>00230     EJS_OP_BRANCH_EQ,
<a name="l00231"></a>00231     EJS_OP_BRANCH_STRICTLY_EQ,
<a name="l00232"></a>00232     EJS_OP_BRANCH_FALSE,
<a name="l00233"></a>00233     EJS_OP_BRANCH_GE,
<a name="l00234"></a>00234     EJS_OP_BRANCH_GT,
<a name="l00235"></a>00235     EJS_OP_BRANCH_LE,
<a name="l00236"></a>00236     EJS_OP_BRANCH_LT,
<a name="l00237"></a>00237     EJS_OP_BRANCH_NE,
<a name="l00238"></a>00238     EJS_OP_BRANCH_STRICTLY_NE,
<a name="l00239"></a>00239     EJS_OP_BRANCH_NULL,
<a name="l00240"></a>00240     EJS_OP_BRANCH_NOT_ZERO,
<a name="l00241"></a>00241     EJS_OP_BRANCH_TRUE,
<a name="l00242"></a>00242     EJS_OP_BRANCH_UNDEFINED,
<a name="l00243"></a>00243     EJS_OP_BRANCH_ZERO,
<a name="l00244"></a>00244     EJS_OP_BRANCH_FALSE_8,
<a name="l00245"></a>00245     EJS_OP_BRANCH_TRUE_8,
<a name="l00246"></a>00246     EJS_OP_BREAKPOINT,
<a name="l00247"></a>00247     EJS_OP_CALL,
<a name="l00248"></a>00248     EJS_OP_CALL_GLOBAL_SLOT,
<a name="l00249"></a>00249     EJS_OP_CALL_OBJ_SLOT,
<a name="l00250"></a>00250     EJS_OP_CALL_THIS_SLOT,
<a name="l00251"></a>00251     EJS_OP_CALL_BLOCK_SLOT,
<a name="l00252"></a>00252     EJS_OP_CALL_OBJ_INSTANCE_SLOT,
<a name="l00253"></a>00253     EJS_OP_CALL_OBJ_STATIC_SLOT,
<a name="l00254"></a>00254     EJS_OP_CALL_THIS_STATIC_SLOT,
<a name="l00255"></a>00255     EJS_OP_CALL_OBJ_NAME,
<a name="l00256"></a>00256     EJS_OP_CALL_SCOPED_NAME,
<a name="l00257"></a>00257     EJS_OP_CALL_CONSTRUCTOR,
<a name="l00258"></a>00258     EJS_OP_CALL_NEXT_CONSTRUCTOR,
<a name="l00259"></a>00259     EJS_OP_CAST,
<a name="l00260"></a>00260     EJS_OP_CAST_BOOLEAN,
<a name="l00261"></a>00261     EJS_OP_CLOSE_BLOCK,
<a name="l00262"></a>00262     EJS_OP_COMPARE_EQ,
<a name="l00263"></a>00263     EJS_OP_COMPARE_STRICTLY_EQ,
<a name="l00264"></a>00264     EJS_OP_COMPARE_FALSE,
<a name="l00265"></a>00265     EJS_OP_COMPARE_GE,
<a name="l00266"></a>00266     EJS_OP_COMPARE_GT,
<a name="l00267"></a>00267     EJS_OP_COMPARE_LE,
<a name="l00268"></a>00268     EJS_OP_COMPARE_LT,
<a name="l00269"></a>00269     EJS_OP_COMPARE_NE,
<a name="l00270"></a>00270     EJS_OP_COMPARE_STRICTLY_NE,
<a name="l00271"></a>00271     EJS_OP_COMPARE_NULL,
<a name="l00272"></a>00272     EJS_OP_COMPARE_NOT_ZERO,
<a name="l00273"></a>00273     EJS_OP_COMPARE_TRUE,
<a name="l00274"></a>00274     EJS_OP_COMPARE_UNDEFINED,
<a name="l00275"></a>00275     EJS_OP_COMPARE_ZERO,
<a name="l00276"></a>00276     EJS_OP_DEBUG,
<a name="l00277"></a>00277     EJS_OP_DEFINE_CLASS,
<a name="l00278"></a>00278     EJS_OP_DEFINE_FUNCTION,
<a name="l00279"></a>00279     EJS_OP_DELETE_NAME_EXPR,
<a name="l00280"></a>00280     EJS_OP_DELETE_SCOPED_NAME_EXPR,
<a name="l00281"></a>00281     EJS_OP_DIV,
<a name="l00282"></a>00282     EJS_OP_DUP,
<a name="l00283"></a>00283     EJS_OP_DUP2,
<a name="l00284"></a>00284     EJS_OP_DUP_STACK,
<a name="l00285"></a>00285     EJS_OP_END_CODE,
<a name="l00286"></a>00286     EJS_OP_END_EXCEPTION,
<a name="l00287"></a>00287     EJS_OP_GOTO,
<a name="l00288"></a>00288     EJS_OP_GOTO_8,
<a name="l00289"></a>00289     EJS_OP_INC,
<a name="l00290"></a>00290     EJS_OP_INIT_DEFAULT_ARGS,
<a name="l00291"></a>00291     EJS_OP_INIT_DEFAULT_ARGS_8,
<a name="l00292"></a>00292     EJS_OP_INST_OF,
<a name="l00293"></a>00293     EJS_OP_IS_A,
<a name="l00294"></a>00294     EJS_OP_LOAD_0,
<a name="l00295"></a>00295     EJS_OP_LOAD_1,
<a name="l00296"></a>00296     EJS_OP_LOAD_2,
<a name="l00297"></a>00297     EJS_OP_LOAD_3,
<a name="l00298"></a>00298     EJS_OP_LOAD_4,
<a name="l00299"></a>00299     EJS_OP_LOAD_5,
<a name="l00300"></a>00300     EJS_OP_LOAD_6,
<a name="l00301"></a>00301     EJS_OP_LOAD_7,
<a name="l00302"></a>00302     EJS_OP_LOAD_8,
<a name="l00303"></a>00303     EJS_OP_LOAD_9,
<a name="l00304"></a>00304     EJS_OP_LOAD_DOUBLE,
<a name="l00305"></a>00305     EJS_OP_LOAD_FALSE,
<a name="l00306"></a>00306     EJS_OP_LOAD_GLOBAL,
<a name="l00307"></a>00307     EJS_OP_LOAD_INT,
<a name="l00308"></a>00308     EJS_OP_LOAD_M1,
<a name="l00309"></a>00309     EJS_OP_LOAD_NAMESPACE,
<a name="l00310"></a>00310     EJS_OP_LOAD_NULL,
<a name="l00311"></a>00311     EJS_OP_LOAD_REGEXP,
<a name="l00312"></a>00312     EJS_OP_LOAD_STRING,
<a name="l00313"></a>00313     EJS_OP_LOAD_THIS,
<a name="l00314"></a>00314     EJS_OP_LOAD_THIS_BASE,
<a name="l00315"></a>00315     EJS_OP_LOAD_TRUE,
<a name="l00316"></a>00316     EJS_OP_LOAD_UNDEFINED,
<a name="l00317"></a>00317     EJS_OP_LOAD_XML,
<a name="l00318"></a>00318     EJS_OP_GET_LOCAL_SLOT_0,
<a name="l00319"></a>00319     EJS_OP_GET_LOCAL_SLOT_1,
<a name="l00320"></a>00320     EJS_OP_GET_LOCAL_SLOT_2,
<a name="l00321"></a>00321     EJS_OP_GET_LOCAL_SLOT_3,
<a name="l00322"></a>00322     EJS_OP_GET_LOCAL_SLOT_4,
<a name="l00323"></a>00323     EJS_OP_GET_LOCAL_SLOT_5,
<a name="l00324"></a>00324     EJS_OP_GET_LOCAL_SLOT_6,
<a name="l00325"></a>00325     EJS_OP_GET_LOCAL_SLOT_7,
<a name="l00326"></a>00326     EJS_OP_GET_LOCAL_SLOT_8,
<a name="l00327"></a>00327     EJS_OP_GET_LOCAL_SLOT_9,
<a name="l00328"></a>00328     EJS_OP_GET_OBJ_SLOT_0,
<a name="l00329"></a>00329     EJS_OP_GET_OBJ_SLOT_1,
<a name="l00330"></a>00330     EJS_OP_GET_OBJ_SLOT_2,
<a name="l00331"></a>00331     EJS_OP_GET_OBJ_SLOT_3,
<a name="l00332"></a>00332     EJS_OP_GET_OBJ_SLOT_4,
<a name="l00333"></a>00333     EJS_OP_GET_OBJ_SLOT_5,
<a name="l00334"></a>00334     EJS_OP_GET_OBJ_SLOT_6,
<a name="l00335"></a>00335     EJS_OP_GET_OBJ_SLOT_7,
<a name="l00336"></a>00336     EJS_OP_GET_OBJ_SLOT_8,
<a name="l00337"></a>00337     EJS_OP_GET_OBJ_SLOT_9,
<a name="l00338"></a>00338     EJS_OP_GET_THIS_SLOT_0,
<a name="l00339"></a>00339     EJS_OP_GET_THIS_SLOT_1,
<a name="l00340"></a>00340     EJS_OP_GET_THIS_SLOT_2,
<a name="l00341"></a>00341     EJS_OP_GET_THIS_SLOT_3,
<a name="l00342"></a>00342     EJS_OP_GET_THIS_SLOT_4,
<a name="l00343"></a>00343     EJS_OP_GET_THIS_SLOT_5,
<a name="l00344"></a>00344     EJS_OP_GET_THIS_SLOT_6,
<a name="l00345"></a>00345     EJS_OP_GET_THIS_SLOT_7,
<a name="l00346"></a>00346     EJS_OP_GET_THIS_SLOT_8,
<a name="l00347"></a>00347     EJS_OP_GET_THIS_SLOT_9,
<a name="l00348"></a>00348     EJS_OP_GET_SCOPED_NAME,
<a name="l00349"></a>00349     EJS_OP_GET_SCOPED_NAME_EXPR,
<a name="l00350"></a>00350     EJS_OP_GET_OBJ_NAME,
<a name="l00351"></a>00351     EJS_OP_GET_OBJ_NAME_EXPR,
<a name="l00352"></a>00352     EJS_OP_GET_BLOCK_SLOT,
<a name="l00353"></a>00353     EJS_OP_GET_GLOBAL_SLOT,
<a name="l00354"></a>00354     EJS_OP_GET_LOCAL_SLOT,
<a name="l00355"></a>00355     EJS_OP_GET_OBJ_SLOT,
<a name="l00356"></a>00356     EJS_OP_GET_THIS_SLOT,
<a name="l00357"></a>00357     EJS_OP_GET_TYPE_SLOT,
<a name="l00358"></a>00358     EJS_OP_GET_THIS_TYPE_SLOT,
<a name="l00359"></a>00359     EJS_OP_IN,
<a name="l00360"></a>00360     EJS_OP_LIKE,
<a name="l00361"></a>00361     EJS_OP_LOGICAL_NOT,
<a name="l00362"></a>00362     EJS_OP_MUL,
<a name="l00363"></a>00363     EJS_OP_NEG,
<a name="l00364"></a>00364     EJS_OP_NEW,
<a name="l00365"></a>00365     EJS_OP_NEW_ARRAY,
<a name="l00366"></a>00366     EJS_OP_NEW_OBJECT,
<a name="l00367"></a>00367     EJS_OP_NOP,
<a name="l00368"></a>00368     EJS_OP_NOT,
<a name="l00369"></a>00369     EJS_OP_OPEN_BLOCK,
<a name="l00370"></a>00370     EJS_OP_OPEN_WITH,
<a name="l00371"></a>00371     EJS_OP_OR,
<a name="l00372"></a>00372     EJS_OP_POP,
<a name="l00373"></a>00373     EJS_OP_POP_ITEMS,
<a name="l00374"></a>00374     EJS_OP_PUSH_CATCH_ARG,
<a name="l00375"></a>00375     EJS_OP_PUSH_RESULT,
<a name="l00376"></a>00376     EJS_OP_PUT_LOCAL_SLOT_0,
<a name="l00377"></a>00377     EJS_OP_PUT_LOCAL_SLOT_1,
<a name="l00378"></a>00378     EJS_OP_PUT_LOCAL_SLOT_2,
<a name="l00379"></a>00379     EJS_OP_PUT_LOCAL_SLOT_3,
<a name="l00380"></a>00380     EJS_OP_PUT_LOCAL_SLOT_4,
<a name="l00381"></a>00381     EJS_OP_PUT_LOCAL_SLOT_5,
<a name="l00382"></a>00382     EJS_OP_PUT_LOCAL_SLOT_6,
<a name="l00383"></a>00383     EJS_OP_PUT_LOCAL_SLOT_7,
<a name="l00384"></a>00384     EJS_OP_PUT_LOCAL_SLOT_8,
<a name="l00385"></a>00385     EJS_OP_PUT_LOCAL_SLOT_9,
<a name="l00386"></a>00386     EJS_OP_PUT_OBJ_SLOT_0,
<a name="l00387"></a>00387     EJS_OP_PUT_OBJ_SLOT_1,
<a name="l00388"></a>00388     EJS_OP_PUT_OBJ_SLOT_2,
<a name="l00389"></a>00389     EJS_OP_PUT_OBJ_SLOT_3,
<a name="l00390"></a>00390     EJS_OP_PUT_OBJ_SLOT_4,
<a name="l00391"></a>00391     EJS_OP_PUT_OBJ_SLOT_5,
<a name="l00392"></a>00392     EJS_OP_PUT_OBJ_SLOT_6,
<a name="l00393"></a>00393     EJS_OP_PUT_OBJ_SLOT_7,
<a name="l00394"></a>00394     EJS_OP_PUT_OBJ_SLOT_8,
<a name="l00395"></a>00395     EJS_OP_PUT_OBJ_SLOT_9,
<a name="l00396"></a>00396     EJS_OP_PUT_THIS_SLOT_0,
<a name="l00397"></a>00397     EJS_OP_PUT_THIS_SLOT_1,
<a name="l00398"></a>00398     EJS_OP_PUT_THIS_SLOT_2,
<a name="l00399"></a>00399     EJS_OP_PUT_THIS_SLOT_3,
<a name="l00400"></a>00400     EJS_OP_PUT_THIS_SLOT_4,
<a name="l00401"></a>00401     EJS_OP_PUT_THIS_SLOT_5,
<a name="l00402"></a>00402     EJS_OP_PUT_THIS_SLOT_6,
<a name="l00403"></a>00403     EJS_OP_PUT_THIS_SLOT_7,
<a name="l00404"></a>00404     EJS_OP_PUT_THIS_SLOT_8,
<a name="l00405"></a>00405     EJS_OP_PUT_THIS_SLOT_9,
<a name="l00406"></a>00406     EJS_OP_PUT_OBJ_NAME_EXPR,
<a name="l00407"></a>00407     EJS_OP_PUT_OBJ_NAME,
<a name="l00408"></a>00408     EJS_OP_PUT_SCOPED_NAME,
<a name="l00409"></a>00409     EJS_OP_PUT_SCOPED_NAME_EXPR,
<a name="l00410"></a>00410     EJS_OP_PUT_BLOCK_SLOT,
<a name="l00411"></a>00411     EJS_OP_PUT_GLOBAL_SLOT,
<a name="l00412"></a>00412     EJS_OP_PUT_LOCAL_SLOT,
<a name="l00413"></a>00413     EJS_OP_PUT_OBJ_SLOT,
<a name="l00414"></a>00414     EJS_OP_PUT_THIS_SLOT,
<a name="l00415"></a>00415     EJS_OP_PUT_TYPE_SLOT,
<a name="l00416"></a>00416     EJS_OP_PUT_THIS_TYPE_SLOT,
<a name="l00417"></a>00417     EJS_OP_REM,
<a name="l00418"></a>00418     EJS_OP_RETURN,
<a name="l00419"></a>00419     EJS_OP_RETURN_VALUE,
<a name="l00420"></a>00420     EJS_OP_SAVE_RESULT,
<a name="l00421"></a>00421     EJS_OP_SHL,
<a name="l00422"></a>00422     EJS_OP_SHR,
<a name="l00423"></a>00423     EJS_OP_SPREAD,
<a name="l00424"></a>00424     EJS_OP_SUB,
<a name="l00425"></a>00425     EJS_OP_SUPER,
<a name="l00426"></a>00426     EJS_OP_SWAP,
<a name="l00427"></a>00427     EJS_OP_THROW,
<a name="l00428"></a>00428     EJS_OP_TYPE_OF,
<a name="l00429"></a>00429     EJS_OP_USHR,
<a name="l00430"></a>00430     EJS_OP_XOR,
<a name="l00431"></a>00431     EJS_OP_FINALLY,
<a name="l00432"></a>00432 } EjsOpCode;
<a name="l00433"></a>00433 
<a name="l00434"></a>00434 <span class="preprocessor">#endif</span>
<a name="l00435"></a>00435 <span class="preprocessor"></span>
<a name="l00436"></a>00436 <span class="comment">/*</span>
<a name="l00437"></a>00437 <span class="comment">    Copyright (c) Embedthis Software LLC, 2003-2010. All Rights Reserved.</span>
<a name="l00438"></a>00438 <span class="comment">    Copyright (c) Michael O'Brien, 1993-2010. All Rights Reserved.</span>
<a name="l00439"></a>00439 <span class="comment">  </span>
<a name="l00440"></a>00440 <span class="comment">    This software is distributed under commercial and open source licenses.</span>
<a name="l00441"></a>00441 <span class="comment">    You may use the GPL open source license described below or you may acquire</span>
<a name="l00442"></a>00442 <span class="comment">    a commercial license from Embedthis Software. You agree to be fully bound</span>
<a name="l00443"></a>00443 <span class="comment">    by the terms of either license. Consult the LICENSE.TXT distributed with</span>
<a name="l00444"></a>00444 <span class="comment">    this software for full details.</span>
<a name="l00445"></a>00445 <span class="comment">  </span>
<a name="l00446"></a>00446 <span class="comment">    This software is open source; you can redistribute it and/or modify it</span>
<a name="l00447"></a>00447 <span class="comment">    under the terms of the GNU General Public License as published by the</span>
<a name="l00448"></a>00448 <span class="comment">    Free Software Foundation; either version 2 of the License, or (at your</span>
<a name="l00449"></a>00449 <span class="comment">    option) any later version. See the GNU General Public License for more</span>
<a name="l00450"></a>00450 <span class="comment">    details at: http://www.embedthis.com/downloads/gplLicense.html</span>
<a name="l00451"></a>00451 <span class="comment">  </span>
<a name="l00452"></a>00452 <span class="comment">    This program is distributed WITHOUT ANY WARRANTY; without even the</span>
<a name="l00453"></a>00453 <span class="comment">    implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<a name="l00454"></a>00454 <span class="comment">  </span>
<a name="l00455"></a>00455 <span class="comment">    This GPL license does NOT permit incorporating this software into</span>
<a name="l00456"></a>00456 <span class="comment">    proprietary programs. If you are unable to comply with the GPL, you must</span>
<a name="l00457"></a>00457 <span class="comment">    acquire a commercial license to use this software. Commercial licenses</span>
<a name="l00458"></a>00458 <span class="comment">    for this software and support services are available from Embedthis</span>
<a name="l00459"></a>00459 <span class="comment">    Software at http://www.embedthis.com</span>
<a name="l00460"></a>00460 <span class="comment"> */</span>
<a name="l00461"></a>00461 <span class="comment">/************************************************************************/</span>
<a name="l00462"></a>00462 <span class="comment">/*</span>
<a name="l00463"></a>00463 <span class="comment"> *  End of file "../../src/include/ejsByteCode.h"</span>
<a name="l00464"></a>00464 <span class="comment"> */</span>
<a name="l00465"></a>00465 <span class="comment">/************************************************************************/</span>
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 
<a name="l00469"></a>00469 <span class="comment">/************************************************************************/</span>
<a name="l00470"></a>00470 <span class="comment">/*</span>
<a name="l00471"></a>00471 <span class="comment"> *  Start of file "../../src/include/ejsByteCodeTable.h"</span>
<a name="l00472"></a>00472 <span class="comment"> */</span>
<a name="l00473"></a>00473 <span class="comment">/************************************************************************/</span>
<a name="l00474"></a>00474 <span class="comment"></span>
<a name="l00475"></a>00475 <span class="comment">/**</span>
<a name="l00476"></a>00476 <span class="comment">    ejsByteCodeTable.h - Master Byte Code Table</span>
<a name="l00477"></a>00477 <span class="comment">  </span>
<a name="l00478"></a>00478 <span class="comment">    Copyright (c) All Rights Reserved. See details at the end of the file.</span>
<a name="l00479"></a>00479 <span class="comment"> */</span>
<a name="l00480"></a>00480 
<a name="l00481"></a>00481 <span class="preprocessor">#ifndef _h_EJS_BYTECODETABLE_H</span>
<a name="l00482"></a>00482 <span class="preprocessor"></span><span class="preprocessor">#define _h_EJS_BYTECODETABLE_H 1</span>
<a name="l00483"></a>00483 <span class="preprocessor"></span>
<a name="l00484"></a>00484 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00485"></a>00485 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
<a name="l00486"></a>00486 <span class="preprocessor">#endif</span>
<a name="l00487"></a>00487 <span class="preprocessor"></span>
<a name="l00488"></a>00488 <span class="comment">/*</span>
<a name="l00489"></a>00489 <span class="comment">    Stack effect special values</span>
<a name="l00490"></a>00490 <span class="comment"> */</span>
<a name="l00491"></a>00491 <span class="preprocessor">#define EBC_POPN            101             </span><span class="comment">/* Operand 1 specifies the stack change (pop) */</span>
<a name="l00492"></a>00492 
<a name="l00493"></a>00493 <span class="comment">/*</span>
<a name="l00494"></a>00494 <span class="comment">    Operands</span>
<a name="l00495"></a>00495 <span class="comment"> */</span>
<a name="l00496"></a>00496 <span class="preprocessor">#define EBC_NONE            0x0             </span><span class="comment">/* No operands */</span>
<a name="l00497"></a>00497 <span class="preprocessor">#define EBC_BYTE            0x1             </span><span class="comment">/* 8 bit integer */</span>
<a name="l00498"></a>00498 <span class="preprocessor">#define EBC_DOUBLE          0x10            </span><span class="comment">/* 64 bit floating */</span>
<a name="l00499"></a>00499 <span class="preprocessor">#define EBC_NUM             0x40            </span><span class="comment">/* Encoded integer */</span>
<a name="l00500"></a>00500 <span class="preprocessor">#define EBC_STRING          0x80            </span><span class="comment">/* Interned string as an encoded integer*/</span>
<a name="l00501"></a>00501 <span class="preprocessor">#define EBC_GLOBAL          0x100           </span><span class="comment">/* Encode global */</span>
<a name="l00502"></a>00502 <span class="preprocessor">#define EBC_SLOT            0x200           </span><span class="comment">/* Slot number as an encoded integer */</span>
<a name="l00503"></a>00503 <span class="preprocessor">#define EBC_JMP             0x1000          </span><span class="comment">/* 32 bit jump offset */</span>
<a name="l00504"></a>00504 <span class="preprocessor">#define EBC_JMP8            0x2000          </span><span class="comment">/* 8 bit jump offset */</span>
<a name="l00505"></a>00505 <span class="preprocessor">#define EBC_INIT_DEFAULT    0x8000          </span><span class="comment">/* Computed goto table, 32 bit jumps  */</span>
<a name="l00506"></a>00506 <span class="preprocessor">#define EBC_INIT_DEFAULT8   0x10000         </span><span class="comment">/* Computed goto table, 8 bit jumps */</span>
<a name="l00507"></a>00507 <span class="preprocessor">#define EBC_ARGC            0x20000         </span><span class="comment">/* Argument count */</span>
<a name="l00508"></a>00508 <span class="preprocessor">#define EBC_ARGC2           0x40000         </span><span class="comment">/* Argument count * 2 */</span>
<a name="l00509"></a>00509 <span class="preprocessor">#define EBC_ARGC3           0x80000         </span><span class="comment">/* Argument count * 3 */</span>
<a name="l00510"></a>00510 <span class="preprocessor">#define EBC_NEW_ARRAY       0x100000        </span><span class="comment">/* New Array: Argument count * 2, byte code */</span>
<a name="l00511"></a>00511 <span class="preprocessor">#define EBC_NEW_OBJECT      0x200000        </span><span class="comment">/* New Object: Argument count * 3, byte code: attributes * 3 */</span>
<a name="l00512"></a>00512 
<a name="l00513"></a>00513 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsOptable {
<a name="l00514"></a>00514     <span class="keywordtype">char</span>    *name;
<a name="l00515"></a>00515     <span class="keywordtype">int</span>     stackEffect;
<a name="l00516"></a>00516     <span class="keywordtype">int</span>     args[8];
<a name="l00517"></a>00517 } EjsOptable;
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 <span class="preprocessor">#if EJS_DEFINE_OPTABLE</span>
<a name="l00520"></a>00520 <span class="preprocessor"></span><span class="comment">/*  </span>
<a name="l00521"></a>00521 <span class="comment">        Opcode string         Stack Effect      Operands, ...                                   </span>
<a name="l00522"></a>00522 <span class="comment"> */</span>      
<a name="l00523"></a>00523 EjsOptable ejsOptable[] = {
<a name="l00524"></a>00524     {   <span class="stringliteral">"ADD"</span>,                      -1,         { EBC_NONE,                               },},
<a name="l00525"></a>00525     {   <span class="stringliteral">"ADD_NAMESPACE"</span>,             0,         { EBC_STRING,                             },},
<a name="l00526"></a>00526     {   <span class="stringliteral">"ADD_NAMESPACE_REF"</span>,        -1,         { EBC_NONE,                               },},
<a name="l00527"></a>00527     {   <span class="stringliteral">"AND"</span>,                      -1,         { EBC_NONE,                               },},
<a name="l00528"></a>00528     {   <span class="stringliteral">"ATTENTION"</span>,                -1,         { EBC_NONE,                               },},
<a name="l00529"></a>00529     {   <span class="stringliteral">"BRANCH_EQ"</span>,                -1,         { EBC_JMP,                                },},
<a name="l00530"></a>00530     {   <span class="stringliteral">"BRANCH_STRICTLY_EQ"</span>,       -1,         { EBC_JMP,                                },},
<a name="l00531"></a>00531     {   <span class="stringliteral">"BRANCH_FALSE"</span>,             -1,         { EBC_JMP,                                },},
<a name="l00532"></a>00532     {   <span class="stringliteral">"BRANCH_GE"</span>,                -1,         { EBC_JMP,                                },},
<a name="l00533"></a>00533     {   <span class="stringliteral">"BRANCH_GT"</span>,                -1,         { EBC_JMP,                                },},
<a name="l00534"></a>00534     {   <span class="stringliteral">"BRANCH_LE"</span>,                -1,         { EBC_JMP,                                },},
<a name="l00535"></a>00535     {   <span class="stringliteral">"BRANCH_LT"</span>,                -1,         { EBC_JMP,                                },},
<a name="l00536"></a>00536     {   <span class="stringliteral">"BRANCH_NE"</span>,                -1,         { EBC_JMP,                                },},
<a name="l00537"></a>00537     {   <span class="stringliteral">"BRANCH_STRICTLY_NE"</span>,       -1,         { EBC_JMP,                                },},
<a name="l00538"></a>00538     {   <span class="stringliteral">"BRANCH_NULL"</span>,              -1,         { EBC_JMP,                                },},
<a name="l00539"></a>00539     {   <span class="stringliteral">"BRANCH_NOT_ZERO"</span>,          -1,         { EBC_JMP,                                },},
<a name="l00540"></a>00540     {   <span class="stringliteral">"BRANCH_TRUE"</span>,              -1,         { EBC_JMP,                                },},
<a name="l00541"></a>00541     {   <span class="stringliteral">"BRANCH_UNDEFINED"</span>,         -1,         { EBC_JMP,                                },},
<a name="l00542"></a>00542     {   <span class="stringliteral">"BRANCH_ZERO"</span>,              -1,         { EBC_JMP,                                },},
<a name="l00543"></a>00543     {   <span class="stringliteral">"BRANCH_FALSE_8"</span>,           -1,         { EBC_JMP8,                               },},
<a name="l00544"></a>00544     {   <span class="stringliteral">"BRANCH_TRUE_8"</span>,            -1,         { EBC_JMP8,                               },},
<a name="l00545"></a>00545     {   <span class="stringliteral">"BREAKPOINT"</span>,                0,         { EBC_NUM, EBC_STRING,                    },},
<a name="l00546"></a>00546     {   <span class="stringliteral">"CALL"</span>,                     -2,         { EBC_ARGC,                               },},
<a name="l00547"></a>00547     {   <span class="stringliteral">"CALL_GLOBAL_SLOT"</span>,          0,         { EBC_SLOT, EBC_ARGC,                     },},
<a name="l00548"></a>00548     {   <span class="stringliteral">"CALL_OBJ_SLOT"</span>,            -1,         { EBC_SLOT, EBC_ARGC,                     },},
<a name="l00549"></a>00549     {   <span class="stringliteral">"CALL_THIS_SLOT"</span>,            0,         { EBC_SLOT, EBC_ARGC,                     },},
<a name="l00550"></a>00550     {   <span class="stringliteral">"CALL_BLOCK_SLOT"</span>,           0,         { EBC_SLOT, EBC_NUM, EBC_ARGC,            },},
<a name="l00551"></a>00551     {   <span class="stringliteral">"CALL_OBJ_INSTANCE_SLOT"</span>,   -1,         { EBC_SLOT, EBC_ARGC,                     },},
<a name="l00552"></a>00552     {   <span class="stringliteral">"CALL_OBJ_STATIC_SLOT"</span>,     -1,         { EBC_SLOT, EBC_NUM, EBC_ARGC,            },},
<a name="l00553"></a>00553     {   <span class="stringliteral">"CALL_THIS_STATIC_SLOT"</span>,     0,         { EBC_SLOT, EBC_NUM, EBC_ARGC,            },},
<a name="l00554"></a>00554     {   <span class="stringliteral">"CALL_OBJ_NAME"</span>,            -1,         { EBC_STRING, EBC_STRING, EBC_ARGC,       },},
<a name="l00555"></a>00555     {   <span class="stringliteral">"CALL_SCOPED_NAME"</span>,          0,         { EBC_STRING, EBC_STRING, EBC_ARGC,       },},
<a name="l00556"></a>00556     {   <span class="stringliteral">"CALL_CONSTRUCTOR"</span>,          0,         { EBC_ARGC,                               },},
<a name="l00557"></a>00557     {   <span class="stringliteral">"CALL_NEXT_CONSTRUCTOR"</span>,     0,         { EBC_STRING, EBC_STRING, EBC_ARGC,       },},
<a name="l00558"></a>00558     {   <span class="stringliteral">"CAST"</span>,                     -1,         { EBC_NONE,                               },},
<a name="l00559"></a>00559     {   <span class="stringliteral">"CAST_BOOLEAN"</span>,              0,         { EBC_NONE,                               },},
<a name="l00560"></a>00560     {   <span class="stringliteral">"CLOSE_BLOCK"</span>,               0,         { EBC_NONE,                               },},
<a name="l00561"></a>00561     {   <span class="stringliteral">"COMPARE_EQ"</span>,               -1,         { EBC_NONE,                               },},
<a name="l00562"></a>00562     {   <span class="stringliteral">"COMPARE_STRICTLY_EQ"</span>,      -1,         { EBC_NONE,                               },},
<a name="l00563"></a>00563     {   <span class="stringliteral">"COMPARE_FALSE"</span>,            -1,         { EBC_NONE,                               },},
<a name="l00564"></a>00564     {   <span class="stringliteral">"COMPARE_GE"</span>,               -1,         { EBC_NONE,                               },},
<a name="l00565"></a>00565     {   <span class="stringliteral">"COMPARE_GT"</span>,               -1,         { EBC_NONE,                               },},
<a name="l00566"></a>00566     {   <span class="stringliteral">"COMPARE_LE"</span>,               -1,         { EBC_NONE,                               },},
<a name="l00567"></a>00567     {   <span class="stringliteral">"COMPARE_LT"</span>,               -1,         { EBC_NONE,                               },},
<a name="l00568"></a>00568     {   <span class="stringliteral">"COMPARE_NE"</span>,               -1,         { EBC_NONE,                               },},
<a name="l00569"></a>00569     {   <span class="stringliteral">"COMPARE_STRICTLY_NE"</span>,      -1,         { EBC_NONE,                               },},
<a name="l00570"></a>00570     {   <span class="stringliteral">"COMPARE_NULL"</span>,             -1,         { EBC_NONE,                               },},
<a name="l00571"></a>00571     {   <span class="stringliteral">"COMPARE_NOT_ZERO"</span>,         -1,         { EBC_NONE,                               },},
<a name="l00572"></a>00572     {   <span class="stringliteral">"COMPARE_TRUE"</span>,             -1,         { EBC_NONE,                               },},
<a name="l00573"></a>00573     {   <span class="stringliteral">"COMPARE_UNDEFINED"</span>,        -1,         { EBC_NONE,                               },},
<a name="l00574"></a>00574     {   <span class="stringliteral">"COMPARE_ZERO"</span>,             -1,         { EBC_NONE,                               },},
<a name="l00575"></a>00575     {   <span class="stringliteral">"DEBUG"</span>,                     0,         { EBC_NUM, EBC_STRING,                    },},
<a name="l00576"></a>00576     {   <span class="stringliteral">"DEFINE_CLASS"</span>,              0,         { EBC_GLOBAL,                             },},
<a name="l00577"></a>00577     {   <span class="stringliteral">"DEFINE_FUNCTION"</span>,           0,         { EBC_STRING, EBC_STRING,                 },},
<a name="l00578"></a>00578     {   <span class="stringliteral">"DELETE_NAME_EXPR"</span>,         -2,         { EBC_NONE,                               },},
<a name="l00579"></a>00579     {   <span class="stringliteral">"DELETE_SCOPED_NAME_EXPR"</span>,  -1,         { EBC_NONE,                               },},
<a name="l00580"></a>00580     {   <span class="stringliteral">"DIV"</span>,                      -1,         { EBC_NONE,                               },},
<a name="l00581"></a>00581     {   <span class="stringliteral">"DUP"</span>,                       1,         { EBC_NONE,                               },},
<a name="l00582"></a>00582     {   <span class="stringliteral">"DUP2"</span>,                      2,         { EBC_NONE,                               },},
<a name="l00583"></a>00583     {   <span class="stringliteral">"DUP_STACK"</span>,                 1,         { EBC_BYTE,                               },},
<a name="l00584"></a>00584     {   <span class="stringliteral">"END_CODE"</span>,                  0,         { EBC_NONE,                               },},
<a name="l00585"></a>00585     {   <span class="stringliteral">"END_EXCEPTION"</span>,             0,         { EBC_NONE,                               },},
<a name="l00586"></a>00586     {   <span class="stringliteral">"GOTO"</span>,                      0,         { EBC_JMP,                                },},
<a name="l00587"></a>00587     {   <span class="stringliteral">"GOTO_8"</span>,                    0,         { EBC_JMP8,                               },},
<a name="l00588"></a>00588     {   <span class="stringliteral">"INC"</span>,                       0,         { EBC_BYTE,                               },},
<a name="l00589"></a>00589     {   <span class="stringliteral">"INIT_DEFAULT_ARGS"</span>,         0,         { EBC_INIT_DEFAULT,                       },},
<a name="l00590"></a>00590     {   <span class="stringliteral">"INIT_DEFAULT_ARGS_8"</span>,       0,         { EBC_INIT_DEFAULT8,                      },},
<a name="l00591"></a>00591     {   <span class="stringliteral">"INST_OF"</span>,                  -1,         { EBC_NONE,                               },},
<a name="l00592"></a>00592     {   <span class="stringliteral">"IS_A"</span>,                     -1,         { EBC_NONE,                               },},
<a name="l00593"></a>00593     {   <span class="stringliteral">"LOAD_0"</span>,                    1,         { EBC_NONE,                               },},
<a name="l00594"></a>00594     {   <span class="stringliteral">"LOAD_1"</span>,                    1,         { EBC_NONE,                               },},
<a name="l00595"></a>00595     {   <span class="stringliteral">"LOAD_2"</span>,                    1,         { EBC_NONE,                               },},
<a name="l00596"></a>00596     {   <span class="stringliteral">"LOAD_3"</span>,                    1,         { EBC_NONE,                               },},
<a name="l00597"></a>00597     {   <span class="stringliteral">"LOAD_4"</span>,                    1,         { EBC_NONE,                               },},
<a name="l00598"></a>00598     {   <span class="stringliteral">"LOAD_5"</span>,                    1,         { EBC_NONE,                               },},
<a name="l00599"></a>00599     {   <span class="stringliteral">"LOAD_6"</span>,                    1,         { EBC_NONE,                               },},
<a name="l00600"></a>00600     {   <span class="stringliteral">"LOAD_7"</span>,                    1,         { EBC_NONE,                               },},
<a name="l00601"></a>00601     {   <span class="stringliteral">"LOAD_8"</span>,                    1,         { EBC_NONE,                               },},
<a name="l00602"></a>00602     {   <span class="stringliteral">"LOAD_9"</span>,                    1,         { EBC_NONE,                               },},
<a name="l00603"></a>00603     {   <span class="stringliteral">"LOAD_DOUBLE"</span>,               1,         { EBC_DOUBLE,                             },},
<a name="l00604"></a>00604     {   <span class="stringliteral">"LOAD_FALSE"</span>,                1,         { EBC_NONE,                               },},
<a name="l00605"></a>00605     {   <span class="stringliteral">"LOAD_GLOBAL"</span>,               1,         { EBC_NONE,                               },},
<a name="l00606"></a>00606     {   <span class="stringliteral">"LOAD_INT"</span>,                  1,         { EBC_NUM,                                },},
<a name="l00607"></a>00607     {   <span class="stringliteral">"LOAD_M1"</span>,                   1,         { EBC_NONE,                               },},
<a name="l00608"></a>00608     {   <span class="stringliteral">"LOAD_NAMESPACE"</span>,            1,         { EBC_STRING,                             },},
<a name="l00609"></a>00609     {   <span class="stringliteral">"LOAD_NULL"</span>,                 1,         { EBC_NONE,                               },},
<a name="l00610"></a>00610     {   <span class="stringliteral">"LOAD_REGEXP"</span>,               1,         { EBC_STRING,                             },},
<a name="l00611"></a>00611     {   <span class="stringliteral">"LOAD_STRING"</span>,               1,         { EBC_STRING,                             },},
<a name="l00612"></a>00612     {   <span class="stringliteral">"LOAD_THIS"</span>,                 1,         { EBC_NONE,                               },},
<a name="l00613"></a>00613     {   <span class="stringliteral">"LOAD_THIS_BASE"</span>,            1,         { EBC_NUM,                                },},
<a name="l00614"></a>00614     {   <span class="stringliteral">"LOAD_TRUE"</span>,                 1,         { EBC_NONE,                               },},
<a name="l00615"></a>00615     {   <span class="stringliteral">"LOAD_UNDEFINED"</span>,            1,         { EBC_NONE,                               },},
<a name="l00616"></a>00616     {   <span class="stringliteral">"LOAD_XML"</span>,                  1,         { EBC_STRING,                             },},
<a name="l00617"></a>00617     {   <span class="stringliteral">"GET_LOCAL_SLOT_0"</span>,          1,         { EBC_NONE,                               },},
<a name="l00618"></a>00618     {   <span class="stringliteral">"GET_LOCAL_SLOT_1"</span>,          1,         { EBC_NONE,                               },},
<a name="l00619"></a>00619     {   <span class="stringliteral">"GET_LOCAL_SLOT_2"</span>,          1,         { EBC_NONE,                               },},
<a name="l00620"></a>00620     {   <span class="stringliteral">"GET_LOCAL_SLOT_3"</span>,          1,         { EBC_NONE,                               },},
<a name="l00621"></a>00621     {   <span class="stringliteral">"GET_LOCAL_SLOT_4"</span>,          1,         { EBC_NONE,                               },},
<a name="l00622"></a>00622     {   <span class="stringliteral">"GET_LOCAL_SLOT_5"</span>,          1,         { EBC_NONE,                               },},
<a name="l00623"></a>00623     {   <span class="stringliteral">"GET_LOCAL_SLOT_6"</span>,          1,         { EBC_NONE,                               },},
<a name="l00624"></a>00624     {   <span class="stringliteral">"GET_LOCAL_SLOT_7"</span>,          1,         { EBC_NONE,                               },},
<a name="l00625"></a>00625     {   <span class="stringliteral">"GET_LOCAL_SLOT_8"</span>,          1,         { EBC_NONE,                               },},
<a name="l00626"></a>00626     {   <span class="stringliteral">"GET_LOCAL_SLOT_9"</span>,          1,         { EBC_NONE,                               },},
<a name="l00627"></a>00627     {   <span class="stringliteral">"GET_OBJ_SLOT_0"</span>,            0,         { EBC_NONE,                               },},
<a name="l00628"></a>00628     {   <span class="stringliteral">"GET_OBJ_SLOT_1"</span>,            0,         { EBC_NONE,                               },},
<a name="l00629"></a>00629     {   <span class="stringliteral">"GET_OBJ_SLOT_2"</span>,            0,         { EBC_NONE,                               },},
<a name="l00630"></a>00630     {   <span class="stringliteral">"GET_OBJ_SLOT_3"</span>,            0,         { EBC_NONE,                               },},
<a name="l00631"></a>00631     {   <span class="stringliteral">"GET_OBJ_SLOT_4"</span>,            0,         { EBC_NONE,                               },},
<a name="l00632"></a>00632     {   <span class="stringliteral">"GET_OBJ_SLOT_5"</span>,            0,         { EBC_NONE,                               },},
<a name="l00633"></a>00633     {   <span class="stringliteral">"GET_OBJ_SLOT_6"</span>,            0,         { EBC_NONE,                               },},
<a name="l00634"></a>00634     {   <span class="stringliteral">"GET_OBJ_SLOT_7"</span>,            0,         { EBC_NONE,                               },},
<a name="l00635"></a>00635     {   <span class="stringliteral">"GET_OBJ_SLOT_8"</span>,            0,         { EBC_NONE,                               },},
<a name="l00636"></a>00636     {   <span class="stringliteral">"GET_OBJ_SLOT_9"</span>,            0,         { EBC_NONE,                               },},
<a name="l00637"></a>00637     {   <span class="stringliteral">"GET_THIS_SLOT_0"</span>,           1,         { EBC_NONE,                               },},
<a name="l00638"></a>00638     {   <span class="stringliteral">"GET_THIS_SLOT_1"</span>,           1,         { EBC_NONE,                               },},
<a name="l00639"></a>00639     {   <span class="stringliteral">"GET_THIS_SLOT_2"</span>,           1,         { EBC_NONE,                               },},
<a name="l00640"></a>00640     {   <span class="stringliteral">"GET_THIS_SLOT_3"</span>,           1,         { EBC_NONE,                               },},
<a name="l00641"></a>00641     {   <span class="stringliteral">"GET_THIS_SLOT_4"</span>,           1,         { EBC_NONE,                               },},
<a name="l00642"></a>00642     {   <span class="stringliteral">"GET_THIS_SLOT_5"</span>,           1,         { EBC_NONE,                               },},
<a name="l00643"></a>00643     {   <span class="stringliteral">"GET_THIS_SLOT_6"</span>,           1,         { EBC_NONE,                               },},
<a name="l00644"></a>00644     {   <span class="stringliteral">"GET_THIS_SLOT_7"</span>,           1,         { EBC_NONE,                               },},
<a name="l00645"></a>00645     {   <span class="stringliteral">"GET_THIS_SLOT_8"</span>,           1,         { EBC_NONE,                               },},
<a name="l00646"></a>00646     {   <span class="stringliteral">"GET_THIS_SLOT_9"</span>,           1,         { EBC_NONE,                               },},
<a name="l00647"></a>00647     {   <span class="stringliteral">"GET_SCOPED_NAME"</span>,           1,         { EBC_STRING, EBC_STRING,                 },},
<a name="l00648"></a>00648     {   <span class="stringliteral">"GET_SCOPED_NAME_EXPR"</span>,      -1,        { EBC_NONE,                               },},
<a name="l00649"></a>00649     {   <span class="stringliteral">"GET_OBJ_NAME"</span>,              0,         { EBC_STRING, EBC_STRING,                 },},
<a name="l00650"></a>00650     {   <span class="stringliteral">"GET_OBJ_NAME_EXPR"</span>,        -2,         { EBC_NONE,                               },},
<a name="l00651"></a>00651     {   <span class="stringliteral">"GET_BLOCK_SLOT"</span>,            1,         { EBC_SLOT, EBC_NUM,                      },},
<a name="l00652"></a>00652     {   <span class="stringliteral">"GET_GLOBAL_SLOT"</span>,           1,         { EBC_SLOT,                               },},
<a name="l00653"></a>00653     {   <span class="stringliteral">"GET_LOCAL_SLOT"</span>,            1,         { EBC_SLOT,                               },},
<a name="l00654"></a>00654     {   <span class="stringliteral">"GET_OBJ_SLOT"</span>,              0,         { EBC_SLOT,                               },},
<a name="l00655"></a>00655     {   <span class="stringliteral">"GET_THIS_SLOT"</span>,             1,         { EBC_SLOT,                               },},
<a name="l00656"></a>00656     {   <span class="stringliteral">"GET_TYPE_SLOT"</span>,             0,         { EBC_SLOT, EBC_NUM,                      },},
<a name="l00657"></a>00657     {   <span class="stringliteral">"GET_THIS_TYPE_SLOT"</span>,        1,         { EBC_SLOT, EBC_NUM,                      },},
<a name="l00658"></a>00658     {   <span class="stringliteral">"IN"</span>,                       -1,         { EBC_NONE,                               },},
<a name="l00659"></a>00659     {   <span class="stringliteral">"LIKE"</span>,                     -1,         { EBC_NONE,                               },},
<a name="l00660"></a>00660     {   <span class="stringliteral">"LOGICAL_NOT"</span>,               0,         { EBC_NONE,                               },},
<a name="l00661"></a>00661     {   <span class="stringliteral">"MUL"</span>,                      -1,         { EBC_NONE,                               },},
<a name="l00662"></a>00662     {   <span class="stringliteral">"NEG"</span>,                       0,         { EBC_NONE,                               },},
<a name="l00663"></a>00663     {   <span class="stringliteral">"NEW"</span>,                       0,         { EBC_NONE,                               },},
<a name="l00664"></a>00664     {   <span class="stringliteral">"NEW_ARRAY"</span>,                 1,         { EBC_GLOBAL, EBC_NEW_ARRAY,              },},
<a name="l00665"></a>00665     {   <span class="stringliteral">"NEW_OBJECT"</span>,                1,         { EBC_GLOBAL, EBC_NEW_OBJECT,             },},
<a name="l00666"></a>00666     {   <span class="stringliteral">"NOP"</span>,                       0,         { EBC_NONE,                               },},
<a name="l00667"></a>00667     {   <span class="stringliteral">"NOT"</span>,                       0,         { EBC_NONE,                               },},
<a name="l00668"></a>00668     {   <span class="stringliteral">"OPEN_BLOCK"</span>,                0,         { EBC_SLOT, EBC_NUM,                      },},
<a name="l00669"></a>00669     {   <span class="stringliteral">"OPEN_WITH"</span>,                 1,         { EBC_NONE,                               },},
<a name="l00670"></a>00670     {   <span class="stringliteral">"OR"</span>,                       -1,         { EBC_NONE,                               },},
<a name="l00671"></a>00671     {   <span class="stringliteral">"POP"</span>,                      -1,         { EBC_NONE,                               },},
<a name="l00672"></a>00672     {   <span class="stringliteral">"POP_ITEMS"</span>,          EBC_POPN,         { EBC_BYTE,                               },},
<a name="l00673"></a>00673     {   <span class="stringliteral">"PUSH_CATCH_ARG"</span>,            1,         { EBC_NONE,                               },},
<a name="l00674"></a>00674     {   <span class="stringliteral">"PUSH_RESULT"</span>,               1,         { EBC_NONE,                               },},
<a name="l00675"></a>00675     {   <span class="stringliteral">"PUT_LOCAL_SLOT_0"</span>,         -1,         { EBC_NONE,                               },},
<a name="l00676"></a>00676     {   <span class="stringliteral">"PUT_LOCAL_SLOT_1"</span>,         -1,         { EBC_NONE,                               },},
<a name="l00677"></a>00677     {   <span class="stringliteral">"PUT_LOCAL_SLOT_2"</span>,         -1,         { EBC_NONE,                               },},
<a name="l00678"></a>00678     {   <span class="stringliteral">"PUT_LOCAL_SLOT_3"</span>,         -1,         { EBC_NONE,                               },},
<a name="l00679"></a>00679     {   <span class="stringliteral">"PUT_LOCAL_SLOT_4"</span>,         -1,         { EBC_NONE,                               },},
<a name="l00680"></a>00680     {   <span class="stringliteral">"PUT_LOCAL_SLOT_5"</span>,         -1,         { EBC_NONE,                               },},
<a name="l00681"></a>00681     {   <span class="stringliteral">"PUT_LOCAL_SLOT_6"</span>,         -1,         { EBC_NONE,                               },},
<a name="l00682"></a>00682     {   <span class="stringliteral">"PUT_LOCAL_SLOT_7"</span>,         -1,         { EBC_NONE,                               },},
<a name="l00683"></a>00683     {   <span class="stringliteral">"PUT_LOCAL_SLOT_8"</span>,         -1,         { EBC_NONE,                               },},
<a name="l00684"></a>00684     {   <span class="stringliteral">"PUT_LOCAL_SLOT_9"</span>,         -1,         { EBC_NONE,                               },},
<a name="l00685"></a>00685     {   <span class="stringliteral">"PUT_OBJ_SLOT_0"</span>,           -2,         { EBC_NONE,                               },},
<a name="l00686"></a>00686     {   <span class="stringliteral">"PUT_OBJ_SLOT_1"</span>,           -2,         { EBC_NONE,                               },},
<a name="l00687"></a>00687     {   <span class="stringliteral">"PUT_OBJ_SLOT_2"</span>,           -2,         { EBC_NONE,                               },},
<a name="l00688"></a>00688     {   <span class="stringliteral">"PUT_OBJ_SLOT_3"</span>,           -2,         { EBC_NONE,                               },},
<a name="l00689"></a>00689     {   <span class="stringliteral">"PUT_OBJ_SLOT_4"</span>,           -2,         { EBC_NONE,                               },},
<a name="l00690"></a>00690     {   <span class="stringliteral">"PUT_OBJ_SLOT_5"</span>,           -2,         { EBC_NONE,                               },},
<a name="l00691"></a>00691     {   <span class="stringliteral">"PUT_OBJ_SLOT_6"</span>,           -2,         { EBC_NONE,                               },},
<a name="l00692"></a>00692     {   <span class="stringliteral">"PUT_OBJ_SLOT_7"</span>,           -2,         { EBC_NONE,                               },},
<a name="l00693"></a>00693     {   <span class="stringliteral">"PUT_OBJ_SLOT_8"</span>,           -2,         { EBC_NONE,                               },},
<a name="l00694"></a>00694     {   <span class="stringliteral">"PUT_OBJ_SLOT_9"</span>,           -2,         { EBC_NONE,                               },},
<a name="l00695"></a>00695     {   <span class="stringliteral">"PUT_THIS_SLOT_0"</span>,          -1,         { EBC_NONE,                               },},
<a name="l00696"></a>00696     {   <span class="stringliteral">"PUT_THIS_SLOT_1"</span>,          -1,         { EBC_NONE,                               },},
<a name="l00697"></a>00697     {   <span class="stringliteral">"PUT_THIS_SLOT_2"</span>,          -1,         { EBC_NONE,                               },},
<a name="l00698"></a>00698     {   <span class="stringliteral">"PUT_THIS_SLOT_3"</span>,          -1,         { EBC_NONE,                               },},
<a name="l00699"></a>00699     {   <span class="stringliteral">"PUT_THIS_SLOT_4"</span>,          -1,         { EBC_NONE,                               },},
<a name="l00700"></a>00700     {   <span class="stringliteral">"PUT_THIS_SLOT_5"</span>,          -1,         { EBC_NONE,                               },},
<a name="l00701"></a>00701     {   <span class="stringliteral">"PUT_THIS_SLOT_6"</span>,          -1,         { EBC_NONE,                               },},
<a name="l00702"></a>00702     {   <span class="stringliteral">"PUT_THIS_SLOT_7"</span>,          -1,         { EBC_NONE,                               },},
<a name="l00703"></a>00703     {   <span class="stringliteral">"PUT_THIS_SLOT_8"</span>,          -1,         { EBC_NONE,                               },},
<a name="l00704"></a>00704     {   <span class="stringliteral">"PUT_THIS_SLOT_9"</span>,          -1,         { EBC_NONE,                               },},
<a name="l00705"></a>00705     {   <span class="stringliteral">"PUT_OBJ_NAME_EXPR"</span>,        -4,         { EBC_NONE,                               },},
<a name="l00706"></a>00706     {   <span class="stringliteral">"PUT_OBJ_NAME"</span>,             -2,         { EBC_STRING, EBC_STRING,                 },},
<a name="l00707"></a>00707     {   <span class="stringliteral">"PUT_SCOPED_NAME"</span>,          -1,         { EBC_STRING, EBC_STRING,                 },},
<a name="l00708"></a>00708     {   <span class="stringliteral">"PUT_SCOPED_NAME_EXPR"</span>,     -3,         { EBC_NONE,                               },},
<a name="l00709"></a>00709     {   <span class="stringliteral">"PUT_BLOCK_SLOT"</span>,           -1,         { EBC_SLOT, EBC_NUM,                      },},
<a name="l00710"></a>00710     {   <span class="stringliteral">"PUT_GLOBAL_SLOT"</span>,          -1,         { EBC_SLOT,                               },},
<a name="l00711"></a>00711     {   <span class="stringliteral">"PUT_LOCAL_SLOT"</span>,           -1,         { EBC_SLOT,                               },},
<a name="l00712"></a>00712     {   <span class="stringliteral">"PUT_OBJ_SLOT"</span>,             -2,         { EBC_SLOT,                               },},
<a name="l00713"></a>00713     {   <span class="stringliteral">"PUT_THIS_SLOT"</span>,            -1,         { EBC_SLOT,                               },},
<a name="l00714"></a>00714     {   <span class="stringliteral">"PUT_TYPE_SLOT"</span>,            -2,         { EBC_SLOT, EBC_NUM,                      },},
<a name="l00715"></a>00715     {   <span class="stringliteral">"PUT_THIS_TYPE_SLOT"</span>,       -1,         { EBC_SLOT, EBC_NUM,                      },},
<a name="l00716"></a>00716     {   <span class="stringliteral">"REM"</span>,                      -1,         { EBC_NONE,                               },},
<a name="l00717"></a>00717     {   <span class="stringliteral">"RETURN"</span>,                    0,         { EBC_NONE,                               },},
<a name="l00718"></a>00718     {   <span class="stringliteral">"RETURN_VALUE"</span>,             -1,         { EBC_NONE,                               },},
<a name="l00719"></a>00719     {   <span class="stringliteral">"SAVE_RESULT"</span>,              -1,         { EBC_NONE,                               },},
<a name="l00720"></a>00720     {   <span class="stringliteral">"SHL"</span>,                      -1,         { EBC_NONE,                               },},
<a name="l00721"></a>00721     {   <span class="stringliteral">"SHR"</span>,                      -1,         { EBC_NONE,                               },},
<a name="l00722"></a>00722     {   <span class="stringliteral">"SPREAD"</span>,                    0,         { EBC_NONE,                               },},
<a name="l00723"></a>00723     {   <span class="stringliteral">"SUB"</span>,                      -1,         { EBC_NONE,                               },},
<a name="l00724"></a>00724     {   <span class="stringliteral">"SUPER"</span>,                     0,         { EBC_NONE,                               },},
<a name="l00725"></a>00725     {   <span class="stringliteral">"SWAP"</span>,                      0,         { EBC_NONE,                               },},
<a name="l00726"></a>00726     {   <span class="stringliteral">"THROW"</span>,                     0,         { EBC_NONE,                               },},
<a name="l00727"></a>00727     {   <span class="stringliteral">"TYPE_OF"</span>,                  -1,         { EBC_NONE,                               },},
<a name="l00728"></a>00728     {   <span class="stringliteral">"USHR"</span>,                     -1,         { EBC_NONE,                               },},
<a name="l00729"></a>00729     {   <span class="stringliteral">"XOR"</span>,                      -1,         { EBC_NONE,                               },},
<a name="l00730"></a>00730     {   <span class="stringliteral">"FINALLY"</span>,                   0,         { EBC_NONE,                               },},
<a name="l00731"></a>00731     {   NULL,                        0,         { EBC_NONE,                               },},
<a name="l00732"></a>00732 };
<a name="l00733"></a>00733 <span class="preprocessor">#endif </span><span class="comment">/* EJS_DEFINE_OPTABLE */</span>
<a name="l00734"></a>00734 
<a name="l00735"></a>00735 <span class="keyword">extern</span> EjsOptable *ejsGetOptable(MprCtx ctx);
<a name="l00736"></a>00736 
<a name="l00737"></a>00737 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00738"></a>00738 <span class="preprocessor"></span>}
<a name="l00739"></a>00739 <span class="preprocessor">#endif</span>
<a name="l00740"></a>00740 <span class="preprocessor"></span>
<a name="l00741"></a>00741 <span class="preprocessor">#endif </span><span class="comment">/* _h_EJS_BYTECODETABLE_H */</span>
<a name="l00742"></a>00742 
<a name="l00743"></a>00743 <span class="comment">/*</span>
<a name="l00744"></a>00744 <span class="comment">    @copy   default</span>
<a name="l00745"></a>00745 <span class="comment">  </span>
<a name="l00746"></a>00746 <span class="comment">    Copyright (c) Embedthis Software LLC, 2003-2010. All Rights Reserved.</span>
<a name="l00747"></a>00747 <span class="comment">    Copyright (c) Michael O'Brien, 1993-2010. All Rights Reserved.</span>
<a name="l00748"></a>00748 <span class="comment">  </span>
<a name="l00749"></a>00749 <span class="comment">    This software is distributed under commercial and open source licenses.</span>
<a name="l00750"></a>00750 <span class="comment">    You may use the GPL open source license described below or you may acquire</span>
<a name="l00751"></a>00751 <span class="comment">    a commercial license from Embedthis Software. You agree to be fully bound</span>
<a name="l00752"></a>00752 <span class="comment">    by the terms of either license. Consult the LICENSE.TXT distributed with</span>
<a name="l00753"></a>00753 <span class="comment">    this software for full details.</span>
<a name="l00754"></a>00754 <span class="comment">  </span>
<a name="l00755"></a>00755 <span class="comment">    This software is open source; you can redistribute it and/or modify it</span>
<a name="l00756"></a>00756 <span class="comment">    under the terms of the GNU General Public License as published by the</span>
<a name="l00757"></a>00757 <span class="comment">    Free Software Foundation; either version 2 of the License, or (at your</span>
<a name="l00758"></a>00758 <span class="comment">    option) any later version. See the GNU General Public License for more</span>
<a name="l00759"></a>00759 <span class="comment">    details at: http://www.embedthis.com/downloads/gplLicense.html</span>
<a name="l00760"></a>00760 <span class="comment">  </span>
<a name="l00761"></a>00761 <span class="comment">    This program is distributed WITHOUT ANY WARRANTY; without even the</span>
<a name="l00762"></a>00762 <span class="comment">    implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<a name="l00763"></a>00763 <span class="comment">  </span>
<a name="l00764"></a>00764 <span class="comment">    This GPL license does NOT permit incorporating this software into</span>
<a name="l00765"></a>00765 <span class="comment">    proprietary programs. If you are unable to comply with the GPL, you must</span>
<a name="l00766"></a>00766 <span class="comment">    acquire a commercial license to use this software. Commercial licenses</span>
<a name="l00767"></a>00767 <span class="comment">    for this software and support services are available from Embedthis</span>
<a name="l00768"></a>00768 <span class="comment">    Software at http://www.embedthis.com</span>
<a name="l00769"></a>00769 <span class="comment">  </span>
<a name="l00770"></a>00770 <span class="comment">    Local variables:
    tab-width: 4
    c-basic-offset: 4
    End:
    vim: sw=8 ts=8 expandtab

    @end</span>
<a name="l00771"></a>00771 <span class="comment"> */</span>
<a name="l00772"></a>00772 
<a name="l00773"></a>00773 <span class="comment">/************************************************************************/</span>
<a name="l00774"></a>00774 <span class="comment">/*</span>
<a name="l00775"></a>00775 <span class="comment"> *  End of file "../../src/include/ejsByteCodeTable.h"</span>
<a name="l00776"></a>00776 <span class="comment"> */</span>
<a name="l00777"></a>00777 <span class="comment">/************************************************************************/</span>
<a name="l00778"></a>00778 
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 
<a name="l00781"></a>00781 <span class="comment">/************************************************************************/</span>
<a name="l00782"></a>00782 <span class="comment">/*</span>
<a name="l00783"></a>00783 <span class="comment"> *  Start of file "../../src/include/ejsCore.h"</span>
<a name="l00784"></a>00784 <span class="comment"> */</span>
<a name="l00785"></a>00785 <span class="comment">/************************************************************************/</span>
<a name="l00786"></a>00786 
<a name="l00787"></a>00787 <span class="comment">/*</span>
<a name="l00788"></a>00788 <span class="comment">    ejsCore.h - Header for the core types.</span>
<a name="l00789"></a>00789 <span class="comment"></span>
<a name="l00790"></a>00790 <span class="comment">    The VM provides core types like numbers, strings and objects. This header provides their API.</span>
<a name="l00791"></a>00791 <span class="comment"></span>
<a name="l00792"></a>00792 <span class="comment">    Copyright (c) All Rights Reserved. See details at the end of the file.</span>
<a name="l00793"></a>00793 <span class="comment"> */</span>
<a name="l00794"></a>00794 
<a name="l00795"></a>00795 
<a name="l00796"></a>00796 <span class="preprocessor">#ifndef _h_EJS_CORE</span>
<a name="l00797"></a>00797 <span class="preprocessor"></span><span class="preprocessor">#define _h_EJS_CORE 1</span>
<a name="l00798"></a>00798 <span class="preprocessor"></span>
<a name="l00799"></a>00799 <span class="preprocessor">#include    "mpr.h"</span>
<a name="l00800"></a>00800 <span class="preprocessor">#include    "http.h"</span>
<a name="l00801"></a>00801 
<a name="l00802"></a>00802 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00803"></a>00803 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
<a name="l00804"></a>00804 <span class="preprocessor">#endif</span>
<a name="l00805"></a>00805 <span class="preprocessor"></span>
<a name="l00806"></a>00806 
<a name="l00807"></a>00807 <span class="preprocessor">#if !DOXYGEN</span>
<a name="l00808"></a>00808 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00809"></a>00809 <span class="comment">    Forward declare types</span>
<a name="l00810"></a>00810 <span class="comment"> */</span>
<a name="l00811"></a>00811 <span class="keyword">struct </span>Ejs;
<a name="l00812"></a>00812 <span class="keyword">struct </span>EjsBlock;
<a name="l00813"></a>00813 <span class="keyword">struct </span>EjsFrame;
<a name="l00814"></a>00814 <span class="keyword">struct </span>EjsFunction;
<a name="l00815"></a>00815 <span class="keyword">struct </span>EjsGC;
<a name="l00816"></a>00816 <span class="keyword">struct </span><a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a>;
<a name="l00817"></a>00817 <span class="keyword">struct </span>EjsNames;
<a name="l00818"></a>00818 <span class="keyword">struct </span>EjsModule;
<a name="l00819"></a>00819 <span class="keyword">struct </span>EjsNamespace;
<a name="l00820"></a>00820 <span class="keyword">struct </span>EjsObj;
<a name="l00821"></a>00821 <span class="keyword">struct </span><a class="code" href="struct_ejs_service.html" title="Ejscript Service structure.">EjsService</a>;
<a name="l00822"></a>00822 <span class="keyword">struct </span>EjsString;
<a name="l00823"></a>00823 <span class="keyword">struct </span><a class="code" href="struct_ejs_state.html" title="VM Evaluation state.">EjsState</a>;
<a name="l00824"></a>00824 <span class="keyword">struct </span><a class="code" href="struct_ejs_trait.html" title="Property traits.">EjsTrait</a>;
<a name="l00825"></a>00825 <span class="keyword">struct </span>EjsTraits;
<a name="l00826"></a>00826 <span class="keyword">struct </span>EjsType;
<a name="l00827"></a>00827 <span class="keyword">struct </span><a class="code" href="struct_ejs_type_helpers.html" title="Type Helpers.">EjsTypeHelpers</a>;
<a name="l00828"></a>00828 <span class="keyword">struct </span>EjsUri;
<a name="l00829"></a>00829 <span class="keyword">struct </span>EjsWorker;
<a name="l00830"></a>00830 <span class="keyword">struct </span>EjsXML;
<a name="l00831"></a>00831 <span class="preprocessor">#endif</span>
<a name="l00832"></a>00832 <span class="preprocessor"></span>
<a name="l00833"></a>00833 <span class="comment">//  MOB -- move</span>
<a name="l00834"></a>00834 <span class="comment">/*</span>
<a name="l00835"></a>00835 <span class="comment">    Default GC thresholds (not tunable)</span>
<a name="l00836"></a>00836 <span class="comment"> */</span>
<a name="l00837"></a>00837 <span class="preprocessor">#define EJS_MIN_TIME_FOR_GC     300     </span><span class="comment">/* Need 1/3 sec for GC */</span>
<a name="l00838"></a>00838 <span class="preprocessor">#define EJS_SHORT_WORK_QUOTA    50      </span><span class="comment">/* Predict GC short of a full work quota */</span>
<a name="l00839"></a>00839     
<a name="l00840"></a>00840 <span class="comment">/*</span>
<a name="l00841"></a>00841 <span class="comment">    GC Object generations</span>
<a name="l00842"></a>00842 <span class="comment"> */</span>
<a name="l00843"></a>00843 <span class="preprocessor">#define EJS_GEN_NEW         0           </span><span class="comment">/* New objects */</span>
<a name="l00844"></a>00844 <span class="preprocessor">#define EJS_GEN_ETERNAL     1           </span><span class="comment">/* Builtin objects that live forever */</span>
<a name="l00845"></a>00845 <span class="preprocessor">#define EJS_MAX_GEN         2           </span><span class="comment">/* Number of generations for object allocation */</span>
<a name="l00846"></a>00846 
<a name="l00847"></a>00847 <span class="comment">/*</span>
<a name="l00848"></a>00848 <span class="comment">    GC Collection modes</span>
<a name="l00849"></a>00849 <span class="comment"> */</span>
<a name="l00850"></a>00850 <span class="preprocessor">#define EJS_GC_ETERNAL      1           </span><span class="comment">/* Collect eternal generation */</span>
<a name="l00851"></a>00851 
<a name="l00852"></a>00852 <span class="comment">/*</span>
<a name="l00853"></a>00853 <span class="comment">    Trait, type, function and property attributes. These are sometimes combined into a single attributes word.</span>
<a name="l00854"></a>00854 <span class="comment"> */</span>
<a name="l00855"></a>00855 <span class="preprocessor">#define EJS_TRAIT_BUILTIN               0x1         </span><span class="comment">/**&lt; Property can take a null value */</span>
<a name="l00856"></a>00856 <span class="preprocessor">#define EJS_TRAIT_CAST_NULLS            0x2         </span><span class="comment">/**&lt; Property casts nulls */</span>
<a name="l00857"></a>00857 <span class="preprocessor">#define EJS_TRAIT_DELETED               0x4         </span><span class="comment">/**&lt; Property has been deleted */</span>
<a name="l00858"></a>00858 <span class="preprocessor">#define EJS_TRAIT_GETTER                0x8         </span><span class="comment">/**&lt; Property is a getter */</span>
<a name="l00859"></a>00859 <span class="preprocessor">#define EJS_TRAIT_FIXED                 0x10        </span><span class="comment">/**&lt; Property is not configurable */</span>
<a name="l00860"></a>00860 <span class="preprocessor">#define EJS_TRAIT_HIDDEN                0x20        </span><span class="comment">/**&lt; !Enumerable */</span>
<a name="l00861"></a>00861 <span class="preprocessor">#define EJS_TRAIT_INITIALIZED           0x40        </span><span class="comment">/**&lt; Readonly property has been initialized */</span>
<a name="l00862"></a>00862 <span class="preprocessor">#define EJS_TRAIT_READONLY              0x80        </span><span class="comment">/**&lt; !Writable */</span>
<a name="l00863"></a>00863 <span class="preprocessor">#define EJS_TRAIT_SETTER                0x100       </span><span class="comment">/**&lt; Property is a settter */</span>
<a name="l00864"></a>00864 <span class="preprocessor">#define EJS_TRAIT_THROW_NULLS           0x200       </span><span class="comment">/**&lt; Property rejects null */</span>
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 <span class="preprocessor">#define EJS_PROP_HAS_VALUE              0x400       </span><span class="comment">/**&lt; Property has a value record */</span>
<a name="l00867"></a>00867 <span class="preprocessor">#define EJS_PROP_NATIVE                 0x800       </span><span class="comment">/**&lt; Property is backed by native code */</span>
<a name="l00868"></a>00868 <span class="preprocessor">#define EJS_PROP_STATIC                 0x1000      </span><span class="comment">/**&lt; Class static property */</span>
<a name="l00869"></a>00869 <span class="preprocessor">#define EJS_PROP_SHARED                 0x2000      </span><span class="comment">/**&lt; Share static method with all subclasses */</span>
<a name="l00870"></a>00870 <span class="preprocessor">#define EJS_PROP_ENUMERABLE             0x4000      </span><span class="comment">/**&lt; Property will be enumerable (compiler use only) */</span>
<a name="l00871"></a>00871 
<a name="l00872"></a>00872 <span class="preprocessor">#define EJS_FUN_CONSTRUCTOR             0x8000      </span><span class="comment">/**&lt; Method is a constructor */</span>
<a name="l00873"></a>00873 <span class="preprocessor">#define EJS_FUN_FULL_SCOPE              0x10000     </span><span class="comment">/**&lt; Function needs closure when defined */</span>
<a name="l00874"></a>00874 <span class="preprocessor">#define EJS_FUN_HAS_RETURN              0x20000     </span><span class="comment">/**&lt; Function has a return statement */</span>
<a name="l00875"></a>00875 <span class="preprocessor">#define EJS_FUN_INITIALIZER             0x40000     </span><span class="comment">/**&lt; Type initializer code */</span>
<a name="l00876"></a>00876 <span class="preprocessor">#define EJS_FUN_OVERRIDE                0x80000     </span><span class="comment">/**&lt; Override base type */</span>
<a name="l00877"></a>00877 <span class="preprocessor">#define EJS_FUN_MODULE_INITIALIZER      0x100000    </span><span class="comment">/**&lt; Module initializer */</span>
<a name="l00878"></a>00878 <span class="preprocessor">#define EJS_FUN_REST_ARGS               0x200000    </span><span class="comment">/**&lt; Parameter is a "..." rest */</span>
<a name="l00879"></a>00879 <span class="preprocessor">#define EJS_TRAIT_MASK                  0x3FFFFF    </span><span class="comment">/**&lt; Mask of trait attributes */</span>
<a name="l00880"></a>00880 
<a name="l00881"></a>00881 <span class="comment">/*</span>
<a name="l00882"></a>00882 <span class="comment">    These attributes are never stored in EjsTrait but are often passed in "attributes"</span>
<a name="l00883"></a>00883 <span class="comment"> */</span>
<a name="l00884"></a>00884 <span class="preprocessor">#define EJS_TYPE_CALLS_SUPER            0x400000    </span><span class="comment">/**&lt; Constructor calls super() */</span>
<a name="l00885"></a>00885 <span class="preprocessor">#define EJS_TYPE_HAS_INSTANCE_VARS      0x800000    </span><span class="comment">/**&lt; Type has non-method instance vars (state) */</span>
<a name="l00886"></a>00886 <span class="preprocessor">#define EJS_TYPE_DYNAMIC_INSTANCE       0x1000000   </span><span class="comment">/**&lt; Instances are not sealed */</span>
<a name="l00887"></a>00887 <span class="preprocessor">#define EJS_TYPE_FINAL                  0x2000000   </span><span class="comment">/**&lt; Type can't be subclassed */</span>
<a name="l00888"></a>00888 <span class="preprocessor">#define EJS_TYPE_FIXUP                  0x4000000   </span><span class="comment">/**&lt; Type needs to inherit base types properties */</span>
<a name="l00889"></a>00889 <span class="preprocessor">#define EJS_TYPE_HAS_CONSTRUCTOR        0x8000000   </span><span class="comment">/**&lt; Type has a constructor */</span>
<a name="l00890"></a>00890 <span class="preprocessor">#define EJS_TYPE_HAS_TYPE_INITIALIZER   0x10000000  </span><span class="comment">/**&lt; Type has an initializer */</span>
<a name="l00891"></a>00891 <span class="preprocessor">#define EJS_TYPE_IMMUTABLE              0x20000000  </span><span class="comment">/**&lt; Instances are immutable */</span>
<a name="l00892"></a>00892 <span class="preprocessor">#define EJS_TYPE_INTERFACE              0x40000000  </span><span class="comment">/**&lt; Class is an interface */</span>
<a name="l00893"></a>00893 
<a name="l00894"></a>00894 <span class="comment">/*</span>
<a name="l00895"></a>00895 <span class="comment">    Interpreter flags</span>
<a name="l00896"></a>00896 <span class="comment"> */</span>
<a name="l00897"></a>00897 <span class="preprocessor">#define EJS_FLAG_EVENT          0x1         </span><span class="comment">/**&lt; Event pending */</span>
<a name="l00898"></a>00898 <span class="preprocessor">#define EJS_FLAG_NO_INIT        0x8         </span><span class="comment">/**&lt; Don't initialize any modules*/</span>
<a name="l00899"></a>00899 <span class="preprocessor">#define EJS_FLAG_MASTER         0x20        </span><span class="comment">/**&lt; Create a master interpreter */</span>
<a name="l00900"></a>00900 <span class="preprocessor">#define EJS_FLAG_DOC            0x40        </span><span class="comment">/**&lt; Load documentation from modules */</span>
<a name="l00901"></a>00901 <span class="preprocessor">#define EJS_FLAG_NOEXIT         0x200       </span><span class="comment">/**&lt; App should service events and not exit */</span>
<a name="l00902"></a>00902 <span class="preprocessor">#define EJS_FLAG_DYNAMIC        0x400       </span><span class="comment">/**&lt; Make a type that is dynamic itself */</span>
<a name="l00903"></a>00903 <span class="preprocessor">#define EJS_STACK_ARG           -1          </span><span class="comment">/* Offset to locate first arg */</span>
<a name="l00904"></a>00904 <span class="comment"></span>
<a name="l00905"></a>00905 <span class="comment">/** </span>
<a name="l00906"></a>00906 <span class="comment">    Configured numeric type</span>
<a name="l00907"></a>00907 <span class="comment"> */</span>
<a name="l00908"></a>00908 <span class="preprocessor">#define BLD_FEATURE_NUM_TYPE double</span>
<a name="l00909"></a>00909 <span class="preprocessor"></span><span class="keyword">typedef</span> BLD_FEATURE_NUM_TYPE MprNumber;
<a name="l00910"></a>00910 
<a name="l00911"></a>00911 <span class="comment">/*  </span>
<a name="l00912"></a>00912 <span class="comment">    Sizes (in bytes) of encoded types in a ByteArray</span>
<a name="l00913"></a>00913 <span class="comment"> */</span>
<a name="l00914"></a>00914 <span class="preprocessor">#define EJS_SIZE_BOOLEAN        1</span>
<a name="l00915"></a>00915 <span class="preprocessor"></span><span class="preprocessor">#define EJS_SIZE_SHORT          2</span>
<a name="l00916"></a>00916 <span class="preprocessor"></span><span class="preprocessor">#define EJS_SIZE_INT            4</span>
<a name="l00917"></a>00917 <span class="preprocessor"></span><span class="preprocessor">#define EJS_SIZE_LONG           8</span>
<a name="l00918"></a>00918 <span class="preprocessor"></span><span class="preprocessor">#define EJS_SIZE_DOUBLE         8</span>
<a name="l00919"></a>00919 <span class="preprocessor"></span><span class="preprocessor">#define EJS_SIZE_DATE           8</span>
<a name="l00920"></a>00920 <span class="preprocessor"></span>
<a name="l00921"></a>00921 <span class="comment">/*  </span>
<a name="l00922"></a>00922 <span class="comment">    Reserved and system Namespaces</span>
<a name="l00923"></a>00923 <span class="comment">    The empty namespace is special. When seaching for properties, the empty namespace implies to search all namespaces.</span>
<a name="l00924"></a>00924 <span class="comment">    When properties are defined without a namespace, they are defined in the the empty namespace.</span>
<a name="l00925"></a>00925 <span class="comment"> */</span>
<a name="l00926"></a>00926 <span class="preprocessor">#define EJS_EMPTY_NAMESPACE         ""</span>
<a name="l00927"></a>00927 <span class="preprocessor"></span><span class="preprocessor">#define EJS_BLOCK_NAMESPACE         "-block-"</span>
<a name="l00928"></a>00928 <span class="preprocessor"></span><span class="preprocessor">#define EJS_CONSTRUCTOR_NAMESPACE   "-constructor-"</span>
<a name="l00929"></a>00929 <span class="preprocessor"></span><span class="preprocessor">#define EJS_EJS_NAMESPACE           "ejs"</span>
<a name="l00930"></a>00930 <span class="preprocessor"></span><span class="preprocessor">#define EJS_ITERATOR_NAMESPACE      "iterator"</span>
<a name="l00931"></a>00931 <span class="preprocessor"></span><span class="preprocessor">#define EJS_INIT_NAMESPACE          "-initializer-"</span>
<a name="l00932"></a>00932 <span class="preprocessor"></span><span class="preprocessor">#define EJS_INTERNAL_NAMESPACE      "internal"</span>
<a name="l00933"></a>00933 <span class="preprocessor"></span><span class="preprocessor">#define EJS_META_NAMESPACE          "meta"</span>
<a name="l00934"></a>00934 <span class="preprocessor"></span><span class="preprocessor">#define EJS_PRIVATE_NAMESPACE       "private"</span>
<a name="l00935"></a>00935 <span class="preprocessor"></span><span class="preprocessor">#define EJS_PROTECTED_NAMESPACE     "protected"</span>
<a name="l00936"></a>00936 <span class="preprocessor"></span><span class="preprocessor">#define EJS_PROTOTYPE_NAMESPACE     "-prototype-"</span>
<a name="l00937"></a>00937 <span class="preprocessor"></span><span class="preprocessor">#define EJS_PUBLIC_NAMESPACE        "public"</span>
<a name="l00938"></a>00938 <span class="preprocessor"></span><span class="preprocessor">#define EJS_WORKER_NAMESPACE        "ejs.worker"</span>
<a name="l00939"></a>00939 <span class="preprocessor"></span>
<a name="l00940"></a>00940 <span class="comment">/*  </span>
<a name="l00941"></a>00941 <span class="comment">    Flags for fast comparison of namespaces</span>
<a name="l00942"></a>00942 <span class="comment"> */</span>
<a name="l00943"></a>00943 <span class="preprocessor">#define EJS_NSP_PRIVATE         0x1</span>
<a name="l00944"></a>00944 <span class="preprocessor"></span><span class="preprocessor">#define EJS_NSP_PROTECTED       0x2</span>
<a name="l00945"></a>00945 <span class="preprocessor"></span>
<a name="l00946"></a>00946 
<a name="l00947"></a>00947 <span class="comment">/*  </span>
<a name="l00948"></a>00948 <span class="comment">    When allocating slots, name hashes and traits, we optimize by rounding up allocations</span>
<a name="l00949"></a>00949 <span class="comment"> */</span>
<a name="l00950"></a>00950 <span class="preprocessor">#define EJS_PROP_ROUNDUP(x) (((x) + EJS_ROUND_PROP - 1) / EJS_ROUND_PROP * EJS_ROUND_PROP)</span>
<a name="l00951"></a>00951 <span class="preprocessor"></span>
<a name="l00952"></a>00952 <span class="comment">/*  Property enumeration flags</span>
<a name="l00953"></a>00953 <span class="comment"> */</span>
<a name="l00954"></a>00954 <span class="preprocessor">#define EJS_FLAGS_ENUM_INHERITED 0x1            </span><span class="comment">/**&lt; Enumerate inherited base classes */</span>
<a name="l00955"></a>00955 <span class="preprocessor">#define EJS_FLAGS_ENUM_ALL      0x2             </span><span class="comment">/**&lt; Enumerate non-enumerable and fixture properties */</span>
<a name="l00956"></a>00956 
<a name="l00957"></a>00957 <span class="comment">/*  </span>
<a name="l00958"></a>00958 <span class="comment">    Exception flags and structure</span>
<a name="l00959"></a>00959 <span class="comment"> */</span>
<a name="l00960"></a>00960 <span class="preprocessor">#define EJS_EX_CATCH            0x1             </span><span class="comment">/* Definition is a catch block */</span>
<a name="l00961"></a>00961 <span class="preprocessor">#define EJS_EX_FINALLY          0x2             </span><span class="comment">/* Definition is a finally block */</span>
<a name="l00962"></a>00962 <span class="preprocessor">#define EJS_EX_ITERATION        0x4             </span><span class="comment">/* Definition is an iteration catch block */</span>
<a name="l00963"></a>00963 <span class="preprocessor">#define EJS_EX_INC              4               </span><span class="comment">/* Growth increment for exception handlers */</span>
<a name="l00964"></a>00964 
<a name="l00965"></a>00965 <span class="comment">/*  </span>
<a name="l00966"></a>00966 <span class="comment">    Ejscript return codes.</span>
<a name="l00967"></a>00967 <span class="comment"> */</span>
<a name="l00968"></a>00968 <span class="preprocessor">#define EJS_SUCCESS             MPR_ERR_OK</span>
<a name="l00969"></a>00969 <span class="preprocessor"></span><span class="preprocessor">#define EJS_ERR                 MPR_ERR_GENERAL</span>
<a name="l00970"></a>00970 <span class="preprocessor"></span><span class="preprocessor">#define EJS_EXCEPTION           (MPR_ERR_MAX - 1)</span>
<a name="l00971"></a>00971 <span class="preprocessor"></span>
<a name="l00972"></a>00972 <span class="comment">/*  </span>
<a name="l00973"></a>00973 <span class="comment">    Xml defines</span>
<a name="l00974"></a>00974 <span class="comment"> */</span>
<a name="l00975"></a>00975 <span class="preprocessor">#define E4X_MAX_ELT_SIZE        (E4X_BUF_MAX-1)</span>
<a name="l00976"></a>00976 <span class="preprocessor"></span><span class="preprocessor">#define E4X_TEXT_PROPERTY       "-txt"</span>
<a name="l00977"></a>00977 <span class="preprocessor"></span><span class="preprocessor">#define E4X_TAG_NAME_PROPERTY   "-tag"</span>
<a name="l00978"></a>00978 <span class="preprocessor"></span><span class="preprocessor">#define E4X_COMMENT_PROPERTY    "-com"</span>
<a name="l00979"></a>00979 <span class="preprocessor"></span><span class="preprocessor">#define E4X_ATTRIBUTES_PROPERTY "-att"</span>
<a name="l00980"></a>00980 <span class="preprocessor"></span><span class="preprocessor">#define E4X_PI_PROPERTY         "-pi"</span>
<a name="l00981"></a>00981 <span class="preprocessor"></span><span class="preprocessor">#define E4X_PARENT_PROPERTY     "-parent"</span>
<a name="l00982"></a>00982 <span class="preprocessor"></span>
<a name="l00983"></a>00983 <span class="preprocessor">#define EJS_XML_FLAGS_TEXT      0x1             </span><span class="comment">/* Node is a text node */</span>
<a name="l00984"></a>00984 <span class="preprocessor">#define EJS_XML_FLAGS_PI        0x2             </span><span class="comment">/* Node is a processing instruction */</span>
<a name="l00985"></a>00985 <span class="preprocessor">#define EJS_XML_FLAGS_COMMENT   0x4             </span><span class="comment">/* Node is a comment */</span>
<a name="l00986"></a>00986 <span class="preprocessor">#define EJS_XML_FLAGS_ATTRIBUTE 0x8             </span><span class="comment">/* Node is an attribute */</span>
<a name="l00987"></a>00987 <span class="preprocessor">#define EJS_XML_FLAGS_ELEMENT   0x10            </span><span class="comment">/* Node is an element */</span>
<a name="l00988"></a>00988 
<a name="l00989"></a>00989 <span class="comment">/*  </span>
<a name="l00990"></a>00990 <span class="comment">    XML node kinds</span>
<a name="l00991"></a>00991 <span class="comment"> */</span>
<a name="l00992"></a>00992 <span class="preprocessor">#define EJS_XML_LIST        1</span>
<a name="l00993"></a>00993 <span class="preprocessor"></span><span class="preprocessor">#define EJS_XML_ELEMENT     2</span>
<a name="l00994"></a>00994 <span class="preprocessor"></span><span class="preprocessor">#define EJS_XML_ATTRIBUTE   3</span>
<a name="l00995"></a>00995 <span class="preprocessor"></span><span class="preprocessor">#define EJS_XML_TEXT        4</span>
<a name="l00996"></a>00996 <span class="preprocessor"></span><span class="preprocessor">#define EJS_XML_COMMENT     5</span>
<a name="l00997"></a>00997 <span class="preprocessor"></span><span class="preprocessor">#define EJS_XML_PROCESSING  6</span>
<a name="l00998"></a>00998 <span class="preprocessor"></span>
<a name="l00999"></a>00999 <span class="comment">/*  </span>
<a name="l01000"></a>01000 <span class="comment">    Convenient slot aliases</span>
<a name="l01001"></a>01001 <span class="comment"> */</span>
<a name="l01002"></a>01002 <span class="preprocessor">#define EJSLOT_CONSTRUCTOR          EJSLOT_Object___constructor__</span>
<a name="l01003"></a>01003 <span class="preprocessor"></span>
<a name="l01004"></a>01004 <span class="comment">/*  </span>
<a name="l01005"></a>01005 <span class="comment">    Default names</span>
<a name="l01006"></a>01006 <span class="comment"> */</span>
<a name="l01007"></a>01007 <span class="preprocessor">#define EJS_GLOBAL                  "global"</span>
<a name="l01008"></a>01008 <span class="preprocessor"></span><span class="preprocessor">#define EJS_DEFAULT_MODULE          "default"</span>
<a name="l01009"></a>01009 <span class="preprocessor"></span><span class="preprocessor">#define EJS_DEFAULT_MODULE_NAME     EJS_DEFAULT_MODULE EJS_MODULE_EXT</span>
<a name="l01010"></a>01010 <span class="preprocessor"></span><span class="preprocessor">#define EJS_BUILTIN_MODULE_NAME     "ejs"  EJS_MODULE_EXT</span>
<a name="l01011"></a>01011 <span class="preprocessor"></span><span class="preprocessor">#define EJS_DEFAULT_CLASS_NAME      "__defaultClass__"</span>
<a name="l01012"></a>01012 <span class="preprocessor"></span><span class="preprocessor">#define EJS_INITIALIZER_NAME        "__initializer__"</span>
<a name="l01013"></a>01013 <span class="preprocessor"></span>
<a name="l01014"></a>01014 <span class="preprocessor">#define EJS_NAME                    "ejs"</span>
<a name="l01015"></a>01015 <span class="preprocessor"></span><span class="preprocessor">#define EJS_MOD                     "ejs.mod"</span>
<a name="l01016"></a>01016 <span class="preprocessor"></span>
<a name="l01017"></a>01017 <span class="comment">/*  </span>
<a name="l01018"></a>01018 <span class="comment">    Compare if a variable is an instance or sub-type of a given type described by the type's global slot.</span>
<a name="l01019"></a>01019 <span class="comment"> */</span>
<a name="l01020"></a>01020 <span class="preprocessor">#define ejsIs(vp, slot)             _ejsIs((EjsObj*) vp, slot)</span>
<a name="l01021"></a>01021 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">int</span> _ejsIs(<span class="keyword">struct</span> EjsObj *vp, <span class="keywordtype">int</span> slot);
<a name="l01022"></a>01022 
<a name="l01023"></a>01023 <span class="comment">/* TODO - merge with MprList */</span><span class="comment"></span>
<a name="l01024"></a>01024 <span class="comment">/**</span>
<a name="l01025"></a>01025 <span class="comment">    List type</span>
<a name="l01026"></a>01026 <span class="comment">    @description    The MprList is a dynamic growable array suitable for storing pointers to arbitrary objects.</span>
<a name="l01027"></a>01027 <span class="comment">    @stability      Prototype.</span>
<a name="l01028"></a>01028 <span class="comment">    @see            EjsList mprCreateList mprFree MprBuf</span>
<a name="l01029"></a>01029 <span class="comment"> */</span>
<a name="l01030"></a><a class="code" href="struct_ejs_list.html">01030</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> {
<a name="l01031"></a>01031     <span class="keywordtype">void</span>    **items;                    <span class="comment">/* List item data */</span>
<a name="l01032"></a>01032     <span class="keywordtype">int</span>     length;                     <span class="comment">/* Count of used items */</span>
<a name="l01033"></a>01033     <span class="keywordtype">int</span>     maxSize;                    <span class="comment">/* Maximum capacity */</span>
<a name="l01034"></a>01034 } <a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a>;
<a name="l01035"></a>01035 
<a name="l01036"></a>01036 <span class="comment">//  TODO - DOC</span>
<a name="l01037"></a>01037 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsInitList(<a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *list);
<a name="l01038"></a>01038 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsAddItem(MprCtx ctx, <a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *list, cvoid *item);
<a name="l01039"></a>01039 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsAddItemToSharedList(MprCtx ctx, <a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *list, cvoid *item);
<a name="l01040"></a>01040 <span class="keyword">extern</span> <a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a>  *ejsAppendList(MprCtx ctx, <a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *list, <a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *<span class="keyword">add</span>);
<a name="l01041"></a>01041 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsCopyList(MprCtx ctx, <a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *dest, <a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *src);
<a name="l01042"></a>01042 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsClearList(<a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *lp);
<a name="l01043"></a>01043 <span class="keyword">extern</span> <span class="keywordtype">void</span>     *ejsGetItem(<a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *lp, <span class="keywordtype">int</span> index);
<a name="l01044"></a>01044 <span class="keyword">extern</span> <span class="keywordtype">void</span>     *ejsGetLastItem(<a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *lp);
<a name="l01045"></a>01045 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsGetListCount(<a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *lp);
<a name="l01046"></a>01046 <span class="keyword">extern</span> <span class="keywordtype">void</span>     *ejsGetNextItem(<a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *lp, <span class="keywordtype">int</span> *lastIndex);
<a name="l01047"></a>01047 <span class="keyword">extern</span> <span class="keywordtype">void</span>     *ejsGetPrevItem(<a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *lp, <span class="keywordtype">int</span> *lastIndex);
<a name="l01048"></a>01048 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsLookupItem(<a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *lp, cvoid *item);
<a name="l01049"></a>01049 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsRemoveItemAtPos(<a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *lp, <span class="keywordtype">int</span> index);
<a name="l01050"></a>01050 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsRemoveLastItem(<a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *lp);
<a name="l01051"></a>01051 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsSetListDetails(MprCtx ctx, <a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *list, <span class="keywordtype">int</span> initialSize, <span class="keywordtype">int</span> maxSize);
<a name="l01052"></a>01052 
<a name="l01053"></a>01053 <span class="comment">/*</span>
<a name="l01054"></a>01054 <span class="comment">    GC Per generation structure</span>
<a name="l01055"></a>01055 <span class="comment"> */</span>
<a name="l01056"></a>01056 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsGen
<a name="l01057"></a>01057 {
<a name="l01058"></a>01058     uint            totalReclaimed;     <span class="comment">/* Total blocks reclaimed on sweeps */</span>
<a name="l01059"></a>01059     uint            totalSweeps;        <span class="comment">/* Total sweeps */</span>
<a name="l01060"></a>01060 } EjsGen;
<a name="l01061"></a>01061 
<a name="l01062"></a>01062 <span class="comment">/*</span>
<a name="l01063"></a>01063 <span class="comment">    GC Pool of free objects of a given type. Each type maintains a free pool for faster allocations.</span>
<a name="l01064"></a>01064 <span class="comment">    Types in the pool have a weak reference and may be reclaimed.</span>
<a name="l01065"></a>01065 <span class="comment"> */</span>
<a name="l01066"></a>01066 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsPool
<a name="l01067"></a>01067 {
<a name="l01068"></a>01068     <span class="keyword">struct </span>EjsType  *type;              <span class="comment">/* Owning type */</span>
<a name="l01069"></a>01069     <span class="keywordtype">int</span>             allocated;          <span class="comment">/* Count of instances created */</span>
<a name="l01070"></a>01070     <span class="keywordtype">int</span>             peakAllocated;      <span class="comment">/* High water mark for allocated */</span>
<a name="l01071"></a>01071     <span class="keywordtype">int</span>             count;              <span class="comment">/* Count in pool */</span>
<a name="l01072"></a>01072     <span class="keywordtype">int</span>             peakCount;          <span class="comment">/* High water mark for count */</span>
<a name="l01073"></a>01073     <span class="keywordtype">int</span>             reuse;              <span class="comment">/* Count of reuses */</span>
<a name="l01074"></a>01074 } EjsPool;
<a name="l01075"></a>01075 
<a name="l01076"></a>01076 
<a name="l01077"></a>01077 <span class="comment">/*</span>
<a name="l01078"></a>01078 <span class="comment">    Garbage collector control</span>
<a name="l01079"></a>01079 <span class="comment"> */</span>
<a name="l01080"></a>01080 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsGC {
<a name="l01081"></a>01081 
<a name="l01082"></a>01082     EjsGen      *generations[EJS_MAX_GEN];
<a name="l01083"></a>01083 
<a name="l01084"></a>01084     <span class="comment">//  MOB -- make this dynamic and remove the constant</span>
<a name="l01085"></a>01085     EjsPool     *pools[EJS_MAX_TYPE];   <span class="comment">/* Object pools */</span>
<a name="l01086"></a>01086     <span class="keywordtype">int</span>         numPools;               <span class="comment">/* Count of object pools */</span>
<a name="l01087"></a>01087     uint        allocGeneration;        <span class="comment">/* Current generation accepting objects */</span>
<a name="l01088"></a>01088     uint        collectGeneration;      <span class="comment">/* Current generation doing GC */</span>
<a name="l01089"></a>01089     uint        markGenRef;             <span class="comment">/* Generation to mark objects */</span>
<a name="l01090"></a>01090     uint        firstGlobal;            <span class="comment">/* First global slots to examine */</span>
<a name="l01091"></a>01091     <span class="keywordtype">bool</span>        collecting;             <span class="comment">/* Running garbage collection */</span>
<a name="l01092"></a>01092     <span class="keywordtype">bool</span>        enabled;                <span class="comment">/* GC is enabled */</span>
<a name="l01093"></a>01093     <span class="keywordtype">int</span>         degraded;               <span class="comment">/* Have exceeded redlineMemory */</span>
<a name="l01094"></a>01094     uint        allocatedTypes;         <span class="comment">/* Count of types allocated */</span>
<a name="l01095"></a>01095     uint        peakAllocatedTypes;     <span class="comment">/* Peak allocated types */</span> 
<a name="l01096"></a>01096     uint        allocatedObjects;       <span class="comment">/* Count of objects allocated */</span>
<a name="l01097"></a>01097     uint        peakAllocatedObjects;   <span class="comment">/* Peak allocated */</span> 
<a name="l01098"></a>01098     uint        peakMemory;             <span class="comment">/* Peak memory usage */</span>
<a name="l01099"></a>01099     uint        totalAllocated;         <span class="comment">/* Total count of allocation calls */</span>
<a name="l01100"></a>01100     uint        totalReclaimed;         <span class="comment">/* Total blocks reclaimed on sweeps */</span>
<a name="l01101"></a>01101     uint        totalOverflows;         <span class="comment">/* Total overflows  */</span>
<a name="l01102"></a>01102     uint        totalRedlines;          <span class="comment">/* Total times redline limit exceeded */</span>
<a name="l01103"></a>01103     uint        totalSweeps;            <span class="comment">/* Total sweeps */</span>
<a name="l01104"></a>01104 <span class="preprocessor">#if BLD_DEBUG</span>
<a name="l01105"></a>01105 <span class="preprocessor"></span>    <span class="keywordtype">int</span>         indent;                 <span class="comment">/* Indent formatting in GC reports */</span>
<a name="l01106"></a>01106 <span class="preprocessor">#endif</span>
<a name="l01107"></a>01107 <span class="preprocessor"></span>} EjsGC;
<a name="l01108"></a>01108 
<a name="l01109"></a>01109 
<a name="l01110"></a>01110 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsLoadState {
<a name="l01111"></a>01111     MprList     *typeFixups;        <span class="comment">/**&lt; Loaded types to fixup */</span>
<a name="l01112"></a>01112     <span class="keywordtype">int</span>         firstModule;        <span class="comment">/**&lt; First module in ejs-&gt;modules for this load */</span>
<a name="l01113"></a>01113     <span class="keywordtype">int</span>         flags;              <span class="comment">/**&lt; Module load flags */</span>
<a name="l01114"></a>01114 } EjsLoadState;
<a name="l01115"></a>01115 
<a name="l01116"></a>01116 <span class="keyword">typedef</span> void (*EjsLoaderCallback)(<span class="keyword">struct </span>Ejs *ejs, <span class="keywordtype">int</span> kind, ...);
<a name="l01117"></a>01117 <span class="comment"></span>
<a name="l01118"></a>01118 <span class="comment">/**</span>
<a name="l01119"></a>01119 <span class="comment">    Ejsript Interperter Structure</span>
<a name="l01120"></a>01120 <span class="comment">    @description The Ejs structure contains the state for a single interpreter. The #ejsCreate routine may be used</span>
<a name="l01121"></a>01121 <span class="comment">        to create multiple interpreters and returns a reference to be used in subsequent Ejscript API calls.</span>
<a name="l01122"></a>01122 <span class="comment">    @stability Prototype.</span>
<a name="l01123"></a>01123 <span class="comment">    @defgroup Ejs Ejs</span>
<a name="l01124"></a>01124 <span class="comment">    @see ejsCreate, ejsCreateService, ejsAppendSearchPath, ejsSetSearchPath, ejsEvalFile, ejsEvalScript, ejsExit</span>
<a name="l01125"></a>01125 <span class="comment"> */</span>
<a name="l01126"></a>01126 <span class="keyword">typedef</span> <span class="keyword">struct </span>Ejs {
<a name="l01127"></a>01127     <span class="keyword">struct </span>EjsObj       *exception;         <span class="comment">/**&lt; Pointer to exception object */</span>
<a name="l01128"></a>01128     <span class="keyword">struct </span>EjsObj       *result;            <span class="comment">/**&lt; Last expression result */</span>
<a name="l01129"></a>01129     <span class="keyword">struct </span><a class="code" href="struct_ejs_state.html" title="VM Evaluation state.">EjsState</a>     *state;             <span class="comment">/**&lt; Current evaluation state and stack */</span>
<a name="l01130"></a>01130     <span class="keyword">struct </span><a class="code" href="struct_ejs_state.html" title="VM Evaluation state.">EjsState</a>     *masterState;       <span class="comment">/**&lt; Owns the eval stack */</span>
<a name="l01131"></a>01131 
<a name="l01132"></a>01132     <span class="keyword">struct </span><a class="code" href="struct_ejs_service.html" title="Ejscript Service structure.">EjsService</a>   *service;           <span class="comment">/**&lt; Back pointer to the service */</span>
<a name="l01133"></a>01133     <span class="keyword">struct </span>Ejs          *master;            <span class="comment">/**&lt; Inherit builtin types from the master */</span>
<a name="l01134"></a>01134     <span class="keyword">struct </span>EjsGC        gc;                 <span class="comment">/**&lt; Garbage collector state */</span>
<a name="l01135"></a>01135     EjsGen              *currentGeneration; <span class="comment">/**&lt; Current allocation generation */</span>
<a name="l01136"></a>01136     MprHeap             *heap;              <span class="comment">/**&lt; Allocation heap */</span>
<a name="l01137"></a>01137     cchar               *bootSearch;        <span class="comment">/**&lt; Module search when bootstrapping the VM */</span>
<a name="l01138"></a>01138     <span class="keyword">struct </span>EjsArray     *search;            <span class="comment">/**&lt; Module load search path */</span>
<a name="l01139"></a>01139     cchar               *className;         <span class="comment">/**&lt; Name of a specific class to run for a program */</span>
<a name="l01140"></a>01140     cchar               *methodName;        <span class="comment">/**&lt; Name of a specific method to run for a program */</span>
<a name="l01141"></a>01141 
<a name="l01142"></a>01142     <span class="comment">/*</span>
<a name="l01143"></a>01143 <span class="comment">        Essential types</span>
<a name="l01144"></a>01144 <span class="comment">     */</span>
<a name="l01145"></a>01145     <span class="keyword">struct </span>EjsType      *appType;           <span class="comment">/**&lt; App type */</span>
<a name="l01146"></a>01146     <span class="keyword">struct </span>EjsType      *arrayType;         <span class="comment">/**&lt; Array type */</span>
<a name="l01147"></a>01147     <span class="keyword">struct </span>EjsType      *blockType;         <span class="comment">/**&lt; Block type */</span>
<a name="l01148"></a>01148     <span class="keyword">struct </span>EjsType      *booleanType;       <span class="comment">/**&lt; Boolean type */</span>
<a name="l01149"></a>01149     <span class="keyword">struct </span>EjsType      *byteArrayType;     <span class="comment">/**&lt; ByteArray type */</span>
<a name="l01150"></a>01150     <span class="keyword">struct </span>EjsType      *dateType;          <span class="comment">/**&lt; Date type */</span>
<a name="l01151"></a>01151     <span class="keyword">struct </span>EjsType      *errorType;         <span class="comment">/**&lt; Error type */</span>
<a name="l01152"></a>01152     <span class="keyword">struct </span>EjsType      *errorEventType;    <span class="comment">/**&lt; ErrorEvent type */</span>
<a name="l01153"></a>01153     <span class="keyword">struct </span>EjsType      *eventType;         <span class="comment">/**&lt; Event type */</span>
<a name="l01154"></a>01154     <span class="keyword">struct </span>EjsType      *frameType;         <span class="comment">/**&lt; Frame type */</span>
<a name="l01155"></a>01155     <span class="keyword">struct </span>EjsType      *fileType;          <span class="comment">/**&lt; File type */</span>
<a name="l01156"></a>01156     <span class="keyword">struct </span>EjsType      *functionType;      <span class="comment">/**&lt; Function type */</span>
<a name="l01157"></a>01157     <span class="keyword">struct </span>EjsType      *iteratorType;      <span class="comment">/**&lt; Iterator type */</span>
<a name="l01158"></a>01158     <span class="keyword">struct </span>EjsType      *mathType;          <span class="comment">/**&lt; Math type */</span>
<a name="l01159"></a>01159     <span class="keyword">struct </span>EjsType      *namespaceType;     <span class="comment">/**&lt; Namespace type */</span>
<a name="l01160"></a>01160     <span class="keyword">struct </span>EjsType      *nullType;          <span class="comment">/**&lt; Null type */</span>
<a name="l01161"></a>01161     <span class="keyword">struct </span>EjsType      *numberType;        <span class="comment">/**&lt; Default numeric type */</span>
<a name="l01162"></a>01162     <span class="keyword">struct </span>EjsType      *objectType;        <span class="comment">/**&lt; Object type */</span>
<a name="l01163"></a>01163     <span class="keyword">struct </span>EjsType      *pathType;          <span class="comment">/**&lt; Path type */</span>
<a name="l01164"></a>01164     <span class="keyword">struct </span>EjsType      *regExpType;        <span class="comment">/**&lt; RegExp type */</span>
<a name="l01165"></a>01165     <span class="keyword">struct </span>EjsType      *requestType;       <span class="comment">/**&lt; Request type */</span>
<a name="l01166"></a>01166     <span class="keyword">struct </span>EjsType      *stringType;        <span class="comment">/**&lt; String type */</span>
<a name="l01167"></a>01167     <span class="keyword">struct </span>EjsType      *stopIterationType; <span class="comment">/**&lt; StopIteration type */</span>
<a name="l01168"></a>01168     <span class="keyword">struct </span>EjsType      *typeType;          <span class="comment">/**&lt; Type type */</span>
<a name="l01169"></a>01169     <span class="keyword">struct </span>EjsType      *uriType;           <span class="comment">/**&lt; URI type */</span>
<a name="l01170"></a>01170     <span class="keyword">struct </span>EjsType      *voidType;          <span class="comment">/**&lt; Void type */</span>
<a name="l01171"></a>01171     <span class="keyword">struct </span>EjsType      *webType;           <span class="comment">/**&lt; Web type */</span>
<a name="l01172"></a>01172     <span class="keyword">struct </span>EjsType      *workerType;        <span class="comment">/**&lt; Worker type */</span>
<a name="l01173"></a>01173     <span class="keyword">struct </span>EjsType      *xmlType;           <span class="comment">/**&lt; XML type */</span>
<a name="l01174"></a>01174     <span class="keyword">struct </span>EjsType      *xmlListType;       <span class="comment">/**&lt; XMLList type */</span>
<a name="l01175"></a>01175 
<a name="l01176"></a>01176     <span class="comment">/*</span>
<a name="l01177"></a>01177 <span class="comment">        Key values</span>
<a name="l01178"></a>01178 <span class="comment">     */</span>
<a name="l01179"></a>01179     <span class="keyword">struct </span>EjsObj       *global;            <span class="comment">/**&lt; The "global" object as an EjsObj */</span>
<a name="l01180"></a>01180     <span class="keyword">struct </span>EjsBlock     *globalBlock;       <span class="comment">/**&lt; The "global" object as an EjsBlock */</span>
<a name="l01181"></a>01181 
<a name="l01182"></a>01182     <span class="keyword">struct </span>EjsString    *emptyStringValue;  <span class="comment">/**&lt; "" value */</span>
<a name="l01183"></a>01183     <span class="keyword">struct </span>EjsObj       *falseValue;        <span class="comment">/**&lt; The "false" value */</span>
<a name="l01184"></a>01184     <span class="keyword">struct </span>EjsNumber    *infinityValue;     <span class="comment">/**&lt; The infinity number value */</span>
<a name="l01185"></a>01185     <span class="keyword">struct </span>EjsIterator  *iterator;          <span class="comment">/**&lt; Default iterator */</span>
<a name="l01186"></a>01186     <span class="keyword">struct </span>EjsNumber    *maxValue;          <span class="comment">/**&lt; Maximum number value */</span>
<a name="l01187"></a>01187     <span class="keyword">struct </span>EjsNumber    *minValue;          <span class="comment">/**&lt; Minimum number value */</span>
<a name="l01188"></a>01188     <span class="keyword">struct </span>EjsNumber    *minusOneValue;     <span class="comment">/**&lt; The -1 number value */</span>
<a name="l01189"></a>01189     <span class="keyword">struct </span>EjsNumber    *nanValue;          <span class="comment">/**&lt; The "NaN" value if floating point numbers, else zero */</span>
<a name="l01190"></a>01190     <span class="keyword">struct </span>EjsNumber    *negativeInfinityValue; <span class="comment">/**&lt; The negative infinity number value */</span>
<a name="l01191"></a>01191     <span class="keyword">struct </span>EjsFunction  *nopFunction;       <span class="comment">/**&lt; The NOP function */</span>
<a name="l01192"></a>01192     <span class="keyword">struct </span>EjsObj       *nullValue;         <span class="comment">/**&lt; The "null" value */</span>
<a name="l01193"></a>01193     <span class="keyword">struct </span>EjsNumber    *oneValue;          <span class="comment">/**&lt; The 1 number value */</span>
<a name="l01194"></a>01194     <span class="keyword">struct </span>EjsObj       *trueValue;         <span class="comment">/**&lt; The "true" value */</span>
<a name="l01195"></a>01195     <span class="keyword">struct </span>EjsObj       *undefinedValue;    <span class="comment">/**&lt; The "void" value */</span>
<a name="l01196"></a>01196     <span class="keyword">struct </span>EjsNumber    *zeroValue;         <span class="comment">/**&lt; The 0 number value */</span>
<a name="l01197"></a>01197     <span class="keyword">struct </span>EjsFunction  *memoryCallback;    <span class="comment">/**&lt; Memory.readline callback */</span>
<a name="l01198"></a>01198 
<a name="l01199"></a>01199     <span class="keyword">struct </span>EjsNamespace *emptySpace;        <span class="comment">/**&lt; Empty namespace */</span>
<a name="l01200"></a>01200     <span class="keyword">struct </span>EjsNamespace *ejsSpace;          <span class="comment">/**&lt; Ejs namespace */</span>
<a name="l01201"></a>01201     <span class="keyword">struct </span>EjsNamespace *iteratorSpace;     <span class="comment">/**&lt; Iterator namespace */</span>
<a name="l01202"></a>01202     <span class="keyword">struct </span>EjsNamespace *internalSpace;     <span class="comment">/**&lt; Internal namespace */</span>
<a name="l01203"></a>01203     <span class="keyword">struct </span>EjsNamespace *publicSpace;       <span class="comment">/**&lt; Public namespace */</span>
<a name="l01204"></a>01204 
<a name="l01205"></a>01205     <span class="keywordtype">char</span>                *castTemp;          <span class="comment">/**&lt; Temporary string for casting */</span>
<a name="l01206"></a>01206     <span class="keywordtype">char</span>                *errorMsg;          <span class="comment">/**&lt; Error message */</span>
<a name="l01207"></a>01207     cchar               **argv;             <span class="comment">/**&lt; Command line args */</span>
<a name="l01208"></a>01208     <span class="keywordtype">int</span>                 argc;               <span class="comment">/**&lt; Count of command line args */</span>
<a name="l01209"></a>01209     <span class="keywordtype">int</span>                 flags;              <span class="comment">/**&lt; Execution flags */</span>
<a name="l01210"></a>01210     <span class="keywordtype">int</span>                 exitStatus;         <span class="comment">/**&lt; Status to exit() */</span>
<a name="l01211"></a>01211     <span class="keywordtype">int</span>                 serializeDepth;     <span class="comment">/**&lt; Serialization depth */</span>
<a name="l01212"></a>01212     <span class="keywordtype">int</span>                 joining;            <span class="comment">/**&lt; In Worker.join */</span>
<a name="l01213"></a>01213     <span class="keywordtype">int</span>                 spreadArgs;         <span class="comment">/**&lt; Count of spread args */</span>
<a name="l01214"></a>01214 
<a name="l01215"></a>01215     <span class="keywordtype">int</span>                 workQuota;          <span class="comment">/* Quota of work before GC */</span>
<a name="l01216"></a>01216     <span class="keywordtype">int</span>                 workDone;           <span class="comment">/**&lt; Count of allocations to determining if GC needed */</span>
<a name="l01217"></a>01217     <span class="keywordtype">int</span>                 gcRequired;         <span class="comment">/**&lt; Garbage collection is now required */</span>
<a name="l01218"></a>01218 
<a name="l01219"></a>01219     uint                compiling: 1;       <span class="comment">/**&lt; Currently executing the compiler */</span>
<a name="l01220"></a>01220     uint                empty: 1;           <span class="comment">/**&lt; Interpreter will be created empty */</span>
<a name="l01221"></a>01221     uint                initialized: 1;     <span class="comment">/**&lt; Interpreter fully initialized and not empty */</span>
<a name="l01222"></a>01222     uint                hasError: 1;        <span class="comment">/**&lt; Interpreter has an initialization error */</span>
<a name="l01223"></a>01223     uint                exiting: 1;         <span class="comment">/**&lt; VM should exit */</span>
<a name="l01224"></a>01224 
<a name="l01225"></a>01225     <span class="keyword">struct </span>EjsObj       *exceptionArg;      <span class="comment">/**&lt; Exception object for catch block */</span>
<a name="l01226"></a>01226 
<a name="l01227"></a>01227     MprDispatcher       *dispatcher;        <span class="comment">/**&lt; Event dispatcher */</span>
<a name="l01228"></a>01228     MprList             *workers;           <span class="comment">/**&lt; Worker interpreters */</span>
<a name="l01229"></a>01229     MprList             *modules;           <span class="comment">/**&lt; Loaded modules */</span>
<a name="l01230"></a>01230 
<a name="l01231"></a>01231     void                (*loaderCallback)(<span class="keyword">struct </span>Ejs *ejs, <span class="keywordtype">int</span> kind, ...);
<a name="l01232"></a>01232     <span class="keywordtype">void</span>                *userData;          <span class="comment">/**&lt; User data */</span>
<a name="l01233"></a>01233     MprHashTable        *coreTypes;         <span class="comment">/**&lt; Core type instances */</span>
<a name="l01234"></a>01234     MprHashTable        *standardSpaces;    <span class="comment">/**&lt; Hash of standard namespaces (global namespaces) */</span>
<a name="l01235"></a>01235     MprHashTable        *doc;               <span class="comment">/**&lt; Documentation */</span>
<a name="l01236"></a>01236     <span class="keywordtype">void</span>                *sqlite;            <span class="comment">/**&lt; Sqlite context information */</span>
<a name="l01237"></a>01237 
<a name="l01238"></a>01238     Http                *http;              <span class="comment">/**&lt; Http service object (copy of EjsService.http) */</span>
<a name="l01239"></a>01239     HttpLocation        *location;          <span class="comment">/**&lt; Current HttpLocation object for web start scripts */</span>
<a name="l01240"></a>01240 
<a name="l01241"></a>01241     <span class="keyword">struct </span>EjsObj       *sessions;          <span class="comment">/**&lt; Session cache */</span>
<a name="l01242"></a>01242     <span class="keyword">struct </span>EjsType      *sessionType;       <span class="comment">/**&lt; Session type object */</span>
<a name="l01243"></a>01243     <span class="keyword">struct </span>EjsObj       *applications;      <span class="comment">/**&lt; Application cache */</span>
<a name="l01244"></a>01244     MprEvent            *sessionTimer;      <span class="comment">/**&lt; Session expiry timer */</span>
<a name="l01245"></a>01245     <span class="keywordtype">int</span>                 sessionTimeout;     <span class="comment">/**&lt; Default session timeout */</span>
<a name="l01246"></a>01246     <span class="keywordtype">int</span>                 nextSession;        <span class="comment">/**&lt; Session ID counter */</span>
<a name="l01247"></a>01247     MprMutex            *mutex;             <span class="comment">/**&lt; Multithread locking */</span>
<a name="l01248"></a>01248 } Ejs;
<a name="l01249"></a>01249 
<a name="l01250"></a>01250 
<a name="l01251"></a>01251 <span class="preprocessor">#if !DOXYGEN</span>
<a name="l01252"></a>01252 <span class="preprocessor"></span><span class="comment">/**</span>
<a name="l01253"></a>01253 <span class="comment">    Native Function signature</span>
<a name="l01254"></a>01254 <span class="comment">    @description This is the calling signature for C Functions.</span>
<a name="l01255"></a>01255 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l01256"></a>01256 <span class="comment">    @param obj Reference to the "this" object. (The object containing the method).</span>
<a name="l01257"></a>01257 <span class="comment">    @param argc Number of arguments.</span>
<a name="l01258"></a>01258 <span class="comment">    @param argv Array of arguments.</span>
<a name="l01259"></a>01259 <span class="comment">    @returns Returns a result variable or NULL on errors and exceptions.</span>
<a name="l01260"></a>01260 <span class="comment">    @stability Prototype.</span>
<a name="l01261"></a>01261 <span class="comment"> */</span>
<a name="l01262"></a>01262 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsObj *(*EjsFun)(Ejs *ejs, <span class="keyword">struct </span>EjsObj *vp, <span class="keywordtype">int</span> argc, <span class="keyword">struct </span>EjsObj **argv);
<a name="l01263"></a>01263 <span class="comment">//LEGACY</span>
<a name="l01264"></a>01264 <span class="keyword">typedef</span> EjsFun EjsProc;
<a name="l01265"></a>01265 <span class="keyword">typedef</span> EjsFun EjsNativeFunction;
<a name="l01266"></a>01266 <span class="preprocessor">#endif</span>
<a name="l01267"></a>01267 <span class="preprocessor"></span>
<a name="l01268"></a>01268 <span class="comment">//  TODO is this used?</span>
<a name="l01269"></a>01269 <span class="keyword">typedef</span> int (*EjsSortFn)(Ejs *ejs, <span class="keyword">struct </span>EjsObj *p1, <span class="keyword">struct </span>EjsObj *p2, cchar *name, <span class="keywordtype">int</span> order);
<a name="l01270"></a>01270 <span class="comment"></span>
<a name="l01271"></a>01271 <span class="comment">/**</span>
<a name="l01272"></a>01272 <span class="comment">    Qualified name structure</span>
<a name="l01273"></a>01273 <span class="comment">    @description All names in Ejscript consist of a property name and a name space. Namespaces provide discrete</span>
<a name="l01274"></a>01274 <span class="comment">        spaces to manage and minimize name conflicts. These names will soon be converted to unicode.</span>
<a name="l01275"></a>01275 <span class="comment">    @stability Prototype</span>
<a name="l01276"></a>01276 <span class="comment">    @defgroup EjsName EjsName</span>
<a name="l01277"></a>01277 <span class="comment">    @see EjsName ejsName ejsAllocName ejsDupName ejsCopyName</span>
<a name="l01278"></a>01278 <span class="comment"> */</span>       
<a name="l01279"></a>01279 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsName {
<a name="l01280"></a>01280     cchar       *name;                          <span class="comment">/**&lt; Property name */</span>
<a name="l01281"></a>01281     cchar       *space;                         <span class="comment">/**&lt; Property namespace */</span>
<a name="l01282"></a>01282 } EjsName;
<a name="l01283"></a>01283 
<a name="l01284"></a>01284 <span class="comment"></span>
<a name="l01285"></a>01285 <span class="comment">/**</span>
<a name="l01286"></a>01286 <span class="comment">    Initialize a Qualified Name structure</span>
<a name="l01287"></a>01287 <span class="comment">    @description Initialize the statically allocated qualified name structure using a name and namespace.</span>
<a name="l01288"></a>01288 <span class="comment">    @param qname Reference to an existing, uninitialized EjsName structure</span>
<a name="l01289"></a>01289 <span class="comment">    @param space Namespace string</span>
<a name="l01290"></a>01290 <span class="comment">    @param name Name string</span>
<a name="l01291"></a>01291 <span class="comment">    @return A reference to the qname structure</span>
<a name="l01292"></a>01292 <span class="comment">    @ingroup EjsName</span>
<a name="l01293"></a>01293 <span class="comment"> */</span>
<a name="l01294"></a>01294 <span class="keyword">extern</span> EjsName *<a class="code" href="group___ejs_name.html#geecb8458a156bed35038acffae182cf4" title="Initialize a Qualified Name structure.">ejsName</a>(<span class="keyword">struct</span> EjsName *qname, cchar *space, cchar *name);
<a name="l01295"></a>01295 
<a name="l01296"></a>01296 <span class="preprocessor">#define EN(qname, name) ejsName(qname, "", name)</span>
<a name="l01297"></a>01297 <span class="preprocessor"></span><span class="comment"></span>
<a name="l01298"></a>01298 <span class="comment">/**</span>
<a name="l01299"></a>01299 <span class="comment">    Allocate and Initialize  a Qualified Name structure</span>
<a name="l01300"></a>01300 <span class="comment">    @description Create and initialize a qualified name structure using a name and namespace.</span>
<a name="l01301"></a>01301 <span class="comment">    @param ctx Any memory context returned by mprAlloc</span>
<a name="l01302"></a>01302 <span class="comment">    @param space Namespace string</span>
<a name="l01303"></a>01303 <span class="comment">    @param name Name string</span>
<a name="l01304"></a>01304 <span class="comment">    @return A reference to an allocated EjsName structure. Caller must free.</span>
<a name="l01305"></a>01305 <span class="comment">    @ingroup EjsName</span>
<a name="l01306"></a>01306 <span class="comment"> */</span>
<a name="l01307"></a>01307 <span class="keyword">extern</span> EjsName *<a class="code" href="group___ejs_name.html#g39d2e825dc6f47acd0bcd48b125e78f7" title="Allocate and Initialize a Qualified Name structure.">ejsAllocName</a>(MprCtx ctx, cchar *space, cchar *name);
<a name="l01308"></a>01308 
<a name="l01309"></a>01309 <span class="keyword">extern</span> EjsName *ejsDupName(MprCtx ctx, EjsName *qname);
<a name="l01310"></a>01310 <span class="keyword">extern</span> EjsName ejsCopyName(MprCtx ctx, EjsName *qname);
<a name="l01311"></a>01311 <span class="comment"></span>
<a name="l01312"></a>01312 <span class="comment">/** </span>
<a name="l01313"></a>01313 <span class="comment">    Property traits. </span>
<a name="l01314"></a>01314 <span class="comment">    @description Property traits describe the type and access attributes of a property. The Trait structure</span>
<a name="l01315"></a>01315 <span class="comment">        is used by EjsBlock to describe the attributes of properties defined within a block.</span>
<a name="l01316"></a>01316 <span class="comment">        Note: These traits apply to a property definition and not to the referenced object. ie. two property </span>
<a name="l01317"></a>01317 <span class="comment">        definitions may have different traits but will refer to the same object.</span>
<a name="l01318"></a>01318 <span class="comment">    @stability Evolving</span>
<a name="l01319"></a>01319 <span class="comment">    @ingroup EjsBlock</span>
<a name="l01320"></a>01320 <span class="comment"> */</span>
<a name="l01321"></a><a class="code" href="struct_ejs_trait.html">01321</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_ejs_trait.html" title="Property traits.">EjsTrait</a> {
<a name="l01322"></a><a class="code" href="struct_ejs_trait.html#961914cbb3a11edfc7ff443f3ae937bc">01322</a>     <span class="keyword">struct </span>EjsType  *<a class="code" href="struct_ejs_trait.html#961914cbb3a11edfc7ff443f3ae937bc" title="Property type (prototype).">type</a>;                  <span class="comment">/**&lt; Property type (prototype) */</span>
<a name="l01323"></a><a class="code" href="struct_ejs_trait.html#6c7bb3a39392f6decb954181dcd69bcb">01323</a>     <span class="keywordtype">int</span>             <a class="code" href="struct_ejs_trait.html#6c7bb3a39392f6decb954181dcd69bcb" title="Modifier attributes.">attributes</a>;             <span class="comment">/**&lt; Modifier attributes */</span>
<a name="l01324"></a>01324 } <a class="code" href="struct_ejs_trait.html" title="Property traits.">EjsTrait</a>;
<a name="l01325"></a>01325 
<a name="l01326"></a>01326 
<a name="l01327"></a>01327 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsSlot {
<a name="l01328"></a>01328     EjsName         qname;                  <span class="comment">/**&lt; Property name */</span>
<a name="l01329"></a>01329     <span class="keywordtype">int</span>             hashChain;              <span class="comment">/**&lt; Next property in hash chain */</span>
<a name="l01330"></a>01330     <a class="code" href="struct_ejs_trait.html" title="Property traits.">EjsTrait</a>        trait;                  <span class="comment">/**&lt; Property descriptor traits */</span>
<a name="l01331"></a>01331     <span class="keyword">union </span>{
<a name="l01332"></a>01332         <span class="keyword">struct </span>EjsObj *ref;                 <span class="comment">/**&lt; Vector of slots containing property references */</span>
<a name="l01333"></a>01333         MprNumber   *number;                <span class="comment">/**&lt; Immediate number value */</span>
<a name="l01334"></a>01334     } value;
<a name="l01335"></a>01335 } EjsSlot;
<a name="l01336"></a>01336 
<a name="l01337"></a>01337 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsSlots {
<a name="l01338"></a>01338     <span class="keyword">struct </span>EjsSlot  *slots;                 <span class="comment">/**&lt; Vector of slots containing property references */</span>
<a name="l01339"></a>01339     <span class="keywordtype">int</span>             sizeSlots;              <span class="comment">/**&lt; Current size of traits[] and slots[] */</span>
<a name="l01340"></a>01340     <span class="keywordtype">int</span>             numSlots;               <span class="comment">/**&lt; Number of properties in traits/slots */</span>
<a name="l01341"></a>01341 } EjsSlots;
<a name="l01342"></a>01342 
<a name="l01343"></a>01343 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsHash {
<a name="l01344"></a>01344     <span class="keywordtype">int</span>             size;                   <span class="comment">/**&lt; Size of hash */</span>
<a name="l01345"></a>01345     <span class="keywordtype">int</span>             *buckets;               <span class="comment">/**&lt; Hash buckets and head of link chains */</span>
<a name="l01346"></a>01346 } EjsHash;
<a name="l01347"></a>01347 
<a name="l01348"></a>01348 <span class="comment"></span>
<a name="l01349"></a>01349 <span class="comment">/** </span>
<a name="l01350"></a>01350 <span class="comment">    Object Type. Base type for all objects.</span>
<a name="l01351"></a>01351 <span class="comment">    @description The EjsObj type is the foundation for all types, blocks, functions and scripted classes. </span>
<a name="l01352"></a>01352 <span class="comment">        It provides storage and hashed lookup for properties.</span>
<a name="l01353"></a>01353 <span class="comment">        \n\n</span>
<a name="l01354"></a>01354 <span class="comment">        EjsObj stores properties in an array of slots. These slots store a reference to the property value. </span>
<a name="l01355"></a>01355 <span class="comment">        Property names are stored in a names hash. Dynamic objects own their own name hash. Sealed object instances </span>
<a name="l01356"></a>01356 <span class="comment">        of a type, will simply refer to the hash of names owned by the type.</span>
<a name="l01357"></a>01357 <span class="comment">        \n\n</span>
<a name="l01358"></a>01358 <span class="comment">        EjsObjs may be either dynamic or sealed. Dynamic objects can grow the number of properties. Sealed </span>
<a name="l01359"></a>01359 <span class="comment">        objects cannot. Sealed objects will store the slot array as part of the EjsObj memory chunk. Dynamic </span>
<a name="l01360"></a>01360 <span class="comment">        objects will perform a separate allocation for the slot array so that it can grow.</span>
<a name="l01361"></a>01361 <span class="comment">    @stability Evolving.</span>
<a name="l01362"></a>01362 <span class="comment">    @defgroup EjsObj EjsObj</span>
<a name="l01363"></a>01363 <span class="comment">    @see EjsObj ejsIsObject ejsCreateSimpleObject ejsCreateObject ejsCloneObject ejsGrowObject ejsMarkObject</span>
<a name="l01364"></a>01364 <span class="comment">        TODO - change these From Var</span>
<a name="l01365"></a>01365 <span class="comment">        ejsGetVarType ejsAllocObj ejsFreeObj ejsCast ejsClone ejsCreateInstance ejsCreateVar</span>
<a name="l01366"></a>01366 <span class="comment">        ejsDestroyVar ejsDefineProperty ejsDeleteProperty ejsDeletePropertyByName</span>
<a name="l01367"></a>01367 <span class="comment">        ejsGetProperty ejsLookupProperty ejsSetProperty ejsSetPropertyByName ejsSetPropertyName</span>
<a name="l01368"></a>01368 <span class="comment">        ejsSetPropertyTrait ejsDeserialize ejsParseVar</span>
<a name="l01369"></a>01369 <span class="comment"> */</span>
<a name="l01370"></a>01370 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsObj {
<a name="l01371"></a>01371 <span class="preprocessor">#if BLD_DEBUG</span>
<a name="l01372"></a>01372 <span class="preprocessor"></span>    cchar   *name;                              <span class="comment">/**&lt; Name useful when debugging memory allocations */</span>
<a name="l01373"></a>01373     <span class="keywordtype">int</span>     seq;                                <span class="comment">/**&lt; Unique allocations squence */</span>
<a name="l01374"></a>01374 <span class="preprocessor">#endif</span>
<a name="l01375"></a>01375 <span class="preprocessor"></span>
<a name="l01376"></a>01376 <span class="preprocessor">#if BLD_HAS_UNNAMED_UNIONS</span>
<a name="l01377"></a>01377 <span class="preprocessor"></span>    <span class="keyword">union </span>{
<a name="l01378"></a>01378         <span class="keyword">struct </span>{
<a name="l01379"></a>01379 <span class="preprocessor">#endif</span>
<a name="l01380"></a>01380 <span class="preprocessor"></span>            uint    builtin           :  1;     <span class="comment">/**&lt; Object is part of ejs-core */</span>
<a name="l01381"></a>01381             uint    dynamic           :  1;     <span class="comment">/**&lt; Object may add properties */</span>
<a name="l01382"></a>01382             uint    isFrame           :  1;     <span class="comment">/**&lt; Instance is a frame */</span>
<a name="l01383"></a>01383             uint    isFunction        :  1;     <span class="comment">/**&lt; Instance is a function */</span>
<a name="l01384"></a>01384             uint    isPrototype       :  1;     <span class="comment">/**&lt; Object is a type prototype object */</span>
<a name="l01385"></a>01385             uint    isType            :  1;     <span class="comment">/**&lt; Instance is a type object */</span>
<a name="l01386"></a>01386             uint    marked            :  1;     <span class="comment">/**&lt; GC marked in use */</span>
<a name="l01387"></a>01387             uint    master            :  1;     <span class="comment">/**&lt; Allocated in the master interpreter */</span>
<a name="l01388"></a>01388             uint    permanent         :  1;     <span class="comment">/**&lt; Object is immune from GC */</span>
<a name="l01389"></a>01389             uint    separateSlots     :  1;     <span class="comment">/**&lt; Object has separate slots[] memory */</span>
<a name="l01390"></a>01390             uint    shortScope        :  1;     <span class="comment">/**&lt; Don't follow type or base classes */</span>
<a name="l01391"></a>01391             uint    visited           :  1;     <span class="comment">/**&lt; Has been traversed */</span>
<a name="l01392"></a>01392 <span class="preprocessor">#if BLD_HAS_UNNAMED_UNIONS</span>
<a name="l01393"></a>01393 <span class="preprocessor"></span>        };
<a name="l01394"></a>01394         <span class="keywordtype">int</span>         bits;
<a name="l01395"></a>01395     };
<a name="l01396"></a>01396 <span class="preprocessor">#endif</span>
<a name="l01397"></a>01397 <span class="preprocessor"></span>    <span class="keyword">struct </span>EjsType  *type;                      <span class="comment">/**&lt; Type of this object (not base type). ie. type for Object is EjsType  */</span>
<a name="l01398"></a>01398 
<a name="l01399"></a>01399     <span class="comment">//  MOB -- convert to EjsSlots *properties;</span>
<a name="l01400"></a>01400     <span class="keyword">struct </span>EjsSlot  *slots;                     <span class="comment">/**&lt; Vector of slots containing property references */</span>
<a name="l01401"></a>01401     <span class="keywordtype">int</span>             sizeSlots;                  <span class="comment">/**&lt; Current size of traits[] and slots[] */</span>
<a name="l01402"></a>01402     <span class="keywordtype">int</span>             numSlots;                   <span class="comment">/**&lt; Number of properties in traits/slots */</span>
<a name="l01403"></a>01403 
<a name="l01404"></a>01404     EjsHash         *hash;                      <span class="comment">/**&lt; Hash buckets and head of link chains */</span>
<a name="l01405"></a>01405 } EjsObj;
<a name="l01406"></a>01406 
<a name="l01407"></a>01407 <span class="comment">//  LEGACY TODO</span>
<a name="l01408"></a>01408 <span class="keyword">typedef</span> EjsObj EjsVar;
<a name="l01409"></a>01409 <span class="keyword">typedef</span> EjsObj EO;
<a name="l01410"></a>01410 
<a name="l01411"></a>01411 <span class="preprocessor">#if DOXYGEN</span>
<a name="l01412"></a>01412 <span class="preprocessor"></span><span class="comment">    /** </span>
<a name="l01413"></a>01413 <span class="comment">        Get a variables type</span>
<a name="l01414"></a>01414 <span class="comment">        @description Get the base type for a variable</span>
<a name="l01415"></a>01415 <span class="comment">        @param vp Variable reference</span>
<a name="l01416"></a>01416 <span class="comment">        @returns A reference to the variables type object</span>
<a name="l01417"></a>01417 <span class="comment">        @ingroup EjsObj</span>
<a name="l01418"></a>01418 <span class="comment">     */</span>
<a name="l01419"></a>01419     <span class="keyword">extern</span> EjsType *<a class="code" href="group___ejs_obj.html#g5cb5fc3dcebf49849eec312e5a9c6de6" title="Get a variables type.">ejsGetVarType</a>(EjsObj *vp);
<a name="l01420"></a>01420 <span class="preprocessor">#else</span>
<a name="l01421"></a>01421 <span class="preprocessor"></span><span class="preprocessor">    #define ejsGetVarType(vp)       (vp-&gt;type)</span>
<a name="l01422"></a>01422 <span class="preprocessor"></span><span class="preprocessor">    #if BLD_DEBUG</span>
<a name="l01423"></a>01423 <span class="preprocessor"></span><span class="preprocessor">    #define ejsGetDebugName(vp) (ejsIsType(vp) ? ((EjsType*)(vp))-&gt;qname.name : mprGetName(vp))</span>
<a name="l01424"></a>01424 <span class="preprocessor"></span><span class="preprocessor">    #define ejsSetDebugName(vp, debugName) \</span>
<a name="l01425"></a>01425 <span class="preprocessor">        if (1) { \</span>
<a name="l01426"></a>01426 <span class="preprocessor">            mprSetName(vp, debugName); \</span>
<a name="l01427"></a>01427 <span class="preprocessor">            ((EjsObj*) vp)-&gt;name = debugName; \</span>
<a name="l01428"></a>01428 <span class="preprocessor">        } else</span>
<a name="l01429"></a>01429 <span class="preprocessor"></span><span class="preprocessor">    #else</span>
<a name="l01430"></a>01430 <span class="preprocessor"></span><span class="preprocessor">    #define ejsGetDebugName(vp) (ejsIsType(vp) ? ((EjsType*)(vp))-&gt;qname.name : "")</span>
<a name="l01431"></a>01431 <span class="preprocessor"></span><span class="preprocessor">    #define ejsSetDebugName(vp, name)</span>
<a name="l01432"></a>01432 <span class="preprocessor"></span><span class="preprocessor">    #define ejsSetFmtDebugName(vp, fmt, arg)</span>
<a name="l01433"></a>01433 <span class="preprocessor"></span><span class="preprocessor">    #endif</span>
<a name="l01434"></a>01434 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01435"></a>01435 <span class="preprocessor"></span>
<a name="l01436"></a>01436 <span class="keyword">extern</span> <span class="keywordtype">void</span> *ejsAlloc(Ejs *ejs, <span class="keywordtype">int</span> size);
<a name="l01437"></a>01437 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsFree(Ejs *ejs, <span class="keywordtype">void</span> *ptr);
<a name="l01438"></a>01438 <span class="comment"></span>
<a name="l01439"></a>01439 <span class="comment">/** </span>
<a name="l01440"></a>01440 <span class="comment">    Allocate a new variable</span>
<a name="l01441"></a>01441 <span class="comment">    @description This will allocate space for a bare variable. This routine should only be called by type factories</span>
<a name="l01442"></a>01442 <span class="comment">        when implementing the createVar helper.</span>
<a name="l01443"></a>01443 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01444"></a>01444 <span class="comment">    @param type Type object from which to create an object instance</span>
<a name="l01445"></a>01445 <span class="comment">    @param size Size of extra property slots to reserve. This is used for dynamic objects.</span>
<a name="l01446"></a>01446 <span class="comment">    @return A newly allocated variable of the requested type. Caller must not free as the GC will manage the lifecycle</span>
<a name="l01447"></a>01447 <span class="comment">        of the variable.</span>
<a name="l01448"></a>01448 <span class="comment">    @ingroup EjsObj</span>
<a name="l01449"></a>01449 <span class="comment"> */</span>
<a name="l01450"></a>01450 <span class="keyword">extern</span> EjsObj *<a class="code" href="group___ejs_obj.html#g4961c97d226991809df294be056f3be1" title="Allocate a new variable.">ejsAllocVar</a>(Ejs *ejs, <span class="keyword">struct</span> EjsType *type, <span class="keywordtype">int</span> size);
<a name="l01451"></a>01451 <span class="keyword">extern</span> EjsObj *ejsAllocPooled(Ejs *ejs, <span class="keywordtype">int</span> <span class="keywordtype">id</span>);
<a name="l01452"></a>01452 <span class="comment"></span>
<a name="l01453"></a>01453 <span class="comment">/**</span>
<a name="l01454"></a>01454 <span class="comment">    Free a new variable</span>
<a name="l01455"></a>01455 <span class="comment">    @description This should typically only be called by the destroyVar type helper which is invoked by the GC when</span>
<a name="l01456"></a>01456 <span class="comment">        a variable is no longer needed. It should not be called by normal code.</span>
<a name="l01457"></a>01457 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01458"></a>01458 <span class="comment">    @param vp Variable to free</span>
<a name="l01459"></a>01459 <span class="comment">    @param pool Optional pool id. Set to -1 for defaults.</span>
<a name="l01460"></a>01460 <span class="comment">    @ingroup EjsObj</span>
<a name="l01461"></a>01461 <span class="comment"> */</span>
<a name="l01462"></a>01462 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="group___ejs_obj.html#g45836119edb7c2a21778603750c175bd" title="Free a new variable.">ejsFreeVar</a>(Ejs *ejs, <span class="keywordtype">void</span> *vp, <span class="keywordtype">int</span> pool);
<a name="l01463"></a>01463 <span class="comment"></span>
<a name="l01464"></a>01464 <span class="comment">/** </span>
<a name="l01465"></a>01465 <span class="comment">    Cast a variable to a new type</span>
<a name="l01466"></a>01466 <span class="comment">    @description Cast a variable and return a new variable of the required type.</span>
<a name="l01467"></a>01467 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01468"></a>01468 <span class="comment">    @param vp Variable to cast</span>
<a name="l01469"></a>01469 <span class="comment">    @param type Type to cast to</span>
<a name="l01470"></a>01470 <span class="comment">    @return A newly allocated variable of the requested type. Caller must not free as the GC will manage the lifecycle</span>
<a name="l01471"></a>01471 <span class="comment">        of the variable.</span>
<a name="l01472"></a>01472 <span class="comment">    @ingroup EjsObj</span>
<a name="l01473"></a>01473 <span class="comment"> */</span>
<a name="l01474"></a>01474 <span class="keyword">extern</span> EjsObj *<a class="code" href="group___ejs_obj.html#ge967dfd860839bcd524474c111081306" title="Cast a variable to a new type.">ejsCast</a>(Ejs *ejs, EjsObj *vp, <span class="keyword">struct</span> EjsType *type);
<a name="l01475"></a>01475 <span class="comment"></span>
<a name="l01476"></a>01476 <span class="comment">/** </span>
<a name="l01477"></a>01477 <span class="comment">    Clone a variable</span>
<a name="l01478"></a>01478 <span class="comment">    @description Copy a variable and create a new copy. This may do a shallow or deep copy. A shallow copy</span>
<a name="l01479"></a>01479 <span class="comment">        will not copy the property instances, rather it will only duplicate the property reference. A deep copy</span>
<a name="l01480"></a>01480 <span class="comment">        will recursively clone all the properties of the variable.</span>
<a name="l01481"></a>01481 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01482"></a>01482 <span class="comment">    @param vp Variable to clone</span>
<a name="l01483"></a>01483 <span class="comment">    @param deep Set to true to do a deep copy.</span>
<a name="l01484"></a>01484 <span class="comment">    @return A newly allocated variable of the requested type. Caller must not free as the GC will manage the lifecycle</span>
<a name="l01485"></a>01485 <span class="comment">        of the variable.</span>
<a name="l01486"></a>01486 <span class="comment">    @ingroup EjsObj</span>
<a name="l01487"></a>01487 <span class="comment"> */</span>
<a name="l01488"></a>01488 <span class="keyword">extern</span> EjsObj *<a class="code" href="group___ejs_obj.html#g082697e0e380a6c98c35f6affb4abd03" title="Clone a variable.">ejsClone</a>(Ejs *ejs, EjsObj *vp, <span class="keywordtype">bool</span> deep);
<a name="l01489"></a>01489 <span class="comment"></span>
<a name="l01490"></a>01490 <span class="comment">/** </span>
<a name="l01491"></a>01491 <span class="comment">    Create a new variable instance </span>
<a name="l01492"></a>01492 <span class="comment">    @description Create a new variable instance and invoke any required constructors with the given arguments.</span>
<a name="l01493"></a>01493 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01494"></a>01494 <span class="comment">    @param type Type from which to create a new instance</span>
<a name="l01495"></a>01495 <span class="comment">    @param argc Count of args in argv</span>
<a name="l01496"></a>01496 <span class="comment">    @param argv Vector of arguments. Each arg is an EjsObj.</span>
<a name="l01497"></a>01497 <span class="comment">    @return A newly allocated variable of the requested type. Caller must not free as the GC will manage the lifecycle</span>
<a name="l01498"></a>01498 <span class="comment">        of the variable.</span>
<a name="l01499"></a>01499 <span class="comment">    @ingroup EjsObj</span>
<a name="l01500"></a>01500 <span class="comment"> */</span>
<a name="l01501"></a>01501 <span class="keyword">extern</span> EjsObj *<a class="code" href="group___ejs_obj.html#g7bb8763a6168fed21e045e1508ef10e9" title="Create a new variable instance.">ejsCreateInstance</a>(Ejs *ejs, <span class="keyword">struct</span> EjsType *type, <span class="keywordtype">int</span> argc, EjsObj **argv);
<a name="l01502"></a>01502 <span class="comment"></span>
<a name="l01503"></a>01503 <span class="comment">/** </span>
<a name="l01504"></a>01504 <span class="comment">    Create a variable</span>
<a name="l01505"></a>01505 <span class="comment">    @description Create a variable of the required type. This invokes the createVar helper method for the specified type.</span>
<a name="l01506"></a>01506 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01507"></a>01507 <span class="comment">    @param type Type to cast to</span>
<a name="l01508"></a>01508 <span class="comment">    @param numSlots Size of extra property slots to reserve. This is used for dynamic objects.</span>
<a name="l01509"></a>01509 <span class="comment">    @return A newly allocated variable of the requested type. Caller must not free as the GC will manage the lifecycle</span>
<a name="l01510"></a>01510 <span class="comment">        of the variable.</span>
<a name="l01511"></a>01511 <span class="comment">    @ingroup EjsObj</span>
<a name="l01512"></a>01512 <span class="comment"> */</span>
<a name="l01513"></a>01513 <span class="keyword">extern</span> EjsObj *<a class="code" href="group___ejs_obj.html#g50d9d774b3cddd1784d654326cddc237" title="Create a variable.">ejsCreate</a>(Ejs *ejs, <span class="keyword">struct</span> EjsType *type, <span class="keywordtype">int</span> numSlots);
<a name="l01514"></a>01514 <span class="comment"></span>
<a name="l01515"></a>01515 <span class="comment">/** </span>
<a name="l01516"></a>01516 <span class="comment">    Destroy a variable</span>
<a name="l01517"></a>01517 <span class="comment">    @description Destroy a variable of the required type. This invokes the destroyVar helper method for the specified type.</span>
<a name="l01518"></a>01518 <span class="comment">        The default action for the destroyVar helper is to simply invoke ejsFreeObj which will return the variable</span>
<a name="l01519"></a>01519 <span class="comment">        storage to a type pool or return the memory to the heap.</span>
<a name="l01520"></a>01520 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01521"></a>01521 <span class="comment">    @param vp Varaible to destroy</span>
<a name="l01522"></a>01522 <span class="comment">    @ingroup EjsObj</span>
<a name="l01523"></a>01523 <span class="comment"> */</span>
<a name="l01524"></a>01524 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="group___ejs_obj.html#g28cf08bc202cd514555e701ebfd7a4af" title="Destroy a variable.">ejsDestroy</a>(Ejs *ejs, EjsObj *vp);
<a name="l01525"></a>01525 <span class="comment"></span>
<a name="l01526"></a>01526 <span class="comment">/** </span>
<a name="l01527"></a>01527 <span class="comment">    Define a property</span>
<a name="l01528"></a>01528 <span class="comment">    @description Define a property in a variable and give it a name, base type, attributes and default value.</span>
<a name="l01529"></a>01529 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01530"></a>01530 <span class="comment">    @param vp Variable in which to define a property</span>
<a name="l01531"></a>01531 <span class="comment">    @param slotNum Slot number in the variable for the property. Slots are numbered sequentially from zero. Set to</span>
<a name="l01532"></a>01532 <span class="comment">        -1 to request the next available slot number.</span>
<a name="l01533"></a>01533 <span class="comment">    @param qname Qualified name containing a name and a namespace.</span>
<a name="l01534"></a>01534 <span class="comment">    @param type Base type of the property. Set to ejs-&gt;voidType to leave as untyped.</span>
<a name="l01535"></a>01535 <span class="comment">    @param attributes Attribute traits. Useful attributes include:</span>
<a name="l01536"></a>01536 <span class="comment">        @li EJS_FUN_OVERRIDE</span>
<a name="l01537"></a>01537 <span class="comment">        @li EJS_ATTR_CONST</span>
<a name="l01538"></a>01538 <span class="comment">        @li EJS_ATTR_ENUMERABLE</span>
<a name="l01539"></a>01539 <span class="comment">    @param value Initial value of the property</span>
<a name="l01540"></a>01540 <span class="comment">    @return A postitive slot number or a negative MPR error code.</span>
<a name="l01541"></a>01541 <span class="comment">    @ingroup EjsObj</span>
<a name="l01542"></a>01542 <span class="comment"> */</span>
<a name="l01543"></a>01543 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_obj.html#ge98ad7a01f5fb0da7801d81aa6df7e27" title="Define a property.">ejsDefineProperty</a>(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum, EjsName *qname, <span class="keyword">struct</span> EjsType *type, 
<a name="l01544"></a>01544     int64 attributes, EjsObj *value);
<a name="l01545"></a>01545 <span class="comment"></span>
<a name="l01546"></a>01546 <span class="comment">/** </span>
<a name="l01547"></a>01547 <span class="comment">    Delete a property</span>
<a name="l01548"></a>01548 <span class="comment">    @description Delete a variable's property and set its slot to null. The slot is not reclaimed and subsequent properties</span>
<a name="l01549"></a>01549 <span class="comment">        are not compacted.</span>
<a name="l01550"></a>01550 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01551"></a>01551 <span class="comment">    @param vp Variable in which to delete the property</span>
<a name="l01552"></a>01552 <span class="comment">    @param slotNum Slot number in the variable for the property to delete.</span>
<a name="l01553"></a>01553 <span class="comment">    @return Zero if successful, otherwise a negative MPR error code.</span>
<a name="l01554"></a>01554 <span class="comment">    @ingroup EjsObj</span>
<a name="l01555"></a>01555 <span class="comment"> */</span>
<a name="l01556"></a>01556 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_obj.html#gb2ce5c61164fab3e4537b096c2643002" title="Delete a property.">ejsDeleteProperty</a>(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum);
<a name="l01557"></a>01557 <span class="comment"></span>
<a name="l01558"></a>01558 <span class="comment">/** </span>
<a name="l01559"></a>01559 <span class="comment">    Delete a property by name</span>
<a name="l01560"></a>01560 <span class="comment">    @description Delete a variable's property by name and set its slot to null. The property is resolved by using </span>
<a name="l01561"></a>01561 <span class="comment">        ejsLookupProperty with the specified name. Once deleted, the slot is not reclaimed and subsequent properties</span>
<a name="l01562"></a>01562 <span class="comment">        are not compacted.</span>
<a name="l01563"></a>01563 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01564"></a>01564 <span class="comment">    @param vp Variable in which to delete the property</span>
<a name="l01565"></a>01565 <span class="comment">    @param qname Qualified name for the property including name and namespace.</span>
<a name="l01566"></a>01566 <span class="comment">    @return Zero if successful, otherwise a negative MPR error code.</span>
<a name="l01567"></a>01567 <span class="comment">    @ingroup EjsObj</span>
<a name="l01568"></a>01568 <span class="comment"> */</span>
<a name="l01569"></a>01569 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_obj.html#g1618c62932d871e10abf445cb4f2cad5" title="Delete a property by name.">ejsDeletePropertyByName</a>(Ejs *ejs, EjsObj *vp, EjsName *qname);
<a name="l01570"></a>01570 <span class="comment"></span>
<a name="l01571"></a>01571 <span class="comment">/** </span>
<a name="l01572"></a>01572 <span class="comment">    Get a property</span>
<a name="l01573"></a>01573 <span class="comment">    @description Get a property from a variable at a given slot.</span>
<a name="l01574"></a>01574 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01575"></a>01575 <span class="comment">    @param vp Variable to examine</span>
<a name="l01576"></a>01576 <span class="comment">    @param slotNum Slot number for the requested property.</span>
<a name="l01577"></a>01577 <span class="comment">    @return The variable property stored at the nominated slot.</span>
<a name="l01578"></a>01578 <span class="comment">    @ingroup EjsObj</span>
<a name="l01579"></a>01579 <span class="comment"> */</span>
<a name="l01580"></a>01580 <span class="keyword">extern</span> <span class="keywordtype">void</span> *<a class="code" href="group___ejs_obj.html#g44ca44b0a510cfd2b7f787787897351a" title="Get a property.">ejsGetProperty</a>(Ejs *ejs, <span class="keywordtype">void</span> *vp, <span class="keywordtype">int</span> slotNum);
<a name="l01581"></a>01581 <span class="comment"></span>
<a name="l01582"></a>01582 <span class="comment">/** </span>
<a name="l01583"></a>01583 <span class="comment">    Get a count of properties in a variable</span>
<a name="l01584"></a>01584 <span class="comment">    @description Get a property from a variable at a given slot.</span>
<a name="l01585"></a>01585 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01586"></a>01586 <span class="comment">    @param vp Variable to examine</span>
<a name="l01587"></a>01587 <span class="comment">    @return A positive integer count of the properties stored by the variable. </span>
<a name="l01588"></a>01588 <span class="comment">    @ingroup EjsObj</span>
<a name="l01589"></a>01589 <span class="comment"> */</span>
<a name="l01590"></a>01590 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_obj.html#gcc5c8bebf6c9d7876ea0761423013051" title="Get a count of properties in a variable.">ejsGetPropertyCount</a>(Ejs *ejs, EjsObj *vp);
<a name="l01591"></a>01591 <span class="comment"></span>
<a name="l01592"></a>01592 <span class="comment">/** </span>
<a name="l01593"></a>01593 <span class="comment">    Get a variable property's name</span>
<a name="l01594"></a>01594 <span class="comment">    @description Get a property name for the property at a given slot in the  variable.</span>
<a name="l01595"></a>01595 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01596"></a>01596 <span class="comment">    @param vp Variable to examine</span>
<a name="l01597"></a>01597 <span class="comment">    @param slotNum Slot number for the requested property.</span>
<a name="l01598"></a>01598 <span class="comment">    @return The qualified property name including namespace and name. Caller must not free.</span>
<a name="l01599"></a>01599 <span class="comment">    @ingroup EjsObj</span>
<a name="l01600"></a>01600 <span class="comment"> */</span>
<a name="l01601"></a>01601 <span class="keyword">extern</span> EjsName <a class="code" href="group___ejs_obj.html#g645e369fd09511af07380601b749ee0c" title="Get a variable property&amp;#39;s name.">ejsGetPropertyName</a>(Ejs *ejs, <span class="keywordtype">void</span> *vp, <span class="keywordtype">int</span> slotNum);
<a name="l01602"></a>01602 <span class="comment"></span>
<a name="l01603"></a>01603 <span class="comment">/** </span>
<a name="l01604"></a>01604 <span class="comment">    Get a property by name</span>
<a name="l01605"></a>01605 <span class="comment">    @description Get a property from a variable by name.</span>
<a name="l01606"></a>01606 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01607"></a>01607 <span class="comment">    @param vp Variable to examine</span>
<a name="l01608"></a>01608 <span class="comment">    @param qname Qualified name specifying both a namespace and name.</span>
<a name="l01609"></a>01609 <span class="comment">    @return The variable property stored at the nominated slot.</span>
<a name="l01610"></a>01610 <span class="comment">    @ingroup EjsObj</span>
<a name="l01611"></a>01611 <span class="comment"> */</span>
<a name="l01612"></a>01612 <span class="keyword">extern</span> <span class="keywordtype">void</span> *<a class="code" href="group___ejs_obj.html#g6c0984c8b243e7cc891c7a5b89791fa4" title="Get a property by name.">ejsGetPropertyByName</a>(Ejs *ejs, <span class="keywordtype">void</span> *vp, EjsName *qname);
<a name="l01613"></a>01613 <span class="comment"></span>
<a name="l01614"></a>01614 <span class="comment">/** </span>
<a name="l01615"></a>01615 <span class="comment">    Get a property's traits</span>
<a name="l01616"></a>01616 <span class="comment">    @description Get a property's trait description. The property traits define the properties base type,</span>
<a name="l01617"></a>01617 <span class="comment">        and access attributes.</span>
<a name="l01618"></a>01618 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01619"></a>01619 <span class="comment">    @param vp Variable to examine</span>
<a name="l01620"></a>01620 <span class="comment">    @param slotNum Slot number for the requested property.</span>
<a name="l01621"></a>01621 <span class="comment">    @return A trait structure reference for the property.</span>
<a name="l01622"></a>01622 <span class="comment">    @ingroup EjsObj</span>
<a name="l01623"></a>01623 <span class="comment"> */</span>
<a name="l01624"></a>01624 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="struct_ejs_trait.html" title="Property traits.">EjsTrait</a> *<a class="code" href="group___ejs_obj.html#ga0f26761cb72cc7387a88a011c90a419" title="Get a property&amp;#39;s traits.">ejsGetPropertyTrait</a>(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum);
<a name="l01625"></a>01625 <span class="comment"></span>
<a name="l01626"></a>01626 <span class="comment">/** </span>
<a name="l01627"></a>01627 <span class="comment">    Invoke an opcode on a native type.</span>
<a name="l01628"></a>01628 <span class="comment">    @description Invoke an Ejscript byte code operator on the specified variable given the expression right hand side.</span>
<a name="l01629"></a>01629 <span class="comment">        Native types would normally implement the invokeOperator helper function to respond to this function call.</span>
<a name="l01630"></a>01630 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01631"></a>01631 <span class="comment">    @param vp Variable to examine</span>
<a name="l01632"></a>01632 <span class="comment">    @param opCode Byte ope code to execute</span>
<a name="l01633"></a>01633 <span class="comment">    @param rhs Expression right hand side for binary expression op codes. May be null for other op codes.</span>
<a name="l01634"></a>01634 <span class="comment">    @return The result of the op code or NULL if the opcode does not require a result.</span>
<a name="l01635"></a>01635 <span class="comment">    @ingroup EjsObj</span>
<a name="l01636"></a>01636 <span class="comment"> */</span>
<a name="l01637"></a>01637 <span class="keyword">extern</span> EjsObj *<a class="code" href="group___ejs_obj.html#g6c73cc22a93ad0d05f14e75d753ea164" title="Invoke an opcode on a native type.">ejsInvokeOperator</a>(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> opCode, EjsObj *rhs);
<a name="l01638"></a>01638 <span class="comment"></span>
<a name="l01639"></a>01639 <span class="comment">/** </span>
<a name="l01640"></a>01640 <span class="comment">    Lookup a property by name</span>
<a name="l01641"></a>01641 <span class="comment">    @description Search for a property by name in the given variable.</span>
<a name="l01642"></a>01642 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01643"></a>01643 <span class="comment">    @param vp Variable to examine</span>
<a name="l01644"></a>01644 <span class="comment">    @param qname Qualified name of the property to search for.</span>
<a name="l01645"></a>01645 <span class="comment">    @return The slot number containing the property. Then use #ejsGetProperty to retrieve the property or alternatively</span>
<a name="l01646"></a>01646 <span class="comment">        use ejsGetPropertyByName to lookup and retrieve in one step.</span>
<a name="l01647"></a>01647 <span class="comment">    @ingroup EjsObj</span>
<a name="l01648"></a>01648 <span class="comment"> */</span>
<a name="l01649"></a>01649 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_obj.html#gdf491fc04a99f00ed31ec30979a87470" title="Lookup a property by name.">ejsLookupProperty</a>(Ejs *ejs, EjsObj *vp, EjsName *qname);
<a name="l01650"></a>01650 <span class="comment"></span>
<a name="l01651"></a>01651 <span class="comment">/** </span>
<a name="l01652"></a>01652 <span class="comment">    Mark a variable as currently in use.</span>
<a name="l01653"></a>01653 <span class="comment">    @description Mark a variables as currently active so the garbage collector will preserve it. This routine should</span>
<a name="l01654"></a>01654 <span class="comment">        be called by native types in their markVar helper.</span>
<a name="l01655"></a>01655 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01656"></a>01656 <span class="comment">    @param vp Variable to mark as currently being used.</span>
<a name="l01657"></a>01657 <span class="comment">    @ingroup EjsObj</span>
<a name="l01658"></a>01658 <span class="comment"> */</span>
<a name="l01659"></a>01659 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="group___ejs_obj.html#gff79cc2e067b27b90618c0c5711577b6" title="Mark a variable as currently in use.">ejsMark</a>(Ejs *ejs, <span class="keywordtype">void</span> *vp);
<a name="l01660"></a>01660 <span class="comment"></span>
<a name="l01661"></a>01661 <span class="comment">/** </span>
<a name="l01662"></a>01662 <span class="comment">    Set a property's value</span>
<a name="l01663"></a>01663 <span class="comment">    @description Set a value for a property at a given slot in the specified variable.</span>
<a name="l01664"></a>01664 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01665"></a>01665 <span class="comment">    @param vp Variable to examine</span>
<a name="l01666"></a>01666 <span class="comment">    @param slotNum Slot number for the requested property.</span>
<a name="l01667"></a>01667 <span class="comment">    @param value Reference to a value to store.</span>
<a name="l01668"></a>01668 <span class="comment">    @return The slot number of the property updated.</span>
<a name="l01669"></a>01669 <span class="comment">    @ingroup EjsObj</span>
<a name="l01670"></a>01670 <span class="comment"> */</span>
<a name="l01671"></a>01671 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_obj.html#g1663e9f2141f201540d1b85e5b7d710e" title="Set a property&amp;#39;s value.">ejsSetProperty</a>(Ejs *ejs, <span class="keywordtype">void</span> *vp, <span class="keywordtype">int</span> slotNum, <span class="keywordtype">void</span> *value);
<a name="l01672"></a>01672 <span class="comment"></span>
<a name="l01673"></a>01673 <span class="comment">/** </span>
<a name="l01674"></a>01674 <span class="comment">    Set a property's value </span>
<a name="l01675"></a>01675 <span class="comment">    @description Set a value for a property. The property is located by name in the specified variable.</span>
<a name="l01676"></a>01676 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01677"></a>01677 <span class="comment">    @param vp Variable to examine</span>
<a name="l01678"></a>01678 <span class="comment">    @param qname Qualified property name.</span>
<a name="l01679"></a>01679 <span class="comment">    @param value Reference to a value to store.</span>
<a name="l01680"></a>01680 <span class="comment">    @return The slot number of the property updated.</span>
<a name="l01681"></a>01681 <span class="comment">    @ingroup EjsObj</span>
<a name="l01682"></a>01682 <span class="comment"> */</span>
<a name="l01683"></a>01683 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_obj.html#g46bc13dc919529d20160d3e4278db49d" title="Set a property&amp;#39;s value.">ejsSetPropertyByName</a>(Ejs *ejs, <span class="keywordtype">void</span> *vp, EjsName *qname, <span class="keywordtype">void</span> *value);
<a name="l01684"></a>01684 <span class="comment"></span>
<a name="l01685"></a>01685 <span class="comment">/** </span>
<a name="l01686"></a>01686 <span class="comment">    Set a property's name </span>
<a name="l01687"></a>01687 <span class="comment">    @description Set a qualified name for a property at the specified slot in the variable. The qualified name</span>
<a name="l01688"></a>01688 <span class="comment">        consists of a namespace and name - both of which must be persistent. A typical paradigm is for these name</span>
<a name="l01689"></a>01689 <span class="comment">        strings to be owned by the memory context of the variable.</span>
<a name="l01690"></a>01690 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01691"></a>01691 <span class="comment">    @param vp Variable to examine</span>
<a name="l01692"></a>01692 <span class="comment">    @param slotNum Slot number of the property in the variable.</span>
<a name="l01693"></a>01693 <span class="comment">    @param qname Qualified property name.</span>
<a name="l01694"></a>01694 <span class="comment">    @return The slot number of the property updated.</span>
<a name="l01695"></a>01695 <span class="comment">    @ingroup EjsObj</span>
<a name="l01696"></a>01696 <span class="comment"> */</span>
<a name="l01697"></a>01697 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_obj.html#g7fabfe8aff123c995c670685fff11a9b" title="Set a property&amp;#39;s name.">ejsSetPropertyName</a>(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum, EjsName *qname);
<a name="l01698"></a>01698 <span class="comment"></span>
<a name="l01699"></a>01699 <span class="comment">/** </span>
<a name="l01700"></a>01700 <span class="comment">    Set a property's traits</span>
<a name="l01701"></a>01701 <span class="comment">    @description Set the traits describing a property. These include the property's base type and access attributes.</span>
<a name="l01702"></a>01702 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01703"></a>01703 <span class="comment">    @param vp Variable to examine</span>
<a name="l01704"></a>01704 <span class="comment">    @param slotNum Slot number of the property in the variable.</span>
<a name="l01705"></a>01705 <span class="comment">    @param type Base type for the property. Set to NULL for an untyped property.</span>
<a name="l01706"></a>01706 <span class="comment">    @param attributes Integer mask of access attributes.</span>
<a name="l01707"></a>01707 <span class="comment">    @return The slot number of the property updated.</span>
<a name="l01708"></a>01708 <span class="comment">    @ingroup EjsObj</span>
<a name="l01709"></a>01709 <span class="comment"> */</span>
<a name="l01710"></a>01710 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_obj.html#g8e22dcbfaea2e1d8805f363d88eef455" title="Set a property&amp;#39;s traits.">ejsSetPropertyTrait</a>(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum, <span class="keyword">struct</span> EjsType *<a class="code" href="struct_ejs_trait.html#961914cbb3a11edfc7ff443f3ae937bc" title="Property type (prototype).">type</a>, <span class="keywordtype">int</span> <a class="code" href="struct_ejs_trait.html#6c7bb3a39392f6decb954181dcd69bcb" title="Modifier attributes.">attributes</a>);
<a name="l01711"></a>01711 
<a name="l01712"></a>01712 <span class="comment">//  TODO - DOC - </span>
<a name="l01713"></a>01713 <span class="keyword">extern</span> EjsObj  *ejsDeserialize(Ejs *ejs, <span class="keyword">struct</span> EjsString *value);
<a name="l01714"></a>01714 
<a name="l01715"></a>01715 <span class="comment">//  TODO - DOC</span>
<a name="l01716"></a>01716 <span class="keyword">extern</span> EjsObj *ejsParse(Ejs *ejs, cchar *str,  <span class="keywordtype">int</span> prefType);
<a name="l01717"></a>01717 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsZeroSlots(Ejs *ejs, EjsSlot *slots, <span class="keywordtype">int</span> count);
<a name="l01718"></a>01718 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsCopySlots(Ejs *ejs, EjsObj *obj, EjsSlot *dest, EjsSlot *src, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> dup);
<a name="l01719"></a>01719 <span class="comment"></span>
<a name="l01720"></a>01720 <span class="comment">/** </span>
<a name="l01721"></a>01721 <span class="comment">    Create a simple object</span>
<a name="l01722"></a>01722 <span class="comment">    @description Create a simple object using Object as its base type.</span>
<a name="l01723"></a>01723 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01724"></a>01724 <span class="comment">    @return A new object instance</span>
<a name="l01725"></a>01725 <span class="comment">    @ingroup EjsObj</span>
<a name="l01726"></a>01726 <span class="comment"> */</span>
<a name="l01727"></a>01727 <span class="keyword">extern</span> EjsObj *<a class="code" href="group___ejs_obj.html#gea80a8028f9d83f0acb4b350904cb40e" title="Create a simple object.">ejsCreateSimpleObject</a>(Ejs *ejs);
<a name="l01728"></a>01728 <span class="comment"></span>
<a name="l01729"></a>01729 <span class="comment">/** </span>
<a name="l01730"></a>01730 <span class="comment">    Create an object instance of the specified type</span>
<a name="l01731"></a>01731 <span class="comment">    @description Create a new object using the specified type as a base class. </span>
<a name="l01732"></a>01732 <span class="comment">        Note: the constructor is not called. If you require the constructor to be invoked, use #ejsCreateInstance</span>
<a name="l01733"></a>01733 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01734"></a>01734 <span class="comment">    @param type Base type to use when creating the object instance</span>
<a name="l01735"></a>01735 <span class="comment">    @param size Number of extra slots to allocate when creating the object</span>
<a name="l01736"></a>01736 <span class="comment">    @return A new object instance</span>
<a name="l01737"></a>01737 <span class="comment">    @ingroup EjsObj</span>
<a name="l01738"></a>01738 <span class="comment"> */</span>
<a name="l01739"></a>01739 <span class="keyword">extern</span> <span class="keywordtype">void</span> *<a class="code" href="group___ejs_obj.html#g1fd05d0bb2afdf48e757d752148bbe71" title="Create an object instance of the specified type.">ejsCreateObject</a>(Ejs *ejs, <span class="keyword">struct</span> EjsType *<a class="code" href="struct_ejs_trait.html#961914cbb3a11edfc7ff443f3ae937bc" title="Property type (prototype).">type</a>, <span class="keywordtype">int</span> size);
<a name="l01740"></a>01740 
<a name="l01741"></a>01741 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsInsertGrowObject(Ejs *ejs, EjsObj *obj, <span class="keywordtype">int</span> numSlots, <span class="keywordtype">int</span> offset);
<a name="l01742"></a>01742 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsRemoveProperty(Ejs *ejs, EjsObj *obj, <span class="keywordtype">int</span> slotNum);
<a name="l01743"></a>01743 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsGetOwnNames(Ejs *ejs, EjsObj *obj, <span class="keywordtype">int</span> sizeNames);
<a name="l01744"></a>01744 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsMakeObjHash(EjsObj *obj);
<a name="l01745"></a>01745 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsClearObjHash(EjsObj *obj);
<a name="l01746"></a>01746 
<a name="l01747"></a>01747 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsGetOwnTraits(Ejs *ejs, EjsObj *obj, <span class="keywordtype">int</span> sizeTraits);
<a name="l01748"></a>01748 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsSetTraitType(<span class="keyword">struct</span> <a class="code" href="struct_ejs_trait.html" title="Property traits.">EjsTrait</a> *trait, <span class="keyword">struct</span> EjsType *<a class="code" href="struct_ejs_trait.html#961914cbb3a11edfc7ff443f3ae937bc" title="Property type (prototype).">type</a>);
<a name="l01749"></a>01749 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsSetTraitAttributes(<span class="keyword">struct</span> <a class="code" href="struct_ejs_trait.html" title="Property traits.">EjsTrait</a> *trait, <span class="keywordtype">int</span> <a class="code" href="struct_ejs_trait.html#6c7bb3a39392f6decb954181dcd69bcb" title="Modifier attributes.">attributes</a>);
<a name="l01750"></a>01750 <span class="keyword">extern</span> <a class="code" href="struct_ejs_trait.html" title="Property traits.">EjsTrait</a> *ejsGetTrait(Ejs *ejs, <span class="keywordtype">void</span> *obj, <span class="keywordtype">int</span> slotNum);
<a name="l01751"></a>01751 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsSetTraitDetails(Ejs *ejs, <span class="keywordtype">void</span> *vp, <span class="keywordtype">int</span> slotNum, <span class="keyword">struct</span> EjsType *<a class="code" href="struct_ejs_trait.html#961914cbb3a11edfc7ff443f3ae937bc" title="Property type (prototype).">type</a>, <span class="keywordtype">int</span> <a class="code" href="struct_ejs_trait.html#6c7bb3a39392f6decb954181dcd69bcb" title="Modifier attributes.">attributes</a>);
<a name="l01752"></a>01752 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsHasTrait(EjsObj *obj, <span class="keywordtype">int</span> slotNum, <span class="keywordtype">int</span> <a class="code" href="struct_ejs_trait.html#6c7bb3a39392f6decb954181dcd69bcb" title="Modifier attributes.">attributes</a>);
<a name="l01753"></a>01753 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsGetTraitAttributes(EjsObj *obj, <span class="keywordtype">int</span> slotNum);
<a name="l01754"></a>01754 <span class="keyword">extern</span> <span class="keyword">struct </span>EjsType *ejsGetTraitType(EjsObj *obj, <span class="keywordtype">int</span> slotNum);
<a name="l01755"></a>01755 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsBlendObject(Ejs *ejs, EjsObj *dest, EjsObj *src, <span class="keywordtype">int</span> overwrite);
<a name="l01756"></a>01756 
<a name="l01757"></a>01757 
<a name="l01758"></a>01758 <span class="comment">//  TODO - inconsistent naming vs ejsCloneVar (clone vs copy)</span>
<a name="l01759"></a>01759 <span class="comment">//</span><span class="comment"></span>
<a name="l01760"></a>01760 <span class="comment">/** </span>
<a name="l01761"></a>01761 <span class="comment">    Copy an object</span>
<a name="l01762"></a>01762 <span class="comment">    @description Copy an object create a new instance. This may do a shallow or deep copy depending on the value of </span>
<a name="l01763"></a>01763 <span class="comment">        \a deep. A shallow copy will not copy the property instances, rather it will only duplicate the property </span>
<a name="l01764"></a>01764 <span class="comment">        reference. A deep copy will recursively clone all the properties of the variable.</span>
<a name="l01765"></a>01765 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01766"></a>01766 <span class="comment">    @param src Source object to copy</span>
<a name="l01767"></a>01767 <span class="comment">    @param deep Set to true to do a deep copy.</span>
<a name="l01768"></a>01768 <span class="comment">    @return A newly allocated object. Caller must not free as the GC will manage the lifecycle of the variable.</span>
<a name="l01769"></a>01769 <span class="comment">    @ingroup EjsObj</span>
<a name="l01770"></a>01770 <span class="comment"> */</span>
<a name="l01771"></a>01771 <span class="keyword">extern</span> <span class="keywordtype">void</span> *<a class="code" href="group___ejs_obj.html#g040d0590c1b16279cfad10c173f44fa7" title="Copy an object.">ejsCloneObject</a>(Ejs *ejs, <span class="keywordtype">void</span> *src, <span class="keywordtype">bool</span> deep);
<a name="l01772"></a>01772 <span class="comment"></span>
<a name="l01773"></a>01773 <span class="comment">/** </span>
<a name="l01774"></a>01774 <span class="comment">    Grow an object</span>
<a name="l01775"></a>01775 <span class="comment">    @description Grow the property storage for an object. Object properties are stored in slots. To store more </span>
<a name="l01776"></a>01776 <span class="comment">        properties, you need to grow the slots.</span>
<a name="l01777"></a>01777 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01778"></a>01778 <span class="comment">    @param obj Object reference to grow</span>
<a name="l01779"></a>01779 <span class="comment">    @param numSlots New minimum count of properties. If size is less than the current number of properties, the call</span>
<a name="l01780"></a>01780 <span class="comment">        will be ignored, i.e. it will not shrink objects.</span>
<a name="l01781"></a>01781 <span class="comment">    @return Zero if successful</span>
<a name="l01782"></a>01782 <span class="comment">    @ingroup EjsObj</span>
<a name="l01783"></a>01783 <span class="comment"> */</span>
<a name="l01784"></a>01784 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_obj.html#g66e600a6e63671a159956c0fd72cfa24" title="Grow an object.">ejsGrowObject</a>(Ejs *ejs, EjsObj *obj, <span class="keywordtype">int</span> numSlots);
<a name="l01785"></a>01785 <span class="comment"></span>
<a name="l01786"></a>01786 <span class="comment">/** </span>
<a name="l01787"></a>01787 <span class="comment">    Mark an object as currently in use.</span>
<a name="l01788"></a>01788 <span class="comment">    @description Mark an object as currently active so the garbage collector will preserve it. This routine should</span>
<a name="l01789"></a>01789 <span class="comment">        be called by native types that extend EjsObj in their markVar helper.</span>
<a name="l01790"></a>01790 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01791"></a>01791 <span class="comment">    @param obj Object to mark as currently being used.</span>
<a name="l01792"></a>01792 <span class="comment">    @ingroup EjsObj</span>
<a name="l01793"></a>01793 <span class="comment"> */</span>
<a name="l01794"></a>01794 <span class="keyword">extern</span> <span class="keywordtype">void</span>     <a class="code" href="group___ejs_obj.html#g4ff5e12635615b2dbcb5ddd6fe3c90cf" title="Mark an object as currently in use.">ejsMarkObject</a>(Ejs *ejs, <span class="keywordtype">void</span> *obj);
<a name="l01795"></a>01795 
<a name="l01796"></a>01796 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsGetSlot(Ejs *ejs, EjsObj *obj, <span class="keywordtype">int</span> slotNum);
<a name="l01797"></a>01797 <span class="keyword">extern</span> EjsObj   *ejsCoerceOperands(Ejs *ejs, EjsObj *lhs, <span class="keywordtype">int</span> opcode, EjsObj *rhs);
<a name="l01798"></a>01798 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsComputeHashCode(EjsObj *obj, EjsName *qname);
<a name="l01799"></a>01799 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsGetHashSize(<span class="keywordtype">int</span> numProp);
<a name="l01800"></a>01800 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateObjectHelpers(Ejs *ejs);
<a name="l01801"></a>01801 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsInsertGrowObject(Ejs *ejs, EjsObj *obj, <span class="keywordtype">int</span> size, <span class="keywordtype">int</span> offset);
<a name="l01802"></a>01802 <span class="preprocessor">#if UNUSED</span>
<a name="l01803"></a>01803 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsLookupSingleProperty(Ejs *ejs, EjsObj *obj, EjsName *qname);
<a name="l01804"></a>01804 <span class="preprocessor">#endif</span>
<a name="l01805"></a>01805 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsMakePropertyDontDelete(EjsObj *vp, <span class="keywordtype">int</span> dontDelete);
<a name="l01806"></a>01806 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsMakePropertyEnumerable(EjsObj *vp, <span class="keywordtype">bool</span> enumerable);
<a name="l01807"></a>01807 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsMakePropertyReadOnly(EjsObj *vp, <span class="keywordtype">int</span> readonly);
<a name="l01808"></a>01808 <span class="keyword">extern</span> EjsObj   *ejsObjectOperator(Ejs *ejs, EjsObj *lhs, <span class="keywordtype">int</span> opcode, EjsObj *rhs);
<a name="l01809"></a>01809 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsRebuildHash(Ejs *ejs, EjsObj *obj);
<a name="l01810"></a>01810 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsResetHash(Ejs *ejs, EjsObj *obj);
<a name="l01811"></a>01811 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsRemoveSlot(Ejs *ejs, EjsObj *slots, <span class="keywordtype">int</span> slotNum, <span class="keywordtype">int</span> compact);
<a name="l01812"></a>01812 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsSetAllocIncrement(Ejs *ejs, <span class="keyword">struct</span> EjsType *type, <span class="keywordtype">int</span> increment);
<a name="l01813"></a>01813 <span class="keyword">extern</span> EjsObj   *ejsToSource(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> argc, EjsObj **argv);
<a name="l01814"></a>01814 
<a name="l01815"></a>01815 <span class="comment"></span>
<a name="l01816"></a>01816 <span class="comment">/** </span>
<a name="l01817"></a>01817 <span class="comment">    Block class</span>
<a name="l01818"></a>01818 <span class="comment">    @description The block class is the base class for all program code block scope objects. This is an internal class</span>
<a name="l01819"></a>01819 <span class="comment">        and not exposed to the script programmer.</span>
<a name="l01820"></a>01820 <span class="comment">    Blocks (including types) may describe their properties via traits. The traits store the property </span>
<a name="l01821"></a>01821 <span class="comment">    type and access attributes and are stored in EjsBlock which is a sub class of EjsObj. See ejsBlock.c for details.</span>
<a name="l01822"></a>01822 <span class="comment">    @stability Evolving</span>
<a name="l01823"></a>01823 <span class="comment">    @defgroup EjsBlock EjsBlock</span>
<a name="l01824"></a>01824 <span class="comment">    @see EjsBlock ejsIsBlock ejsBindFunction</span>
<a name="l01825"></a>01825 <span class="comment"> */</span>
<a name="l01826"></a>01826 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsBlock {
<a name="l01827"></a>01827     EjsObj          obj;                            <span class="comment">/**&lt; Extends Object - Property storage */</span>
<a name="l01828"></a>01828     <a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a>         namespaces;                     <span class="comment">/**&lt; Current list of namespaces open in this block of properties */</span>
<a name="l01829"></a>01829     <span class="keyword">struct </span>EjsBlock *scope;                         <span class="comment">/**&lt; Lexical scope chain for this block */</span>
<a name="l01830"></a>01830     <span class="keyword">struct </span>EjsBlock *prev;                          <span class="comment">/**&lt; Previous block in activation chain */</span>
<a name="l01831"></a>01831 
<a name="l01832"></a>01832     <span class="comment">//  MOB -- OPT and compress / eliminate some of these fields. Every function has these.</span>
<a name="l01833"></a>01833     EjsObj          *prevException;                 <span class="comment">/**&lt; Previous exception if nested exceptions */</span>
<a name="l01834"></a>01834     EjsVar          **stackBase;                    <span class="comment">/**&lt; Start of stack in this block */</span>
<a name="l01835"></a>01835     uint            breakCatch: 1;                  <span class="comment">/**&lt; Return, break or continue in a catch block */</span>
<a name="l01836"></a>01836     uint            isGlobal: 1;                    <span class="comment">/**&lt; Block is the global block */</span>
<a name="l01837"></a>01837     uint            nobind: 1;                      <span class="comment">/**&lt; Don't bind to properties in this block */</span>
<a name="l01838"></a>01838 } EjsBlock;
<a name="l01839"></a>01839 
<a name="l01840"></a>01840 
<a name="l01841"></a>01841 <span class="preprocessor">#if DOXYGEN</span>
<a name="l01842"></a>01842 <span class="preprocessor"></span><span class="comment">    /** </span>
<a name="l01843"></a>01843 <span class="comment">        Determine if a variable is a block.</span>
<a name="l01844"></a>01844 <span class="comment">        @description This call tests if the variable is a block.</span>
<a name="l01845"></a>01845 <span class="comment">        @param vp Variable to test</span>
<a name="l01846"></a>01846 <span class="comment">        @returns True if the variable is based on EjsBlock</span>
<a name="l01847"></a>01847 <span class="comment">        @ingroup EjsBlock</span>
<a name="l01848"></a>01848 <span class="comment">     */</span>
<a name="l01849"></a>01849     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_block.html#g03d5847d1e77fbc981645bc303ff5b07" title="Determine if a variable is a block.">ejsIsBlock</a>(EjsObj *vp);
<a name="l01850"></a>01850 <span class="preprocessor">#else</span>
<a name="l01851"></a>01851 <span class="preprocessor"></span>    <span class="comment">//  MOB -- very slot. Should have EjsObj.isBlock</span>
<a name="l01852"></a>01852 <span class="preprocessor">    #define ejsIsBlock(vp) (ejsIs(vp, ES_Block) || ejsIs(vp, ES_Function) || ejsIs(vp, ES_Type) || ejsIsFrame(vp))</span>
<a name="l01853"></a>01853 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01854"></a>01854 <span class="preprocessor"></span><span class="comment"></span>
<a name="l01855"></a>01855 <span class="comment">/** </span>
<a name="l01856"></a>01856 <span class="comment">    Bind a native C function to a function property</span>
<a name="l01857"></a>01857 <span class="comment">    @description Bind a native C function to an existing javascript function. Functions are typically created</span>
<a name="l01858"></a>01858 <span class="comment">        by compiling a script file of native function definitions into a mod file. When loaded, this mod file </span>
<a name="l01859"></a>01859 <span class="comment">        will create the function properties. This routine will then bind the specified C function to the </span>
<a name="l01860"></a>01860 <span class="comment">        function property.</span>
<a name="l01861"></a>01861 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l01862"></a>01862 <span class="comment">    @param obj Object containing the function property to bind.</span>
<a name="l01863"></a>01863 <span class="comment">    @param slotNum Slot number of the method property</span>
<a name="l01864"></a>01864 <span class="comment">    @param fn Native C function to bind</span>
<a name="l01865"></a>01865 <span class="comment">    @return Zero if successful, otherwise a negative MPR error code.</span>
<a name="l01866"></a>01866 <span class="comment">    @ingroup EjsType</span>
<a name="l01867"></a>01867 <span class="comment"> */</span>
<a name="l01868"></a>01868 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_type.html#g2d265a2559f36be71d9948349f2fe9e7" title="Bind a native C function to a function property.">ejsBindFunction</a>(Ejs *ejs, <span class="keywordtype">void</span> *obj, <span class="keywordtype">int</span> slotNum, EjsProc fn);
<a name="l01869"></a>01869 
<a name="l01870"></a>01870 <span class="comment">/*  </span>
<a name="l01871"></a>01871 <span class="comment">    This is all an internal API. Native types should probably not be using these routines. Speak up if you find</span>
<a name="l01872"></a>01872 <span class="comment">    you need these routines in your code.</span>
<a name="l01873"></a>01873 <span class="comment"> */</span>
<a name="l01874"></a>01874 
<a name="l01875"></a>01875 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsAddNamespaceToBlock(Ejs *ejs, EjsBlock *blockRef, <span class="keyword">struct</span> EjsNamespace *<span class="keyword">namespace</span>);
<a name="l01876"></a>01876 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsAddScope(MprCtx ctx, EjsBlock *block, EjsBlock *scopeBlock);
<a name="l01877"></a>01877 <span class="keyword">extern</span> EjsBlock *ejsCreateBlock(Ejs *ejs, <span class="keywordtype">int</span> numSlots);
<a name="l01878"></a>01878 
<a name="l01879"></a>01879 <span class="comment">//  TODO - why do we have ejsCloneObject, ejsCloneBlock ... Surely ejsCloneVar is sufficient?</span>
<a name="l01880"></a>01880 <span class="keyword">extern</span> EjsBlock *ejsCloneBlock(Ejs *ejs, EjsBlock *src, <span class="keywordtype">bool</span> deep);
<a name="l01881"></a>01881 
<a name="l01882"></a>01882 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsCaptureScope(Ejs *ejs, EjsBlock *block, <a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *scopeChain);
<a name="l01883"></a>01883 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsCopyScope(EjsBlock *block, <a class="code" href="struct_ejs_list.html" title="List type.">EjsList</a> *chain);
<a name="l01884"></a>01884 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsGetNamespaceCount(EjsBlock *block);
<a name="l01885"></a>01885 
<a name="l01886"></a>01886 <span class="keyword">extern</span> EjsBlock *ejsGetTopScope(EjsBlock *block);
<a name="l01887"></a>01887 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsMarkBlock(Ejs *ejs, EjsBlock *block);
<a name="l01888"></a>01888 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsPopBlockNamespaces(EjsBlock *block, <span class="keywordtype">int</span> count);
<a name="l01889"></a>01889 <span class="keyword">extern</span> EjsBlock *ejsRemoveScope(EjsBlock *block);
<a name="l01890"></a>01890 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsResetBlockNamespaces(Ejs *ejs, EjsBlock *block);
<a name="l01891"></a>01891 <span class="comment"></span>
<a name="l01892"></a>01892 <span class="comment">/** </span>
<a name="l01893"></a>01893 <span class="comment">    Exception Handler Record</span>
<a name="l01894"></a>01894 <span class="comment">    @description Each exception handler has an exception handler record allocated that describes it.</span>
<a name="l01895"></a>01895 <span class="comment">    @ingroup EjsFunction</span>
<a name="l01896"></a>01896 <span class="comment"> */</span>
<a name="l01897"></a><a class="code" href="struct_ejs_ex.html">01897</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_ejs_ex.html" title="Exception Handler Record.">EjsEx</a> {
<a name="l01898"></a>01898 <span class="comment">// TODO - OPT. Should this be compressed via bit fields for flags Could use short for these offsets.</span>
<a name="l01899"></a><a class="code" href="struct_ejs_ex.html#7828edd37cb2f8e0f72a8abe84a1092c">01899</a>     <span class="keyword">struct </span>EjsType  *<a class="code" href="struct_ejs_ex.html#7828edd37cb2f8e0f72a8abe84a1092c" title="Type of error to catch.">catchType</a>;             <span class="comment">/**&lt; Type of error to catch */</span>
<a name="l01900"></a><a class="code" href="struct_ejs_ex.html#87d151aba36a9e6b141e3c26a19e9506">01900</a>     uint            <a class="code" href="struct_ejs_ex.html#87d151aba36a9e6b141e3c26a19e9506" title="Exception flags.">flags</a>;                  <span class="comment">/**&lt; Exception flags */</span>
<a name="l01901"></a><a class="code" href="struct_ejs_ex.html#47bbb2fd50b22b520fab4cfc650b854f">01901</a>     uint            <a class="code" href="struct_ejs_ex.html#47bbb2fd50b22b520fab4cfc650b854f" title="Ptr to start of try block.">tryStart</a>;               <span class="comment">/**&lt; Ptr to start of try block */</span>
<a name="l01902"></a><a class="code" href="struct_ejs_ex.html#4dce233c5db38cfde56cd4adf525a5d8">01902</a>     uint            <a class="code" href="struct_ejs_ex.html#4dce233c5db38cfde56cd4adf525a5d8" title="Ptr to one past the end.">tryEnd</a>;                 <span class="comment">/**&lt; Ptr to one past the end */</span>
<a name="l01903"></a><a class="code" href="struct_ejs_ex.html#d7b33fe2f697cfbbf44e5769b5c5c678">01903</a>     uint            <a class="code" href="struct_ejs_ex.html#d7b33fe2f697cfbbf44e5769b5c5c678" title="Ptr to start of catch/finally block.">handlerStart</a>;           <span class="comment">/**&lt; Ptr to start of catch/finally block */</span>
<a name="l01904"></a><a class="code" href="struct_ejs_ex.html#0d87e1294e4f3c9253deaab0322b6457">01904</a>     uint            <a class="code" href="struct_ejs_ex.html#0d87e1294e4f3c9253deaab0322b6457" title="Ptr to one past the end.">handlerEnd</a>;             <span class="comment">/**&lt; Ptr to one past the end */</span>
<a name="l01905"></a><a class="code" href="struct_ejs_ex.html#9001e876331edefed444af2b3d494491">01905</a>     uint            <a class="code" href="struct_ejs_ex.html#9001e876331edefed444af2b3d494491" title="Count of blocks opened before the try block.">numBlocks</a>;              <span class="comment">/**&lt; Count of blocks opened before the try block */</span>
<a name="l01906"></a><a class="code" href="struct_ejs_ex.html#6223de535a61bc04b099739cb508dc57">01906</a>     uint            <a class="code" href="struct_ejs_ex.html#6223de535a61bc04b099739cb508dc57" title="Count of stack slots pushed before the try block.">numStack</a>;               <span class="comment">/**&lt; Count of stack slots pushed before the try block */</span>
<a name="l01907"></a>01907 } <a class="code" href="struct_ejs_ex.html" title="Exception Handler Record.">EjsEx</a>;
<a name="l01908"></a>01908 
<a name="l01909"></a>01909 
<a name="l01910"></a>01910 <span class="comment">// TODO OPT. Could compress this.</span><span class="comment"></span>
<a name="l01911"></a>01911 <span class="comment">/** </span>
<a name="l01912"></a>01912 <span class="comment">    Byte code</span>
<a name="l01913"></a>01913 <span class="comment">    @description This structure describes a sequence of byte code for a function. It also defines a set of</span>
<a name="l01914"></a>01914 <span class="comment">        execption handlers pertaining to this byte code.</span>
<a name="l01915"></a>01915 <span class="comment">    @ingroup EjsFunction</span>
<a name="l01916"></a>01916 <span class="comment"> */</span>
<a name="l01917"></a><a class="code" href="struct_ejs_code.html">01917</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_ejs_code.html" title="Byte code.">EjsCode</a> {
<a name="l01918"></a><a class="code" href="struct_ejs_code.html#40d6a7a1679bbb1befa8bc5eefa0bad8">01918</a>     uchar           *<a class="code" href="struct_ejs_code.html#40d6a7a1679bbb1befa8bc5eefa0bad8" title="Byte code.">byteCode</a>;              <span class="comment">/**&lt; Byte code */</span>
<a name="l01919"></a><a class="code" href="struct_ejs_code.html#b09c2c01aaed134f977f5b6441038936">01919</a>     <span class="keywordtype">int</span>             <a class="code" href="struct_ejs_code.html#b09c2c01aaed134f977f5b6441038936" title="Byte code length.">codeLen</a>;                <span class="comment">/**&lt; Byte code length */</span>
<a name="l01920"></a><a class="code" href="struct_ejs_code.html#c7d843374ff7e8431f3a833b0554c6d4">01920</a>     <span class="keyword">struct </span>EjsConst *<a class="code" href="struct_ejs_code.html#c7d843374ff7e8431f3a833b0554c6d4" title="Constant pool.">constants</a>;             <span class="comment">/**&lt; Constant pool. Reference to module constant pool */</span>
<a name="l01921"></a><a class="code" href="struct_ejs_code.html#2b0bd63868d71736e564ff6f7978b379">01921</a>     <span class="keywordtype">int</span>             <a class="code" href="struct_ejs_code.html#2b0bd63868d71736e564ff6f7978b379" title="Number of exception handlers.">numHandlers</a>;            <span class="comment">/**&lt; Number of exception handlers */</span>
<a name="l01922"></a><a class="code" href="struct_ejs_code.html#42462a42fdd5fcc595f79d706b087167">01922</a>     <span class="keywordtype">int</span>             <a class="code" href="struct_ejs_code.html#42462a42fdd5fcc595f79d706b087167" title="Size of handlers array.">sizeHandlers</a>;           <span class="comment">/**&lt; Size of handlers array */</span>
<a name="l01923"></a><a class="code" href="struct_ejs_code.html#cfc7f15ba5b176c8d31770d7f55467e1">01923</a>     <span class="keyword">struct </span><a class="code" href="struct_ejs_ex.html" title="Exception Handler Record.">EjsEx</a>    **<a class="code" href="struct_ejs_code.html#cfc7f15ba5b176c8d31770d7f55467e1" title="Exception handlers.">handlers</a>;             <span class="comment">/**&lt; Exception handlers */</span>
<a name="l01924"></a>01924 } <a class="code" href="struct_ejs_code.html" title="Byte code.">EjsCode</a>;
<a name="l01925"></a>01925 
<a name="l01926"></a>01926 <span class="comment"></span>
<a name="l01927"></a>01927 <span class="comment">/** </span>
<a name="l01928"></a>01928 <span class="comment">    Function class</span>
<a name="l01929"></a>01929 <span class="comment">    @description The Function type is used to represent closures, function expressions and class methods. </span>
<a name="l01930"></a>01930 <span class="comment">        It contains a reference to the code to execute, the execution scope and possibly a bound "this" reference.</span>
<a name="l01931"></a>01931 <span class="comment">    @stability Evolving</span>
<a name="l01932"></a>01932 <span class="comment">    @defgroup EjsFunction EjsFunction</span>
<a name="l01933"></a>01933 <span class="comment">    @see EjsFunction ejsIsFunction ejsIsNativeFunction ejsIsInitializer ejsCreateFunction ejsCloneFunction</span>
<a name="l01934"></a>01934 <span class="comment">        ejsRunFunctionBySlot ejsRunFunction ejsRunInitializer</span>
<a name="l01935"></a>01935 <span class="comment"> */</span>
<a name="l01936"></a>01936 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsFunction {
<a name="l01937"></a>01937     <span class="comment">/*</span>
<a name="l01938"></a>01938 <span class="comment">        A function can store properties like any other object. If it has parameters, it must also must maintain an</span>
<a name="l01939"></a>01939 <span class="comment">        activation object. When compiling, the compiler stores parameters in the normal property "block", it then</span>
<a name="l01940"></a>01940 <span class="comment">        transfers them into the activation block when complete.</span>
<a name="l01941"></a>01941 <span class="comment">     */</span>
<a name="l01942"></a>01942     EjsBlock        block;                  <span class="comment">/** Activation block for local vars */</span>
<a name="l01943"></a>01943     EjsObj          *activation;            <span class="comment">/** Activation properties (parameters + locals) */</span>
<a name="l01944"></a>01944 
<a name="l01945"></a>01945     <span class="comment">//  MOB -- should this be BLD_DEBUG?</span>
<a name="l01946"></a>01946     cchar           *name;                  <span class="comment">/** Function name for debuggability */</span>
<a name="l01947"></a>01947 
<a name="l01948"></a>01948 <span class="preprocessor">#if FUTURE &amp;&amp; MOB</span>
<a name="l01949"></a>01949 <span class="preprocessor"></span>    <span class="keyword">union </span>{
<a name="l01950"></a>01950 <span class="preprocessor">#endif</span>
<a name="l01951"></a>01951 <span class="preprocessor"></span>        <span class="keyword">struct </span>EjsFunction *setter;         <span class="comment">/**&lt; Setter function for this property */</span>
<a name="l01952"></a>01952         <span class="keyword">struct </span>EjsType  *archetype;         <span class="comment">/**&lt; Type to use to create instances */</span>
<a name="l01953"></a>01953 <span class="preprocessor">#if FUTURE &amp;&amp; MOB</span>
<a name="l01954"></a>01954 <span class="preprocessor"></span>    } extra;
<a name="l01955"></a>01955 <span class="preprocessor">#endif</span>
<a name="l01956"></a>01956 <span class="preprocessor"></span>
<a name="l01957"></a>01957     <span class="keyword">union </span>{
<a name="l01958"></a>01958         <a class="code" href="struct_ejs_code.html" title="Byte code.">EjsCode</a>     code;                   <span class="comment">/**&lt; Byte code */</span>
<a name="l01959"></a>01959         EjsProc     proc;                   <span class="comment">/**&lt; Native function pointer */</span>
<a name="l01960"></a>01960     } body;
<a name="l01961"></a>01961 
<a name="l01962"></a>01962     <span class="keyword">struct </span>EjsArray *boundArgs;             <span class="comment">/**&lt; Bound "args" */</span>
<a name="l01963"></a>01963     EjsObj          *boundThis;             <span class="comment">/**&lt; Bound "this" object value */</span>
<a name="l01964"></a>01964     <span class="keyword">struct </span>EjsType  *resultType;            <span class="comment">/**&lt; Return type of method */</span>
<a name="l01965"></a>01965 
<a name="l01966"></a>01966 <span class="preprocessor">#if BLD_HAS_UNNAMED_UNIONS</span>
<a name="l01967"></a>01967 <span class="preprocessor"></span>    <span class="keyword">union </span>{
<a name="l01968"></a>01968         <span class="keyword">struct </span>{
<a name="l01969"></a>01969 <span class="preprocessor">#endif</span>
<a name="l01970"></a>01970 <span class="preprocessor"></span>            uint    numArgs: 8;             <span class="comment">/**&lt; Count of formal parameters */</span>
<a name="l01971"></a>01971             uint    numDefault: 8;          <span class="comment">/**&lt; Count of formal parameters with default initializers */</span>
<a name="l01972"></a>01972             uint    castNulls: 1;           <span class="comment">/**&lt; Cast return values of null */</span>
<a name="l01973"></a>01973             uint    fullScope: 1;           <span class="comment">/**&lt; Closures must capture full scope */</span>
<a name="l01974"></a>01974             uint    hasReturn: 1;           <span class="comment">/**&lt; Function has a return stmt */</span>
<a name="l01975"></a>01975             uint    inCatch: 1;             <span class="comment">/**&lt; Executing catch block */</span>
<a name="l01976"></a>01976             uint    inException: 1;         <span class="comment">/**&lt; Executing catch/finally exception processing */</span>
<a name="l01977"></a>01977             uint    isConstructor: 1;       <span class="comment">/**&lt; Function is a constructor */</span>
<a name="l01978"></a>01978             uint    isInitializer: 1;       <span class="comment">/**&lt; Function is a type initializer */</span>
<a name="l01979"></a>01979             uint    isNativeProc: 1;        <span class="comment">/**&lt; Function is native procedure */</span>
<a name="l01980"></a>01980             uint    moduleInitializer: 1;   <span class="comment">/**&lt; Function is a module initializer */</span>
<a name="l01981"></a>01981             uint    rest: 1;                <span class="comment">/**&lt; Function has a "..." rest of args parameter */</span>
<a name="l01982"></a>01982             uint    staticMethod: 1;        <span class="comment">/**&lt; Function is a static method */</span>
<a name="l01983"></a>01983             uint    strict: 1;              <span class="comment">/**&lt; Language strict mode (vs standard) */</span>
<a name="l01984"></a>01984             uint    throwNulls: 1;          <span class="comment">/**&lt; Return type cannot be null */</span>
<a name="l01985"></a>01985 
<a name="l01986"></a>01986 <span class="preprocessor">#if BLD_HAS_UNNAMED_UNIONS</span>
<a name="l01987"></a>01987 <span class="preprocessor"></span>        };
<a name="l01988"></a>01988         int64       bits;
<a name="l01989"></a>01989     };
<a name="l01990"></a>01990 <span class="preprocessor">#endif</span>
<a name="l01991"></a>01991 <span class="preprocessor"></span>} EjsFunction;
<a name="l01992"></a>01992 
<a name="l01993"></a>01993 <span class="preprocessor">#if DOXYGEN</span>
<a name="l01994"></a>01994 <span class="preprocessor"></span><span class="comment">    /** </span>
<a name="l01995"></a>01995 <span class="comment">        Determine if a variable is a function. This will return true if the variable is a function of any kind, including</span>
<a name="l01996"></a>01996 <span class="comment">            methods, native and script functions or initializers.</span>
<a name="l01997"></a>01997 <span class="comment">        @param vp Variable to test</span>
<a name="l01998"></a>01998 <span class="comment">        @return True if the variable is a function</span>
<a name="l01999"></a>01999 <span class="comment">        @ingroup EjsFunction</span>
<a name="l02000"></a>02000 <span class="comment">     */</span>
<a name="l02001"></a>02001     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_function.html#g57f528868eed5536dde9dacccd059083" title="Determine if a variable is a function.">ejsIsFunction</a>(EjsObj *vp);
<a name="l02002"></a>02002 <span class="comment"></span>
<a name="l02003"></a>02003 <span class="comment">    /** </span>
<a name="l02004"></a>02004 <span class="comment">        Determine if the function is a native function. Functions can be either native - meaning the implementation is</span>
<a name="l02005"></a>02005 <span class="comment">            via a C function, or can be scripted.</span>
<a name="l02006"></a>02006 <span class="comment">        @param vp Variable to test</span>
<a name="l02007"></a>02007 <span class="comment">        @return True if the variable is a native function.</span>
<a name="l02008"></a>02008 <span class="comment">        @ingroup EjsFunction</span>
<a name="l02009"></a>02009 <span class="comment">     */</span>
<a name="l02010"></a>02010     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_function.html#g461f8132dd432d5b27d253419c9a85c8" title="Determine if the function is a native function.">ejsIsNativeFunction</a>(EjsObj *vp);
<a name="l02011"></a>02011 <span class="comment"></span>
<a name="l02012"></a>02012 <span class="comment">    /** </span>
<a name="l02013"></a>02013 <span class="comment">        Determine if the function is an initializer. Initializers are special functions created by the compiler to do</span>
<a name="l02014"></a>02014 <span class="comment">            static and instance initialization of classes during construction.</span>
<a name="l02015"></a>02015 <span class="comment">        @param vp Variable to test</span>
<a name="l02016"></a>02016 <span class="comment">        @return True if the variable is an initializer</span>
<a name="l02017"></a>02017 <span class="comment">        @ingroup EjsFunction</span>
<a name="l02018"></a>02018 <span class="comment">     */</span>
<a name="l02019"></a>02019     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_function.html#g8e764d2fd382cc8f0d4bf34c227db88c" title="Determine if the function is an initializer.">ejsIsInitializer</a>(EjsObj *vp);
<a name="l02020"></a>02020 <span class="preprocessor">#else</span>
<a name="l02021"></a>02021 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsFunction(vp)       (vp &amp;&amp; ((EjsObj*) vp)-&gt;isFunction)</span>
<a name="l02022"></a>02022 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsNativeFunction(vp) (ejsIsFunction(vp) &amp;&amp; (((EjsFunction*) (vp))-&gt;isNativeProc))</span>
<a name="l02023"></a>02023 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsInitializer(vp)    (ejsIsFunction(vp) &amp;&amp; (((EjsFunction*) (vp))-&gt;isInitializer)</span>
<a name="l02024"></a>02024 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02025"></a>02025 <span class="preprocessor"></span><span class="comment"></span>
<a name="l02026"></a>02026 <span class="comment">/** </span>
<a name="l02027"></a>02027 <span class="comment">    Create a function object</span>
<a name="l02028"></a>02028 <span class="comment">    @description This creates a function object and optionally associates byte code with the function.</span>
<a name="l02029"></a>02029 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02030"></a>02030 <span class="comment">    @param name Function name used in stack backtraces.</span>
<a name="l02031"></a>02031 <span class="comment">    @param code Pointer to the byte code. The byte code is not copied so this must be a persistent pointer.</span>
<a name="l02032"></a>02032 <span class="comment">    @param codeLen Length of the code.</span>
<a name="l02033"></a>02033 <span class="comment">    @param numArgs Number of formal arguments to the function.</span>
<a name="l02034"></a>02034 <span class="comment">    @param numDefault Number of default args to the function.</span>
<a name="l02035"></a>02035 <span class="comment">    @param numExceptions Number of exception handlers</span>
<a name="l02036"></a>02036 <span class="comment">    @param returnType Return type of the function. Set to NULL for no defined type.</span>
<a name="l02037"></a>02037 <span class="comment">    @param attributes Integer mask of access attributes.</span>
<a name="l02038"></a>02038 <span class="comment">    @param constants Reference to the module constant pool. Some byte code opcodes contain references into the</span>
<a name="l02039"></a>02039 <span class="comment">        constant pool</span>
<a name="l02040"></a>02040 <span class="comment">    @param scope Reference to the chain of blocks that that comprises the lexical scope chain for this function.</span>
<a name="l02041"></a>02041 <span class="comment">    @param strict Run code in strict mode (vs standard).</span>
<a name="l02042"></a>02042 <span class="comment">    @return An initialized function object</span>
<a name="l02043"></a>02043 <span class="comment">    @ingroup EjsFunction</span>
<a name="l02044"></a>02044 <span class="comment"> */</span>
<a name="l02045"></a>02045 <span class="keyword">extern</span> EjsFunction *<a class="code" href="group___ejs_function.html#g1b04a89fc17493abd5f3d95dedf036d2" title="Create a function object.">ejsCreateFunction</a>(Ejs *ejs, cchar *name, cuchar *code, <span class="keywordtype">int</span> codeLen, <span class="keywordtype">int</span> numArgs, <span class="keywordtype">int</span> numDefault,
<a name="l02046"></a>02046     <span class="keywordtype">int</span> numExceptions, <span class="keyword">struct</span> EjsType *returnType, <span class="keywordtype">int</span> attributes, <span class="keyword">struct</span> EjsConst *constants, EjsBlock *scope, 
<a name="l02047"></a>02047     <span class="keywordtype">int</span> strict);
<a name="l02048"></a>02048 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsInitFunction(Ejs *ejs, EjsFunction *fun, cchar *name, cuchar *code, <span class="keywordtype">int</span> codeLen, <span class="keywordtype">int</span> numArgs, <span class="keywordtype">int</span> numDefault,
<a name="l02049"></a>02049     <span class="keywordtype">int</span> numExceptions, <span class="keyword">struct</span> EjsType *returnType, <span class="keywordtype">int</span> attributes, <span class="keyword">struct</span> EjsConst *constants, EjsBlock *scope, 
<a name="l02050"></a>02050     <span class="keywordtype">int</span> strict);
<a name="l02051"></a>02051 <span class="keyword">extern</span> EjsFunction *ejsCreateSimpleFunction(Ejs *ejs, cchar *name, <span class="keywordtype">int</span> attributes);
<a name="l02052"></a>02052 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsDisableFunction(Ejs *ejs, EjsFunction *fun);
<a name="l02053"></a>02053 
<a name="l02054"></a>02054 <span class="keyword">extern</span> EjsObj *ejsCreateActivation(Ejs *ejs, EjsFunction *fun, <span class="keywordtype">int</span> numSlots);
<a name="l02055"></a>02055 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsCompleteFunction(Ejs *ejs, EjsFunction *fun);
<a name="l02056"></a>02056 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsUseActivation(Ejs *ejs, EjsFunction *fun);
<a name="l02057"></a>02057 <span class="comment"></span>
<a name="l02058"></a>02058 <span class="comment">/** </span>
<a name="l02059"></a>02059 <span class="comment">    Run the initializer for a module</span>
<a name="l02060"></a>02060 <span class="comment">    @description A module's initializer runs global code defined in the module</span>
<a name="l02061"></a>02061 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02062"></a>02062 <span class="comment">    @param module Module object reference</span>
<a name="l02063"></a>02063 <span class="comment">    @return The last expression result of global code executed</span>
<a name="l02064"></a>02064 <span class="comment">    @ingroup EjsFunction</span>
<a name="l02065"></a>02065 <span class="comment"> */</span>
<a name="l02066"></a>02066 <span class="keyword">extern</span> EjsObj *<a class="code" href="group___ejs_function.html#g5a7d2ad5dd3cf09e90d6288ac2ba73fc" title="Run the initializer for a module.">ejsRunInitializer</a>(Ejs *ejs, <span class="keyword">struct</span> EjsModule *module);
<a name="l02067"></a>02067 <span class="comment"></span>
<a name="l02068"></a>02068 <span class="comment">/** </span>
<a name="l02069"></a>02069 <span class="comment">    Run a function</span>
<a name="l02070"></a>02070 <span class="comment">    @description Run a function with the given actual parameters</span>
<a name="l02071"></a>02071 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02072"></a>02072 <span class="comment">    @param fn Function object to run</span>
<a name="l02073"></a>02073 <span class="comment">    @param obj Object to use as the "this" object when running the function</span>
<a name="l02074"></a>02074 <span class="comment">    @param argc Count of actual parameters</span>
<a name="l02075"></a>02075 <span class="comment">    @param argv Vector of actual parameters</span>
<a name="l02076"></a>02076 <span class="comment">    @return The return value from the function. If an exception is thrown, NULL will be returned and ejs-&gt;exception</span>
<a name="l02077"></a>02077 <span class="comment">        will be set to the exception object.</span>
<a name="l02078"></a>02078 <span class="comment">    @ingroup EjsFunction</span>
<a name="l02079"></a>02079 <span class="comment"> */</span>
<a name="l02080"></a>02080 <span class="keyword">extern</span> EjsObj *<a class="code" href="group___ejs_function.html#gfc48c2ee73ed572e466a83f6903d29f9" title="Run a function.">ejsRunFunction</a>(Ejs *ejs, EjsFunction *fn, EjsObj *obj, <span class="keywordtype">int</span> argc, EjsObj **argv);
<a name="l02081"></a>02081 <span class="comment"></span>
<a name="l02082"></a>02082 <span class="comment">/** </span>
<a name="l02083"></a>02083 <span class="comment">    Run a function by slot number</span>
<a name="l02084"></a>02084 <span class="comment">    @description Run a function identified by slot number with the given actual parameters. This will run the function</span>
<a name="l02085"></a>02085 <span class="comment">        stored at \a slotNum in the \a obj variable. </span>
<a name="l02086"></a>02086 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02087"></a>02087 <span class="comment">    @param obj Object that holds the function at its "slotNum" slot. Also use this object as the "this" object </span>
<a name="l02088"></a>02088 <span class="comment">        when running the function.</span>
<a name="l02089"></a>02089 <span class="comment">    @param slotNum Slot number in \a obj that contains the function to run.</span>
<a name="l02090"></a>02090 <span class="comment">    @param argc Count of actual parameters</span>
<a name="l02091"></a>02091 <span class="comment">    @param argv Vector of actual parameters</span>
<a name="l02092"></a>02092 <span class="comment">    @return The return value from the function. If an exception is thrown, NULL will be returned and ejs-&gt;exception</span>
<a name="l02093"></a>02093 <span class="comment">        will be set to the exception object.</span>
<a name="l02094"></a>02094 <span class="comment">    @ingroup EjsFunction</span>
<a name="l02095"></a>02095 <span class="comment"> */</span>
<a name="l02096"></a>02096 <span class="keyword">extern</span> EjsObj *<a class="code" href="group___ejs_function.html#g07c05d4fe96ac9752069730ec21ef7ee" title="Run a function by slot number.">ejsRunFunctionBySlot</a>(Ejs *ejs, EjsObj *obj, <span class="keywordtype">int</span> slotNum, <span class="keywordtype">int</span> argc, EjsObj **argv);
<a name="l02097"></a>02097 <span class="keyword">extern</span> EjsObj *ejsRunFunctionByName(Ejs *ejs, EjsObj *container, EjsName *qname, EjsObj *obj, <span class="keywordtype">int</span> argc, EjsObj **argv);
<a name="l02098"></a>02098 
<a name="l02099"></a>02099 <span class="keyword">extern</span> <a class="code" href="struct_ejs_ex.html" title="Exception Handler Record.">EjsEx</a> *ejsAddException(EjsFunction *mp, uint tryStart, uint tryEnd, <span class="keyword">struct</span> EjsType *catchType,
<a name="l02100"></a>02100     uint handlerStart, uint handlerEnd, <span class="keywordtype">int</span> numBlocks, <span class="keywordtype">int</span> numStack, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> preferredIndex);
<a name="l02101"></a>02101 <span class="keyword">extern</span> EjsFunction *ejsCloneFunction(Ejs *ejs, EjsFunction *src, <span class="keywordtype">int</span> deep);
<a name="l02102"></a>02102 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsDefineException(Ejs *ejs, <span class="keyword">struct</span> EjsType *vp, <span class="keywordtype">int</span> slot, uint tryOffset,
<a name="l02103"></a>02103     uint tryLength, uint handlerOffset, uint handlerLength, <span class="keywordtype">int</span> flags);
<a name="l02104"></a>02104 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsOffsetExceptions(EjsFunction *mp, <span class="keywordtype">int</span> offset);
<a name="l02105"></a>02105 <span class="keyword">extern</span> <span class="keywordtype">int</span>  ejsSetFunctionCode(EjsFunction *mp, uchar *byteCode, <span class="keywordtype">int</span> len);
<a name="l02106"></a>02106 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsMarkFunction(Ejs *ejs, EjsFunction *fun);
<a name="l02107"></a>02107 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsShowOpFrequency(Ejs *ejs);
<a name="l02108"></a>02108 <span class="preprocessor">#if UNUSED</span>
<a name="l02109"></a>02109 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">int</span> ejsLookupFunctionProperty(Ejs *ejs, EjsFunction *fun, EjsName *qname);
<a name="l02110"></a>02110 <span class="preprocessor">#endif</span>
<a name="l02111"></a>02111 <span class="preprocessor"></span>
<a name="l02112"></a>02112 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsFrame {
<a name="l02113"></a>02113     EjsFunction     function;               <span class="comment">/**&lt; Activation frame for function calls. Stores local variables */</span>
<a name="l02114"></a>02114     <span class="keyword">struct </span>EjsFrame *caller;                <span class="comment">/**&lt; Previous invoking frame */</span>
<a name="l02115"></a>02115     EjsVar          **stackBase;            <span class="comment">/**&lt; Start of stack in this function */</span>
<a name="l02116"></a>02116     EjsObj          **stackReturn;          <span class="comment">/**&lt; Top of stack to return to */</span>
<a name="l02117"></a>02117     <span class="keywordtype">int</span>             slotNum;                <span class="comment">/**&lt; Slot in owner */</span>
<a name="l02118"></a>02118     uchar           *pc;                    <span class="comment">/**&lt; Program counter */</span>
<a name="l02119"></a>02119     uchar           *attentionPc;           <span class="comment">/**&lt; Restoration PC value after attention */</span>
<a name="l02120"></a>02120     <span class="keywordtype">int</span>             ignoreAttention;        <span class="comment">/**&lt; Ignore attention commands */</span>
<a name="l02121"></a>02121     <span class="keywordtype">int</span>             lineNumber;             <span class="comment">/**&lt; Source code line number */</span>
<a name="l02122"></a>02122     cchar           *currentLine;           <span class="comment">/**&lt; Current source code line */</span>
<a name="l02123"></a>02123     cchar           *filename;              <span class="comment">/**&lt; Source code file name */</span>
<a name="l02124"></a>02124     <span class="keywordtype">int</span>             getter;                 <span class="comment">/**&lt; Frame is a getter */</span>
<a name="l02125"></a>02125     uint            argc;                   <span class="comment">/**&lt; Actual parameter count */</span>
<a name="l02126"></a>02126 } EjsFrame;
<a name="l02127"></a>02127 
<a name="l02128"></a>02128 <span class="preprocessor">#if DOXYGEN</span>
<a name="l02129"></a>02129 <span class="preprocessor"></span><span class="comment">    /** </span>
<a name="l02130"></a>02130 <span class="comment">        Determine if a variable is a frame. Only used internally in the VM.</span>
<a name="l02131"></a>02131 <span class="comment">        @param vp Variable to test</span>
<a name="l02132"></a>02132 <span class="comment">        @return True if the variable is a frame. </span>
<a name="l02133"></a>02133 <span class="comment">        @ingroup EjsFrame</span>
<a name="l02134"></a>02134 <span class="comment">     */</span>
<a name="l02135"></a>02135     <span class="keyword">extern</span> <span class="keywordtype">bool</span> ejsIsFrame(EjsObj *vp);
<a name="l02136"></a>02136 <span class="preprocessor">#else</span>
<a name="l02137"></a>02137 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsFrame(vp)       ejsIs(vp, ES_Frame)</span>
<a name="l02138"></a>02138 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02139"></a>02139 <span class="preprocessor"></span>
<a name="l02140"></a>02140 <span class="keyword">extern</span> EjsFrame *ejsCreateFrame(Ejs *ejs, EjsFunction *src, EjsObj *thisObj, <span class="keywordtype">int</span> argc, EjsObj **argv);
<a name="l02141"></a>02141 <span class="keyword">extern</span> EjsFrame *ejsCreateCompilerFrame(Ejs *ejs, EjsFunction *src);
<a name="l02142"></a>02142 <span class="keyword">extern</span> EjsBlock *ejsPopBlock(Ejs *ejs);
<a name="l02143"></a>02143 <span class="keyword">extern</span> EjsBlock *ejsPushBlock(Ejs *ejs, EjsBlock *block);
<a name="l02144"></a>02144 <span class="comment"></span>
<a name="l02145"></a>02145 <span class="comment">/** </span>
<a name="l02146"></a>02146 <span class="comment">    Array class</span>
<a name="l02147"></a>02147 <span class="comment">    @description Arrays provide a growable, integer indexed, in-memory store for objects. An array can be treated as a </span>
<a name="l02148"></a>02148 <span class="comment">        stack (FIFO or LIFO) or a list (ordered). Insertions can be done at the beginning or end of the stack or at an </span>
<a name="l02149"></a>02149 <span class="comment">        indexed location within a list. The Array class can store objects with numerical indicies and can also store </span>
<a name="l02150"></a>02150 <span class="comment">        any named properties. The named properties are stored in the obj field, whereas the numeric indexed values are</span>
<a name="l02151"></a>02151 <span class="comment">        stored in the data field. Array extends EjsObj and has all the capabilities of EjsObj.</span>
<a name="l02152"></a>02152 <span class="comment">    @stability Evolving</span>
<a name="l02153"></a>02153 <span class="comment">    @defgroup EjsArray EjsArray</span>
<a name="l02154"></a>02154 <span class="comment">    @see EjsArray ejsCreateArray ejsIsArray</span>
<a name="l02155"></a>02155 <span class="comment"> */</span>
<a name="l02156"></a>02156 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsArray {
<a name="l02157"></a>02157     EjsObj          obj;                <span class="comment">/**&lt; Extends Object */</span>
<a name="l02158"></a>02158     EjsObj          **data;             <span class="comment">/**&lt; Array elements */</span>
<a name="l02159"></a>02159     <span class="keywordtype">int</span>             length;             <span class="comment">/**&lt; Array length property */</span>
<a name="l02160"></a>02160 } EjsArray;
<a name="l02161"></a>02161 
<a name="l02162"></a>02162 <span class="comment"></span>
<a name="l02163"></a>02163 <span class="comment">/** </span>
<a name="l02164"></a>02164 <span class="comment">    Create an array</span>
<a name="l02165"></a>02165 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02166"></a>02166 <span class="comment">    @param size Initial size of the array</span>
<a name="l02167"></a>02167 <span class="comment">    @return A new array object</span>
<a name="l02168"></a>02168 <span class="comment">    @ingroup EjsArray</span>
<a name="l02169"></a>02169 <span class="comment"> */</span>
<a name="l02170"></a>02170 <span class="keyword">extern</span> EjsArray *<a class="code" href="group___ejs_array.html#g43cacbf358fdf4d364706dd01a5ebdc0" title="Create an array.">ejsCreateArray</a>(Ejs *ejs, <span class="keywordtype">int</span> size);
<a name="l02171"></a>02171 
<a name="l02172"></a>02172 <span class="preprocessor">#if DOXYGEN</span>
<a name="l02173"></a>02173 <span class="preprocessor"></span><span class="comment">    /** </span>
<a name="l02174"></a>02174 <span class="comment">        Determine if a variable is an array</span>
<a name="l02175"></a>02175 <span class="comment">        @param vp Variable to test</span>
<a name="l02176"></a>02176 <span class="comment">        @return True if the variable is an array</span>
<a name="l02177"></a>02177 <span class="comment">        @ingroup EjsArray</span>
<a name="l02178"></a>02178 <span class="comment">     */</span>
<a name="l02179"></a>02179     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_array.html#gb1a6986eca85443289e2d32d78c2c12d" title="Determine if a variable is an array.">ejsIsArray</a>(EjsObj *vp);
<a name="l02180"></a>02180 <span class="preprocessor">#else</span>
<a name="l02181"></a>02181 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsArray(vp) ejsIs(vp, ES_Array)</span>
<a name="l02182"></a>02182 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02183"></a>02183 <span class="preprocessor"></span><span class="comment"></span>
<a name="l02184"></a>02184 <span class="comment">/** </span>
<a name="l02185"></a>02185 <span class="comment">    Boolean class</span>
<a name="l02186"></a>02186 <span class="comment">    @description The Boolean class provides the base class for the boolean values "true" and "false".</span>
<a name="l02187"></a>02187 <span class="comment">        EjsBoolean is a primitive native type and extends EjsObj. It is still logically an Object, but implements</span>
<a name="l02188"></a>02188 <span class="comment">        Object properties and methods itself. Only two instances of the boolean class are ever created created</span>
<a name="l02189"></a>02189 <span class="comment">        these are referenced as ejs-&gt;trueValue and ejs-&gt;falseValue.</span>
<a name="l02190"></a>02190 <span class="comment">    @stability Evolving</span>
<a name="l02191"></a>02191 <span class="comment">    @defgroup EjsBoolean EjsBoolean</span>
<a name="l02192"></a>02192 <span class="comment">    @see EjsBoolean ejsCreateBoolean ejsIsBoolean ejsGetBoolean</span>
<a name="l02193"></a>02193 <span class="comment"> */</span>
<a name="l02194"></a>02194 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsBoolean {
<a name="l02195"></a>02195     EjsObj          obj;                <span class="comment">/**&lt; Extends Object - Property storage */</span>
<a name="l02196"></a>02196     <span class="keywordtype">bool</span>            value;              <span class="comment">/**&lt; Boolean value */</span>
<a name="l02197"></a>02197 } EjsBoolean;
<a name="l02198"></a>02198 <span class="comment"></span>
<a name="l02199"></a>02199 <span class="comment">/** </span>
<a name="l02200"></a>02200 <span class="comment">    Create a boolean</span>
<a name="l02201"></a>02201 <span class="comment">    @description Create a boolean value. This will not actually create a new boolean instance as there can only ever</span>
<a name="l02202"></a>02202 <span class="comment">        be two boolean instances (true and false). Boolean properties are immutable in Ejscript and so this routine</span>
<a name="l02203"></a>02203 <span class="comment">        will simply return the appropriate pre-created true or false boolean value.</span>
<a name="l02204"></a>02204 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02205"></a>02205 <span class="comment">    @param value Desired boolean value. Set to 1 for true and zero for false.</span>
<a name="l02206"></a>02206 <span class="comment">    @ingroup EjsBoolean</span>
<a name="l02207"></a>02207 <span class="comment"> */</span>
<a name="l02208"></a>02208 <span class="keyword">extern</span> EjsBoolean *<a class="code" href="group___ejs_boolean.html#g52a502e93b5f5a05d5619ce53fbcfe48" title="Create a boolean.">ejsCreateBoolean</a>(Ejs *ejs, <span class="keywordtype">int</span> value);
<a name="l02209"></a>02209 <span class="comment"></span>
<a name="l02210"></a>02210 <span class="comment">/** </span>
<a name="l02211"></a>02211 <span class="comment">    Cast a variable to a boolean </span>
<a name="l02212"></a>02212 <span class="comment">    @description</span>
<a name="l02213"></a>02213 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02214"></a>02214 <span class="comment">    @param vp Variable to cast</span>
<a name="l02215"></a>02215 <span class="comment">    @return A new boolean object</span>
<a name="l02216"></a>02216 <span class="comment">    @ingroup EjsBoolean</span>
<a name="l02217"></a>02217 <span class="comment"> */</span>
<a name="l02218"></a>02218 <span class="keyword">extern</span> EjsBoolean *<a class="code" href="group___ejs_boolean.html#gc8ccf50072bb45f10d7799b0c168efd8" title="Cast a variable to a boolean.">ejsToBoolean</a>(Ejs *ejs, EjsObj *vp);
<a name="l02219"></a>02219 
<a name="l02220"></a>02220 <span class="preprocessor">#if DOXYGEN</span>
<a name="l02221"></a>02221 <span class="preprocessor"></span><span class="comment">    /** </span>
<a name="l02222"></a>02222 <span class="comment">        Determine if a variable is a boolean</span>
<a name="l02223"></a>02223 <span class="comment">        @param vp Variable to test</span>
<a name="l02224"></a>02224 <span class="comment">        @return True if the variable is a boolean</span>
<a name="l02225"></a>02225 <span class="comment">        @ingroup EjsBoolean</span>
<a name="l02226"></a>02226 <span class="comment">     */</span>
<a name="l02227"></a>02227     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_boolean.html#g829a6197515e48a50b7ee0393e30c662" title="Determine if a variable is a boolean.">ejsIsBoolean</a>(EjsObj *vp);
<a name="l02228"></a>02228 <span class="comment"></span>
<a name="l02229"></a>02229 <span class="comment">    /** </span>
<a name="l02230"></a>02230 <span class="comment">        Get the C boolean value from a boolean object</span>
<a name="l02231"></a>02231 <span class="comment">        @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02232"></a>02232 <span class="comment">        @param vp Boolean variable to access</span>
<a name="l02233"></a>02233 <span class="comment">        @return True or false</span>
<a name="l02234"></a>02234 <span class="comment">        @ingroup EjsBoolean</span>
<a name="l02235"></a>02235 <span class="comment">     */</span>
<a name="l02236"></a>02236     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_boolean.html#ge09d9685c6dfe8b6f09054afbccc87d5" title="Get the C boolean value from a boolean object.">ejsGetBoolean</a>(Ejs *ejs, EjsObj *vp);
<a name="l02237"></a>02237 <span class="preprocessor">#else</span>
<a name="l02238"></a>02238 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsBoolean(vp) ejsIs(vp, ES_Boolean)</span>
<a name="l02239"></a>02239 <span class="preprocessor"></span>    <span class="keyword">extern</span> <span class="keywordtype">int</span> _ejsGetBoolean(Ejs *ejs, EjsObj *vp);
<a name="l02240"></a>02240 <span class="preprocessor">    #define ejsGetBoolean(ejs, vp) _ejsGetBoolean(ejs, (EjsObj*) (vp))</span>
<a name="l02241"></a>02241 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02242"></a>02242 <span class="preprocessor"></span>
<a name="l02243"></a>02243 <span class="comment">/*</span>
<a name="l02244"></a>02244 <span class="comment">    Thse constants match Stream.READ, Stream.WRITE, Stream.BOTH</span>
<a name="l02245"></a>02245 <span class="comment"> */</span>
<a name="l02246"></a>02246 <span class="preprocessor">#define EJS_STREAM_READ     0x1</span>
<a name="l02247"></a>02247 <span class="preprocessor"></span><span class="preprocessor">#define EJS_STREAM_WRITE    0x2</span>
<a name="l02248"></a>02248 <span class="preprocessor"></span><span class="preprocessor">#define EJS_STREAM_BOTH     0x3</span>
<a name="l02249"></a>02249 <span class="preprocessor"></span><span class="comment"></span>
<a name="l02250"></a>02250 <span class="comment">/** </span>
<a name="l02251"></a>02251 <span class="comment">    ByteArray class</span>
<a name="l02252"></a>02252 <span class="comment">    @description ByteArrays provide a growable, integer indexed, in-memory store for bytes. ByteArrays can be used as a </span>
<a name="l02253"></a>02253 <span class="comment">    simple array type to store and encode data as bytes or they can be used as buffered Streams implementing the Stream </span>
<a name="l02254"></a>02254 <span class="comment">    interface.</span>
<a name="l02255"></a>02255 <span class="comment">    \n\n</span>
<a name="l02256"></a>02256 <span class="comment">    When used as a simple byte array, the ByteArray class offers a low level set of methods to insert and </span>
<a name="l02257"></a>02257 <span class="comment">    extract bytes. The index operator [] can be used to access individual bytes and the copyIn and copyOut methods </span>
<a name="l02258"></a>02258 <span class="comment">    can be used to get and put blocks of data. In this mode, the read and write position properties are ignored. </span>
<a name="l02259"></a>02259 <span class="comment">    Access to the byte array is from index zero up to the size defined by the length property. When constructed, </span>
<a name="l02260"></a>02260 <span class="comment">    the ByteArray can be designated as growable, in which case the initial size will grow as required to accomodate </span>
<a name="l02261"></a>02261 <span class="comment">    data and the length property will be updated accordingly.</span>
<a name="l02262"></a>02262 <span class="comment">    \n\n</span>
<a name="l02263"></a>02263 <span class="comment">    When used as a Stream, the byte array additional write methods to store data at the location specified by the </span>
<a name="l02264"></a>02264 <span class="comment">    $writePosition property and read methods to read from the $readPosition property. The $available method </span>
<a name="l02265"></a>02265 <span class="comment">    indicates how much data is available between the read and write position pointers. The $reset method can </span>
<a name="l02266"></a>02266 <span class="comment">    reset the pointers to the start of the array.  When used with for/in, ByteArrays will iterate or </span>
<a name="l02267"></a>02267 <span class="comment">    enumerate over the available data between the read and write pointers.</span>
<a name="l02268"></a>02268 <span class="comment">    \n\n</span>
<a name="l02269"></a>02269 <span class="comment">    If numeric values are read or written, they will be encoded according to the value of the endian property </span>
<a name="l02270"></a>02270 <span class="comment">    which can be set to either LittleEndian or BigEndian. </span>
<a name="l02271"></a>02271 <span class="comment">    \n\n</span>
<a name="l02272"></a>02272 <span class="comment">    In Stream mode ByteArrays can be configured to run in sync or async mode. Adding observers via the $addObserver</span>
<a name="l02273"></a>02273 <span class="comment">    method will put a stream into async mode. Events will then be issued for close, eof, read and write events.</span>
<a name="l02274"></a>02274 <span class="comment">    @stability Evolving</span>
<a name="l02275"></a>02275 <span class="comment">    @defgroup EjsByteArray EjsByteArray</span>
<a name="l02276"></a>02276 <span class="comment">    @see EjsByteArray ejsIsByteArray ejsCreateByteArray ejsSetByteArrayPositions ejsCopyToByteArray</span>
<a name="l02277"></a>02277 <span class="comment"> */</span>
<a name="l02278"></a>02278 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsByteArray {
<a name="l02279"></a>02279     EjsObj          obj;                <span class="comment">/**&lt; Extends Object - Property storage (not used) */</span>
<a name="l02280"></a>02280     EjsObj          *emitter;           <span class="comment">/**&lt; Event emitter for listeners */</span>
<a name="l02281"></a>02281     uchar           *value;             <span class="comment">/**&lt; Data bytes in the array */</span>
<a name="l02282"></a>02282     <span class="keywordtype">int</span>             async;              <span class="comment">/**&lt; Async mode */</span>
<a name="l02283"></a>02283     <span class="keywordtype">int</span>             endian;             <span class="comment">/**&lt; Endian encoding */</span>
<a name="l02284"></a>02284     <span class="keywordtype">int</span>             length;             <span class="comment">/**&lt; Length property */</span>
<a name="l02285"></a>02285     <span class="keywordtype">int</span>             growInc;            <span class="comment">/**&lt; Current read position */</span>
<a name="l02286"></a>02286     <span class="keywordtype">int</span>             swap;               <span class="comment">/**&lt; I/O must swap bytes due to endian byte ordering */</span>
<a name="l02287"></a>02287     <span class="keywordtype">int</span>             readPosition;       <span class="comment">/**&lt; Current read position */</span>
<a name="l02288"></a>02288     <span class="keywordtype">int</span>             writePosition;      <span class="comment">/**&lt; Current write position */</span>
<a name="l02289"></a>02289     <span class="keywordtype">bool</span>            growable;           <span class="comment">/**&lt; Aray is growable */</span>
<a name="l02290"></a>02290     EjsObj          *listeners;         <span class="comment">/**&lt; Event listeners in async mode */</span>
<a name="l02291"></a>02291 } EjsByteArray;
<a name="l02292"></a>02292 
<a name="l02293"></a>02293 <span class="preprocessor">#if DOXYGEN</span>
<a name="l02294"></a>02294 <span class="preprocessor"></span><span class="comment">    /** </span>
<a name="l02295"></a>02295 <span class="comment">        Determine if a variable is a byte array</span>
<a name="l02296"></a>02296 <span class="comment">        @param vp Variable to test</span>
<a name="l02297"></a>02297 <span class="comment">        @return True if the variable is a byte array</span>
<a name="l02298"></a>02298 <span class="comment">        @ingroup EjsByteArray</span>
<a name="l02299"></a>02299 <span class="comment">     */</span>
<a name="l02300"></a>02300     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_byte_array.html#gd776821fe6df5db995543ec0d60387f0" title="Determine if a variable is a byte array.">ejsIsByteArray</a>(EjsObj *vp);
<a name="l02301"></a>02301 <span class="preprocessor">#else</span>
<a name="l02302"></a>02302 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsByteArray(vp) ejsIs(vp, ES_ByteArray)</span>
<a name="l02303"></a>02303 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02304"></a>02304 <span class="preprocessor"></span><span class="comment"></span>
<a name="l02305"></a>02305 <span class="comment">/** </span>
<a name="l02306"></a>02306 <span class="comment">    Create a byte array</span>
<a name="l02307"></a>02307 <span class="comment">    @description Create a new byte array instance.</span>
<a name="l02308"></a>02308 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02309"></a>02309 <span class="comment">    @param size Initial size of the byte array</span>
<a name="l02310"></a>02310 <span class="comment">    @return A new byte array instance</span>
<a name="l02311"></a>02311 <span class="comment">    @ingroup EjsByteArray</span>
<a name="l02312"></a>02312 <span class="comment"> */</span>
<a name="l02313"></a>02313 <span class="keyword">extern</span> EjsByteArray *<a class="code" href="group___ejs_byte_array.html#g7c58836430321096069355ee4f0f1114" title="Create a byte array.">ejsCreateByteArray</a>(Ejs *ejs, <span class="keywordtype">int</span> size);
<a name="l02314"></a>02314 <span class="comment"></span>
<a name="l02315"></a>02315 <span class="comment">/** </span>
<a name="l02316"></a>02316 <span class="comment">    Set the I/O byte array positions</span>
<a name="l02317"></a>02317 <span class="comment">    @description Set the read and/or write positions into the byte array. ByteArrays implement the Stream interface</span>
<a name="l02318"></a>02318 <span class="comment">        and support sequential and random access reading and writing of data in the array. The byte array maintains</span>
<a name="l02319"></a>02319 <span class="comment">        read and write positions that are automatically updated as data is read or written from or to the array. </span>
<a name="l02320"></a>02320 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02321"></a>02321 <span class="comment">    @param ba Byte array object</span>
<a name="l02322"></a>02322 <span class="comment">    @param readPosition New read position to set</span>
<a name="l02323"></a>02323 <span class="comment">    @param writePosition New write position to set</span>
<a name="l02324"></a>02324 <span class="comment">    @ingroup EjsByteArray</span>
<a name="l02325"></a>02325 <span class="comment"> */</span>
<a name="l02326"></a>02326 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="group___ejs_byte_array.html#gb8ca386fac3fe62e25d296a15da3e80e" title="Set the I/O byte array positions.">ejsSetByteArrayPositions</a>(Ejs *ejs, EjsByteArray *ba, <span class="keywordtype">int</span> readPosition, <span class="keywordtype">int</span> writePosition);
<a name="l02327"></a>02327 <span class="comment"></span>
<a name="l02328"></a>02328 <span class="comment">/** </span>
<a name="l02329"></a>02329 <span class="comment">    Copy data into a byte array</span>
<a name="l02330"></a>02330 <span class="comment">    @description Copy data into a byte array at a specified \a offset. </span>
<a name="l02331"></a>02331 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02332"></a>02332 <span class="comment">    @param ba Byte array object</span>
<a name="l02333"></a>02333 <span class="comment">    @param offset Offset in the byte array to which to copy the data.</span>
<a name="l02334"></a>02334 <span class="comment">    @param data Pointer to the source data</span>
<a name="l02335"></a>02335 <span class="comment">    @param length Length of the data to copy</span>
<a name="l02336"></a>02336 <span class="comment">    @return Zero if successful, otherwise a negative MPR error code.</span>
<a name="l02337"></a>02337 <span class="comment"> */</span>
<a name="l02338"></a>02338 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsCopyToByteArray(Ejs *ejs, EjsByteArray *ba, <span class="keywordtype">int</span> offset, <span class="keywordtype">char</span> *data, <span class="keywordtype">int</span> length);
<a name="l02339"></a>02339 
<a name="l02340"></a>02340 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsResetByteArray(EjsByteArray *ba);
<a name="l02341"></a>02341 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsGetByteArrayAvailable(EjsByteArray *ba);
<a name="l02342"></a>02342 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsGetByteArrayRoom(EjsByteArray *ba);
<a name="l02343"></a>02343 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsGrowByteArray(Ejs *ejs, EjsByteArray *ap, <span class="keywordtype">int</span> size);
<a name="l02344"></a>02344 
<a name="l02345"></a>02345 <span class="keyword">extern</span> <span class="keyword">struct </span>EjsNumber *ejsWriteToByteArray(Ejs *ejs, EjsByteArray *ap, <span class="keywordtype">int</span> argc, EjsObj **argv);
<a name="l02346"></a>02346 
<a name="l02347"></a>02347 <span class="comment"></span>
<a name="l02348"></a>02348 <span class="comment">/** </span>
<a name="l02349"></a>02349 <span class="comment">    Date class</span>
<a name="l02350"></a>02350 <span class="comment">    @description The Date class is a general purpose class for working with dates and times. </span>
<a name="l02351"></a>02351 <span class="comment">        is a a primitive native type and extends EjsObj. It is still logically an Object, but implements Object </span>
<a name="l02352"></a>02352 <span class="comment">        properties and methods itself. </span>
<a name="l02353"></a>02353 <span class="comment">    @stability Evolving</span>
<a name="l02354"></a>02354 <span class="comment">    @defgroup EjsDate EjsDate</span>
<a name="l02355"></a>02355 <span class="comment">    @see EjsDate EjsIsDate ejsCreateDate</span>
<a name="l02356"></a>02356 <span class="comment"> */</span>
<a name="l02357"></a>02357 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsDate {
<a name="l02358"></a>02358     EjsObj          obj;                <span class="comment">/**&lt; Extends Object - Property storage */</span>
<a name="l02359"></a>02359     MprTime         value;              <span class="comment">/**&lt; Time in milliseconds since "1970/01/01 GMT" */</span>
<a name="l02360"></a>02360 } EjsDate;
<a name="l02361"></a>02361 
<a name="l02362"></a>02362 <span class="preprocessor">#if DOXYGEN</span>
<a name="l02363"></a>02363 <span class="preprocessor"></span><span class="comment">    /** </span>
<a name="l02364"></a>02364 <span class="comment">        Determine if a variable is a Date</span>
<a name="l02365"></a>02365 <span class="comment">        @param vp Variable to test</span>
<a name="l02366"></a>02366 <span class="comment">        @return True if the variable is a date</span>
<a name="l02367"></a>02367 <span class="comment">        @ingroup EjsDate</span>
<a name="l02368"></a>02368 <span class="comment">     */</span>
<a name="l02369"></a>02369     <span class="keywordtype">bool</span> <a class="code" href="group___ejs_date.html#gb2a17520c72680a81dc8cb56d806c944" title="Determine if a variable is a Date.">ejsIsDate</a>(EjsObj *vp);
<a name="l02370"></a>02370 <span class="preprocessor">#else</span>
<a name="l02371"></a>02371 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsDate(vp) ejsIs(vp, ES_Date)</span>
<a name="l02372"></a>02372 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02373"></a>02373 <span class="preprocessor"></span><span class="comment"></span>
<a name="l02374"></a>02374 <span class="comment">/** </span>
<a name="l02375"></a>02375 <span class="comment">    Create a new date instance</span>
<a name="l02376"></a>02376 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02377"></a>02377 <span class="comment">    @param value Date/time value to set the new date instance to</span>
<a name="l02378"></a>02378 <span class="comment">    @return An initialized date instance</span>
<a name="l02379"></a>02379 <span class="comment">    @ingroup EjsDate</span>
<a name="l02380"></a>02380 <span class="comment"> */</span>
<a name="l02381"></a>02381 <span class="keyword">extern</span> EjsDate *<a class="code" href="group___ejs_date.html#gd85120109dc8c4d6a399d5e81be3cc78" title="Create a new date instance.">ejsCreateDate</a>(Ejs *ejs, MprTime value);
<a name="l02382"></a>02382 <span class="comment"></span>
<a name="l02383"></a>02383 <span class="comment">/** </span>
<a name="l02384"></a>02384 <span class="comment">    Error classes</span>
<a name="l02385"></a>02385 <span class="comment">    @description Base class for error exception objects. Exception objects are created by programs and by the system </span>
<a name="l02386"></a>02386 <span class="comment">    as part of changing the normal flow of execution when some error condition occurs. </span>
<a name="l02387"></a>02387 <span class="comment">    When an exception is created and acted upon ("thrown"), the system transfers the flow of control to a </span>
<a name="l02388"></a>02388 <span class="comment">    pre-defined instruction stream (the handler or "catch" code). The handler may return processing to the </span>
<a name="l02389"></a>02389 <span class="comment">    point at which the exception was thrown or not. It may re-throw the exception or pass control up the call stack.</span>
<a name="l02390"></a>02390 <span class="comment">    @stability Evolving.</span>
<a name="l02391"></a>02391 <span class="comment">    @defgroup EjsError EjsError ejsFormatStack ejsGetErrorMsg ejsHasException ejsThrowArgError ejsThrowAssertError</span>
<a name="l02392"></a>02392 <span class="comment">        ejsThrowArithmeticError ejsThrowInstructionError ejsThrowError ejsThrowInternalError ejsThrowIOError</span>
<a name="l02393"></a>02393 <span class="comment">        ejsThrowMemoryError ejsThrowOutOfBoundsError ejsThrowReferenceError ejsThrowResourceError ejsThrowStateError</span>
<a name="l02394"></a>02394 <span class="comment">        ejsThrowStopIteration ejsThrowSyntaxError ejsThrowTypeError</span>
<a name="l02395"></a>02395 <span class="comment"> */</span>
<a name="l02396"></a>02396 <span class="comment">//  MOB -- perhaps remove and just use EjsObj. Ie. no longer native</span>
<a name="l02397"></a>02397 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsError {
<a name="l02398"></a>02398     EjsObj          obj;                <span class="comment">/**&lt; Extends Object */</span>
<a name="l02399"></a>02399 <span class="preprocessor">#if UNUSED</span>
<a name="l02400"></a>02400 <span class="preprocessor"></span>    EjsObj          *data;              <span class="comment">/**&lt; Error data message */</span>
<a name="l02401"></a>02401     <span class="keywordtype">char</span>            *message;           <span class="comment">/**&lt; Exception message */</span>
<a name="l02402"></a>02402     <span class="keywordtype">char</span>            *stack;             <span class="comment">/**&lt; Execution stack back trace */</span>
<a name="l02403"></a>02403     <span class="keywordtype">char</span>            *filename;          <span class="comment">/**&lt; Source code file name */</span>
<a name="l02404"></a>02404     <span class="keywordtype">int</span>             lineNumber;         <span class="comment">/**&lt; Source code line number */</span>
<a name="l02405"></a>02405     <span class="keywordtype">int</span>             code;               <span class="comment">/**&lt; Unique error lookup code */</span>
<a name="l02406"></a>02406 <span class="preprocessor">#endif</span>
<a name="l02407"></a>02407 <span class="preprocessor"></span>} EjsError;
<a name="l02408"></a>02408 
<a name="l02409"></a>02409 <span class="preprocessor">#define ejsIsError(vp) ejsIs(vp, ES_Error)</span>
<a name="l02410"></a>02410 <span class="preprocessor"></span>
<a name="l02411"></a>02411 <span class="keyword">extern</span> EjsError *ejsCreateError(Ejs *ejs, <span class="keyword">struct</span> EjsType *type, EjsObj *message);
<a name="l02412"></a>02412 <span class="keyword">extern</span> EjsArray *ejsCaptureStack(Ejs *ejs, <span class="keywordtype">int</span> uplevels);
<a name="l02413"></a>02413 
<a name="l02414"></a>02414 <span class="comment">/* </span>
<a name="l02415"></a>02415 <span class="comment">    DEPRECATED MOB</span>
<a name="l02416"></a>02416 <span class="comment">    Format the stack backtrace</span>
<a name="l02417"></a>02417 <span class="comment">    @description Return a string containing the current interpreter stack backtrace</span>
<a name="l02418"></a>02418 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02419"></a>02419 <span class="comment">    @param error Error exception object to analyseo analyseo analyseo analyse</span>
<a name="l02420"></a>02420 <span class="comment">    @return A string containing the stack backtrace. The caller must free.</span>
<a name="l02421"></a>02421 <span class="comment">    @ingroup EjsError</span>
<a name="l02422"></a>02422 <span class="comment">extern char *ejsFormatStack(Ejs *ejs, EjsError *error);</span>
<a name="l02423"></a>02423 <span class="comment"> */</span>
<a name="l02424"></a>02424 <span class="comment"></span>
<a name="l02425"></a>02425 <span class="comment">/** </span>
<a name="l02426"></a>02426 <span class="comment">    Get the interpreter error message</span>
<a name="l02427"></a>02427 <span class="comment">    @description Return a string containing the current interpreter error message</span>
<a name="l02428"></a>02428 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02429"></a>02429 <span class="comment">    @param withStack Set to 1 to include a stack backtrace in the error message</span>
<a name="l02430"></a>02430 <span class="comment">    @return A string containing the error message. The caller must not free.</span>
<a name="l02431"></a>02431 <span class="comment">    @ingroup EjsError</span>
<a name="l02432"></a>02432 <span class="comment"> */</span>
<a name="l02433"></a>02433 <span class="keyword">extern</span> cchar *<a class="code" href="group___ejs_error.html#g26516321557d20655ded73648c787e46" title="Get the interpreter error message.">ejsGetErrorMsg</a>(Ejs *ejs, <span class="keywordtype">int</span> withStack);
<a name="l02434"></a>02434 <span class="comment"></span>
<a name="l02435"></a>02435 <span class="comment">/** </span>
<a name="l02436"></a>02436 <span class="comment">    Determine if an exception has been thrown</span>
<a name="l02437"></a>02437 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02438"></a>02438 <span class="comment">    @return True if an exception has been thrown</span>
<a name="l02439"></a>02439 <span class="comment">    @ingroup EjsError</span>
<a name="l02440"></a>02440 <span class="comment"> */</span>
<a name="l02441"></a>02441 <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_error.html#gba0d6e967d7b71217b76f8166baf7183" title="Determine if an exception has been thrown.">ejsHasException</a>(Ejs *ejs);
<a name="l02442"></a>02442 
<a name="l02443"></a>02443 <span class="comment">// TODO - DOC</span>
<a name="l02444"></a>02444 <span class="keyword">extern</span> EjsObj *ejsGetException(Ejs *ejs);
<a name="l02445"></a>02445 <span class="comment"></span>
<a name="l02446"></a>02446 <span class="comment">/** </span>
<a name="l02447"></a>02447 <span class="comment">    Throw an argument exception</span>
<a name="l02448"></a>02448 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02449"></a>02449 <span class="comment">    @param fmt Printf style format string to use for the error message</span>
<a name="l02450"></a>02450 <span class="comment">    @param ... Message arguments</span>
<a name="l02451"></a>02451 <span class="comment">    @ingroup EjsError</span>
<a name="l02452"></a>02452 <span class="comment"> */</span>
<a name="l02453"></a>02453 <span class="keyword">extern</span> EjsObj *<a class="code" href="group___ejs_error.html#g728c0c3c7353c5ece9d9c8a7252eca57" title="Throw an argument exception.">ejsThrowArgError</a>(Ejs *ejs, cchar *fmt, ...) PRINTF_ATTRIBUTE(2,3);
<a name="l02454"></a>02454 <span class="comment"></span>
<a name="l02455"></a>02455 <span class="comment">/** </span>
<a name="l02456"></a>02456 <span class="comment">    Throw an assertion exception</span>
<a name="l02457"></a>02457 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02458"></a>02458 <span class="comment">    @param fmt Printf style format string to use for the error message</span>
<a name="l02459"></a>02459 <span class="comment">    @param ... Message arguments</span>
<a name="l02460"></a>02460 <span class="comment">    @ingroup EjsError</span>
<a name="l02461"></a>02461 <span class="comment"> */</span>
<a name="l02462"></a>02462 extern EjsObj *<a class="code" href="group___ejs_error.html#g841a5e9818d58b407f0845f72f31baea" title="Throw an assertion exception.">ejsThrowAssertError</a>(Ejs *ejs, cchar *fmt, ...) PRINTF_ATTRIBUTE(2,3);
<a name="l02463"></a>02463 <span class="comment"></span>
<a name="l02464"></a>02464 <span class="comment">/** </span>
<a name="l02465"></a>02465 <span class="comment">    Throw an math exception</span>
<a name="l02466"></a>02466 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02467"></a>02467 <span class="comment">    @param fmt Printf style format string to use for the error message</span>
<a name="l02468"></a>02468 <span class="comment">    @param ... Message arguments</span>
<a name="l02469"></a>02469 <span class="comment">    @ingroup EjsError</span>
<a name="l02470"></a>02470 <span class="comment"> */</span>
<a name="l02471"></a>02471 extern EjsObj *<a class="code" href="group___ejs_error.html#g2ed4b80af588982f4b5eaf4d10012447" title="Throw an math exception.">ejsThrowArithmeticError</a>(Ejs *ejs, cchar *fmt, ...) PRINTF_ATTRIBUTE(2,3);
<a name="l02472"></a>02472 <span class="comment"></span>
<a name="l02473"></a>02473 <span class="comment">/** </span>
<a name="l02474"></a>02474 <span class="comment">    Throw an instruction code exception</span>
<a name="l02475"></a>02475 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02476"></a>02476 <span class="comment">    @param fmt Printf style format string to use for the error message</span>
<a name="l02477"></a>02477 <span class="comment">    @param ... Message arguments</span>
<a name="l02478"></a>02478 <span class="comment">    @ingroup EjsError</span>
<a name="l02479"></a>02479 <span class="comment"> */</span>
<a name="l02480"></a>02480 extern EjsObj *<a class="code" href="group___ejs_error.html#g4e7cf341078092e2b455be68e0710b8a" title="Throw an instruction code exception.">ejsThrowInstructionError</a>(Ejs *ejs, cchar *fmt, ...) PRINTF_ATTRIBUTE(2,3);
<a name="l02481"></a>02481 <span class="comment"></span>
<a name="l02482"></a>02482 <span class="comment">/** </span>
<a name="l02483"></a>02483 <span class="comment">    Throw an general error exception</span>
<a name="l02484"></a>02484 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02485"></a>02485 <span class="comment">    @param fmt Printf style format string to use for the error message</span>
<a name="l02486"></a>02486 <span class="comment">    @param ... Message arguments</span>
<a name="l02487"></a>02487 <span class="comment">    @ingroup EjsError</span>
<a name="l02488"></a>02488 <span class="comment"> */</span>
<a name="l02489"></a>02489 extern EjsObj *<a class="code" href="group___ejs_error.html#g287d5245d90a95dbc8db2e184672b3c2" title="Throw an general error exception.">ejsThrowError</a>(Ejs *ejs, cchar *fmt, ...) PRINTF_ATTRIBUTE(2,3);
<a name="l02490"></a>02490 <span class="comment"></span>
<a name="l02491"></a>02491 <span class="comment">/** </span>
<a name="l02492"></a>02492 <span class="comment">    Throw an internal error exception</span>
<a name="l02493"></a>02493 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02494"></a>02494 <span class="comment">    @param fmt Printf style format string to use for the error message</span>
<a name="l02495"></a>02495 <span class="comment">    @param ... Message arguments</span>
<a name="l02496"></a>02496 <span class="comment">    @ingroup EjsError</span>
<a name="l02497"></a>02497 <span class="comment"> */</span>
<a name="l02498"></a>02498 extern EjsObj *<a class="code" href="group___ejs_error.html#gb17c0d454663539ea9e4e37576e9d1ad" title="Throw an internal error exception.">ejsThrowInternalError</a>(Ejs *ejs, cchar *fmt, ...) PRINTF_ATTRIBUTE(2,3);
<a name="l02499"></a>02499 <span class="comment"></span>
<a name="l02500"></a>02500 <span class="comment">/** </span>
<a name="l02501"></a>02501 <span class="comment">    Throw an IO exception</span>
<a name="l02502"></a>02502 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02503"></a>02503 <span class="comment">    @param fmt Printf style format string to use for the error message</span>
<a name="l02504"></a>02504 <span class="comment">    @param ... Message arguments</span>
<a name="l02505"></a>02505 <span class="comment">    @ingroup EjsError</span>
<a name="l02506"></a>02506 <span class="comment"> */</span>
<a name="l02507"></a>02507 extern EjsObj *<a class="code" href="group___ejs_error.html#g77d16ceec4830daccf21493931c3647b" title="Throw an IO exception.">ejsThrowIOError</a>(Ejs *ejs, cchar *fmt, ...) PRINTF_ATTRIBUTE(2,3);
<a name="l02508"></a>02508 <span class="comment"></span>
<a name="l02509"></a>02509 <span class="comment">/** </span>
<a name="l02510"></a>02510 <span class="comment">    Throw an Memory depletion exception</span>
<a name="l02511"></a>02511 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02512"></a>02512 <span class="comment">    @ingroup EjsError</span>
<a name="l02513"></a>02513 <span class="comment"> */</span>
<a name="l02514"></a>02514 extern EjsObj *<a class="code" href="group___ejs_error.html#g8397057f54899e31de1e6a16a90888f5" title="Throw an Memory depletion exception.">ejsThrowMemoryError</a>(Ejs *ejs);
<a name="l02515"></a>02515 <span class="comment"></span>
<a name="l02516"></a>02516 <span class="comment">/** </span>
<a name="l02517"></a>02517 <span class="comment">    Throw an out of bounds exception</span>
<a name="l02518"></a>02518 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02519"></a>02519 <span class="comment">    @param fmt Printf style format string to use for the error message</span>
<a name="l02520"></a>02520 <span class="comment">    @param ... Message arguments</span>
<a name="l02521"></a>02521 <span class="comment">    @ingroup EjsError</span>
<a name="l02522"></a>02522 <span class="comment"> */</span>
<a name="l02523"></a>02523 extern EjsObj *<a class="code" href="group___ejs_error.html#g0f340392e88ad2bd7fba1d8b4c5b8d1a" title="Throw an out of bounds exception.">ejsThrowOutOfBoundsError</a>(Ejs *ejs, cchar *fmt, ...) PRINTF_ATTRIBUTE(2,3);
<a name="l02524"></a>02524 <span class="comment"></span>
<a name="l02525"></a>02525 <span class="comment">/** </span>
<a name="l02526"></a>02526 <span class="comment">    Throw an reference exception</span>
<a name="l02527"></a>02527 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02528"></a>02528 <span class="comment">    @param fmt Printf style format string to use for the error message</span>
<a name="l02529"></a>02529 <span class="comment">    @param ... Message arguments</span>
<a name="l02530"></a>02530 <span class="comment">    @ingroup EjsError</span>
<a name="l02531"></a>02531 <span class="comment"> */</span>
<a name="l02532"></a>02532 extern EjsObj *<a class="code" href="group___ejs_error.html#g5a7fcf0e6f50be3f9338a22b2de2ef4a" title="Throw an reference exception.">ejsThrowReferenceError</a>(Ejs *ejs, cchar *fmt, ...) PRINTF_ATTRIBUTE(2,3);
<a name="l02533"></a>02533 <span class="comment"></span>
<a name="l02534"></a>02534 <span class="comment">/** </span>
<a name="l02535"></a>02535 <span class="comment">    Throw an resource exception</span>
<a name="l02536"></a>02536 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02537"></a>02537 <span class="comment">    @param fmt Printf style format string to use for the error message</span>
<a name="l02538"></a>02538 <span class="comment">    @param ... Message arguments</span>
<a name="l02539"></a>02539 <span class="comment">    @ingroup EjsError</span>
<a name="l02540"></a>02540 <span class="comment"> */</span>
<a name="l02541"></a>02541 extern EjsObj *<a class="code" href="group___ejs_error.html#g89a1a9b3b3af372c438c1220c2af988e" title="Throw an resource exception.">ejsThrowResourceError</a>(Ejs *ejs, cchar *fmt, ...) PRINTF_ATTRIBUTE(2,3);
<a name="l02542"></a>02542 <span class="comment"></span>
<a name="l02543"></a>02543 <span class="comment">/** </span>
<a name="l02544"></a>02544 <span class="comment">    Throw an state exception</span>
<a name="l02545"></a>02545 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02546"></a>02546 <span class="comment">    @param fmt Printf style format string to use for the error message</span>
<a name="l02547"></a>02547 <span class="comment">    @param ... Message arguments</span>
<a name="l02548"></a>02548 <span class="comment">    @ingroup EjsError</span>
<a name="l02549"></a>02549 <span class="comment"> */</span>
<a name="l02550"></a>02550 extern EjsObj *<a class="code" href="group___ejs_error.html#g0ce5ad97f148ce6e0ad50009d08dec23" title="Throw an state exception.">ejsThrowStateError</a>(Ejs *ejs, cchar *fmt, ...) PRINTF_ATTRIBUTE(2,3);
<a name="l02551"></a>02551 <span class="comment"></span>
<a name="l02552"></a>02552 <span class="comment">/** </span>
<a name="l02553"></a>02553 <span class="comment">    Throw an stop iteration exception</span>
<a name="l02554"></a>02554 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02555"></a>02555 <span class="comment">    @ingroup EjsError</span>
<a name="l02556"></a>02556 <span class="comment"> */</span>
<a name="l02557"></a>02557 extern EjsObj *<a class="code" href="group___ejs_error.html#g1e0a863535a31f998de69e7814136e52" title="Throw an stop iteration exception.">ejsThrowStopIteration</a>(Ejs *ejs);
<a name="l02558"></a>02558 <span class="comment"></span>
<a name="l02559"></a>02559 <span class="comment">/** </span>
<a name="l02560"></a>02560 <span class="comment">    Throw an syntax error exception</span>
<a name="l02561"></a>02561 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02562"></a>02562 <span class="comment">    @param fmt Printf style format string to use for the error message</span>
<a name="l02563"></a>02563 <span class="comment">    @param ... Message arguments</span>
<a name="l02564"></a>02564 <span class="comment">    @ingroup EjsError</span>
<a name="l02565"></a>02565 <span class="comment"> */</span>
<a name="l02566"></a>02566 extern EjsObj *<a class="code" href="group___ejs_error.html#g53d90d6cf4328f62db3d8d27df4ee6d0" title="Throw an syntax error exception.">ejsThrowSyntaxError</a>(Ejs *ejs, cchar *fmt, ...) PRINTF_ATTRIBUTE(2,3);
<a name="l02567"></a>02567 <span class="comment"></span>
<a name="l02568"></a>02568 <span class="comment">/** </span>
<a name="l02569"></a>02569 <span class="comment">    Throw an type error exception</span>
<a name="l02570"></a>02570 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02571"></a>02571 <span class="comment">    @param fmt Printf style format string to use for the error message</span>
<a name="l02572"></a>02572 <span class="comment">    @param ... Message arguments</span>
<a name="l02573"></a>02573 <span class="comment">    @ingroup EjsError</span>
<a name="l02574"></a>02574 <span class="comment"> */</span>
<a name="l02575"></a>02575 extern EjsObj *<a class="code" href="group___ejs_error.html#g2e69a566496d92803f39017fb9cba1d7" title="Throw an type error exception.">ejsThrowTypeError</a>(Ejs *ejs, cchar *fmt, ...) PRINTF_ATTRIBUTE(2,3);
<a name="l02576"></a>02576 
<a name="l02577"></a>02577 <span class="comment"></span>
<a name="l02578"></a>02578 <span class="comment">/** </span>
<a name="l02579"></a>02579 <span class="comment">    File class</span>
<a name="l02580"></a>02580 <span class="comment">    @description The File class provides a foundation of I/O services to interact with physical files and directories.</span>
<a name="l02581"></a>02581 <span class="comment">    Each File object represents a single file or directory and provides methods for creating, opening, reading, writing </span>
<a name="l02582"></a>02582 <span class="comment">    and deleting files, and for accessing and modifying information about the file.</span>
<a name="l02583"></a>02583 <span class="comment">    @stability Prototype</span>
<a name="l02584"></a>02584 <span class="comment">    @defgroup EjsFile EjsFile </span>
<a name="l02585"></a>02585 <span class="comment">    @see EjsFile ejsCreateFile ejsIsFile</span>
<a name="l02586"></a>02586 <span class="comment"> */</span>
<a name="l02587"></a>02587 typedef struct EjsFile {
<a name="l02588"></a>02588     EjsObj          obj;                <span class="comment">/**&lt; Extends Object */</span>
<a name="l02589"></a>02589     MprFile         *file;              <span class="comment">/**&lt; Open file handle */</span>
<a name="l02590"></a>02590     MprPath         info;               <span class="comment">/**&lt; Cached file info */</span>
<a name="l02591"></a>02591     <span class="keywordtype">char</span>            *path;              <span class="comment">/**&lt; Filename path */</span>
<a name="l02592"></a>02592     <span class="keywordtype">char</span>            *modeString;        <span class="comment">/**&lt; User supplied mode string */</span>
<a name="l02593"></a>02593     <span class="keywordtype">int</span>             mode;               <span class="comment">/**&lt; Current open mode */</span>
<a name="l02594"></a>02594     <span class="keywordtype">int</span>             perms;              <span class="comment">/**&lt; Posix permissions mask */</span>
<a name="l02595"></a>02595 <span class="preprocessor">#if FUTURE</span>
<a name="l02596"></a>02596 <span class="preprocessor"></span>    cchar           *cygdrive;          <span class="comment">/**&lt; Cygwin drive directory (c:/cygdrive) */</span>
<a name="l02597"></a>02597     cchar           *newline;           <span class="comment">/**&lt; Newline delimiters */</span>
<a name="l02598"></a>02598     <span class="keywordtype">int</span>             delimiter;          <span class="comment">/**&lt; Path delimiter ('/' or '\\') */</span>
<a name="l02599"></a>02599     <span class="keywordtype">int</span>             hasDriveSpecs;      <span class="comment">/**&lt; Paths on this file system have a drive spec */</span>
<a name="l02600"></a>02600 <span class="preprocessor">#endif</span>
<a name="l02601"></a>02601 <span class="preprocessor"></span>} EjsFile;
<a name="l02602"></a>02602 <span class="comment"></span>
<a name="l02603"></a>02603 <span class="comment">/** </span>
<a name="l02604"></a>02604 <span class="comment">    Create a File object</span>
<a name="l02605"></a>02605 <span class="comment">    @description Create a file object associated with the given filename. The filename is not opened, just stored.</span>
<a name="l02606"></a>02606 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02607"></a>02607 <span class="comment">    @param filename Filename to associate with the file object</span>
<a name="l02608"></a>02608 <span class="comment">    @return A new file object</span>
<a name="l02609"></a>02609 <span class="comment">    @ingroup EjsFile</span>
<a name="l02610"></a>02610 <span class="comment"> */</span>
<a name="l02611"></a>02611 <span class="keyword">extern</span> EjsFile *<a class="code" href="group___ejs_file.html#g5f2c865e36e54f93f3caa0159982cff9" title="Create a File object.">ejsCreateFile</a>(Ejs *ejs, cchar *filename);
<a name="l02612"></a>02612 
<a name="l02613"></a>02613 <span class="keyword">extern</span> EjsFile *ejsCreateFileFromFd(Ejs *ejs, <span class="keywordtype">int</span> fd, cchar *name, <span class="keywordtype">int</span> mode);
<a name="l02614"></a>02614 
<a name="l02615"></a>02615 <span class="preprocessor">#if DOXYGEN</span>
<a name="l02616"></a>02616 <span class="preprocessor"></span><span class="comment">    /** </span>
<a name="l02617"></a>02617 <span class="comment">        Determine if a variable is a File</span>
<a name="l02618"></a>02618 <span class="comment">        @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02619"></a>02619 <span class="comment">        @param vp Variable to test</span>
<a name="l02620"></a>02620 <span class="comment">        @return True if the variable is a File</span>
<a name="l02621"></a>02621 <span class="comment">        @ingroup File</span>
<a name="l02622"></a>02622 <span class="comment">     */</span>
<a name="l02623"></a>02623     <span class="keyword">extern</span> <span class="keywordtype">bool</span> ejsIsFile(Ejs *ejs, EjsObj *vp);
<a name="l02624"></a>02624 <span class="preprocessor">#else</span>
<a name="l02625"></a>02625 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsFile(ejs, vp) (vp &amp;&amp; ((EjsObj*) vp)-&gt;type == ejs-&gt;fileType)</span>
<a name="l02626"></a>02626 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02627"></a>02627 <span class="preprocessor"></span>
<a name="l02628"></a>02628 <span class="comment"></span>
<a name="l02629"></a>02629 <span class="comment">/**</span>
<a name="l02630"></a>02630 <span class="comment">    Path class</span>
<a name="l02631"></a>02631 <span class="comment">    @description The Path class provides file path name services.</span>
<a name="l02632"></a>02632 <span class="comment">    @stability Prototype</span>
<a name="l02633"></a>02633 <span class="comment">    @defgroup EjsPath EjsPath </span>
<a name="l02634"></a>02634 <span class="comment">    @see EjsFile ejsCreatePath ejsIsPath</span>
<a name="l02635"></a>02635 <span class="comment"> */</span>
<a name="l02636"></a>02636 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsPath {
<a name="l02637"></a>02637     EjsObj          obj;                <span class="comment">/**&lt; Extends Object */</span>
<a name="l02638"></a>02638     MprPath         info;               <span class="comment">/**&lt; Cached file info */</span>
<a name="l02639"></a>02639     <span class="comment">//  TODO - should have pathLength</span>
<a name="l02640"></a>02640     <span class="comment">//  TODO - rename value</span>
<a name="l02641"></a>02641     <span class="keywordtype">char</span>            *path;              <span class="comment">/**&lt; Filename path */</span>
<a name="l02642"></a>02642     MprList         *files;             <span class="comment">/**&lt; File list for enumeration */</span>
<a name="l02643"></a>02643 <span class="preprocessor">#if FUTURE</span>
<a name="l02644"></a>02644 <span class="preprocessor"></span>    cchar           *cygdrive;          <span class="comment">/**&lt; Cygwin drive directory (c:/cygdrive) */</span>
<a name="l02645"></a>02645     cchar           *newline;           <span class="comment">/**&lt; Newline delimiters */</span>
<a name="l02646"></a>02646     <span class="keywordtype">int</span>             delimiter;          <span class="comment">/**&lt; Path delimiter ('/' or '\\') */</span>
<a name="l02647"></a>02647     <span class="keywordtype">int</span>             hasDriveSpecs;      <span class="comment">/**&lt; Paths on this file system have a drive spec */</span>
<a name="l02648"></a>02648 <span class="preprocessor">#endif</span>
<a name="l02649"></a>02649 <span class="preprocessor"></span>} EjsPath;
<a name="l02650"></a>02650 
<a name="l02651"></a>02651 <span class="comment"></span>
<a name="l02652"></a>02652 <span class="comment">/** </span>
<a name="l02653"></a>02653 <span class="comment">    Create a Path object</span>
<a name="l02654"></a>02654 <span class="comment">    @description Create a file object associated with the given filename. The filename is not opened, just stored.</span>
<a name="l02655"></a>02655 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02656"></a>02656 <span class="comment">    @param path Path file name</span>
<a name="l02657"></a>02657 <span class="comment">    @return A new Path object</span>
<a name="l02658"></a>02658 <span class="comment">    @ingroup EjsPath</span>
<a name="l02659"></a>02659 <span class="comment"> */</span>
<a name="l02660"></a>02660 <span class="keyword">extern</span> EjsPath *<a class="code" href="group___ejs_path.html#ga846f8814b3aee5e8aebbd66a9cb945e" title="Create a Path object.">ejsCreatePath</a>(Ejs *ejs, cchar *path);
<a name="l02661"></a>02661 
<a name="l02662"></a>02662 <span class="keyword">extern</span> EjsPath *ejsCreatePathAndFree(Ejs *ejs, <span class="keywordtype">char</span> *path);
<a name="l02663"></a>02663 
<a name="l02664"></a>02664 <span class="preprocessor">#if DOXYGEN</span>
<a name="l02665"></a>02665 <span class="preprocessor"></span><span class="comment">    /** </span>
<a name="l02666"></a>02666 <span class="comment">        Determine if a variable is a Path</span>
<a name="l02667"></a>02667 <span class="comment">        @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02668"></a>02668 <span class="comment">        @param vp Variable to test</span>
<a name="l02669"></a>02669 <span class="comment">        @return True if the variable is a Path</span>
<a name="l02670"></a>02670 <span class="comment">        @ingroup EjsPath</span>
<a name="l02671"></a>02671 <span class="comment">     */</span>
<a name="l02672"></a>02672     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_path.html#g0d08757d7915410db9de0c35c815e124" title="Determine if a variable is a Path.">ejsIsPath</a>(Ejs *ejs, EjsObj *vp);
<a name="l02673"></a>02673 <span class="preprocessor">#else</span>
<a name="l02674"></a>02674 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsPath(ejs, vp) (vp &amp;&amp; ((EjsObj*) vp)-&gt;type == ejs-&gt;pathType)</span>
<a name="l02675"></a>02675 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02676"></a>02676 <span class="preprocessor"></span>
<a name="l02677"></a>02677 <span class="comment"></span>
<a name="l02678"></a>02678 <span class="comment">/** </span>
<a name="l02679"></a>02679 <span class="comment">    Uri class</span>
<a name="l02680"></a>02680 <span class="comment">    @description The Uri class provides file path name services.</span>
<a name="l02681"></a>02681 <span class="comment">    @stability Prototype</span>
<a name="l02682"></a>02682 <span class="comment">    @defgroup EjsUri EjsUri </span>
<a name="l02683"></a>02683 <span class="comment">    @see EjsFile ejsCreateUri ejsIsUri</span>
<a name="l02684"></a>02684 <span class="comment"> */</span>
<a name="l02685"></a>02685 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsUri {
<a name="l02686"></a>02686     EjsObj          obj;                <span class="comment">/**&lt; Extends Object */</span>
<a name="l02687"></a>02687     HttpUri         *uri;               <span class="comment">/**&lt; Decoded URI */</span>
<a name="l02688"></a>02688 } EjsUri;
<a name="l02689"></a>02689 
<a name="l02690"></a>02690 <span class="comment"></span>
<a name="l02691"></a>02691 <span class="comment">/** </span>
<a name="l02692"></a>02692 <span class="comment">    Create a Uri object</span>
<a name="l02693"></a>02693 <span class="comment">    @description Create a URI object associated with the given URI string.</span>
<a name="l02694"></a>02694 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02695"></a>02695 <span class="comment">    @param uri Uri string to parse</span>
<a name="l02696"></a>02696 <span class="comment">    @return A new Uri object</span>
<a name="l02697"></a>02697 <span class="comment">    @ingroup EjsUri</span>
<a name="l02698"></a>02698 <span class="comment"> */</span>
<a name="l02699"></a>02699 <span class="keyword">extern</span> EjsUri *<a class="code" href="group___ejs_uri.html#gc27bb05f2a8b6c1cc0301a5d66cff42b" title="Create a Uri object.">ejsCreateUri</a>(Ejs *ejs, cchar *uri);
<a name="l02700"></a>02700 <span class="keyword">extern</span> EjsUri *ejsCreateUriAndFree(Ejs *ejs, <span class="keywordtype">char</span> *uri);
<a name="l02701"></a>02701 <span class="keyword">extern</span> EjsUri *ejsCreateFullUri(Ejs *ejs, cchar *scheme, cchar *host, <span class="keywordtype">int</span> port, cchar *path, cchar *query, cchar *reference);
<a name="l02702"></a>02702 
<a name="l02703"></a>02703 <span class="preprocessor">#if DOXYGEN</span>
<a name="l02704"></a>02704 <span class="preprocessor"></span><span class="comment">    /** </span>
<a name="l02705"></a>02705 <span class="comment">        Determine if a variable is a Uri</span>
<a name="l02706"></a>02706 <span class="comment">        @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02707"></a>02707 <span class="comment">        @param vp Variable to test</span>
<a name="l02708"></a>02708 <span class="comment">        @return True if the variable is a Uri</span>
<a name="l02709"></a>02709 <span class="comment">        @ingroup EjsUri</span>
<a name="l02710"></a>02710 <span class="comment">     */</span>
<a name="l02711"></a>02711     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_uri.html#ga0c37d3ccb1815c72c703e2038a0d90d" title="Determine if a variable is a Uri.">ejsIsUri</a>(Ejs *ejs, EjsObj *vp);
<a name="l02712"></a>02712 <span class="preprocessor">#else</span>
<a name="l02713"></a>02713 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsUri(ejs, vp) (vp &amp;&amp; ((EjsObj*) vp)-&gt;type == ejs-&gt;uriType)</span>
<a name="l02714"></a>02714 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02715"></a>02715 <span class="preprocessor"></span>
<a name="l02716"></a>02716 <span class="comment"></span>
<a name="l02717"></a>02717 <span class="comment">/** </span>
<a name="l02718"></a>02718 <span class="comment">    FileSystem class</span>
<a name="l02719"></a>02719 <span class="comment">    @description The FileSystem class provides file system services.</span>
<a name="l02720"></a>02720 <span class="comment">    @stability Prototype</span>
<a name="l02721"></a>02721 <span class="comment">    @defgroup EjsFileSystem EjsFileSystem </span>
<a name="l02722"></a>02722 <span class="comment">    @see EjsFile ejsCreateFile ejsIsFile</span>
<a name="l02723"></a>02723 <span class="comment"> */</span>
<a name="l02724"></a>02724 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsFileSystem {
<a name="l02725"></a>02725     EjsObj          obj;                <span class="comment">/**&lt; Extends Object */</span>
<a name="l02726"></a>02726     <span class="keywordtype">char</span>            *path;              <span class="comment">/**&lt; Filename path */</span>
<a name="l02727"></a>02727     MprFileSystem   *fs;                <span class="comment">/**&lt; MPR file system object */</span>
<a name="l02728"></a>02728 } EjsFileSystem;
<a name="l02729"></a>02729 
<a name="l02730"></a>02730 <span class="comment"></span>
<a name="l02731"></a>02731 <span class="comment">/** </span>
<a name="l02732"></a>02732 <span class="comment">    Create a FileSystem object</span>
<a name="l02733"></a>02733 <span class="comment">    @description Create a file system object associated with the given pathname.</span>
<a name="l02734"></a>02734 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02735"></a>02735 <span class="comment">    @param path Path to describe the file system. Can be any path in the file system.</span>
<a name="l02736"></a>02736 <span class="comment">    @return A new file system object</span>
<a name="l02737"></a>02737 <span class="comment">    @ingroup EjsPath</span>
<a name="l02738"></a>02738 <span class="comment"> */</span>
<a name="l02739"></a>02739 <span class="keyword">extern</span> EjsFileSystem *<a class="code" href="group___ejs_path.html#g50234ab8d65dd433fea18ff170f62f15" title="Create a FileSystem object.">ejsCreateFileSystem</a>(Ejs *ejs, cchar *path);
<a name="l02740"></a>02740 
<a name="l02741"></a>02741 <span class="preprocessor">#if DOXYGEN</span>
<a name="l02742"></a>02742 <span class="preprocessor"></span><span class="comment">    /**</span>
<a name="l02743"></a>02743 <span class="comment">        Determine if a variable is a Path</span>
<a name="l02744"></a>02744 <span class="comment">        @param vp Variable to test</span>
<a name="l02745"></a>02745 <span class="comment">        @return True if the variable is a FileSystem</span>
<a name="l02746"></a>02746 <span class="comment">        @ingroup EjsFileSystem</span>
<a name="l02747"></a>02747 <span class="comment">     */</span>
<a name="l02748"></a>02748     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_file_system.html#gc98cb8ddcfec2dfa858cabfda4a76fb3" title="Determine if a variable is a Path.">ejsIsFileSystem</a>(EjsObj *vp);
<a name="l02749"></a>02749 <span class="preprocessor">#else</span>
<a name="l02750"></a>02750 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsFileSystem(vp) ejsIs(vp, ES_ejs_io_FileSystem)</span>
<a name="l02751"></a>02751 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02752"></a>02752 <span class="preprocessor"></span>
<a name="l02753"></a>02753 <span class="comment"></span>
<a name="l02754"></a>02754 <span class="comment">/** </span>
<a name="l02755"></a>02755 <span class="comment">    EjsGlobal cass</span>
<a name="l02756"></a>02756 <span class="comment">    @description The Global class is the base class for the global object. The global object is the top level</span>
<a name="l02757"></a>02757 <span class="comment">        scoping object.</span>
<a name="l02758"></a>02758 <span class="comment">    @stability Stable</span>
<a name="l02759"></a>02759 <span class="comment">    @defgroup EjsGlobal EjsGlobal</span>
<a name="l02760"></a>02760 <span class="comment"> */</span>
<a name="l02761"></a>02761 <span class="keyword">typedef</span> EjsObj EjsGlobal;
<a name="l02762"></a>02762 
<a name="l02763"></a>02763 <span class="keyword">extern</span> EjsObj *ejsCreateGlobal(Ejs *ejs);
<a name="l02764"></a>02764 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsFreezeGlobal(Ejs *ejs);
<a name="l02765"></a>02765 
<a name="l02766"></a>02766 <span class="comment"></span>
<a name="l02767"></a>02767 <span class="comment">/** </span>
<a name="l02768"></a>02768 <span class="comment">    Http Class</span>
<a name="l02769"></a>02769 <span class="comment">    @description</span>
<a name="l02770"></a>02770 <span class="comment">        Http objects represents a Hypertext Transfer Protocol version 1.1 client connection and are used </span>
<a name="l02771"></a>02771 <span class="comment">        HTTP requests and capture responses. This class supports the HTTP/1.1 standard including methods for GET, POST, </span>
<a name="l02772"></a>02772 <span class="comment">        PUT, DELETE, OPTIONS, and TRACE. It also supports Keep-Alive and SSL connections. </span>
<a name="l02773"></a>02773 <span class="comment">    @stability Prototype</span>
<a name="l02774"></a>02774 <span class="comment">    @defgroup EjsHttp EjsHttp</span>
<a name="l02775"></a>02775 <span class="comment">    @see EjsHttp ejsCreateHttp ejsIsHttp</span>
<a name="l02776"></a>02776 <span class="comment"> */</span>
<a name="l02777"></a>02777 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsHttp {
<a name="l02778"></a>02778     EjsObj          obj;                        <span class="comment">/**&lt; Extends Object (not used) */</span>
<a name="l02779"></a>02779     Ejs             *ejs;                       <span class="comment">/**&lt; Convenience access to ejs interpreter instance */</span>
<a name="l02780"></a>02780     EjsObj          *emitter;                   <span class="comment">/**&lt; Event emitter */</span>
<a name="l02781"></a>02781     EjsByteArray    *data;                      <span class="comment">/**&lt; Buffered write data */</span>
<a name="l02782"></a>02782     EjsObj          *limits;                    <span class="comment">/**&lt; Limits object */</span>
<a name="l02783"></a>02783     EjsObj          *responseCache;             <span class="comment">/**&lt; Cached response (only used if response() is used) */</span>
<a name="l02784"></a>02784     HttpConn        *conn;                      <span class="comment">/**&lt; Http connection object */</span>
<a name="l02785"></a>02785     MprBuf          *requestContent;            <span class="comment">/**&lt; Request body data supplied */</span>
<a name="l02786"></a>02786     MprBuf          *responseContent;           <span class="comment">/**&lt; Response data */</span>
<a name="l02787"></a>02787     <span class="keywordtype">char</span>            *uri;                       <span class="comment">/**&lt; Target uri */</span>
<a name="l02788"></a>02788     <span class="keywordtype">char</span>            *method;                    <span class="comment">/**&lt; HTTP method */</span>
<a name="l02789"></a>02789     <span class="keywordtype">char</span>            *keyFile;                   <span class="comment">/**&lt; SSL key file */</span>
<a name="l02790"></a>02790     <span class="keywordtype">char</span>            *certFile;                  <span class="comment">/**&lt; SSL certificate file */</span>
<a name="l02791"></a>02791     <span class="keywordtype">int</span>             dontFinalize;               <span class="comment">/**&lt; Suppress finalization */</span>
<a name="l02792"></a>02792     <span class="keywordtype">int</span>             readCount;                  <span class="comment">/**&lt; Count of body bytes read */</span>
<a name="l02793"></a>02793     <span class="keywordtype">int</span>             requestContentCount;        <span class="comment">/**&lt; Count of bytes written from requestContent */</span>
<a name="l02794"></a>02794     <span class="keywordtype">int</span>             writeCount;                 <span class="comment">/**&lt; Count of bytes written via write() */</span>
<a name="l02795"></a>02795 } EjsHttp;
<a name="l02796"></a>02796 
<a name="l02797"></a>02797 <span class="comment"></span>
<a name="l02798"></a>02798 <span class="comment">/** </span>
<a name="l02799"></a>02799 <span class="comment">    Create a new Http object</span>
<a name="l02800"></a>02800 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02801"></a>02801 <span class="comment">    @return a new Http object</span>
<a name="l02802"></a>02802 <span class="comment">    @ingroup EjsHttp</span>
<a name="l02803"></a>02803 <span class="comment"> */</span>
<a name="l02804"></a>02804 <span class="keyword">extern</span> EjsHttp *<a class="code" href="group___ejs_http.html#g35375f154c987c2f3838c2e58a76ca3c" title="Create a new Http object.">ejsCreateHttp</a>(Ejs *ejs);
<a name="l02805"></a>02805 
<a name="l02806"></a>02806 <span class="preprocessor">#if DOXYGEN</span>
<a name="l02807"></a>02807 <span class="preprocessor"></span>    <span class="keyword">extern</span> <span class="keywordtype">bool</span> ejsIsHttp(EjsObj *vp);
<a name="l02808"></a>02808 <span class="preprocessor">#else</span>
<a name="l02809"></a>02809 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsHttp(vp) ejsIs(vp, ES_ejs_io_Http)</span>
<a name="l02810"></a>02810 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02811"></a>02811 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">void</span> ejsSetHttpLimits(Ejs *ejs, HttpLimits *limits, EjsObj *obj, <span class="keywordtype">int</span> server);
<a name="l02812"></a>02812 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsGetHttpLimits(Ejs *ejs, EjsObj *obj, HttpLimits *limits, <span class="keywordtype">int</span> server);
<a name="l02813"></a>02813 
<a name="l02814"></a>02814 <span class="comment"></span>
<a name="l02815"></a>02815 <span class="comment">/** </span>
<a name="l02816"></a>02816 <span class="comment">    Iterator Class</span>
<a name="l02817"></a>02817 <span class="comment">    @description Iterator is a helper class to implement iterators in other native classes</span>
<a name="l02818"></a>02818 <span class="comment">    @stability Prototype</span>
<a name="l02819"></a>02819 <span class="comment">    @defgroup EjsIterator EjsIterator</span>
<a name="l02820"></a>02820 <span class="comment">    @see EjsIterator ejsCreateIterator</span>
<a name="l02821"></a>02821 <span class="comment"> */</span>
<a name="l02822"></a>02822 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsIterator {
<a name="l02823"></a>02823     EjsObj              var;                <span class="comment">/**&lt; Extends Object - Property storage (not used) */</span>
<a name="l02824"></a>02824     EjsObj              *target;            <span class="comment">/**&lt; Object to be enumerated */</span>
<a name="l02825"></a>02825     EjsProc             nativeNext;         <span class="comment">/**&lt; Native next function */</span>
<a name="l02826"></a>02826     <span class="keywordtype">bool</span>                deep;               <span class="comment">/**&lt; Iterator deep (recursively over all properties) */</span>
<a name="l02827"></a>02827     EjsArray            *namespaces;        <span class="comment">/**&lt; Namespaces to consider in iteration */</span>
<a name="l02828"></a>02828     <span class="keywordtype">int</span>                 index;              <span class="comment">/**&lt; Current index */</span>
<a name="l02829"></a>02829     EjsObj              *indexVar;          <span class="comment">/**&lt; Reference to current item */</span>
<a name="l02830"></a>02830 } EjsIterator;
<a name="l02831"></a>02831 <span class="comment"></span>
<a name="l02832"></a>02832 <span class="comment">/** </span>
<a name="l02833"></a>02833 <span class="comment">    Create an iterator object</span>
<a name="l02834"></a>02834 <span class="comment">    @description The EjsIterator object is a helper class for native types to implement iteration and enumeration.</span>
<a name="l02835"></a>02835 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02836"></a>02836 <span class="comment">    @param target Target variable to iterate or enumerate </span>
<a name="l02837"></a>02837 <span class="comment">    @param next Function to invoke to step to the next element</span>
<a name="l02838"></a>02838 <span class="comment">    @param deep Set to true to do a deep iteration/enumeration</span>
<a name="l02839"></a>02839 <span class="comment">    @param namespaces Reserved and not used. Supply NULL.</span>
<a name="l02840"></a>02840 <span class="comment">    @return A new EjsIterator object</span>
<a name="l02841"></a>02841 <span class="comment">    @ingroup EjsIterator</span>
<a name="l02842"></a>02842 <span class="comment"> */</span>
<a name="l02843"></a>02843 <span class="keyword">extern</span> EjsIterator *<a class="code" href="group___ejs_iterator.html#g623995732e7f632be558d7d7b8c88841" title="Create an iterator object.">ejsCreateIterator</a>(Ejs *ejs, EjsObj *target, EjsProc next, <span class="keywordtype">bool</span> deep, EjsArray *namespaces);
<a name="l02844"></a>02844 <span class="comment"></span>
<a name="l02845"></a>02845 <span class="comment">/** </span>
<a name="l02846"></a>02846 <span class="comment">    Namespace Class</span>
<a name="l02847"></a>02847 <span class="comment">    @description Namespaces are used to qualify names into discrete spaces.</span>
<a name="l02848"></a>02848 <span class="comment">    @stability Evolving</span>
<a name="l02849"></a>02849 <span class="comment">    @defgroup EjsNamespace EjsNamespace</span>
<a name="l02850"></a>02850 <span class="comment">    @see EjsNamespace ejsIsNamespace ejsCreateNamespace ejsLookupNamespace ejsDefineReservedNamespace </span>
<a name="l02851"></a>02851 <span class="comment">        ejsCreateReservedNamespace ejsFormatReservedNamespace </span>
<a name="l02852"></a>02852 <span class="comment"> */</span>
<a name="l02853"></a>02853 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsNamespace {
<a name="l02854"></a>02854     EjsObj      obj;                <span class="comment">/**&lt; Extends Object - Property storage */</span>
<a name="l02855"></a>02855     <span class="keywordtype">char</span>        *name;              <span class="comment">/**&lt; Textual name of the namespace */</span>
<a name="l02856"></a>02856 <span class="preprocessor">#if TODO || 1 </span><span class="comment">/* REMOVE */</span>
<a name="l02857"></a>02857     <span class="keywordtype">char</span>        *uri;               <span class="comment">/**&lt; Optional uri definition */</span>
<a name="l02858"></a>02858     <span class="keywordtype">int</span>         flags;              <span class="comment">/**&lt; Fast comparison flags */</span>
<a name="l02859"></a>02859 <span class="preprocessor">#endif</span>
<a name="l02860"></a>02860 <span class="preprocessor"></span>} EjsNamespace;
<a name="l02861"></a>02861 
<a name="l02862"></a>02862 <span class="comment"></span>
<a name="l02863"></a>02863 <span class="comment">/** </span>
<a name="l02864"></a>02864 <span class="comment">    Create a namespace object</span>
<a name="l02865"></a>02865 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02866"></a>02866 <span class="comment">    @param name Space name to use for the namespace</span>
<a name="l02867"></a>02867 <span class="comment">    @param uri URI to associate with the namespace</span>
<a name="l02868"></a>02868 <span class="comment">    @return A new namespace object</span>
<a name="l02869"></a>02869 <span class="comment">    @ingroup EjsNamespace</span>
<a name="l02870"></a>02870 <span class="comment"> */</span>
<a name="l02871"></a>02871 <span class="keyword">extern</span> EjsNamespace *<a class="code" href="group___ejs_namespace.html#g431d32cf25ca780421483ab457062b81" title="Create a namespace object.">ejsCreateNamespace</a>(Ejs *ejs, cchar *name, cchar *uri);
<a name="l02872"></a>02872 
<a name="l02873"></a>02873 <span class="preprocessor">#if DOXYGEN</span>
<a name="l02874"></a>02874 <span class="preprocessor"></span><span class="comment">    /**</span>
<a name="l02875"></a>02875 <span class="comment">        Determine if a variable is a namespace</span>
<a name="l02876"></a>02876 <span class="comment">        @return True if the variable is a namespace</span>
<a name="l02877"></a>02877 <span class="comment">        @ingroup EjsNamespace</span>
<a name="l02878"></a>02878 <span class="comment">     */</span>
<a name="l02879"></a>02879     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_namespace.html#g50dc0c3d60b577aed11b1da9e3864b8a" title="Determine if a variable is a namespace.">ejsIsNamespace</a>(EjsObj *vp)
<a name="l02880"></a>02880 <span class="preprocessor">#else</span>
<a name="l02881"></a>02881 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsNamespace(vp) ejsIs(vp, ES_Namespace)</span>
<a name="l02882"></a>02882 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02883"></a>02883 <span class="preprocessor"></span>
<a name="l02884"></a>02884 <span class="keyword">extern</span> EjsNamespace *ejsDefineReservedNamespace(Ejs *ejs, EjsBlock *block, EjsName *typeName, cchar *name);
<a name="l02885"></a>02885 <span class="keyword">extern</span> EjsNamespace *ejsCreateReservedNamespace(Ejs *ejs, EjsName *typeName, cchar *name);
<a name="l02886"></a>02886 <span class="keyword">extern</span> <span class="keywordtype">char</span> *ejsFormatReservedNamespace(MprCtx ctx, EjsName *typeName, cchar *spaceName);
<a name="l02887"></a>02887 <span class="comment"></span>
<a name="l02888"></a>02888 <span class="comment">/** </span>
<a name="l02889"></a>02889 <span class="comment">    Null Class</span>
<a name="l02890"></a>02890 <span class="comment">    @description The Null class provides the base class for the singleton null instance. This instance is stored</span>
<a name="l02891"></a>02891 <span class="comment">        in ejs-&gt;nullValue.</span>
<a name="l02892"></a>02892 <span class="comment">    @stability Evolving</span>
<a name="l02893"></a>02893 <span class="comment">    @defgroup EjsNull EjsNull</span>
<a name="l02894"></a>02894 <span class="comment">    @see EjsNull ejsCreateIsNull</span>
<a name="l02895"></a>02895 <span class="comment"> */</span>
<a name="l02896"></a>02896 <span class="keyword">typedef</span> EjsObj EjsNull;
<a name="l02897"></a>02897 <span class="comment"></span>
<a name="l02898"></a>02898 <span class="comment">/** </span>
<a name="l02899"></a>02899 <span class="comment">    Determine if a variable is a null</span>
<a name="l02900"></a>02900 <span class="comment">    @return True if a variable is a null</span>
<a name="l02901"></a>02901 <span class="comment">    @ingroup EjsNull</span>
<a name="l02902"></a>02902 <span class="comment"> */</span>
<a name="l02903"></a><a class="code" href="group___ejs_null.html#g41b7ac7cd23790f96b26463b383b61d7">02903</a> <span class="preprocessor">#define ejsIsNull(vp) ejsIs(vp, ES_Null)</span>
<a name="l02904"></a>02904 <span class="preprocessor"></span>
<a name="l02905"></a>02905 <span class="keyword">extern</span> EjsNull *ejsCreateNull(Ejs *ejs);
<a name="l02906"></a>02906 <span class="comment"></span>
<a name="l02907"></a>02907 <span class="comment">/** </span>
<a name="l02908"></a>02908 <span class="comment">    Number class</span>
<a name="l02909"></a>02909 <span class="comment">    @description The Number class provide the base class for all numeric values. </span>
<a name="l02910"></a>02910 <span class="comment">        The primitive number storage data type may be set via the configure program to be either double, float, int</span>
<a name="l02911"></a>02911 <span class="comment">        or int64. </span>
<a name="l02912"></a>02912 <span class="comment">    @stability Evolving</span>
<a name="l02913"></a>02913 <span class="comment">    @defgroup EjsNumber EjsNumber</span>
<a name="l02914"></a>02914 <span class="comment">    @see EjsNumber ejsToNumber ejsCreateNumber ejsIsNumber ejsGetNumber ejsGetInt ejsGetDouble ejsIsInfinite ejsIsNan</span>
<a name="l02915"></a>02915 <span class="comment"> */</span>
<a name="l02916"></a>02916 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsNumber {
<a name="l02917"></a>02917     EjsObj      obj;                <span class="comment">/**&lt; Extends Object - Property storage */</span>
<a name="l02918"></a>02918     MprNumber   value;              <span class="comment">/**&lt; Numeric value */</span>
<a name="l02919"></a>02919 } EjsNumber;
<a name="l02920"></a>02920 
<a name="l02921"></a>02921 <span class="comment"></span>
<a name="l02922"></a>02922 <span class="comment">/** </span>
<a name="l02923"></a>02923 <span class="comment">    Create a number object</span>
<a name="l02924"></a>02924 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02925"></a>02925 <span class="comment">    @param value Numeric value to initialize the number object</span>
<a name="l02926"></a>02926 <span class="comment">    @return A number object</span>
<a name="l02927"></a>02927 <span class="comment">    @ingroup EjsNumber</span>
<a name="l02928"></a>02928 <span class="comment"> */</span>
<a name="l02929"></a>02929 <span class="keyword">extern</span> EjsNumber *<a class="code" href="group___ejs_number.html#gbbc997d13a55ae22b87abb9d3b1df9ec" title="Create a number object.">ejsCreateNumber</a>(Ejs *ejs, MprNumber value);
<a name="l02930"></a>02930 <span class="comment"></span>
<a name="l02931"></a>02931 <span class="comment">/** </span>
<a name="l02932"></a>02932 <span class="comment">    Cast a variable to a number</span>
<a name="l02933"></a>02933 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02934"></a>02934 <span class="comment">    @param vp Variable to cast</span>
<a name="l02935"></a>02935 <span class="comment">    @return A number object</span>
<a name="l02936"></a>02936 <span class="comment">    @ingroup EjsNumber</span>
<a name="l02937"></a>02937 <span class="comment"> */</span>
<a name="l02938"></a>02938 <span class="keyword">extern</span> <span class="keyword">struct </span>EjsNumber *<a class="code" href="group___ejs_number.html#ge58a7214afe9bc9b439197ce04511214" title="Cast a variable to a number.">ejsToNumber</a>(Ejs *ejs, EjsObj *vp);
<a name="l02939"></a>02939 
<a name="l02940"></a>02940 <span class="keyword">extern</span> <span class="keywordtype">bool</span> ejsIsInfinite(MprNumber f);
<a name="l02941"></a>02941 <span class="preprocessor">#if WIN</span>
<a name="l02942"></a>02942 <span class="preprocessor"></span><span class="preprocessor">#define ejsIsNan(f) (_isnan(f))</span>
<a name="l02943"></a>02943 <span class="preprocessor"></span><span class="preprocessor">#elif MACOSX</span>
<a name="l02944"></a>02944 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsNan(f) isnan(f)</span>
<a name="l02945"></a>02945 <span class="preprocessor"></span><span class="preprocessor">#elif VXWORKS</span>
<a name="l02946"></a>02946 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsNan(f) isnan(f)</span>
<a name="l02947"></a>02947 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l02948"></a>02948 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsNan(f) (f == FP_NAN)</span>
<a name="l02949"></a>02949 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02950"></a>02950 <span class="preprocessor"></span><span class="comment"></span>
<a name="l02951"></a>02951 <span class="comment">/** </span>
<a name="l02952"></a>02952 <span class="comment">    Reflect Class</span>
<a name="l02953"></a>02953 <span class="comment">    @description The Reflect class permits introspection into the type and attributes of objects and properties.</span>
<a name="l02954"></a>02954 <span class="comment">    @stability Evolving</span>
<a name="l02955"></a>02955 <span class="comment">    @defgroup EjsNamespace EjsNamespace</span>
<a name="l02956"></a>02956 <span class="comment">    @see EjsReflect</span>
<a name="l02957"></a>02957 <span class="comment"> */</span>
<a name="l02958"></a>02958 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsReflect {
<a name="l02959"></a>02959     EjsObj      obj;                <span class="comment">/**&lt; Extends Object - Property storage (unused) */</span>
<a name="l02960"></a>02960     EjsObj      *subject;           <span class="comment">/**&lt; Object under examination */</span>
<a name="l02961"></a>02961 } EjsReflect;
<a name="l02962"></a>02962 
<a name="l02963"></a>02963 
<a name="l02964"></a>02964 <span class="keyword">extern</span> EjsObj *ejsGetTypeName(Ejs *ejs, EjsObj *vp);
<a name="l02965"></a>02965 <span class="keyword">extern</span> EjsObj *ejsGetTypeOf(Ejs *ejs, EjsObj *vp);
<a name="l02966"></a>02966 <span class="comment"></span>
<a name="l02967"></a>02967 <span class="comment">/** </span>
<a name="l02968"></a>02968 <span class="comment">    RegExp Class</span>
<a name="l02969"></a>02969 <span class="comment">    @description The regular expression class provides string pattern matching and substitution.</span>
<a name="l02970"></a>02970 <span class="comment">    @stability Evolving</span>
<a name="l02971"></a>02971 <span class="comment">    @defgroup EjsRegExp EjsRegExp</span>
<a name="l02972"></a>02972 <span class="comment">    @see EjsRegExp ejsCreateRegExp ejsIsRegExp</span>
<a name="l02973"></a>02973 <span class="comment"> */</span>
<a name="l02974"></a>02974 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsRegExp {
<a name="l02975"></a>02975     EjsObj          var;                <span class="comment">/**&lt; Extends Object - Property storage */</span>
<a name="l02976"></a>02976     <span class="keywordtype">char</span>            *pattern;           <span class="comment">/**&lt; Pattern to match with */</span>
<a name="l02977"></a>02977     <span class="keywordtype">void</span>            *compiled;          <span class="comment">/**&lt; Compiled pattern */</span>
<a name="l02978"></a>02978     <span class="keywordtype">bool</span>            global;             <span class="comment">/**&lt; Search for pattern globally (multiple times) */</span>
<a name="l02979"></a>02979     <span class="keywordtype">bool</span>            ignoreCase;         <span class="comment">/**&lt; Do case insensitive matching */</span>
<a name="l02980"></a>02980     <span class="keywordtype">bool</span>            multiline;          <span class="comment">/**&lt; Match patterns over multiple lines */</span>
<a name="l02981"></a>02981     <span class="keywordtype">bool</span>            sticky;
<a name="l02982"></a>02982     <span class="keywordtype">int</span>             options;            <span class="comment">/**&lt; Pattern matching options */</span>
<a name="l02983"></a>02983     <span class="keywordtype">int</span>             endLastMatch;       <span class="comment">/**&lt; End of the last match (one past end) */</span>
<a name="l02984"></a>02984     <span class="keywordtype">int</span>             startLastMatch;     <span class="comment">/**&lt; Start of the last match */</span>
<a name="l02985"></a>02985     <span class="keyword">struct </span>EjsString *matched;          <span class="comment">/**&lt; Last matched component */</span>
<a name="l02986"></a>02986 } EjsRegExp;
<a name="l02987"></a>02987 
<a name="l02988"></a>02988 <span class="comment"></span>
<a name="l02989"></a>02989 <span class="comment">/** </span>
<a name="l02990"></a>02990 <span class="comment">    Create a new regular expression object</span>
<a name="l02991"></a>02991 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l02992"></a>02992 <span class="comment">    @param pattern Regular expression pattern string</span>
<a name="l02993"></a>02993 <span class="comment">    @return a EjsRegExp object</span>
<a name="l02994"></a>02994 <span class="comment">    @ingroup EjsRegExp</span>
<a name="l02995"></a>02995 <span class="comment"> */</span>
<a name="l02996"></a>02996 <span class="keyword">extern</span> EjsRegExp *<a class="code" href="group___ejs_reg_exp.html#g6900b595ab2e5b7a7feac913f79ccb36" title="Create a new regular expression object.">ejsCreateRegExp</a>(Ejs *ejs, cchar *pattern);
<a name="l02997"></a>02997 
<a name="l02998"></a>02998 <span class="keyword">struct </span>EjsString *ejsRegExpToString(Ejs *ejs, EjsRegExp *rp);
<a name="l02999"></a>02999 
<a name="l03000"></a>03000 <span class="preprocessor">#if DOXYGEN</span>
<a name="l03001"></a>03001 <span class="preprocessor"></span><span class="comment">    /** </span>
<a name="l03002"></a>03002 <span class="comment">        Determine if the variable is a regular expression</span>
<a name="l03003"></a>03003 <span class="comment">        @return True if the variable is a regular expression</span>
<a name="l03004"></a>03004 <span class="comment">        @ingroup EjsRegExp</span>
<a name="l03005"></a>03005 <span class="comment">     */</span>
<a name="l03006"></a>03006     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_reg_exp.html#ge100e3eccec81351fbae11e58839b3b8" title="Determine if the variable is a regular expression.">ejsIsRegExp</a>(EjsObj *vp);
<a name="l03007"></a>03007 <span class="preprocessor">#else</span>
<a name="l03008"></a>03008 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsRegExp(vp) ejsIs(vp, ES_RegExp)</span>
<a name="l03009"></a>03009 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l03010"></a>03010 <span class="preprocessor"></span><span class="comment"></span>
<a name="l03011"></a>03011 <span class="comment">/**</span>
<a name="l03012"></a>03012 <span class="comment">    Socket Class</span>
<a name="l03013"></a>03013 <span class="comment">    @description</span>
<a name="l03014"></a>03014 <span class="comment">    @stability Prototype</span>
<a name="l03015"></a>03015 <span class="comment">    @defgroup EjsSocket EjsSocket</span>
<a name="l03016"></a>03016 <span class="comment">    @see EjsSocket ejsCreateSocket ejsIsSocket</span>
<a name="l03017"></a>03017 <span class="comment"> */</span>
<a name="l03018"></a>03018 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsSocket {
<a name="l03019"></a>03019     EjsObj          obj;                        <span class="comment">/**&lt; Extends Object */</span>
<a name="l03020"></a>03020     EjsObj          *emitter;                   <span class="comment">/**&lt; Event emitter */</span>
<a name="l03021"></a>03021     EjsByteArray    *data;                      <span class="comment">/**&lt; Buffered write data */</span>
<a name="l03022"></a>03022     MprSocket       *sock;                      <span class="comment">/**&lt; Underlying MPR socket object */</span>
<a name="l03023"></a>03023     MprWaitHandler  waitHandler;                <span class="comment">/**&lt; I/O event wait handler */</span>
<a name="l03024"></a>03024     Ejs             *ejs;                       <span class="comment">/**&lt; Convenience access to ejs interpreter instance */</span>
<a name="l03025"></a>03025     <span class="keywordtype">char</span>            *address;                   <span class="comment">/**&lt; Remote address */</span>
<a name="l03026"></a>03026     <span class="keywordtype">int</span>             port;                       <span class="comment">/**&lt; Remote port */</span>
<a name="l03027"></a>03027     <span class="keywordtype">int</span>             async;                      <span class="comment">/**&lt; In async mode */</span>
<a name="l03028"></a>03028     <span class="keywordtype">int</span>             mask;                       <span class="comment">/**&lt; IO event mask */</span>
<a name="l03029"></a>03029     MprMutex        *mutex;                     <span class="comment">/**&lt; Multithread sync */</span>
<a name="l03030"></a>03030 } EjsSocket;
<a name="l03031"></a>03031 <span class="comment"></span>
<a name="l03032"></a>03032 <span class="comment">/** </span>
<a name="l03033"></a>03033 <span class="comment">    Create a new Socket object</span>
<a name="l03034"></a>03034 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l03035"></a>03035 <span class="comment">    @return a new Socket object</span>
<a name="l03036"></a>03036 <span class="comment">    @ingroup EjsSocket</span>
<a name="l03037"></a>03037 <span class="comment"> */</span>
<a name="l03038"></a>03038 <span class="keyword">extern</span> EjsSocket *<a class="code" href="group___ejs_socket.html#g4e359dc0db9f78ff9cc2969f12102370" title="Create a new Socket object.">ejsCreateSocket</a>(Ejs *ejs);
<a name="l03039"></a>03039 
<a name="l03040"></a>03040 <span class="preprocessor">#if DOXYGEN</span>
<a name="l03041"></a>03041 <span class="preprocessor"></span>    <span class="keyword">extern</span> <span class="keywordtype">bool</span> ejsIsSocket(EjsObj *vp);
<a name="l03042"></a>03042 <span class="preprocessor">#else</span>
<a name="l03043"></a>03043 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsSocket(vp) ejsIs(vp, ES_ejs_io_Socket)</span>
<a name="l03044"></a>03044 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l03045"></a>03045 <span class="preprocessor"></span><span class="comment"></span>
<a name="l03046"></a>03046 <span class="comment">/** </span>
<a name="l03047"></a>03047 <span class="comment">    String Class</span>
<a name="l03048"></a>03048 <span class="comment">    @description The String class provides the base class for all strings. Each String object represents a single </span>
<a name="l03049"></a>03049 <span class="comment">    immutable linear sequence of characters. Strings have operators for: comparison, concatenation, copying, </span>
<a name="l03050"></a>03050 <span class="comment">    searching, conversion, matching, replacement, and, subsetting.</span>
<a name="l03051"></a>03051 <span class="comment">    \n\n</span>
<a name="l03052"></a>03052 <span class="comment">    Strings are currently sequences of UTF-8 characters. They will soon be upgraded to UTF-16.</span>
<a name="l03053"></a>03053 <span class="comment">    @stability Evolving</span>
<a name="l03054"></a>03054 <span class="comment">    @defgroup EjsString EjsString</span>
<a name="l03055"></a>03055 <span class="comment">    @see EjsString ejsToString ejsCreateString ejsCreateBareString ejsCreateStringWithLength ejsDupString</span>
<a name="l03056"></a>03056 <span class="comment">        ejsVarToString ejsStrdup ejsStrcat ejsIsString ejsGetString ejsToJson</span>
<a name="l03057"></a>03057 <span class="comment"> */</span>
<a name="l03058"></a>03058 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsString {
<a name="l03059"></a>03059     EjsObj      obj;                <span class="comment">/**&lt; Extends Object - Property storage */</span>
<a name="l03060"></a>03060     <span class="keywordtype">int</span>         length;             <span class="comment">/**&lt; String length (sans null) */</span>
<a name="l03061"></a>03061     <span class="keywordtype">char</span>        *value;             <span class="comment">/**&lt; String value. Currently UTF-8. Will upgrade to UTF-16 soon */</span>
<a name="l03062"></a>03062 } EjsString;
<a name="l03063"></a>03063 
<a name="l03064"></a>03064 <span class="comment"></span>
<a name="l03065"></a>03065 <span class="comment">/** </span>
<a name="l03066"></a>03066 <span class="comment">    Cast a variable to a string</span>
<a name="l03067"></a>03067 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l03068"></a>03068 <span class="comment">    @param obj Object to convert</span>
<a name="l03069"></a>03069 <span class="comment">    @return A string object</span>
<a name="l03070"></a>03070 <span class="comment">    @ingroup EjsObj</span>
<a name="l03071"></a>03071 <span class="comment"> */</span>
<a name="l03072"></a>03072 <span class="keyword">extern</span> EjsString *<a class="code" href="group___ejs_obj.html#g3bf38c71fac27819c73611bcf78ca2dd" title="Cast a variable to a string.">ejsToString</a>(Ejs *ejs, EjsObj *obj);
<a name="l03073"></a>03073 <span class="comment"></span>
<a name="l03074"></a>03074 <span class="comment">/**</span>
<a name="l03075"></a>03075 <span class="comment">    Convert a variable to a string in JSON format</span>
<a name="l03076"></a>03076 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l03077"></a>03077 <span class="comment">    @param obj Object to cast</span>
<a name="l03078"></a>03078 <span class="comment">    @param options Options object. See serialize for details.</span>
<a name="l03079"></a>03079 <span class="comment">    @return A string object</span>
<a name="l03080"></a>03080 <span class="comment">    @ingroup EjsObj</span>
<a name="l03081"></a>03081 <span class="comment"> */</span>
<a name="l03082"></a>03082 <span class="keyword">extern</span> EjsString *<a class="code" href="group___ejs_obj.html#gd6ac7066a19ea6e2cda258a5192e8329" title="Convert a variable to a string in JSON format.">ejsToJSON</a>(Ejs *ejs, EjsObj *obj, EjsObj *options);
<a name="l03083"></a>03083 <span class="comment"></span>
<a name="l03084"></a>03084 <span class="comment">/** </span>
<a name="l03085"></a>03085 <span class="comment">    Create a string object</span>
<a name="l03086"></a>03086 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l03087"></a>03087 <span class="comment">    @param value C string value to define for the string object. Note: this will soon be changed to unicode.</span>
<a name="l03088"></a>03088 <span class="comment">    @stability Prototype</span>
<a name="l03089"></a>03089 <span class="comment">    @return A string object</span>
<a name="l03090"></a>03090 <span class="comment">    @ingroup EjsString</span>
<a name="l03091"></a>03091 <span class="comment"> */</span>
<a name="l03092"></a>03092 <span class="keyword">extern</span> EjsString *<a class="code" href="group___ejs_string.html#g140c9b85c965bf99b43cefab10fc9c6a" title="Create a string object.">ejsCreateString</a>(Ejs *ejs, cchar *value);
<a name="l03093"></a>03093 <span class="comment"></span>
<a name="l03094"></a>03094 <span class="comment">/** </span>
<a name="l03095"></a>03095 <span class="comment">    Create a string object and free the argument</span>
<a name="l03096"></a>03096 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l03097"></a>03097 <span class="comment">    @param value C string value to define for the string object. Note: this will soon be changed to unicode.</span>
<a name="l03098"></a>03098 <span class="comment">    @stability Prototype</span>
<a name="l03099"></a>03099 <span class="comment">    @return A string object</span>
<a name="l03100"></a>03100 <span class="comment">    @ingroup EjsString</span>
<a name="l03101"></a>03101 <span class="comment"> */</span>
<a name="l03102"></a>03102 <span class="keyword">extern</span> EjsString *<a class="code" href="group___ejs_string.html#gee6c60b8ef53bd637a6d7b9c4312f103" title="Create a string object and free the argument.">ejsCreateStringAndFree</a>(Ejs *ejs, <span class="keywordtype">char</span> *value);
<a name="l03103"></a>03103 <span class="comment"></span>
<a name="l03104"></a>03104 <span class="comment">/** </span>
<a name="l03105"></a>03105 <span class="comment">    Create an empty string object</span>
<a name="l03106"></a>03106 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l03107"></a>03107 <span class="comment">    @param len Length of space to reserve for future string data</span>
<a name="l03108"></a>03108 <span class="comment">    @return A string object</span>
<a name="l03109"></a>03109 <span class="comment">    @ingroup EjsString</span>
<a name="l03110"></a>03110 <span class="comment"> */</span>
<a name="l03111"></a>03111 <span class="keyword">extern</span> EjsString *<a class="code" href="group___ejs_string.html#g611144db7d4c394839bbaf8187eec557" title="Create an empty string object.">ejsCreateBareString</a>(Ejs *ejs, <span class="keywordtype">int</span> len);
<a name="l03112"></a>03112 <span class="comment"></span>
<a name="l03113"></a>03113 <span class="comment">/** </span>
<a name="l03114"></a>03114 <span class="comment">    Create a string and reserve extra room.</span>
<a name="l03115"></a>03115 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l03116"></a>03116 <span class="comment">    @param value C string value to define for the string object. Note: this will soon be changed to unicode.</span>
<a name="l03117"></a>03117 <span class="comment">    @param len Length of the string storage to allocate.</span>
<a name="l03118"></a>03118 <span class="comment">    @return A string object</span>
<a name="l03119"></a>03119 <span class="comment">    @ingroup EjsString</span>
<a name="l03120"></a>03120 <span class="comment"> */</span>
<a name="l03121"></a>03121 <span class="keyword">extern</span> EjsString *<a class="code" href="group___ejs_string.html#g68b0413293779cdd7151b3743e93fe11" title="Create a string and reserve extra room.">ejsCreateStringWithLength</a>(Ejs *ejs, cchar *value, <span class="keywordtype">int</span> len);
<a name="l03122"></a>03122 
<a name="l03123"></a>03123 <span class="comment">//  TODO - why do we need this. Why not just use ejsCloneVar?</span><span class="comment"></span>
<a name="l03124"></a>03124 <span class="comment">/**</span>
<a name="l03125"></a>03125 <span class="comment">    Duplicate a string object</span>
<a name="l03126"></a>03126 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l03127"></a>03127 <span class="comment">    @param sp String value to copy</span>
<a name="l03128"></a>03128 <span class="comment">    @return A string object</span>
<a name="l03129"></a>03129 <span class="comment">    @ingroup EjsString</span>
<a name="l03130"></a>03130 <span class="comment"> */</span>
<a name="l03131"></a>03131 <span class="keyword">extern</span> EjsString *<a class="code" href="group___ejs_string.html#gc7d6dba8b2e401b79b01a3410e6794c2" title="Duplicate a string object.">ejsDupString</a>(Ejs *ejs, EjsString *sp);
<a name="l03132"></a>03132 
<a name="l03133"></a>03133 <span class="preprocessor">#if DOXYGEN</span>
<a name="l03134"></a>03134 <span class="preprocessor"></span>    <span class="keywordtype">bool</span> ejsIsString(EjsObj *vp);
<a name="l03135"></a>03135     <span class="keyword">extern</span> cchar *ejsGetString(Ejs *ejs, EjsObj *vp);
<a name="l03136"></a>03136 <span class="preprocessor">#else</span>
<a name="l03137"></a>03137 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsString(vp) ejsIs(vp, ES_String)</span>
<a name="l03138"></a>03138 <span class="preprocessor"></span><span class="preprocessor">    #define ejsGetString(ejs, vp) _ejsGetString(ejs, (EjsObj*) (vp))</span>
<a name="l03139"></a>03139 <span class="preprocessor"></span>    <span class="keyword">extern</span> cchar *_ejsGetString(Ejs *ejs, EjsObj *vp);
<a name="l03140"></a>03140 <span class="preprocessor">#endif</span>
<a name="l03141"></a>03141 <span class="preprocessor"></span>
<a name="l03142"></a>03142 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsStrdup(MprCtx ctx, uchar **dest, <span class="keyword">const</span> <span class="keywordtype">void</span> *src, <span class="keywordtype">int</span> nbytes);
<a name="l03143"></a>03143 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsStrcat(Ejs *ejs, EjsString *dest, EjsObj *src);
<a name="l03144"></a>03144 <span class="comment"></span>
<a name="l03145"></a>03145 <span class="comment">/** </span>
<a name="l03146"></a>03146 <span class="comment">    Timer Class</span>
<a name="l03147"></a>03147 <span class="comment">    @description Timers manage the scheduling and execution of Ejscript functions. Timers run repeatedly </span>
<a name="l03148"></a>03148 <span class="comment">        until stopped by calling the stop method and are scheduled with a granularity of 1 millisecond. </span>
<a name="l03149"></a>03149 <span class="comment">    @stability Evolving</span>
<a name="l03150"></a>03150 <span class="comment">    @defgroup EjsTimer EjsTimer</span>
<a name="l03151"></a>03151 <span class="comment">    @see EjsTimer</span>
<a name="l03152"></a>03152 <span class="comment"> */</span>
<a name="l03153"></a>03153 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsTimer {
<a name="l03154"></a>03154     EjsObj          obj;                            <span class="comment">/**&lt; Extends Object */</span>
<a name="l03155"></a>03155     Ejs             *ejs;                           <span class="comment">/**&lt; Need interpreter reference in callback */</span>
<a name="l03156"></a>03156     MprEvent        *event;                         <span class="comment">/**&lt; MPR event for the timer */</span>
<a name="l03157"></a>03157     <span class="keywordtype">int</span>             drift;                          <span class="comment">/**&lt; Timer event is allowed to drift if system conditions requrie */</span>
<a name="l03158"></a>03158     <span class="keywordtype">int</span>             repeat;                         <span class="comment">/**&lt; Timer repeatedly fires */</span>
<a name="l03159"></a>03159     <span class="keywordtype">int</span>             period;                         <span class="comment">/**&lt; Time in msec between invocations */</span>          
<a name="l03160"></a>03160     EjsFunction     *callback;                      <span class="comment">/**&lt; Callback function */</span>
<a name="l03161"></a>03161     EjsFunction     *onerror;                       <span class="comment">/**&lt; onerror function */</span>
<a name="l03162"></a>03162     EjsArray        *args;                          <span class="comment">/**&lt; Callback args */</span>
<a name="l03163"></a>03163 } EjsTimer;
<a name="l03164"></a>03164 
<a name="l03165"></a>03165 
<a name="l03166"></a>03166 <span class="preprocessor">#define EJS_WORKER_BEGIN        1                   </span><span class="comment">/**&lt; Worker yet to start */</span>
<a name="l03167"></a>03167 <span class="preprocessor">#define EJS_WORKER_STARTED      2                   </span><span class="comment">/**&lt; Worker has started a script */</span>
<a name="l03168"></a>03168 <span class="preprocessor">#define EJS_WORKER_CLOSED       3                   </span><span class="comment">/**&lt; Inside worker has finished */</span>
<a name="l03169"></a>03169 <span class="preprocessor">#define EJS_WORKER_COMPLETE     4                   </span><span class="comment">/**&lt; Worker has completed all messages */</span>
<a name="l03170"></a>03170 <span class="comment"></span>
<a name="l03171"></a>03171 <span class="comment">/** </span>
<a name="l03172"></a>03172 <span class="comment">    Worker Class</span>
<a name="l03173"></a>03173 <span class="comment">    @description The Worker class provides the ability to create new interpreters in dedicated threads</span>
<a name="l03174"></a>03174 <span class="comment">    @stability Prototype</span>
<a name="l03175"></a>03175 <span class="comment">    @defgroup EjsWorker EjsWorker</span>
<a name="l03176"></a>03176 <span class="comment">    @see EjsObj</span>
<a name="l03177"></a>03177 <span class="comment"> */</span>
<a name="l03178"></a>03178 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsWorker {
<a name="l03179"></a>03179     EjsObj          obj;                            <span class="comment">/**&lt; Logically extentends Object */</span>
<a name="l03180"></a>03180     <span class="keywordtype">char</span>            *name;                          <span class="comment">/**&lt; Optional worker name */</span>
<a name="l03181"></a>03181     Ejs             *ejs;                           <span class="comment">/**&lt; Interpreter */</span>
<a name="l03182"></a>03182     EjsObj          *event;                         <span class="comment">/**&lt; Current event object */</span>
<a name="l03183"></a>03183     <span class="keyword">struct </span>EjsWorker *pair;                         <span class="comment">/**&lt; Corresponding worker object in other thread */</span>
<a name="l03184"></a>03184     <span class="keywordtype">char</span>            *scriptFile;                    <span class="comment">/**&lt; Script or module to run */</span>
<a name="l03185"></a>03185     <span class="keywordtype">char</span>            *scriptLiteral;                 <span class="comment">/**&lt; Literal script string to run */</span>
<a name="l03186"></a>03186     <span class="keywordtype">int</span>             state;                          <span class="comment">/**&lt; Worker state */</span>
<a name="l03187"></a>03187     <span class="keywordtype">int</span>             inside;                         <span class="comment">/**&lt; Running inside the worker */</span>
<a name="l03188"></a>03188     <span class="keywordtype">int</span>             complete;                       <span class="comment">/**&lt; Worker has completed its work */</span>
<a name="l03189"></a>03189     <span class="keywordtype">int</span>             gotMessage;                     <span class="comment">/**&lt; Worker has received a message */</span>
<a name="l03190"></a>03190     <span class="keywordtype">int</span>             terminated;                     <span class="comment">/**&lt; Worker has had terminate() called */</span>
<a name="l03191"></a>03191 } EjsWorker;
<a name="l03192"></a>03192 
<a name="l03193"></a>03193 <span class="keyword">extern</span> EjsWorker *ejsCreateWorker(Ejs *ejs);
<a name="l03194"></a>03194 <span class="comment"></span>
<a name="l03195"></a>03195 <span class="comment">/** </span>
<a name="l03196"></a>03196 <span class="comment">    Void class</span>
<a name="l03197"></a>03197 <span class="comment">    @description The Void class provides the base class for the singleton "undefined" instance. This instance is stored</span>
<a name="l03198"></a>03198 <span class="comment">        in ejs-&gt;undefinedValue..</span>
<a name="l03199"></a>03199 <span class="comment">    @stability Evolving</span>
<a name="l03200"></a>03200 <span class="comment">    @defgroup EjsVoid EjsVoid</span>
<a name="l03201"></a>03201 <span class="comment">    @see EjsVoid</span>
<a name="l03202"></a>03202 <span class="comment"> */</span>
<a name="l03203"></a>03203 <span class="keyword">typedef</span> EjsObj EjsVoid;
<a name="l03204"></a>03204 
<a name="l03205"></a>03205 <span class="keyword">extern</span> EjsVoid  *ejsCreateUndefined(Ejs *ejs);
<a name="l03206"></a>03206 <span class="preprocessor">#define ejsIsUndefined(vp) ejsIs(vp, ES_Void)</span>
<a name="l03207"></a>03207 <span class="preprocessor"></span>
<a name="l03208"></a>03208 
<a name="l03209"></a>03209 <span class="comment">/*  </span>
<a name="l03210"></a>03210 <span class="comment">    Xml tag state</span>
<a name="l03211"></a>03211 <span class="comment"> */</span>
<a name="l03212"></a>03212 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsXmlTagState {
<a name="l03213"></a>03213     <span class="keyword">struct </span>EjsXML   *obj;
<a name="l03214"></a>03214     <span class="comment">//  TODO these two should be XML also</span>
<a name="l03215"></a>03215     EjsObj          *attributes;
<a name="l03216"></a>03216     EjsObj          *comments;
<a name="l03217"></a>03217 } EjsXmlTagState;
<a name="l03218"></a>03218 
<a name="l03219"></a>03219 
<a name="l03220"></a>03220 <span class="comment">/*  </span>
<a name="l03221"></a>03221 <span class="comment">    Xml Parser state</span>
<a name="l03222"></a>03222 <span class="comment"> */</span>
<a name="l03223"></a>03223 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsXmlState {
<a name="l03224"></a>03224     <span class="comment">//  MOB -- should not be fixed but should be growable</span>
<a name="l03225"></a>03225     EjsXmlTagState  nodeStack[EJS_XML_MAX_NODE_DEPTH];
<a name="l03226"></a>03226     Ejs             *ejs;
<a name="l03227"></a>03227     <span class="keyword">struct </span>EjsType  *xmlType;
<a name="l03228"></a>03228     <span class="keyword">struct </span>EjsType  *xmlListType;
<a name="l03229"></a>03229     <span class="keywordtype">int</span>             topOfStack;
<a name="l03230"></a>03230     <span class="keywordtype">long</span>            inputSize;
<a name="l03231"></a>03231     <span class="keywordtype">long</span>            inputPos;
<a name="l03232"></a>03232     cchar           *inputBuf;
<a name="l03233"></a>03233     cchar           *filename;
<a name="l03234"></a>03234 } EjsXmlState;
<a name="l03235"></a>03235 
<a name="l03236"></a>03236 <span class="comment"></span>
<a name="l03237"></a>03237 <span class="comment">/** </span>
<a name="l03238"></a>03238 <span class="comment">    XML class</span>
<a name="l03239"></a>03239 <span class="comment">    @description The XML class and API is based on ECMA-357 -- ECMAScript for XML (E4X). The XML class is a </span>
<a name="l03240"></a>03240 <span class="comment">    core class in the E4X specification; it provides the ability to load, parse and save XML documents.</span>
<a name="l03241"></a>03241 <span class="comment">    @stability Evolving</span>
<a name="l03242"></a>03242 <span class="comment">    @defgroup EjsXML EjsXML</span>
<a name="l03243"></a>03243 <span class="comment">    @see EjsXML ejsIsXML ejsConfigureXML ejsCreateXML ejsLoadXMLString ejsDeepCopyXML ejsXMLDescendants</span>
<a name="l03244"></a>03244 <span class="comment"> */</span>
<a name="l03245"></a>03245 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsXML {
<a name="l03246"></a>03246     EjsObj          obj;                <span class="comment">/**&lt; Extends Object - Property storage (unused) */</span>
<a name="l03247"></a>03247     EjsName         qname;              <span class="comment">/**&lt; XML node name (e.g. tagName) */</span>
<a name="l03248"></a>03248     <span class="keywordtype">int</span>             kind;               <span class="comment">/**&lt; Kind of XML node */</span>
<a name="l03249"></a>03249     MprList         *elements;          <span class="comment">/**&lt; List elements or child nodes */</span>
<a name="l03250"></a>03250     MprList         *attributes;        <span class="comment">/**&lt; Node attributes */</span>
<a name="l03251"></a>03251     MprList         *namespaces;        <span class="comment">/**&lt; List of namespaces as Namespace objects */</span>
<a name="l03252"></a>03252     <span class="keyword">struct </span>EjsXML   *parent;            <span class="comment">/**&lt; Parent node reference (XML or XMLList) */</span>
<a name="l03253"></a>03253     <span class="keyword">struct </span>EjsXML   *targetObject;      <span class="comment">/**&lt; XML/XMLList object modified when items inserted into an empty list */</span>
<a name="l03254"></a>03254     EjsName         targetProperty;     <span class="comment">/**&lt; XML property modified when items inserted into an empty list */</span>
<a name="l03255"></a>03255     <span class="keywordtype">char</span>            *value;             <span class="comment">/**&lt; String vale of text|attribute|comment|pi */</span>
<a name="l03256"></a>03256     <span class="keywordtype">int</span>             flags;
<a name="l03257"></a>03257 } EjsXML;
<a name="l03258"></a>03258 
<a name="l03259"></a>03259 
<a name="l03260"></a>03260 <span class="preprocessor">#if DOXYGEN</span>
<a name="l03261"></a>03261 <span class="preprocessor"></span>    <span class="comment">//  MOB -- missing param doc</span><span class="comment"></span>
<a name="l03262"></a>03262 <span class="comment">    /** </span>
<a name="l03263"></a>03263 <span class="comment">        Determine if a variable is an XML object</span>
<a name="l03264"></a>03264 <span class="comment">        @return true if the variable is an XML or XMLList object</span>
<a name="l03265"></a>03265 <span class="comment">        @ingroup EjsXML</span>
<a name="l03266"></a>03266 <span class="comment">     */</span>
<a name="l03267"></a>03267     <span class="keyword">extern</span> <span class="keywordtype">boolean</span> <a class="code" href="group___ejs_x_m_l.html#gfcf47f785585d764c86103ea746934f2" title="Determine if a variable is an XML object.">ejsIsXML</a>(Ejs *ejs, EjsObj *vp);
<a name="l03268"></a>03268 <span class="preprocessor">#else</span>
<a name="l03269"></a>03269 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsXML(ejs, vp) (vp &amp;&amp; \</span>
<a name="l03270"></a>03270 <span class="preprocessor">        ((((EjsObj*) vp)-&gt;type == ejs-&gt;xmlType) || (((EjsObj*) vp)-&gt;type == ejs-&gt;xmlListType)))</span>
<a name="l03271"></a>03271 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l03272"></a>03272 <span class="preprocessor"></span>
<a name="l03273"></a>03273 <span class="keyword">extern</span> EjsXML *ejsCreateXML(Ejs *ejs, <span class="keywordtype">int</span> kind, EjsName *name, EjsXML *parent, cchar *value);
<a name="l03274"></a>03274 <span class="keyword">extern</span> <span class="keywordtype">void</span>  ejsLoadXMLString(Ejs *ejs, EjsXML *xml, cchar *xmlString);
<a name="l03275"></a>03275 <span class="keyword">extern</span> EjsXML *ejsConfigureXML(Ejs *ejs, EjsXML *xml, <span class="keywordtype">int</span> kind, cchar *name, EjsXML *parent, cchar *value);
<a name="l03276"></a>03276 <span class="keyword">extern</span> EjsXML *ejsDeepCopyXML(Ejs *ejs, EjsXML *xml);
<a name="l03277"></a>03277 <span class="keyword">extern</span> EjsXML *ejsXMLDescendants(Ejs *ejs, EjsXML *xml, EjsName *qname);
<a name="l03278"></a>03278 
<a name="l03279"></a>03279 <span class="comment">/*  </span>
<a name="l03280"></a>03280 <span class="comment">    Xml private prototypes</span>
<a name="l03281"></a>03281 <span class="comment"> */</span>
<a name="l03282"></a>03282 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsMarkXML(Ejs *ejs, EjsXML *xml);
<a name="l03283"></a>03283 <span class="keyword">extern</span> MprXml *ejsCreateXmlParser(Ejs *ejs, EjsXML *xml, cchar *filename);
<a name="l03284"></a>03284 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsXMLToString(Ejs *ejs, MprBuf *buf, EjsXML *xml, <span class="keywordtype">int</span> indentLevel);
<a name="l03285"></a>03285 <span class="keyword">extern</span> EjsXML *ejsAppendToXML(Ejs *ejs, EjsXML *xml, EjsXML *node);
<a name="l03286"></a>03286 <span class="keyword">extern</span> EjsXML *ejsSetXML(Ejs *ejs, EjsXML *xml, <span class="keywordtype">int</span> index, EjsXML *node);
<a name="l03287"></a>03287 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsAppendAttributeToXML(Ejs *ejs, EjsXML *parent, EjsXML *node);
<a name="l03288"></a>03288 <span class="keyword">extern</span> EjsXML *ejsCreateXMLList(Ejs *ejs, EjsXML *targetObject, EjsName *targetProperty);
<a name="l03289"></a>03289 
<a name="l03290"></a>03290 
<a name="l03291"></a>03291 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsAddObserver(Ejs *ejs, EjsObj **emitterPtr, EjsObj *name, EjsObj *listener);
<a name="l03292"></a>03292 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsRemoveObserver(Ejs *ejs, EjsObj *emitter, EjsObj *name, EjsObj *listener);
<a name="l03293"></a>03293 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsSendEventv(Ejs *ejs, EjsObj *emitter, cchar *name, <span class="keywordtype">int</span> argc, EjsObj **argv);
<a name="l03294"></a>03294 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsSendEvent(Ejs *ejs, EjsObj *emitter, cchar *name, EjsObj *arg);
<a name="l03295"></a>03295 
<a name="l03296"></a>03296 
<a name="l03297"></a>03297 <span class="preprocessor">#if DOXYGEN</span>
<a name="l03298"></a>03298 <span class="preprocessor"></span><span class="comment">    /** </span>
<a name="l03299"></a>03299 <span class="comment">        Determine if a variable is a number</span>
<a name="l03300"></a>03300 <span class="comment">        @param vp Variable to examine</span>
<a name="l03301"></a>03301 <span class="comment">        @return True if the variable is a number</span>
<a name="l03302"></a>03302 <span class="comment">        @ingroup EjsNumber</span>
<a name="l03303"></a>03303 <span class="comment">     */</span>
<a name="l03304"></a>03304     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_number.html#g359aca35bd4958b29d540500deea7621" title="Determine if a variable is a number.">ejsIsNumber</a>(EjsObj *vp);
<a name="l03305"></a>03305 <span class="comment"></span>
<a name="l03306"></a>03306 <span class="comment">    /** </span>
<a name="l03307"></a>03307 <span class="comment">        Get the numeric value stored in a EjsNumber object</span>
<a name="l03308"></a>03308 <span class="comment">        @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l03309"></a>03309 <span class="comment">        @param vp Variable to examine</span>
<a name="l03310"></a>03310 <span class="comment">        @return A numeric value</span>
<a name="l03311"></a>03311 <span class="comment">        @ingroup EjsNumber</span>
<a name="l03312"></a>03312 <span class="comment">     */</span>
<a name="l03313"></a>03313     <span class="keyword">extern</span> MprNumber <a class="code" href="group___ejs_number.html#g28517af3e15a4830ac4aef33c77ca443" title="Get the numeric value stored in a EjsNumber object.">ejsGetNumber</a>(Ejs *ejs, EjsObj *vp);
<a name="l03314"></a>03314 <span class="comment"></span>
<a name="l03315"></a>03315 <span class="comment">    /** </span>
<a name="l03316"></a>03316 <span class="comment">        Get the numeric value stored in a EjsNumber object</span>
<a name="l03317"></a>03317 <span class="comment">        @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l03318"></a>03318 <span class="comment">        @param vp Variable to examine</span>
<a name="l03319"></a>03319 <span class="comment">        @return An integer value</span>
<a name="l03320"></a>03320 <span class="comment">        @ingroup EjsNumber</span>
<a name="l03321"></a>03321 <span class="comment">     */</span>
<a name="l03322"></a>03322     <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_number.html#ge6b4ff8d014588ca4582ed211a67e11a" title="Get the numeric value stored in a EjsNumber object.">ejsGetInt</a>(Ejs *ejs, EjsObj *vp);
<a name="l03323"></a>03323 <span class="comment"></span>
<a name="l03324"></a>03324 <span class="comment">    /** </span>
<a name="l03325"></a>03325 <span class="comment">        Get the numeric value stored in a EjsNumber object</span>
<a name="l03326"></a>03326 <span class="comment">        @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l03327"></a>03327 <span class="comment">        @param vp Variable to examine</span>
<a name="l03328"></a>03328 <span class="comment">        @return A double value</span>
<a name="l03329"></a>03329 <span class="comment">        @ingroup EjsNumber</span>
<a name="l03330"></a>03330 <span class="comment">     */</span>
<a name="l03331"></a>03331     <span class="keyword">extern</span> <span class="keywordtype">double</span> <a class="code" href="group___ejs_number.html#gae335f1dd005f157bc1ea3c936f91c72" title="Get the numeric value stored in a EjsNumber object.">ejsGetDouble</a>(Ejs *ejs, EjsObj *vp);
<a name="l03332"></a>03332 <span class="preprocessor">#else</span>
<a name="l03333"></a>03333 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsNumber(vp) ejsIs(vp, ES_Number)</span>
<a name="l03334"></a>03334 <span class="preprocessor"></span>    <span class="keyword">extern</span> MprNumber _ejsGetNumber(Ejs *ejs, EjsObj *vp);
<a name="l03335"></a>03335     <span class="keyword">extern</span> <span class="keywordtype">double</span> _ejsGetDouble(Ejs *ejs, EjsObj *vp);
<a name="l03336"></a>03336     <span class="keyword">extern</span> <span class="keywordtype">int</span> _ejsGetInt(Ejs *ejs, EjsObj *vp);
<a name="l03337"></a>03337 <span class="preprocessor">    #define ejsGetNumber(ejs, vp) _ejsGetNumber(ejs, (EjsObj*) (vp))</span>
<a name="l03338"></a>03338 <span class="preprocessor"></span><span class="preprocessor">    #define ejsGetInt(ejs, vp) _ejsGetInt(ejs, (EjsObj*) (vp))</span>
<a name="l03339"></a>03339 <span class="preprocessor"></span><span class="preprocessor">    #define ejsGetDouble(ejs, vp) _ejsGetDouble(ejs, (EjsObj*) (vp))</span>
<a name="l03340"></a>03340 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l03341"></a>03341 <span class="preprocessor"></span><span class="comment"></span>
<a name="l03342"></a>03342 <span class="comment">/** </span>
<a name="l03343"></a>03343 <span class="comment">    Type Helpers</span>
<a name="l03344"></a>03344 <span class="comment">    @description The type helpers interface defines the set of primitive operations a type must support to</span>
<a name="l03345"></a>03345 <span class="comment">        interact with the virtual machine.</span>
<a name="l03346"></a>03346 <span class="comment">    @ingroup EjsType</span>
<a name="l03347"></a>03347 <span class="comment"> */</span>
<a name="l03348"></a><a class="code" href="struct_ejs_type_helpers.html">03348</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_ejs_type_helpers.html" title="Type Helpers.">EjsTypeHelpers</a> {
<a name="l03349"></a>03349     EjsObj  *(*cast)(Ejs *ejs, EjsObj *vp, <span class="keyword">struct </span>EjsType *type);
<a name="l03350"></a>03350     EjsObj  *(*clone)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">bool</span> deep);
<a name="l03351"></a>03351     EjsObj  *(*create)(Ejs *ejs, <span class="keyword">struct </span>EjsType *type, <span class="keywordtype">int</span> size);
<a name="l03352"></a>03352     int     (*defineProperty)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum, EjsName *qname, <span class="keyword">struct </span>EjsType *propType, 
<a name="l03353"></a>03353                 int64 attributes, EjsObj *value);
<a name="l03354"></a>03354     void    (*destroy)(Ejs *ejs, EjsObj *vp);
<a name="l03355"></a>03355     int     (*deleteProperty)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum);
<a name="l03356"></a>03356     int     (*deletePropertyByName)(Ejs *ejs, EjsObj *vp, EjsName *qname);
<a name="l03357"></a>03357     EjsObj  *(*getProperty)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum);
<a name="l03358"></a>03358     EjsObj  *(*getPropertyByName)(Ejs *ejs, EjsObj *vp, EjsName *qname);
<a name="l03359"></a>03359     int     (*getPropertyCount)(Ejs *ejs, EjsObj *vp);
<a name="l03360"></a>03360     EjsName (*getPropertyName)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum);
<a name="l03361"></a>03361 <span class="preprocessor">#if UNUSED</span>
<a name="l03362"></a>03362 <span class="preprocessor"></span>    <span class="keyword">struct </span><a class="code" href="struct_ejs_trait.html" title="Property traits.">EjsTrait</a> *(*getPropertyTrait)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum);
<a name="l03363"></a>03363 <span class="preprocessor">#endif</span>
<a name="l03364"></a>03364 <span class="preprocessor"></span>    EjsObj  *(*invokeOperator)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> opCode, EjsObj *rhs);
<a name="l03365"></a>03365     int     (*lookupProperty)(Ejs *ejs, EjsObj *vp, EjsName *qname);
<a name="l03366"></a>03366     void    (*mark)(Ejs *ejs, EjsObj *vp);
<a name="l03367"></a>03367     int     (*setProperty)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum, EjsObj *value);
<a name="l03368"></a>03368     int     (*setPropertyByName)(Ejs *ejs, EjsObj *vp, EjsName *qname, EjsObj *value);
<a name="l03369"></a>03369     int     (*setPropertyName)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum, EjsName *qname);
<a name="l03370"></a>03370 <span class="preprocessor">#if UNUSED</span>
<a name="l03371"></a>03371 <span class="preprocessor"></span>    int     (*setPropertyTrait)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum, <span class="keyword">struct </span>EjsType *propType, <span class="keywordtype">int</span> attributes);
<a name="l03372"></a>03372 <span class="preprocessor">#endif</span>
<a name="l03373"></a>03373 <span class="preprocessor"></span>} <a class="code" href="struct_ejs_type_helpers.html" title="Type Helpers.">EjsTypeHelpers</a>;
<a name="l03374"></a>03374 
<a name="l03375"></a>03375 
<a name="l03376"></a>03376 <span class="keyword">typedef</span> EjsObj  *(*EjsCreateHelper)(Ejs *ejs, <span class="keyword">struct </span>EjsType *type, <span class="keywordtype">int</span> size);
<a name="l03377"></a>03377 <span class="keyword">typedef</span> void    (*EjsDestroyHelper)(Ejs *ejs, EjsObj *vp);
<a name="l03378"></a>03378 <span class="keyword">typedef</span> EjsObj  *(*EjsCastHelper)(Ejs *ejs, EjsObj *vp, <span class="keyword">struct </span>EjsType *type);
<a name="l03379"></a>03379 <span class="keyword">typedef</span> EjsObj  *(*EjsCloneHelper)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">bool</span> deep);
<a name="l03380"></a>03380 <span class="keyword">typedef</span> int     (*EjsDefinePropertyHelper)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum, EjsName *qname, <span class="keyword">struct </span>EjsType *propType, 
<a name="l03381"></a>03381                     int64 attributes, EjsObj *value);
<a name="l03382"></a>03382 <span class="keyword">typedef</span> int     (*EjsDeletePropertyHelper)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum);
<a name="l03383"></a>03383 <span class="keyword">typedef</span> int     (*EjsDeletePropertyByNameHelper)(Ejs *ejs, EjsObj *vp, EjsName *qname);
<a name="l03384"></a>03384 <span class="keyword">typedef</span> EjsObj  *(*EjsGetPropertyHelper)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum);
<a name="l03385"></a>03385 <span class="keyword">typedef</span> EjsObj  *(*EjsGetPropertyByNameHelper)(Ejs *ejs, EjsObj *vp, EjsName *qname);
<a name="l03386"></a>03386 <span class="keyword">typedef</span> int     (*EjsGetPropertyCountHelper)(Ejs *ejs, EjsObj *vp);
<a name="l03387"></a>03387 <span class="keyword">typedef</span> EjsName (*EjsGetPropertyNameHelper)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum);
<a name="l03388"></a>03388 <span class="keyword">typedef</span> int     (*EjsLookupPropertyHelper)(Ejs *ejs, EjsObj *vp, EjsName *qname);
<a name="l03389"></a>03389 <span class="keyword">typedef</span> EjsObj  *(*EjsInvokeOperatorHelper)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> opCode, EjsObj *rhs);
<a name="l03390"></a>03390 <span class="keyword">typedef</span> void    (*EjsMarkHelper)(Ejs *ejs, EjsObj *vp);
<a name="l03391"></a>03391 <span class="keyword">typedef</span> int     (*EjsSetPropertyByNameHelper)(Ejs *ejs, EjsObj *vp, EjsName *qname, EjsObj *value);
<a name="l03392"></a>03392 <span class="keyword">typedef</span> int     (*EjsSetPropertyHelper)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum, EjsObj *value);
<a name="l03393"></a>03393 <span class="keyword">typedef</span> int     (*EjsSetPropertyNameHelper)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum, EjsName *qname);
<a name="l03394"></a>03394 <span class="preprocessor">#if UNUSED</span>
<a name="l03395"></a>03395 <span class="preprocessor"></span><span class="keyword">typedef</span> int     (*EjsSetPropertyTraitHelper)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum, <span class="keyword">struct </span>EjsType *propType, <span class="keywordtype">int</span> attributes);
<a name="l03396"></a>03396 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_ejs_trait.html" title="Property traits.">EjsTrait</a> *(*EjsGetPropertyTraitHelper)(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slotNum);
<a name="l03397"></a>03397 <span class="preprocessor">#endif</span>
<a name="l03398"></a>03398 <span class="preprocessor"></span><span class="comment"></span>
<a name="l03399"></a>03399 <span class="comment">/** </span>
<a name="l03400"></a>03400 <span class="comment">    Type class</span>
<a name="l03401"></a>03401 <span class="comment">    @description Classes in Ejscript are represented by instances of an EjsType. </span>
<a name="l03402"></a>03402 <span class="comment">        Types are templates for creating instances of the given type, but they are also are runtime accessible objects.</span>
<a name="l03403"></a>03403 <span class="comment">        Types contain the static properties and methods for objects and store these in their object slots array. </span>
<a name="l03404"></a>03404 <span class="comment">        They store the instance properties in the type-&gt;instance object. EjsType inherits from EjsBlock, EjsObj </span>
<a name="l03405"></a>03405 <span class="comment">        and EjsObj. </span>
<a name="l03406"></a>03406 <span class="comment">    @stability Evolving</span>
<a name="l03407"></a>03407 <span class="comment">    @defgroup EjsType EjsType</span>
<a name="l03408"></a>03408 <span class="comment">    @see EjsType ejsIsType ejsIsProperty ejsCreateType ejsDefineFunction ejsIsA ejsIsTypeSubType </span>
<a name="l03409"></a>03409 <span class="comment">        ejsBindMethod ejsDefineInstanceProperty ejsGetType</span>
<a name="l03410"></a>03410 <span class="comment"> */</span>
<a name="l03411"></a>03411 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsType {
<a name="l03412"></a>03412     EjsFunction     constructor;                    <span class="comment">/**&lt; Constructor function and type properties */</span>
<a name="l03413"></a>03413     EjsName         qname;                          <span class="comment">/**&lt; Qualified name of the type. Type name and namespace */</span>
<a name="l03414"></a>03414     EjsObj          *prototype;                     <span class="comment">/**&lt; Prototype for instances when using prototype inheritance (only) */</span>
<a name="l03415"></a>03415     <span class="keyword">struct </span>EjsType  *baseType;                      <span class="comment">/**&lt; Base class */</span>
<a name="l03416"></a>03416     MprList         *implements;                    <span class="comment">/**&lt; List of implemented interfaces */</span>
<a name="l03417"></a>03417         
<a name="l03418"></a>03418     uint            callsSuper              :  1;   <span class="comment">/**&lt; Constructor calls super() */</span>
<a name="l03419"></a>03419     uint            dontPool                :  1;   <span class="comment">/**&lt; Don't pool instances */</span>
<a name="l03420"></a>03420     uint            dynamicInstance         :  1;   <span class="comment">/**&lt; Object instances may add properties */</span>
<a name="l03421"></a>03421     uint            <span class="keyword">final</span>                   :  1;   <span class="comment">/**&lt; Type is final */</span>
<a name="l03422"></a>03422     uint            hasBaseConstructors     :  1;   <span class="comment">/**&lt; Base types has constructors */</span>
<a name="l03423"></a>03423     uint            hasBaseInitializers     :  1;   <span class="comment">/**&lt; Base types have initializers */</span>
<a name="l03424"></a>03424     uint            hasConstructor          :  1;   <span class="comment">/**&lt; Type has a constructor */</span>
<a name="l03425"></a>03425     uint            hasInitializer          :  1;   <span class="comment">/**&lt; Type has static level initialization code */</span>
<a name="l03426"></a>03426     uint            hasInstanceVars         :  1;   <span class="comment">/**&lt; Type has non-function instance vars (state) */</span>
<a name="l03427"></a>03427     uint            hasMeta                 :  1;   <span class="comment">/**&lt; Type has meta methods */</span>
<a name="l03428"></a>03428     uint            hasScriptFunctions      :  1;   <span class="comment">/**&lt; Block has non-native functions requiring namespaces */</span>
<a name="l03429"></a>03429     uint            immutable               :  1;   <span class="comment">/**&lt; Instances are immutable */</span>
<a name="l03430"></a>03430     uint            initialized             :  1;   <span class="comment">/**&lt; Static initializer has run */</span>
<a name="l03431"></a>03431     uint            isInterface             :  1;   <span class="comment">/**&lt; Interface vs class */</span>
<a name="l03432"></a>03432     uint            needFinalize            :  1;   <span class="comment">/**&lt; Instances need finalization */</span>
<a name="l03433"></a>03433     uint            needFixup               :  1;   <span class="comment">/**&lt; Slots need fixup */</span>
<a name="l03434"></a>03434     uint            numericIndicies         :  1;   <span class="comment">/**&lt; Instances support direct numeric indicies */</span>
<a name="l03435"></a>03435     uint            virtualSlots            :  1;   <span class="comment">/**&lt; Properties are not stored in slots[] */</span>
<a name="l03436"></a>03436     
<a name="l03437"></a>03437     <span class="keywordtype">int</span>             numInherited;                   <span class="comment">/**&lt; Number of inherited prototype properties */</span>
<a name="l03438"></a>03438     <span class="keywordtype">short</span>           id;                             <span class="comment">/**&lt; Unique type id */</span>
<a name="l03439"></a>03439     ushort          instanceSize;                   <span class="comment">/**&lt; Size of instances in bytes */</span>
<a name="l03440"></a>03440     <a class="code" href="struct_ejs_type_helpers.html" title="Type Helpers.">EjsTypeHelpers</a>  helpers;                        <span class="comment">/**&lt; Type helper methods */</span>
<a name="l03441"></a>03441     <span class="keyword">struct </span>EjsModule *module;                       <span class="comment">/**&lt; Module owning the type - stores the constant pool */</span>
<a name="l03442"></a>03442     <span class="keywordtype">void</span>            *typeData;                      <span class="comment">/**&lt; Type specific data */</span>
<a name="l03443"></a>03443 } EjsType;
<a name="l03444"></a>03444 
<a name="l03445"></a>03445 
<a name="l03446"></a>03446 <span class="preprocessor">#if DOXYGEN</span>
<a name="l03447"></a>03447 <span class="preprocessor"></span><span class="comment">    /** </span>
<a name="l03448"></a>03448 <span class="comment">        Determine if a variable is an type</span>
<a name="l03449"></a>03449 <span class="comment">        @param vp Variable to test</span>
<a name="l03450"></a>03450 <span class="comment">        @return True if the variable is a type</span>
<a name="l03451"></a>03451 <span class="comment">        @ingroup EjsType</span>
<a name="l03452"></a>03452 <span class="comment">     */</span>
<a name="l03453"></a>03453     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_type.html#ga7ededaf6f7ebf327861ea00ce62784a" title="Determine if a variable is an type.">ejsIsType</a>(EjsObj *vp);
<a name="l03454"></a>03454 <span class="comment"></span>
<a name="l03455"></a>03455 <span class="comment">    /** </span>
<a name="l03456"></a>03456 <span class="comment">        Determine if a variable is a prototype object. Types store the template for instance properties in a prototype object</span>
<a name="l03457"></a>03457 <span class="comment">        @param vp Variable to test</span>
<a name="l03458"></a>03458 <span class="comment">        @return True if the variable is a prototype object.</span>
<a name="l03459"></a>03459 <span class="comment">        @ingroup EjsType</span>
<a name="l03460"></a>03460 <span class="comment">     */</span>
<a name="l03461"></a>03461     <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_type.html#g1b86509135212a079885a54454389eed" title="Determine if a variable is a prototype object.">ejsIsPrototype</a>(EjsObj *vp);
<a name="l03462"></a>03462 <span class="preprocessor">#else</span>
<a name="l03463"></a>03463 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsType(vp)       (vp &amp;&amp; (((EjsObj*) (vp))-&gt;isType))</span>
<a name="l03464"></a>03464 <span class="preprocessor"></span><span class="preprocessor">    #define ejsIsPrototype(vp)  (vp &amp;&amp; (((EjsObj*) (vp))-&gt;isPrototype))</span>
<a name="l03465"></a>03465 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l03466"></a>03466 <span class="preprocessor"></span><span class="comment"></span>
<a name="l03467"></a>03467 <span class="comment">/** </span>
<a name="l03468"></a>03468 <span class="comment">    Create a new type object</span>
<a name="l03469"></a>03469 <span class="comment">    @description Create a new type object </span>
<a name="l03470"></a>03470 <span class="comment">    @param ejs Ejs reference returned from #ejsCreate</span>
<a name="l03471"></a>03471 <span class="comment">    @param name Qualified name to give the type. This name is merely referenced by the type and must be persistent.</span>
<a name="l03472"></a>03472 <span class="comment">        This name is not used to define the type as a global property.</span>
<a name="l03473"></a>03473 <span class="comment">    @param up Reference to a module that will own the type. Set to null if not owned by any module.</span>
<a name="l03474"></a>03474 <span class="comment">    @param baseType Base type for this type.</span>
<a name="l03475"></a>03475 <span class="comment">    @param prototype Prototype object instance properties of this type.</span>
<a name="l03476"></a>03476 <span class="comment">    @param size Size of instances. This is the size in bytes of an instance object.</span>
<a name="l03477"></a>03477 <span class="comment">    @param slotNum Slot number that the type will be installed at. This is used by core types to define a unique type ID. </span>
<a name="l03478"></a>03478 <span class="comment">        For non-core types, set to -1.</span>
<a name="l03479"></a>03479 <span class="comment">    @param numTypeProp Number of type (class) properties for the type. These include static properties and methods.</span>
<a name="l03480"></a>03480 <span class="comment">    @param numInstanceProp Number of instance properties.</span>
<a name="l03481"></a>03481 <span class="comment">    @param attributes Attribute mask to modify how the type is initialized.</span>
<a name="l03482"></a>03482 <span class="comment">    @param data</span>
<a name="l03483"></a>03483 <span class="comment">    @ingroup EjsType EjsType</span>
<a name="l03484"></a>03484 <span class="comment"> */</span>
<a name="l03485"></a>03485 <span class="keyword">extern</span> EjsType *<a class="code" href="group___ejs_type.html#g0d0ddf8d7e1d5f07f0398749cb2e574f" title="Create a new type object.">ejsCreateType</a>(Ejs *ejs, EjsName *name, <span class="keyword">struct</span> EjsModule *up, EjsType *baseType, EjsObj *prototype,
<a name="l03486"></a>03486     <span class="keywordtype">int</span> size, <span class="keywordtype">int</span> slotNum, <span class="keywordtype">int</span> numTypeProp, <span class="keywordtype">int</span> numInstanceProp, int64 attributes, <span class="keywordtype">void</span> *data);
<a name="l03487"></a>03487 
<a name="l03488"></a>03488 <span class="keyword">extern</span> EjsType *ejsConfigureType(Ejs *ejs, EjsType *type, <span class="keyword">struct</span> EjsModule *up, EjsType *baseType, 
<a name="l03489"></a>03489     <span class="keywordtype">int</span> numTypeProp, <span class="keywordtype">int</span> numInstanceProp, int64 attributes);
<a name="l03490"></a>03490 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsCompleteType(Ejs *ejs, EjsType *type);
<a name="l03491"></a>03491 
<a name="l03492"></a>03492 <span class="keyword">extern</span> EjsObj *ejsCreatePrototype(Ejs *ejs, EjsType *type, <span class="keywordtype">int</span> numProp);
<a name="l03493"></a>03493 <span class="keyword">extern</span> EjsType *ejsCreateArchetype(Ejs *ejs, <span class="keyword">struct</span> EjsFunction *fun, EjsObj *prototype);
<a name="l03494"></a>03494 <span class="comment"></span>
<a name="l03495"></a>03495 <span class="comment">/** </span>
<a name="l03496"></a>03496 <span class="comment">    Define a global function</span>
<a name="l03497"></a>03497 <span class="comment">    @description Define a global public function and bind it to the C native function. This is a simple one liner</span>
<a name="l03498"></a>03498 <span class="comment">        to define a public global function. The more typical paradigm to define functions is to create a script file</span>
<a name="l03499"></a>03499 <span class="comment">        of native method definitions and and compile it. This results in a mod file that can be loaded which will</span>
<a name="l03500"></a>03500 <span class="comment">        create the function/method definitions. Then use #ejsBindMethod to associate a C function with a property.</span>
<a name="l03501"></a>03501 <span class="comment">    @ingroup EjsType</span>
<a name="l03502"></a>03502 <span class="comment"> */</span>
<a name="l03503"></a>03503 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_type.html#g24a592f56804bb98240f21cea4288f01" title="Define a global function.">ejsDefineGlobalFunction</a>(Ejs *ejs, cchar *name, EjsProc fn);
<a name="l03504"></a>03504 
<a name="l03505"></a>03505 <span class="comment"></span>
<a name="l03506"></a>03506 <span class="comment">/** </span>
<a name="l03507"></a>03507 <span class="comment">    Test if an variable is an instance of a given type</span>
<a name="l03508"></a>03508 <span class="comment">    @description Perform an "is a" test. This tests if a variable is a direct instance or subclass of a given base type.</span>
<a name="l03509"></a>03509 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l03510"></a>03510 <span class="comment">    @param target Target variable to test.</span>
<a name="l03511"></a>03511 <span class="comment">    @param type Type to compare with the target</span>
<a name="l03512"></a>03512 <span class="comment">    @return True if target is an instance of "type" or an instance of a subclass of "type".</span>
<a name="l03513"></a>03513 <span class="comment">    @ingroup EjsType</span>
<a name="l03514"></a>03514 <span class="comment"> */</span>
<a name="l03515"></a>03515 <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_type.html#gc3a3057b7806228b552a4acc82695a7d" title="Test if an variable is an instance of a given type.">ejsIsA</a>(Ejs *ejs, EjsObj *target, EjsType *type);
<a name="l03516"></a>03516 <span class="comment"></span>
<a name="l03517"></a>03517 <span class="comment">/** </span>
<a name="l03518"></a>03518 <span class="comment">    Test if a type is a derived type of a given base type.</span>
<a name="l03519"></a>03519 <span class="comment">    @description Test if a type subclasses a base type.</span>
<a name="l03520"></a>03520 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l03521"></a>03521 <span class="comment">    @param target Target type to test.</span>
<a name="l03522"></a>03522 <span class="comment">    @param baseType Base class to see if the target subclasses it.</span>
<a name="l03523"></a>03523 <span class="comment">    @return True if target is a "baseType" or a subclass of "baseType".</span>
<a name="l03524"></a>03524 <span class="comment">    @ingroup EjsType</span>
<a name="l03525"></a>03525 <span class="comment"> */</span>
<a name="l03526"></a>03526 <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="group___ejs_type.html#g1c07c5c5908c4a6db4b35f765efa31ca" title="Test if a type is a derived type of a given base type.">ejsIsTypeSubType</a>(Ejs *ejs, EjsType *target, EjsType *baseType);
<a name="l03527"></a>03527 <span class="comment"></span>
<a name="l03528"></a>03528 <span class="comment">/** </span>
<a name="l03529"></a>03529 <span class="comment">    Bind a native C function to a method property</span>
<a name="l03530"></a>03530 <span class="comment">    @description Bind a native C function to an existing javascript method. Method functions are typically created</span>
<a name="l03531"></a>03531 <span class="comment">        by compiling a script file of native method definitions into a mod file. When loaded, this mod file will create</span>
<a name="l03532"></a>03532 <span class="comment">        the method properties. This routine will then bind the specified C function to the method property.</span>
<a name="l03533"></a>03533 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l03534"></a>03534 <span class="comment">    @param obj Type containing the function property to bind.</span>
<a name="l03535"></a>03535 <span class="comment">    @param slotNum Slot number of the method property</span>
<a name="l03536"></a>03536 <span class="comment">    @param fn Native C function to bind</span>
<a name="l03537"></a>03537 <span class="comment">    @return Zero if successful, otherwise a negative MPR error code.</span>
<a name="l03538"></a>03538 <span class="comment">    @ingroup EjsType</span>
<a name="l03539"></a>03539 <span class="comment"> */</span>
<a name="l03540"></a>03540 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_type.html#gd1d108c8341a4f6ef3be935d4dc8a723" title="Bind a native C function to a method property.">ejsBindMethod</a>(Ejs *ejs, <span class="keywordtype">void</span> *obj, <span class="keywordtype">int</span> slotNum, EjsProc fn);
<a name="l03541"></a>03541 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsBindAccess(Ejs *ejs, <span class="keywordtype">void</span> *obj, <span class="keywordtype">int</span> slotNum, EjsProc getter, EjsProc setter);
<a name="l03542"></a>03542 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsBindConstructor(Ejs *ejs, EjsType *type, EjsProc nativeProc);
<a name="l03543"></a>03543 <span class="comment"></span>
<a name="l03544"></a>03544 <span class="comment">/** </span>
<a name="l03545"></a>03545 <span class="comment">    Define an instance property</span>
<a name="l03546"></a>03546 <span class="comment">    @description Define an instance property on a type. This routine should not normally be called manually. Instance</span>
<a name="l03547"></a>03547 <span class="comment">        properties are best created by creating a script file of native property definitions and then loading the resultant</span>
<a name="l03548"></a>03548 <span class="comment">        mod file.</span>
<a name="l03549"></a>03549 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l03550"></a>03550 <span class="comment">    @param type Type in which to create the instance property</span>
<a name="l03551"></a>03551 <span class="comment">    @param slotNum Instance slot number in the type that will hold the property. Set to -1 to allocate the next available</span>
<a name="l03552"></a>03552 <span class="comment">        free slot.</span>
<a name="l03553"></a>03553 <span class="comment">    @param name Qualified name for the property including namespace and name.</span>
<a name="l03554"></a>03554 <span class="comment">    @param propType Type of the instance property.</span>
<a name="l03555"></a>03555 <span class="comment">    @param attributes Integer mask of access attributes.</span>
<a name="l03556"></a>03556 <span class="comment">    @param value Initial value of the instance property.</span>
<a name="l03557"></a>03557 <span class="comment">    @return The slot number used for the property.</span>
<a name="l03558"></a>03558 <span class="comment">    @ingroup EjsType</span>
<a name="l03559"></a>03559 <span class="comment"> */</span>
<a name="l03560"></a>03560 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs_type.html#g53d103cc075475c48e027d246a7f2398" title="Define an instance property.">ejsDefineInstanceProperty</a>(Ejs *ejs, EjsType *type, <span class="keywordtype">int</span> slotNum, EjsName *name, EjsType *propType, 
<a name="l03561"></a>03561     <span class="keywordtype">int</span> attributes, EjsObj *value);
<a name="l03562"></a>03562 <span class="comment"></span>
<a name="l03563"></a>03563 <span class="comment">/** </span>
<a name="l03564"></a>03564 <span class="comment">    Get a type</span>
<a name="l03565"></a>03565 <span class="comment">    @description Get the type installed at the given slot number. All core-types are installed a specific global slots.</span>
<a name="l03566"></a>03566 <span class="comment">        When Ejscript is built, these slots are converted into C program defines of the form: ES_TYPE where TYPE is the </span>
<a name="l03567"></a>03567 <span class="comment">        name of the type concerned. For example, you can get the String type object via:</span>
<a name="l03568"></a>03568 <span class="comment">        @pre</span>
<a name="l03569"></a>03569 <span class="comment">        ejsGetType(ejs, ES_String)</span>
<a name="l03570"></a>03570 <span class="comment">    @param ejs Interpreter instance returned from #ejsCreate</span>
<a name="l03571"></a>03571 <span class="comment">    @param slotNum Slot number of the type to retrieve. Use ES_TYPE defines. </span>
<a name="l03572"></a>03572 <span class="comment">    @return A type object if successful or zero if the type could not be found</span>
<a name="l03573"></a>03573 <span class="comment">    @ingroup EjsType</span>
<a name="l03574"></a>03574 <span class="comment"> */</span>
<a name="l03575"></a>03575 <span class="keyword">extern</span> EjsType  *<a class="code" href="group___ejs_type.html#gf41edbabce385e7cb73ed6526aa2cf22" title="Get a type.">ejsGetType</a>(Ejs *ejs, <span class="keywordtype">int</span> slotNum);
<a name="l03576"></a>03576 
<a name="l03577"></a>03577 <span class="keyword">extern</span> EjsType  *ejsGetTypeByName(Ejs *ejs, cchar *space, cchar *name);
<a name="l03578"></a>03578 
<a name="l03579"></a>03579 <span class="preprocessor">#define VSPACE(space) space "-" BLD_VNUM</span>
<a name="l03580"></a>03580 <span class="preprocessor"></span><span class="preprocessor">#define ejsGetVType(ejs, space, name) ejsGetTypeByName(ejs, space "-" BLD_VNUM, name)</span>
<a name="l03581"></a>03581 <span class="preprocessor"></span>
<a name="l03582"></a>03582 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsCompactClass(Ejs *ejs, EjsType *type);
<a name="l03583"></a>03583 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsCopyBaseProperties(Ejs *ejs, EjsType *type, EjsType *baseType);
<a name="l03584"></a>03584 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsDefineTypeNamespaces(Ejs *ejs, EjsType *type);
<a name="l03585"></a>03585 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsFixupType(Ejs *ejs, EjsType *type, EjsType *baseType, <span class="keywordtype">int</span> makeRoom);
<a name="l03586"></a>03586 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsBlendTypeProperties(Ejs *ejs, EjsType *type, EjsType *typeType);
<a name="l03587"></a>03587 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsGetTypePropertyAttributes(Ejs *ejs, EjsObj *vp, <span class="keywordtype">int</span> slot);
<a name="l03588"></a>03588 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsInitializeBlockHelpers(<a class="code" href="struct_ejs_type_helpers.html" title="Type Helpers.">EjsTypeHelpers</a> *helpers);
<a name="l03589"></a>03589 
<a name="l03590"></a>03590 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsSetTypeName(Ejs *ejs, EjsType *type, EjsName *qname);
<a name="l03591"></a>03591 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsTypeNeedsFixup(Ejs *ejs, EjsType *type);
<a name="l03592"></a>03592 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsGetTypeSize(Ejs *ejs, EjsType *type);
<a name="l03593"></a>03593 
<a name="l03594"></a>03594 <span class="keyword">extern</span> EjsType  *ejsCreateCoreType(Ejs *ejs, EjsName *name, EjsType *extendsType, <span class="keywordtype">int</span> size, <span class="keywordtype">int</span> slotNum, 
<a name="l03595"></a>03595     <span class="keywordtype">int</span> numTypeProp, <span class="keywordtype">int</span> numInstanceProp, int64 attributes);
<a name="l03596"></a>03596 
<a name="l03597"></a>03597 <span class="keyword">extern</span> EjsType  *ejsCreateNativeType(Ejs *ejs, cchar *space, cchar *name, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> size);
<a name="l03598"></a>03598 <span class="keyword">extern</span> EjsType  *ejsConfigureNativeType(Ejs *ejs, cchar *space, cchar *name, <span class="keywordtype">int</span> size);
<a name="l03599"></a>03599 
<a name="l03600"></a>03600 
<a name="l03601"></a>03601 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsBootstrapTypes(Ejs *ejs);
<a name="l03602"></a>03602 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateArrayType(Ejs *ejs);
<a name="l03603"></a>03603 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateBlockType(Ejs *ejs);
<a name="l03604"></a>03604 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateBooleanType(Ejs *ejs);
<a name="l03605"></a>03605 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateErrorType(Ejs *ejs);
<a name="l03606"></a>03606 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateFrameType(Ejs *ejs);
<a name="l03607"></a>03607 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateFunctionType(Ejs *ejs);
<a name="l03608"></a>03608 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateGlobalBlock(Ejs *ejs);
<a name="l03609"></a>03609 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateIteratorType(Ejs *ejs);
<a name="l03610"></a>03610 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateNamespaceType(Ejs *ejs);
<a name="l03611"></a>03611 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateNullType(Ejs *ejs);
<a name="l03612"></a>03612 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateNumberType(Ejs *ejs);
<a name="l03613"></a>03613 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateObjectType(Ejs *ejs);
<a name="l03614"></a>03614 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateRegExpType(Ejs *ejs);
<a name="l03615"></a>03615 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateStringType(Ejs *ejs);
<a name="l03616"></a>03616 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateTypeType(Ejs *ejs);
<a name="l03617"></a>03617 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateVoidType(Ejs *ejs);
<a name="l03618"></a>03618 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateXMLType(Ejs *ejs);
<a name="l03619"></a>03619 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateXMLListType(Ejs *ejs);
<a name="l03620"></a>03620 
<a name="l03621"></a>03621 <span class="comment">/*  </span>
<a name="l03622"></a>03622 <span class="comment">    Native type configuration</span>
<a name="l03623"></a>03623 <span class="comment"> */</span>
<a name="l03624"></a>03624 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureAppType(Ejs *ejs);
<a name="l03625"></a>03625 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureArrayType(Ejs *ejs);
<a name="l03626"></a>03626 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureBooleanType(Ejs *ejs);
<a name="l03627"></a>03627 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureByteArrayType(Ejs *ejs);
<a name="l03628"></a>03628 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureConfigType(Ejs *ejs);
<a name="l03629"></a>03629 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureDateType(Ejs *ejs);
<a name="l03630"></a>03630 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureSqliteTypes(Ejs *ejs);
<a name="l03631"></a>03631 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureDebugType(Ejs *ejs);
<a name="l03632"></a>03632 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureErrorType(Ejs *ejs);
<a name="l03633"></a>03633 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureEventType(Ejs *ejs);
<a name="l03634"></a>03634 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureGCType(Ejs *ejs);
<a name="l03635"></a>03635 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureGlobalBlock(Ejs *ejs);
<a name="l03636"></a>03636 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureFileType(Ejs *ejs);
<a name="l03637"></a>03637 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureFileSystemType(Ejs *ejs);
<a name="l03638"></a>03638 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureFunctionType(Ejs *ejs);
<a name="l03639"></a>03639 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureHttpType(Ejs *ejs);
<a name="l03640"></a>03640 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureIteratorType(Ejs *ejs);
<a name="l03641"></a>03641 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureJSONType(Ejs *ejs);
<a name="l03642"></a>03642 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureLoggerType(Ejs *ejs);
<a name="l03643"></a>03643 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureNamespaceType(Ejs *ejs);
<a name="l03644"></a>03644 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureMemoryType(Ejs *ejs);
<a name="l03645"></a>03645 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureMathType(Ejs *ejs);
<a name="l03646"></a>03646 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureNumberType(Ejs *ejs);
<a name="l03647"></a>03647 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureNullType(Ejs *ejs);
<a name="l03648"></a>03648 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureObjectType(Ejs *ejs);
<a name="l03649"></a>03649 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigurePathType(Ejs *ejs);
<a name="l03650"></a>03650 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureReflectType(Ejs *ejs);
<a name="l03651"></a>03651 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureRegExpType(Ejs *ejs);
<a name="l03652"></a>03652 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureStringType(Ejs *ejs);
<a name="l03653"></a>03653 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureSocketType(Ejs *ejs);
<a name="l03654"></a>03654 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureSystemType(Ejs *ejs);
<a name="l03655"></a>03655 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureTimerType(Ejs *ejs);
<a name="l03656"></a>03656 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureTypes(Ejs *ejs);
<a name="l03657"></a>03657 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureUriType(Ejs *ejs);
<a name="l03658"></a>03658 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureVoidType(Ejs *ejs);
<a name="l03659"></a>03659 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureWorkerType(Ejs *ejs);
<a name="l03660"></a>03660 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureXMLType(Ejs *ejs);
<a name="l03661"></a>03661 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsConfigureXMLListType(Ejs *ejs);
<a name="l03662"></a>03662 
<a name="l03663"></a>03663 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCreateCoreNamespaces(Ejs *ejs);
<a name="l03664"></a>03664 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsCopyCoreTypes(Ejs *ejs);
<a name="l03665"></a>03665 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsDefineCoreTypes(Ejs *ejs);
<a name="l03666"></a>03666 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsDefineErrorTypes(Ejs *ejs);
<a name="l03667"></a>03667 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsInheritBaseClassNamespaces(Ejs *ejs, EjsType *type, EjsType *baseType);
<a name="l03668"></a>03668 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsInitializeDefaultHelpers(<a class="code" href="struct_ejs_type_helpers.html" title="Type Helpers.">EjsTypeHelpers</a> *helpers);
<a name="l03669"></a>03669 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsInitializeFunctionHelpers(<a class="code" href="struct_ejs_type_helpers.html" title="Type Helpers.">EjsTypeHelpers</a> *helpers, <span class="keywordtype">int</span> all);
<a name="l03670"></a>03670 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsServiceEvents(Ejs *ejs, <span class="keywordtype">int</span> timeout, <span class="keywordtype">int</span> flags);
<a name="l03671"></a>03671 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsSetSqliteMemCtx(MprThreadLocal *tls, MprCtx ctx);
<a name="l03672"></a>03672 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsSetSqliteTls(MprThreadLocal *tls);
<a name="l03673"></a>03673 
<a name="l03674"></a>03674 <span class="preprocessor">#if BLD_FEATURE_EJS_ALL_IN_ONE || BLD_FEATURE_STATIC</span>
<a name="l03675"></a>03675 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">int</span>      ejs_events_Init(MprCtx ctx);
<a name="l03676"></a>03676 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejs_xml_Init(MprCtx ctx);
<a name="l03677"></a>03677 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejs_io_Init(MprCtx ctx);
<a name="l03678"></a>03678 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejs_sys_Init(MprCtx ctx);
<a name="l03679"></a>03679 <span class="preprocessor">#if BLD_FEATURE_SQLITE</span>
<a name="l03680"></a>03680 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">int</span>      ejs_db_sqlite_Init(MprCtx ctx);
<a name="l03681"></a>03681 <span class="preprocessor">#endif</span>
<a name="l03682"></a>03682 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">int</span>      ejs_web_Init(MprCtx ctx);
<a name="l03683"></a>03683 <span class="preprocessor">#endif</span>
<a name="l03684"></a>03684 <span class="preprocessor"></span>
<a name="l03685"></a>03685 <span class="comment">/* </span>
<a name="l03686"></a>03686 <span class="comment">    Move some ejsWeb.h declarations here so handlers can just include ejs.h whether they are using the</span>
<a name="l03687"></a>03687 <span class="comment">    all-in-one ejs.h or the pure ejs.h</span>
<a name="l03688"></a>03688 <span class="comment"> */</span>
<a name="l03689"></a>03689 <span class="keyword">extern</span> HttpStage *ejsAddWebHandler(Http *http);
<a name="l03690"></a>03690 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsHostHttpServer(HttpConn *conn);
<a name="l03691"></a>03691 
<a name="l03692"></a>03692 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejs_db_sqlite_Init(MprCtx ctx);
<a name="l03693"></a>03693 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejs_web_init(MprCtx ctx);
<a name="l03694"></a>03694 <span class="comment"></span>
<a name="l03695"></a>03695 <span class="comment">/**</span>
<a name="l03696"></a>03696 <span class="comment">    VM Evaluation state. </span>
<a name="l03697"></a>03697 <span class="comment">    The VM Stacks grow forward in memory. A push is done by incrementing first, then storing. ie. *++top = value</span>
<a name="l03698"></a>03698 <span class="comment">    A pop is done by extraction then decrement. ie. value = *top--</span>
<a name="l03699"></a>03699 <span class="comment">    @ingroup EjsVm</span>
<a name="l03700"></a>03700 <span class="comment"> */</span>
<a name="l03701"></a><a class="code" href="struct_ejs_state.html">03701</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_ejs_state.html" title="VM Evaluation state.">EjsState</a> {
<a name="l03702"></a>03702     <span class="keyword">struct </span>EjsFrame     *fp;                <span class="comment">/* Current Frame function pointer */</span>
<a name="l03703"></a>03703     <span class="keyword">struct </span>EjsBlock     *bp;                <span class="comment">/* Current block pointer */</span>
<a name="l03704"></a>03704     <span class="keyword">struct </span>EjsObj       **stack;            <span class="comment">/* Top of stack (points to the last element pushed) */</span>
<a name="l03705"></a>03705     <span class="keyword">struct </span>EjsObj       **stackBase;        <span class="comment">/* Pointer to start of stack mem */</span>
<a name="l03706"></a>03706     <span class="keyword">struct </span><a class="code" href="struct_ejs_state.html" title="VM Evaluation state.">EjsState</a>     *prev;              <span class="comment">/* Previous state */</span>
<a name="l03707"></a>03707     <span class="keyword">struct </span>EjsNamespace *<span class="keyword">internal</span>;          <span class="comment">/* Current internal namespace */</span>
<a name="l03708"></a>03708     <span class="keywordtype">int</span>                 stackSize;          <span class="comment">/* Stack size */</span>
<a name="l03709"></a>03709 } <a class="code" href="struct_ejs_state.html" title="VM Evaluation state.">EjsState</a>;
<a name="l03710"></a>03710 
<a name="l03711"></a>03711 <span class="comment"></span>
<a name="l03712"></a>03712 <span class="comment">/**</span>
<a name="l03713"></a>03713 <span class="comment">    Lookup State.</span>
<a name="l03714"></a>03714 <span class="comment">    @description Location information returned when looking up properties.</span>
<a name="l03715"></a>03715 <span class="comment">    @ingroup EjsVm</span>
<a name="l03716"></a>03716 <span class="comment"> */</span>
<a name="l03717"></a><a class="code" href="struct_ejs_lookup.html">03717</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_ejs_lookup.html" title="Lookup State.">EjsLookup</a> {
<a name="l03718"></a>03718     EjsObj          *obj;                   <span class="comment">/* Final object / Type containing the variable */</span>
<a name="l03719"></a>03719     <span class="keywordtype">int</span>             slotNum;                <span class="comment">/* Final slot in obj containing the variable reference */</span>
<a name="l03720"></a>03720     uint            nthBase;                <span class="comment">/* Property on Nth super type -- count from the object */</span>
<a name="l03721"></a>03721     uint            nthBlock;               <span class="comment">/* Property on Nth block in the scope chain -- count from the end */</span>
<a name="l03722"></a>03722     EjsType         *type;                  <span class="comment">/* Type containing property (if on a prototype obj) */</span>
<a name="l03723"></a>03723 <span class="preprocessor">#if UNUSED || 1</span>
<a name="l03724"></a>03724 <span class="preprocessor"></span>    uint            useThis;                <span class="comment">/* Property accessible via "this." */</span>
<a name="l03725"></a>03725     <span class="comment">//  MOB -- check all these being used</span>
<a name="l03726"></a>03726     uint            instanceProperty;       <span class="comment">/* Property is an instance property */</span>
<a name="l03727"></a>03727     <span class="comment">//  MOB -- check all these being used</span>
<a name="l03728"></a>03728     uint            ownerIsType;            <span class="comment">/* Original object owning the property is a type */</span>
<a name="l03729"></a>03729     <span class="comment">//  MOB -- check all these being used</span>
<a name="l03730"></a>03730     <span class="keyword">struct </span>EjsObj   *originalObj;           <span class="comment">/* Original object used for the search */</span>
<a name="l03731"></a>03731 <span class="preprocessor">#endif</span>
<a name="l03732"></a>03732 <span class="preprocessor"></span>    <span class="keyword">struct </span>EjsObj   *ref;                   <span class="comment">/* Actual property reference */</span>
<a name="l03733"></a>03733     <span class="keyword">struct </span><a class="code" href="struct_ejs_trait.html" title="Property traits.">EjsTrait</a> *trait;                 <span class="comment">/* Property trait describing the property */</span>
<a name="l03734"></a>03734     <span class="keyword">struct </span>EjsName  name;                   <span class="comment">/* Name and namespace used to find the property */</span>
<a name="l03735"></a>03735     <span class="keywordtype">int</span>             bind;                   <span class="comment">/* Whether to bind to this lookup */</span>
<a name="l03736"></a>03736 } <a class="code" href="struct_ejs_lookup.html" title="Lookup State.">EjsLookup</a>;
<a name="l03737"></a>03737 
<a name="l03738"></a>03738 
<a name="l03739"></a>03739 
<a name="l03740"></a>03740 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsSetGeneration(Ejs *ejs, <span class="keywordtype">int</span> generation);
<a name="l03741"></a>03741 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsAnalyzeGlobal(Ejs *ejs);
<a name="l03742"></a>03742 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsCreateGCService(Ejs *ejs);
<a name="l03743"></a>03743 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsDestroyGCService(Ejs *ejs);
<a name="l03744"></a>03744 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsIsTimeForGC(Ejs *ejs, <span class="keywordtype">int</span> timeTillNextEvent);
<a name="l03745"></a>03745 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCollectEverything(Ejs *ejs);
<a name="l03746"></a>03746 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsCollectGarbage(Ejs *ejs, <span class="keywordtype">int</span> gen);
<a name="l03747"></a>03747 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ejsEnableGC(Ejs *ejs, <span class="keywordtype">bool</span> on);
<a name="l03748"></a>03748 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsTraceMark(Ejs *ejs, <span class="keyword">struct</span> EjsObj *vp);
<a name="l03749"></a>03749 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsGracefulDegrade(Ejs *ejs);
<a name="l03750"></a>03750 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsPrintAllocReport(Ejs *ejs);
<a name="l03751"></a>03751 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsMakeEternalPermanent(Ejs *ejs);
<a name="l03752"></a>03752 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsMakePermanent(Ejs *ejs, <span class="keyword">struct</span> EjsObj *vp);
<a name="l03753"></a>03753 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsMakeTransient(Ejs *ejs, <span class="keyword">struct</span> EjsObj *vp);
<a name="l03754"></a>03754 
<a name="l03755"></a>03755 <span class="preprocessor">#if BLD_DEBUG</span>
<a name="l03756"></a>03756 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">void</span>     ejsAddToGcStats(Ejs *ejs, <span class="keyword">struct</span> EjsObj *vp, <span class="keywordtype">int</span> <span class="keywordtype">id</span>);
<a name="l03757"></a>03757 <span class="preprocessor">#else</span>
<a name="l03758"></a>03758 <span class="preprocessor"></span><span class="preprocessor">#define         ejsAddToGcStats(ejs, vp, id)</span>
<a name="l03759"></a>03759 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l03760"></a>03760 <span class="preprocessor"></span><span class="comment"></span>
<a name="l03761"></a>03761 <span class="comment">/**</span>
<a name="l03762"></a>03762 <span class="comment">    Ejscript Service structure</span>
<a name="l03763"></a>03763 <span class="comment">    @description The Ejscript service manages the overall language runtime. It </span>
<a name="l03764"></a>03764 <span class="comment">        is the factory that creates interpreter instances via #ejsCreate.</span>
<a name="l03765"></a>03765 <span class="comment">    @ingroup EjsService</span>
<a name="l03766"></a>03766 <span class="comment"> */</span>
<a name="l03767"></a><a class="code" href="struct_ejs_service.html">03767</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_ejs_service.html" title="Ejscript Service structure.">EjsService</a> {
<a name="l03768"></a>03768     <span class="keyword">struct </span>EjsObj           *(*loadScriptLiteral)(Ejs *ejs, cchar *script, cchar *cache);
<a name="l03769"></a>03769     <span class="keyword">struct </span>EjsObj           *(*loadScriptFile)(Ejs *ejs, cchar *path, cchar *cache);
<a name="l03770"></a>03770     MprHashTable            *nativeModules;
<a name="l03771"></a>03771     Http                    *http;
<a name="l03772"></a>03772 } <a class="code" href="struct_ejs_service.html" title="Ejscript Service structure.">EjsService</a>;
<a name="l03773"></a>03773 
<a name="l03774"></a>03774 <span class="preprocessor">#define ejsGetAllocCtx(ejs) ejs-&gt;currentGeneration</span>
<a name="l03775"></a>03775 <span class="preprocessor"></span>
<a name="l03776"></a>03776 <span class="keyword">extern</span> <a class="code" href="struct_ejs_service.html" title="Ejscript Service structure.">EjsService</a> *ejsGetService(MprCtx ctx);
<a name="l03777"></a>03777 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsInitCompiler(<a class="code" href="struct_ejs_service.html" title="Ejscript Service structure.">EjsService</a> *service);
<a name="l03778"></a>03778 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsAttention(Ejs *ejs);
<a name="l03779"></a>03779 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsClearAttention(Ejs *ejs);
<a name="l03780"></a>03780 <span class="comment"></span>
<a name="l03781"></a>03781 <span class="comment">/**</span>
<a name="l03782"></a>03782 <span class="comment">    Open the Ejscript service</span>
<a name="l03783"></a>03783 <span class="comment">    @description One Ejscript service object is required per application. From this service, interpreters</span>
<a name="l03784"></a>03784 <span class="comment">        can be created.</span>
<a name="l03785"></a>03785 <span class="comment">    @param ctx Any memory context returned by mprAlloc</span>
<a name="l03786"></a>03786 <span class="comment">    @return An ejs service object</span>
<a name="l03787"></a>03787 <span class="comment">    @ingroup Ejs</span>
<a name="l03788"></a>03788 <span class="comment"> */</span>
<a name="l03789"></a>03789 <span class="keyword">extern</span> <a class="code" href="struct_ejs_service.html" title="Ejscript Service structure.">EjsService</a> *<a class="code" href="group___ejs.html#g78fb0ad5d9f4998a0b64914370aacd24" title="Open the Ejscript service.">ejsCreateService</a>(MprCtx ctx);
<a name="l03790"></a>03790 <span class="comment"></span>
<a name="l03791"></a>03791 <span class="comment">/**</span>
<a name="l03792"></a>03792 <span class="comment">    Create an ejs virtual machine </span>
<a name="l03793"></a>03793 <span class="comment">    @description Create a virtual machine interpreter object to evalute Ejscript programs. Ejscript supports multiple </span>
<a name="l03794"></a>03794 <span class="comment">        interpreters. One interpreter can be designated as a master interpreter and then it can be cloned by supplying </span>
<a name="l03795"></a>03795 <span class="comment">        the master interpreter to this call. A master interpreter provides the standard system types and clone interpreters </span>
<a name="l03796"></a>03796 <span class="comment">        can quickly be created an utilize the master interpreter's types. This saves memory and speeds initialization.</span>
<a name="l03797"></a>03797 <span class="comment">    @param ctx Any memory context returned by mprAlloc</span>
<a name="l03798"></a>03798 <span class="comment">    @param master Optional master interpreter to clone.</span>
<a name="l03799"></a>03799 <span class="comment">    @param search Module search path to use. Set to NULL for the default search path.</span>
<a name="l03800"></a>03800 <span class="comment">    @param require Optional list of required modules to load. If NULL, the following modules will be loaded:</span>
<a name="l03801"></a>03801 <span class="comment">        ejs, ejs.io, ejs.events, ejs.xml, ejs.sys and ejs.unix.</span>
<a name="l03802"></a>03802 <span class="comment">    @param argc Count of command line argumements in argv</span>
<a name="l03803"></a>03803 <span class="comment">    @param argv Command line arguments</span>
<a name="l03804"></a>03804 <span class="comment">    @param flags Optional flags to modify the interpreter behavior. Valid flags are:</span>
<a name="l03805"></a>03805 <span class="comment">        @li    EJS_FLAG_COMPILER       - Interpreter will compile code from source</span>
<a name="l03806"></a>03806 <span class="comment">        @li    EJS_FLAG_NO_EXE         - Don't execute any code. Just compile.</span>
<a name="l03807"></a>03807 <span class="comment">        @li    EJS_FLAG_MASTER         - Create a master interpreter</span>
<a name="l03808"></a>03808 <span class="comment">        @li    EJS_FLAG_DOC            - Load documentation from modules</span>
<a name="l03809"></a>03809 <span class="comment">        @li    EJS_FLAG_NOEXIT         - App should service events and not exit unless explicitly instructed</span>
<a name="l03810"></a>03810 <span class="comment">    @return A new interpreter</span>
<a name="l03811"></a>03811 <span class="comment">    @ingroup Ejs</span>
<a name="l03812"></a>03812 <span class="comment"> */</span>
<a name="l03813"></a>03813 <span class="keyword">extern</span> Ejs *<a class="code" href="group___ejs.html#ga00af6ecbf1d316061aa7524935ac22f" title="Create an ejs virtual machine.">ejsCreateVm</a>(MprCtx ctx, Ejs *master, cchar *search, MprList *require, <span class="keywordtype">int</span> argc, cchar **argv, <span class="keywordtype">int</span> flags);
<a name="l03814"></a>03814 <span class="comment"></span>
<a name="l03815"></a>03815 <span class="comment">/**</span>
<a name="l03816"></a>03816 <span class="comment">    Create a search path array. This can be used in ejsCreateVm.</span>
<a name="l03817"></a>03817 <span class="comment">    @description Create and array of search paths.</span>
<a name="l03818"></a>03818 <span class="comment">    @param ejs Ejs interpreter</span>
<a name="l03819"></a>03819 <span class="comment">    @param searchPath Search path string. This is a colon (or semicolon on Windows) separated string of directories.</span>
<a name="l03820"></a>03820 <span class="comment">    @return An array of search paths</span>
<a name="l03821"></a>03821 <span class="comment">    @ingroup Ejs</span>
<a name="l03822"></a>03822 <span class="comment"> */</span>
<a name="l03823"></a>03823 <span class="keyword">struct </span>EjsArray *<a class="code" href="group___ejs.html#g2074536c4ebc6f82689d783ec5cde5bf" title="Create a search path array.">ejsCreateSearchPath</a>(Ejs *ejs, cchar *searchPath);
<a name="l03824"></a>03824 <span class="comment"></span>
<a name="l03825"></a>03825 <span class="comment">/**</span>
<a name="l03826"></a>03826 <span class="comment">    Set the module search path</span>
<a name="l03827"></a>03827 <span class="comment">    @description Set the ejs module search path. The search path is by default set to the value of the EJSPATH</span>
<a name="l03828"></a>03828 <span class="comment">        environment directory. Ejsript will search for modules by name. The search strategy is:</span>
<a name="l03829"></a>03829 <span class="comment">        Given a name "a.b.c", scan for:</span>
<a name="l03830"></a>03830 <span class="comment">        @li File named a.b.c</span>
<a name="l03831"></a>03831 <span class="comment">        @li File named a/b/c</span>
<a name="l03832"></a>03832 <span class="comment">        @li File named a.b.c in EJSPATH</span>
<a name="l03833"></a>03833 <span class="comment">        @li File named a/b/c in EJSPATH</span>
<a name="l03834"></a>03834 <span class="comment">        @li File named c in EJSPATH</span>
<a name="l03835"></a>03835 <span class="comment"></span>
<a name="l03836"></a>03836 <span class="comment">    Ejs will search for files with no extension and also search for modules with a ".mod" extension. If there is</span>
<a name="l03837"></a>03837 <span class="comment">    a shared library of the same name with a shared library extension (.so, .dll, .dylib) and the module requires </span>
<a name="l03838"></a>03838 <span class="comment">    native code, then the shared library will also be loaded.</span>
<a name="l03839"></a>03839 <span class="comment">    @param ejs Ejs interpreter</span>
<a name="l03840"></a>03840 <span class="comment">    @param search Array of search paths</span>
<a name="l03841"></a>03841 <span class="comment">    @ingroup Ejs</span>
<a name="l03842"></a>03842 <span class="comment"> */</span>
<a name="l03843"></a>03843 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="group___ejs.html#gce4f9f6ccb7c748e5a4a03f4378eca7d" title="Set the module search path.">ejsSetSearchPath</a>(Ejs *ejs, <span class="keyword">struct</span> EjsArray *search);
<a name="l03844"></a>03844 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsInitSearchPath(Ejs *ejs);
<a name="l03845"></a>03845 <span class="comment"></span>
<a name="l03846"></a>03846 <span class="comment">/**</span>
<a name="l03847"></a>03847 <span class="comment">    Evaluate a file</span>
<a name="l03848"></a>03848 <span class="comment">    @description Evaluate a file containing an Ejscript. This requires linking with the Ejscript compiler library (libec). </span>
<a name="l03849"></a>03849 <span class="comment">    @param path Filename of the script to evaluate</span>
<a name="l03850"></a>03850 <span class="comment">    @return Return zero on success. Otherwise return a negative Mpr error code.</span>
<a name="l03851"></a>03851 <span class="comment">    @ingroup Ejs</span>
<a name="l03852"></a>03852 <span class="comment"> */</span>
<a name="l03853"></a>03853 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs.html#g2dd387ab6e232ecbe44b901cd5b01e58" title="Evaluate a file.">ejsEvalFile</a>(cchar *path);
<a name="l03854"></a>03854 
<a name="l03855"></a>03855 <span class="comment">/*</span>
<a name="l03856"></a>03856 <span class="comment">    Flags for LoadScript and compiling</span>
<a name="l03857"></a>03857 <span class="comment"> */</span>
<a name="l03858"></a>03858 <span class="preprocessor">#define EC_FLAGS_BIND            0x1                    </span><span class="comment">/* Bind global references and type/object properties */</span>
<a name="l03859"></a>03859 <span class="preprocessor">#define EC_FLAGS_DEBUG           0x2                    </span><span class="comment">/* Generate symbolic debugging information */</span>
<a name="l03860"></a>03860 <span class="preprocessor">#define EC_FLAGS_MERGE           0x8                    </span><span class="comment">/* Merge all output onto one output file */</span>
<a name="l03861"></a>03861 <span class="preprocessor">#define EC_FLAGS_NO_OUT          0x10                   </span><span class="comment">/* Don't generate any output file */</span>
<a name="l03862"></a>03862 <span class="preprocessor">#define EC_FLAGS_PARSE_ONLY      0x20                   </span><span class="comment">/* Just parse source. Don't generate code */</span>
<a name="l03863"></a>03863 <span class="preprocessor">#define EC_FLAGS_THROW           0x40                   </span><span class="comment">/* Throw errors when compiling. Used for eval() */</span>
<a name="l03864"></a>03864 <span class="preprocessor">#define EC_FLAGS_VISIBLE         0x80                   </span><span class="comment">/* Make global vars visible to all */</span>
<a name="l03865"></a>03865 
<a name="l03866"></a>03866 <span class="comment">//  TODO - DOC</span>
<a name="l03867"></a>03867 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsLoadScriptFile(Ejs *ejs, cchar *path, cchar *cache, <span class="keywordtype">int</span> flags);
<a name="l03868"></a>03868 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsLoadScriptLiteral(Ejs *ejs, cchar *script, cchar *cache, <span class="keywordtype">int</span> flags);
<a name="l03869"></a>03869 <span class="comment"></span>
<a name="l03870"></a>03870 <span class="comment">/**</span>
<a name="l03871"></a>03871 <span class="comment">    Evaluate a module</span>
<a name="l03872"></a>03872 <span class="comment">    @description Evaluate a module containing compiled Ejscript.</span>
<a name="l03873"></a>03873 <span class="comment">    @param path Filename of the module to evaluate.</span>
<a name="l03874"></a>03874 <span class="comment">    @return Return zero on success. Otherwise return a negative Mpr error code.</span>
<a name="l03875"></a>03875 <span class="comment">    @ingroup Ejs</span>
<a name="l03876"></a>03876 <span class="comment"> */</span>
<a name="l03877"></a>03877 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs.html#g9ab6a1f6c32ecbadc72d1f09495b85b8" title="Evaluate a module.">ejsEvalModule</a>(cchar *path);
<a name="l03878"></a>03878 <span class="comment"></span>
<a name="l03879"></a>03879 <span class="comment">/**</span>
<a name="l03880"></a>03880 <span class="comment">    Evaluate a script</span>
<a name="l03881"></a>03881 <span class="comment">    @description Evaluate a script. This requires linking with the Ejscript compiler library (libec). </span>
<a name="l03882"></a>03882 <span class="comment">    @param script Script to evaluate</span>
<a name="l03883"></a>03883 <span class="comment">    @return Return zero on success. Otherwise return a negative Mpr error code.</span>
<a name="l03884"></a>03884 <span class="comment">    @ingroup Ejs</span>
<a name="l03885"></a>03885 <span class="comment"> */</span>
<a name="l03886"></a>03886 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group___ejs.html#gc9d73946c6d81f299103daa26fcbc7f1" title="Evaluate a script.">ejsEvalScript</a>(cchar *script);
<a name="l03887"></a>03887 <span class="comment"></span>
<a name="l03888"></a>03888 <span class="comment">/**</span>
<a name="l03889"></a>03889 <span class="comment">    Instruct the interpreter to exit.</span>
<a name="l03890"></a>03890 <span class="comment">    @description This will instruct the interpreter to cease interpreting any further script code.</span>
<a name="l03891"></a>03891 <span class="comment">    @param ejs Interpeter object returned from #ejsCreate</span>
<a name="l03892"></a>03892 <span class="comment">    @param status Reserved and ignored</span>
<a name="l03893"></a>03893 <span class="comment">    @ingroup Ejs</span>
<a name="l03894"></a>03894 <span class="comment"> */</span>
<a name="l03895"></a>03895 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="group___ejs.html#g913f7898999e35964f1e93783808bda5" title="Instruct the interpreter to exit.">ejsExit</a>(Ejs *ejs, <span class="keywordtype">int</span> status);
<a name="l03896"></a>03896 <span class="comment"></span>
<a name="l03897"></a>03897 <span class="comment">/**</span>
<a name="l03898"></a>03898 <span class="comment">    Get the hosting handle</span>
<a name="l03899"></a>03899 <span class="comment">    @description The interpreter can store a hosting handle. This is typically a web server object if hosted inside</span>
<a name="l03900"></a>03900 <span class="comment">        a web server</span>
<a name="l03901"></a>03901 <span class="comment">    @param ejs Interpeter object returned from #ejsCreate</span>
<a name="l03902"></a>03902 <span class="comment">    @return Hosting handle</span>
<a name="l03903"></a>03903 <span class="comment">    @ingroup Ejs</span>
<a name="l03904"></a>03904 <span class="comment"> */</span>
<a name="l03905"></a>03905 <span class="keyword">extern</span> <span class="keywordtype">void</span> *<a class="code" href="group___ejs.html#g219502088780c6399a9a49241c477dbe" title="Get the hosting handle.">ejsGetHandle</a>(Ejs *ejs);
<a name="l03906"></a>03906 <span class="comment"></span>
<a name="l03907"></a>03907 <span class="comment">/**</span>
<a name="l03908"></a>03908 <span class="comment">    Run a script</span>
<a name="l03909"></a>03909 <span class="comment">    @description Run a script that has previously ben compiled by ecCompile</span>
<a name="l03910"></a>03910 <span class="comment">    @param ejs Interpeter object returned from #ejsCreate</span>
<a name="l03911"></a>03911 <span class="comment">    @return Zero if successful, otherwise a non-zero Mpr error code.</span>
<a name="l03912"></a>03912 <span class="comment"> */</span>
<a name="l03913"></a>03913 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsRun(Ejs *ejs);
<a name="l03914"></a>03914 <span class="comment"></span>
<a name="l03915"></a>03915 <span class="comment">/**</span>
<a name="l03916"></a>03916 <span class="comment">    Throw an exception</span>
<a name="l03917"></a>03917 <span class="comment">    @description Throw an exception object </span>
<a name="l03918"></a>03918 <span class="comment">    @param ejs Interpeter object returned from #ejsCreate</span>
<a name="l03919"></a>03919 <span class="comment">    @param error Exception argument object.</span>
<a name="l03920"></a>03920 <span class="comment">    @return The exception argument for chaining.</span>
<a name="l03921"></a>03921 <span class="comment">    @ingroup Ejs</span>
<a name="l03922"></a>03922 <span class="comment"> */</span>
<a name="l03923"></a>03923 <span class="keyword">extern</span> EjsObj *<a class="code" href="group___ejs.html#g2ff2fd4dcddc377935aab9aa47936907" title="Throw an exception.">ejsThrowException</a>(Ejs *ejs, EjsObj *error);
<a name="l03924"></a>03924 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsClearException(Ejs *ejs);
<a name="l03925"></a>03925 <span class="comment"></span>
<a name="l03926"></a>03926 <span class="comment">/**</span>
<a name="l03927"></a>03927 <span class="comment">    Report an error message using the MprLog error channel</span>
<a name="l03928"></a>03928 <span class="comment">    @description This will emit an error message of the format:</span>
<a name="l03929"></a>03929 <span class="comment">        @li program:line:errorCode:SEVERITY: message</span>
<a name="l03930"></a>03930 <span class="comment">    @param ejs Interpeter object returned from #ejsCreate</span>
<a name="l03931"></a>03931 <span class="comment">    @param fmt Is an alternate printf style format to emit if the interpreter has no valid error message.</span>
<a name="l03932"></a>03932 <span class="comment">    @param ... Arguments for fmt</span>
<a name="l03933"></a>03933 <span class="comment">    @ingroup Ejs</span>
<a name="l03934"></a>03934 <span class="comment"> */</span>
<a name="l03935"></a>03935 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="group___ejs.html#ga8b22395b62585cbd8edabfea237e48d" title="Report an error message using the MprLog error channel.">ejsReportError</a>(Ejs *ejs, <span class="keywordtype">char</span> *fmt, ...);
<a name="l03936"></a>03936 
<a name="l03937"></a>03937 <span class="keyword">extern</span> EjsObj *ejsCastOperands(Ejs *ejs, EjsObj *lhs, <span class="keywordtype">int</span> opcode,  EjsObj *rhs);
<a name="l03938"></a>03938 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsCheckModuleLoaded(Ejs *ejs, cchar *name);
<a name="l03939"></a>03939 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsClearExiting(Ejs *ejs);
<a name="l03940"></a>03940 <span class="keyword">extern</span> EjsObj *ejsCreateException(Ejs *ejs, <span class="keywordtype">int</span> slot, cchar *fmt, va_list fmtArgs);
<a name="l03941"></a>03941 <span class="keyword">extern</span> MprList *ejsGetModuleList(Ejs *ejs);
<a name="l03942"></a>03942 <span class="keyword">extern</span> EjsObj *ejsGetVarByName(Ejs *ejs, EjsObj *vp, EjsName *name, <a class="code" href="struct_ejs_lookup.html" title="Lookup State.">EjsLookup</a> *lookup);
<a name="l03943"></a>03943 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsInitStack(Ejs *ejs);
<a name="l03944"></a>03944 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsLog(Ejs *ejs, cchar *fmt, ...);
<a name="l03945"></a>03945 
<a name="l03946"></a>03946 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsLookupVar(Ejs *ejs, EjsObj *vp, EjsName *name, <a class="code" href="struct_ejs_lookup.html" title="Lookup State.">EjsLookup</a> *lookup);
<a name="l03947"></a>03947 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsLookupVarWithNamespaces(Ejs *ejs, EjsObj *vp, EjsName *name, <a class="code" href="struct_ejs_lookup.html" title="Lookup State.">EjsLookup</a> *lookup);
<a name="l03948"></a>03948 
<a name="l03949"></a>03949 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsLookupScope(Ejs *ejs, EjsName *name, <a class="code" href="struct_ejs_lookup.html" title="Lookup State.">EjsLookup</a> *lookup);
<a name="l03950"></a>03950 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsMemoryFailure(MprCtx ctx, int64 size, int64 total, <span class="keywordtype">bool</span> granted);
<a name="l03951"></a>03951 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsRunProgram(Ejs *ejs, cchar *className, cchar *methodName);
<a name="l03952"></a>03952 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsSetHandle(Ejs *ejs, <span class="keywordtype">void</span> *handle);
<a name="l03953"></a>03953 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsShowCurrentScope(Ejs *ejs);
<a name="l03954"></a>03954 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsShowStack(Ejs *ejs, EjsFunction *fp);
<a name="l03955"></a>03955 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsShowBlockScope(Ejs *ejs, EjsBlock *block);
<a name="l03956"></a>03956 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsStartMprLogging(Mpr *mpr, <span class="keywordtype">char</span> *logSpec);
<a name="l03957"></a>03957 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsCloneObjectHelpers(Ejs *ejs, EjsType *type);
<a name="l03958"></a>03958 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsCloneBlockHelpers(Ejs *ejs, EjsType *type);
<a name="l03959"></a>03959 <span class="keyword">extern</span> <span class="keywordtype">int</span>  ejsParseModuleVersion(cchar *name);
<a name="l03960"></a>03960 
<a name="l03961"></a>03961 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsLockVm(Ejs *ejs);
<a name="l03962"></a>03962 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsUnlockVm(Ejs *ejs);
<a name="l03963"></a>03963 
<a name="l03964"></a>03964 
<a name="l03965"></a>03965 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l03966"></a>03966 <span class="preprocessor"></span>}
<a name="l03967"></a>03967 <span class="preprocessor">#endif</span>
<a name="l03968"></a>03968 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* _h_EJS_CORE */</span>
<a name="l03969"></a>03969 
<a name="l03970"></a>03970 <span class="comment">/*</span>
<a name="l03971"></a>03971 <span class="comment">    @copy   default</span>
<a name="l03972"></a>03972 <span class="comment"> </span>
<a name="l03973"></a>03973 <span class="comment">    Copyright (c) Embedthis Software LLC, 2003-2010. All Rights Reserved.</span>
<a name="l03974"></a>03974 <span class="comment">    Copyright (c) Michael O'Brien, 1993-2010. All Rights Reserved.</span>
<a name="l03975"></a>03975 <span class="comment"></span>
<a name="l03976"></a>03976 <span class="comment">    This software is distributed under commercial and open source licenses.</span>
<a name="l03977"></a>03977 <span class="comment">    You may use the GPL open source license described below or you may acquire</span>
<a name="l03978"></a>03978 <span class="comment">    a commercial license from Embedthis Software. You agree to be fully bound</span>
<a name="l03979"></a>03979 <span class="comment">    by the terms of either license. Consult the LICENSE.TXT distributed with</span>
<a name="l03980"></a>03980 <span class="comment">    this software for full details.</span>
<a name="l03981"></a>03981 <span class="comment"></span>
<a name="l03982"></a>03982 <span class="comment">    This software is open source; you can redistribute it and/or modify it</span>
<a name="l03983"></a>03983 <span class="comment">    under the terms of the GNU General Public License as published by the</span>
<a name="l03984"></a>03984 <span class="comment">    Free Software Foundation; either version 2 of the License, or (at your</span>
<a name="l03985"></a>03985 <span class="comment">    option) any later version. See the GNU General Public License for more</span>
<a name="l03986"></a>03986 <span class="comment">    details at: http://www.embedthis.com/downloads/gplLicense.html</span>
<a name="l03987"></a>03987 <span class="comment"></span>
<a name="l03988"></a>03988 <span class="comment">    This program is distributed WITHOUT ANY WARRANTY; without even the</span>
<a name="l03989"></a>03989 <span class="comment">    implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<a name="l03990"></a>03990 <span class="comment"></span>
<a name="l03991"></a>03991 <span class="comment">    This GPL license does NOT permit incorporating this software into</span>
<a name="l03992"></a>03992 <span class="comment">    proprietary programs. If you are unable to comply with the GPL, you must</span>
<a name="l03993"></a>03993 <span class="comment">    acquire a commercial license to use this software. Commercial licenses</span>
<a name="l03994"></a>03994 <span class="comment">    for this software and support services are available from Embedthis</span>
<a name="l03995"></a>03995 <span class="comment">    Software at http://www.embedthis.com</span>
<a name="l03996"></a>03996 <span class="comment"></span>
<a name="l03997"></a>03997 <span class="comment">    Local variables:
    tab-width: 4
    c-basic-offset: 4
    End:
    vim: sw=8 ts=8 expandtab

    @end</span>
<a name="l03998"></a>03998 <span class="comment"> */</span>
<a name="l03999"></a>03999 
<a name="l04000"></a>04000 <span class="comment">/************************************************************************/</span>
<a name="l04001"></a>04001 <span class="comment">/*</span>
<a name="l04002"></a>04002 <span class="comment"> *  End of file "../../src/include/ejsCore.h"</span>
<a name="l04003"></a>04003 <span class="comment"> */</span>
<a name="l04004"></a>04004 <span class="comment">/************************************************************************/</span>
<a name="l04005"></a>04005 
<a name="l04006"></a>04006 
<a name="l04007"></a>04007 
<a name="l04008"></a>04008 <span class="comment">/************************************************************************/</span>
<a name="l04009"></a>04009 <span class="comment">/*</span>
<a name="l04010"></a>04010 <span class="comment"> *  Start of file "../../src/include/ejsModule.h"</span>
<a name="l04011"></a>04011 <span class="comment"> */</span>
<a name="l04012"></a>04012 <span class="comment">/************************************************************************/</span>
<a name="l04013"></a>04013 
<a name="l04014"></a>04014 <span class="comment">/*</span>
<a name="l04015"></a>04015 <span class="comment">    ejsModule.h - Module file format.</span>
<a name="l04016"></a>04016 <span class="comment"></span>
<a name="l04017"></a>04017 <span class="comment">    Copyright (c) All Rights Reserved. See details at the end of the file.</span>
<a name="l04018"></a>04018 <span class="comment"> */</span>
<a name="l04019"></a>04019 
<a name="l04020"></a>04020 
<a name="l04021"></a>04021 <span class="preprocessor">#ifndef _h_EJS_MODULE</span>
<a name="l04022"></a>04022 <span class="preprocessor"></span><span class="preprocessor">#define _h_EJS_MODULE 1</span>
<a name="l04023"></a>04023 <span class="preprocessor"></span>
<a name="l04024"></a>04024 
<a name="l04025"></a>04025 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l04026"></a>04026 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
<a name="l04027"></a>04027 <span class="preprocessor">#endif</span>
<a name="l04028"></a>04028 <span class="preprocessor"></span>
<a name="l04029"></a>04029 <span class="comment">/*</span>
<a name="l04030"></a>04030 <span class="comment">    A module file may contain multiple logical modules.</span>
<a name="l04031"></a>04031 <span class="comment"></span>
<a name="l04032"></a>04032 <span class="comment">    Module File Format and Layout:</span>
<a name="l04033"></a>04033 <span class="comment"></span>
<a name="l04034"></a>04034 <span class="comment">    (N) Numbers are 1-3 little-endian encoded bytes using the 0x80 as the continuation character</span>
<a name="l04035"></a>04035 <span class="comment">    (S) Strings are pointers into the constant pool encoded as number offsets. Strings are UTF-8.</span>
<a name="l04036"></a>04036 <span class="comment">    (T) Types are encoded and ored with the type encoding masks below. Types are either: untyped, </span>
<a name="l04037"></a>04037 <span class="comment">        unresolved or primitive (builtin). The relevant mask is ored into the lower 2 bits. Slot numbers and</span>
<a name="l04038"></a>04038 <span class="comment">        name tokens are shifted up 2 bits. Zero means untyped.</span>
<a name="l04039"></a>04039 <span class="comment"></span>
<a name="l04040"></a>04040 <span class="comment">    ModuleHeader {</span>
<a name="l04041"></a>04041 <span class="comment">        short       magic</span>
<a name="l04042"></a>04042 <span class="comment">        int         fileVersion</span>
<a name="l04043"></a>04043 <span class="comment">        int         version</span>
<a name="l04044"></a>04044 <span class="comment">        int         flags</span>
<a name="l04045"></a>04045 <span class="comment">    }</span>
<a name="l04046"></a>04046 <span class="comment"></span>
<a name="l04047"></a>04047 <span class="comment">    Module {</span>
<a name="l04048"></a>04048 <span class="comment">        byte        section</span>
<a name="l04049"></a>04049 <span class="comment">        string      name</span>
<a name="l04050"></a>04050 <span class="comment">        number      version</span>
<a name="l04051"></a>04051 <span class="comment">        number      checksum</span>
<a name="l04052"></a>04052 <span class="comment">        number      constantPoolLength</span>
<a name="l04053"></a>04053 <span class="comment">        block       constantPool</span>
<a name="l04054"></a>04054 <span class="comment">    }</span>
<a name="l04055"></a>04055 <span class="comment"></span>
<a name="l04056"></a>04056 <span class="comment">    Dependencies {</span>
<a name="l04057"></a>04057 <span class="comment">        byte        section</span>
<a name="l04058"></a>04058 <span class="comment">        string      moduleName</span>
<a name="l04059"></a>04059 <span class="comment">        number      minVersion</span>
<a name="l04060"></a>04060 <span class="comment">        number      maxVersion</span>
<a name="l04061"></a>04061 <span class="comment">        number      checksum</span>
<a name="l04062"></a>04062 <span class="comment">        byte        flags</span>
<a name="l04063"></a>04063 <span class="comment">    }</span>
<a name="l04064"></a>04064 <span class="comment"></span>
<a name="l04065"></a>04065 <span class="comment">    Type {</span>
<a name="l04066"></a>04066 <span class="comment">        byte        section</span>
<a name="l04067"></a>04067 <span class="comment">        string      typeName</span>
<a name="l04068"></a>04068 <span class="comment">        string      namespace</span>
<a name="l04069"></a>04069 <span class="comment">        number      attributes</span>
<a name="l04070"></a>04070 <span class="comment">        number      slot</span>
<a name="l04071"></a>04071 <span class="comment">        type        baseType</span>
<a name="l04072"></a>04072 <span class="comment">        number      numStaticProperties</span>
<a name="l04073"></a>04073 <span class="comment">        number      numInstanceProperties</span>
<a name="l04074"></a>04074 <span class="comment">        number      numInterfaces</span>
<a name="l04075"></a>04075 <span class="comment">        type        Interfaces ...</span>
<a name="l04076"></a>04076 <span class="comment">        ...</span>
<a name="l04077"></a>04077 <span class="comment">    }</span>
<a name="l04078"></a>04078 <span class="comment"></span>
<a name="l04079"></a>04079 <span class="comment">    Property {</span>
<a name="l04080"></a>04080 <span class="comment">        byte        section</span>
<a name="l04081"></a>04081 <span class="comment">        string      name</span>
<a name="l04082"></a>04082 <span class="comment">        string      namespace</span>
<a name="l04083"></a>04083 <span class="comment">        number      attributes</span>
<a name="l04084"></a>04084 <span class="comment">        number      slot</span>
<a name="l04085"></a>04085 <span class="comment">        type        property type</span>
<a name="l04086"></a>04086 <span class="comment">    }</span>
<a name="l04087"></a>04087 <span class="comment"></span>
<a name="l04088"></a>04088 <span class="comment">    Function {</span>
<a name="l04089"></a>04089 <span class="comment">        byte        section</span>
<a name="l04090"></a>04090 <span class="comment">        string      name</span>
<a name="l04091"></a>04091 <span class="comment">        string      namespace</span>
<a name="l04092"></a>04092 <span class="comment">        number      nextSlotForSetter</span>
<a name="l04093"></a>04093 <span class="comment">        number      attributes</span>
<a name="l04094"></a>04094 <span class="comment">        byte        languageMode</span>
<a name="l04095"></a>04095 <span class="comment">        type        returnType</span>
<a name="l04096"></a>04096 <span class="comment">        number      slot</span>
<a name="l04097"></a>04097 <span class="comment">        number      argCount</span>
<a name="l04098"></a>04098 <span class="comment">        number      defaultArgCount</span>
<a name="l04099"></a>04099 <span class="comment">        number      localCount</span>
<a name="l04100"></a>04100 <span class="comment">        number      exceptionCount</span>
<a name="l04101"></a>04101 <span class="comment">        number      codeLength</span>
<a name="l04102"></a>04102 <span class="comment">        block       code        </span>
<a name="l04103"></a>04103 <span class="comment">    }</span>
<a name="l04104"></a>04104 <span class="comment"></span>
<a name="l04105"></a>04105 <span class="comment">    Exception {</span>
<a name="l04106"></a>04106 <span class="comment">        byte        section</span>
<a name="l04107"></a>04107 <span class="comment">        byte        flags</span>
<a name="l04108"></a>04108 <span class="comment">        number      tryStartOffset</span>
<a name="l04109"></a>04109 <span class="comment">        number      tryEndOffset</span>
<a name="l04110"></a>04110 <span class="comment">        number      handlerStartOffset</span>
<a name="l04111"></a>04111 <span class="comment">        number      handlerEndOffset</span>
<a name="l04112"></a>04112 <span class="comment">        number      numOpenBlocks</span>
<a name="l04113"></a>04113 <span class="comment">        type        catchType</span>
<a name="l04114"></a>04114 <span class="comment">    }</span>
<a name="l04115"></a>04115 <span class="comment"></span>
<a name="l04116"></a>04116 <span class="comment">    Block {</span>
<a name="l04117"></a>04117 <span class="comment">        byte        section</span>
<a name="l04118"></a>04118 <span class="comment">        string      name</span>
<a name="l04119"></a>04119 <span class="comment">        number      slot</span>
<a name="l04120"></a>04120 <span class="comment">        number      propCount</span>
<a name="l04121"></a>04121 <span class="comment">    }</span>
<a name="l04122"></a>04122 <span class="comment"></span>
<a name="l04123"></a>04123 <span class="comment">    Documentation {</span>
<a name="l04124"></a>04124 <span class="comment">        byte        section</span>
<a name="l04125"></a>04125 <span class="comment">        string      text</span>
<a name="l04126"></a>04126 <span class="comment">    }</span>
<a name="l04127"></a>04127 <span class="comment"> */</span>
<a name="l04128"></a>04128 
<a name="l04129"></a>04129 <span class="comment">/*</span>
<a name="l04130"></a>04130 <span class="comment">    Type encoding masks</span>
<a name="l04131"></a>04131 <span class="comment"> */</span>
<a name="l04132"></a>04132 <span class="preprocessor">#define EJS_ENCODE_GLOBAL_NOREF         0x0</span>
<a name="l04133"></a>04133 <span class="preprocessor"></span><span class="preprocessor">#define EJS_ENCODE_GLOBAL_NAME          0x1</span>
<a name="l04134"></a>04134 <span class="preprocessor"></span><span class="preprocessor">#define EJS_ENCODE_GLOBAL_SLOT          0x2</span>
<a name="l04135"></a>04135 <span class="preprocessor"></span><span class="preprocessor">#define EJS_ENCODE_GLOBAL_MASK          0x3</span>
<a name="l04136"></a>04136 <span class="preprocessor"></span>
<a name="l04137"></a>04137 <span class="comment">/*</span>
<a name="l04138"></a>04138 <span class="comment">    Fixup kinds</span>
<a name="l04139"></a>04139 <span class="comment"> */</span>
<a name="l04140"></a>04140 <span class="preprocessor">#define EJS_FIXUP_BASE_TYPE             1</span>
<a name="l04141"></a>04141 <span class="preprocessor"></span><span class="preprocessor">#define EJS_FIXUP_INTERFACE_TYPE        2</span>
<a name="l04142"></a>04142 <span class="preprocessor"></span><span class="preprocessor">#define EJS_FIXUP_RETURN_TYPE           3</span>
<a name="l04143"></a>04143 <span class="preprocessor"></span><span class="preprocessor">#define EJS_FIXUP_TYPE_PROPERTY         4</span>
<a name="l04144"></a>04144 <span class="preprocessor"></span><span class="preprocessor">#define EJS_FIXUP_INSTANCE_PROPERTY     5</span>
<a name="l04145"></a>04145 <span class="preprocessor"></span><span class="preprocessor">#define EJS_FIXUP_LOCAL                 6</span>
<a name="l04146"></a>04146 <span class="preprocessor"></span><span class="preprocessor">#define EJS_FIXUP_EXCEPTION             7</span>
<a name="l04147"></a>04147 <span class="preprocessor"></span>
<a name="l04148"></a>04148 <span class="comment">/*</span>
<a name="l04149"></a>04149 <span class="comment">    Number encoding uses one bit per byte plus a sign bit in the first byte</span>
<a name="l04150"></a>04150 <span class="comment"> */</span> 
<a name="l04151"></a>04151 <span class="preprocessor">#define EJS_ENCODE_MAX_WORD             0x07FFFFFF</span>
<a name="l04152"></a>04152 <span class="preprocessor"></span>
<a name="l04153"></a>04153 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsTypeFixup
<a name="l04154"></a>04154 {
<a name="l04155"></a>04155     <span class="keywordtype">int</span>              kind;                       <span class="comment">/* Kind of fixup */</span>
<a name="l04156"></a>04156     <span class="keywordtype">int</span>              slotNum;                    <span class="comment">/* Slot of target */</span>
<a name="l04157"></a>04157     EjsObj           *target;                    <span class="comment">/* Target to fixup */</span>
<a name="l04158"></a>04158     EjsName          typeName;                   <span class="comment">/* Type name */</span>
<a name="l04159"></a>04159     <span class="keywordtype">int</span>              typeSlotNum;                <span class="comment">/* Type slot number */</span>
<a name="l04160"></a>04160 } EjsTypeFixup;
<a name="l04161"></a>04161 
<a name="l04162"></a>04162 
<a name="l04163"></a>04163 <span class="preprocessor">#define EJS_MODULE_MAGIC        0xC7DA</span>
<a name="l04164"></a>04164 <span class="preprocessor"></span>
<a name="l04165"></a>04165 <span class="comment">/*</span>
<a name="l04166"></a>04166 <span class="comment">    Module file format version</span>
<a name="l04167"></a>04167 <span class="comment"> */</span>
<a name="l04168"></a>04168 <span class="preprocessor">#define EJS_MODULE_VERSION      3</span>
<a name="l04169"></a>04169 <span class="preprocessor"></span><span class="preprocessor">#define EJS_VERSION_FACTOR      1000</span>
<a name="l04170"></a>04170 <span class="preprocessor"></span>
<a name="l04171"></a>04171 <span class="comment">/*</span>
<a name="l04172"></a>04172 <span class="comment">    Module content version</span>
<a name="l04173"></a>04173 <span class="comment"> */</span>
<a name="l04174"></a>04174 <span class="preprocessor">#define EJS_COMPAT_VERSION(v1, v2) ((v1 / EJS_VERSION_FACTOR) == (v2 / EJS_VERSION_FACTOR))</span>
<a name="l04175"></a>04175 <span class="preprocessor"></span><span class="preprocessor">#define EJS_MAKE_COMPAT_VERSION(version) (version / EJS_VERSION_FACTOR * EJS_VERSION_FACTOR)</span>
<a name="l04176"></a>04176 <span class="preprocessor"></span><span class="preprocessor">#define EJS_MAKE_VERSION(maj, min, patch) (((((maj) * EJS_VERSION_FACTOR) + (min)) * EJS_VERSION_FACTOR) + (patch))</span>
<a name="l04177"></a>04177 <span class="preprocessor"></span><span class="preprocessor">#define EJS_MAJOR(version)      (((version / EJS_VERSION_FACTOR) / EJS_VERSION_FACTOR) % EJS_VERSION_FACTOR)</span>
<a name="l04178"></a>04178 <span class="preprocessor"></span><span class="preprocessor">#define EJS_MINOR(version)      ((version / EJS_VERSION_FACTOR) % EJS_VERSION_FACTOR)</span>
<a name="l04179"></a>04179 <span class="preprocessor"></span><span class="preprocessor">#define EJS_PATCH(version)      (version % EJS_VERSION_FACTOR)</span>
<a name="l04180"></a>04180 <span class="preprocessor"></span><span class="preprocessor">#define EJS_MAX_VERSION         EJS_MAKE_VERSION(EJS_VERSION_FACTOR-1, EJS_VERSION_FACTOR-1, EJS_VERSION_FACTOR-1)</span>
<a name="l04181"></a>04181 <span class="preprocessor"></span><span class="preprocessor">#define EJS_VERSION             EJS_MAKE_VERSION(BLD_MAJOR_VERSION, BLD_MINOR_VERSION, BLD_PATCH_VERSION)</span>
<a name="l04182"></a>04182 <span class="preprocessor"></span>
<a name="l04183"></a>04183 <span class="comment">/*</span>
<a name="l04184"></a>04184 <span class="comment">    Section types</span>
<a name="l04185"></a>04185 <span class="comment"> */</span>
<a name="l04186"></a>04186 <span class="preprocessor">#define EJS_SECT_MODULE         1           </span><span class="comment">/* Module section */</span>
<a name="l04187"></a>04187 <span class="preprocessor">#define EJS_SECT_MODULE_END     2           </span><span class="comment">/* End of a module */</span>
<a name="l04188"></a>04188 <span class="preprocessor">#define EJS_SECT_DEPENDENCY     3           </span><span class="comment">/* Module dependency */</span>
<a name="l04189"></a>04189 <span class="preprocessor">#define EJS_SECT_CLASS          4           </span><span class="comment">/* Class definition */</span>
<a name="l04190"></a>04190 <span class="preprocessor">#define EJS_SECT_CLASS_END      5           </span><span class="comment">/* End of class definition */</span>
<a name="l04191"></a>04191 <span class="preprocessor">#define EJS_SECT_FUNCTION       6           </span><span class="comment">/* Function */</span>
<a name="l04192"></a>04192 <span class="preprocessor">#define EJS_SECT_FUNCTION_END   7           </span><span class="comment">/* End of function definition */</span>
<a name="l04193"></a>04193 <span class="preprocessor">#define EJS_SECT_BLOCK          8           </span><span class="comment">/* Nested block */</span>
<a name="l04194"></a>04194 <span class="preprocessor">#define EJS_SECT_BLOCK_END      9           </span><span class="comment">/* End of Nested block */</span>
<a name="l04195"></a>04195 <span class="preprocessor">#define EJS_SECT_PROPERTY       10          </span><span class="comment">/* Property (variable) definition */</span>
<a name="l04196"></a>04196 <span class="preprocessor">#define EJS_SECT_EXCEPTION      11          </span><span class="comment">/* Exception definition */</span>
<a name="l04197"></a>04197 <span class="preprocessor">#define EJS_SECT_DOC            12          </span><span class="comment">/* Documentation for an element */</span>
<a name="l04198"></a>04198 <span class="preprocessor">#define EJS_SECT_MAX            13</span>
<a name="l04199"></a>04199 <span class="preprocessor"></span>
<a name="l04200"></a>04200 <span class="comment">/*</span>
<a name="l04201"></a>04201 <span class="comment">    Psudo section types for loader callback</span>
<a name="l04202"></a>04202 <span class="comment"> */</span>
<a name="l04203"></a>04203 <span class="preprocessor">#define EJS_SECT_START          (EJS_SECT_MAX + 1)</span>
<a name="l04204"></a>04204 <span class="preprocessor"></span><span class="preprocessor">#define EJS_SECT_END            (EJS_SECT_MAX + 2)</span>
<a name="l04205"></a>04205 <span class="preprocessor"></span>
<a name="l04206"></a>04206 <span class="comment">/*</span>
<a name="l04207"></a>04207 <span class="comment">    Align headers on a 4 byte boundary</span>
<a name="l04208"></a>04208 <span class="comment"> */</span>
<a name="l04209"></a>04209 <span class="preprocessor">#define EJS_HDR_ALIGN           4</span>
<a name="l04210"></a>04210 <span class="preprocessor"></span>
<a name="l04211"></a>04211 <span class="comment">/*</span>
<a name="l04212"></a>04212 <span class="comment">    File format is little-endian. All headers are aligned on word boundaries.</span>
<a name="l04213"></a>04213 <span class="comment"> */</span>
<a name="l04214"></a>04214 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsModuleHdr {
<a name="l04215"></a>04215     <span class="keywordtype">int</span>         magic;                      <span class="comment">/* Magic number for Ejscript modules */</span>
<a name="l04216"></a>04216     <span class="keywordtype">int</span>         fileVersion;                <span class="comment">/* Module file format version */</span>
<a name="l04217"></a>04217     <span class="keywordtype">int</span>         flags;                      <span class="comment">/* Module flags */</span>
<a name="l04218"></a>04218 } EjsModuleHdr;
<a name="l04219"></a>04219 
<a name="l04220"></a>04220 <span class="comment">/*</span>
<a name="l04221"></a>04221 <span class="comment">    Structure for the string constant pool</span>
<a name="l04222"></a>04222 <span class="comment"> */</span>
<a name="l04223"></a>04223 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsConst {
<a name="l04224"></a>04224     <span class="keywordtype">char</span>        *pool;                      <span class="comment">/* Constant pool storage */</span>
<a name="l04225"></a>04225     <span class="keywordtype">int</span>         size;                       <span class="comment">/* Size of constant pool storage */</span>
<a name="l04226"></a>04226     <span class="keywordtype">int</span>         len;                        <span class="comment">/* Length of active constant pool */</span>
<a name="l04227"></a>04227     <span class="keywordtype">int</span>         base;                       <span class="comment">/* Base used during relocations */</span>
<a name="l04228"></a>04228     <span class="keywordtype">int</span>         locked;                     <span class="comment">/* No more additions allowed */</span>
<a name="l04229"></a>04229     MprHashTable *table;                    <span class="comment">/* Hash table for fast lookup */</span>
<a name="l04230"></a>04230 } EjsConst;
<a name="l04231"></a>04231 
<a name="l04232"></a>04232 <span class="comment">/*</span>
<a name="l04233"></a>04233 <span class="comment">    Module. NOTE: not an EjsObj</span>
<a name="l04234"></a>04234 <span class="comment"> */</span>
<a name="l04235"></a>04235 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsModule {
<a name="l04236"></a>04236     <span class="keywordtype">char</span>            *name;                  <span class="comment">/* Name of this module */</span>
<a name="l04237"></a>04237     <span class="keywordtype">char</span>            *vname;                 <span class="comment">/* Versioned name */</span>
<a name="l04238"></a>04238     <span class="keywordtype">char</span>            *path;                  <span class="comment">/* Module file path name */</span>
<a name="l04239"></a>04239     <span class="keywordtype">int</span>             version;                <span class="comment">/* Made with EJS_MAKE_VERSION */</span>
<a name="l04240"></a>04240     <span class="keywordtype">int</span>             minVersion;             <span class="comment">/* Minimum version when used as a dependency */</span>
<a name="l04241"></a>04241     <span class="keywordtype">int</span>             maxVersion;             <span class="comment">/* Maximum version when used as a dependency */</span>
<a name="l04242"></a>04242     <span class="keywordtype">int</span>             checksum;               <span class="comment">/* Checksum of slots and names */</span>
<a name="l04243"></a>04243 
<a name="l04244"></a>04244     EjsLoadState    *loadState;             <span class="comment">/* State while loading */</span>
<a name="l04245"></a>04245     MprList         *dependencies;          <span class="comment">/* Module file dependencies. List of EjsModules */</span>
<a name="l04246"></a>04246     MprFile         *file;                  <span class="comment">/* File handle for loading and code generation */</span>
<a name="l04247"></a>04247 
<a name="l04248"></a>04248     <span class="comment">/*</span>
<a name="l04249"></a>04249 <span class="comment">        Used during code generation</span>
<a name="l04250"></a>04250 <span class="comment">     */</span>
<a name="l04251"></a>04251     <span class="keyword">struct </span>EcCodeGen *code;                 <span class="comment">/* Code generation buffer */</span>
<a name="l04252"></a>04252     MprList         *globalProperties;      <span class="comment">/* List of global properties */</span>
<a name="l04253"></a>04253     EjsFunction     *initializer;           <span class="comment">/* Initializer method */</span>
<a name="l04254"></a>04254 
<a name="l04255"></a>04255     <span class="comment">/*</span>
<a name="l04256"></a>04256 <span class="comment">        Used only while loading modules</span>
<a name="l04257"></a>04257 <span class="comment">     */</span>
<a name="l04258"></a>04258     MprList         *current;               <span class="comment">/* Current stack of open objects */</span>
<a name="l04259"></a>04259     EjsBlock        *scope;                 <span class="comment">/* Lexical scope chain */</span>
<a name="l04260"></a>04260     EjsConst        *constants;             <span class="comment">/* Constant pool */</span>
<a name="l04261"></a>04261     <span class="keywordtype">int</span>             nameToken;              <span class="comment">/* */</span>
<a name="l04262"></a>04262     <span class="keywordtype">int</span>             firstGlobal;            <span class="comment">/* First global property */</span>
<a name="l04263"></a>04263     <span class="keywordtype">int</span>             lastGlobal;             <span class="comment">/* Last global property + 1*/</span>
<a name="l04264"></a>04264     <span class="keyword">struct </span>EjsFunction  *currentMethod;     <span class="comment">/* Current method being loaded */</span>
<a name="l04265"></a>04265 
<a name="l04266"></a>04266     uint            compiling       : 1;    <span class="comment">/* Module currently being compiled from source */</span>
<a name="l04267"></a>04267     uint            configured      : 1;    <span class="comment">/* Module types have been configured with native code */</span>
<a name="l04268"></a>04268     uint            loaded          : 1;    <span class="comment">/* Module has been loaded from an external file */</span>
<a name="l04269"></a>04269     uint            nativeLoaded    : 1;    <span class="comment">/* Backing shared library loaded */</span>
<a name="l04270"></a>04270     uint            hasNative       : 1;    <span class="comment">/* Has native property definitions */</span>
<a name="l04271"></a>04271     uint            hasInitializer  : 1;    <span class="comment">/* Has initializer function */</span>
<a name="l04272"></a>04272     uint            initialized     : 1;    <span class="comment">/* Initializer has run */</span>
<a name="l04273"></a>04273     uint            hasError        : 1;    <span class="comment">/* Module has a loader error */</span>
<a name="l04274"></a>04274     uint            visited         : 1;    <span class="comment">/* Module has been traversed */</span>
<a name="l04275"></a>04275     <span class="keywordtype">int</span>             flags;                  <span class="comment">/* Loading flags */</span>
<a name="l04276"></a>04276     <span class="keywordtype">char</span>            *doc;                   <span class="comment">/* Current doc string */</span>
<a name="l04277"></a>04277 } EjsModule;
<a name="l04278"></a>04278 
<a name="l04279"></a>04279 
<a name="l04280"></a>04280 <span class="keyword">typedef</span> int (*EjsNativeCallback)(Ejs *ejs);
<a name="l04281"></a>04281 
<a name="l04282"></a>04282 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsNativeModule {
<a name="l04283"></a>04283     EjsNativeCallback callback;             <span class="comment">/* Callback to configure module native types and properties */</span>
<a name="l04284"></a>04284     cchar           *name;                  <span class="comment">/* Module name */</span>
<a name="l04285"></a>04285     <span class="keywordtype">int</span>             checksum;               <span class="comment">/* Checksum expected by native code */</span>
<a name="l04286"></a>04286     <span class="keywordtype">int</span>             flags;                  <span class="comment">/* Configuration flags */</span>
<a name="l04287"></a>04287 } EjsNativeModule;
<a name="l04288"></a>04288 
<a name="l04289"></a>04289 <span class="comment">/*</span>
<a name="l04290"></a>04290 <span class="comment">    Documentation string information</span>
<a name="l04291"></a>04291 <span class="comment">    Element documentation string. The loader will create if required.</span>
<a name="l04292"></a>04292 <span class="comment"> */</span>
<a name="l04293"></a>04293 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsDoc {
<a name="l04294"></a>04294     <span class="keywordtype">char</span>        *docString;                         <span class="comment">/* Original doc string */</span>
<a name="l04295"></a>04295     <span class="keywordtype">char</span>        *brief;
<a name="l04296"></a>04296     <span class="keywordtype">char</span>        *description;
<a name="l04297"></a>04297     <span class="keywordtype">char</span>        *example;
<a name="l04298"></a>04298     <span class="keywordtype">char</span>        *requires;
<a name="l04299"></a>04299     <span class="keywordtype">char</span>        *returns;
<a name="l04300"></a>04300     <span class="keywordtype">char</span>        *stability;                         <span class="comment">/* prototype, evolving, stable, mature, deprecated */</span>
<a name="l04301"></a>04301     <span class="keywordtype">char</span>        *spec;                              <span class="comment">/* Where specified */</span>
<a name="l04302"></a>04302     <span class="keywordtype">int</span>         deprecated;                         <span class="comment">/* Hide doc if true */</span>
<a name="l04303"></a>04303     <span class="keywordtype">int</span>         hide;                               <span class="comment">/* Hide doc if true */</span>
<a name="l04304"></a>04304     <span class="keywordtype">int</span>         cracked;                            <span class="comment">/* Doc has been cracked and tokenized */</span>
<a name="l04305"></a>04305 
<a name="l04306"></a>04306     <span class="keyword">struct </span>EjsDoc *duplicate;                       <span class="comment">/* From @duplicate directive */</span>
<a name="l04307"></a>04307 
<a name="l04308"></a>04308     MprList     *defaults;                          <span class="comment">/* Parameter default values */</span>
<a name="l04309"></a>04309     MprList     *params;                            <span class="comment">/* Function parameters */</span>
<a name="l04310"></a>04310     MprList     *options;                           <span class="comment">/* Option parameter values */</span>
<a name="l04311"></a>04311     MprList     *events;                            <span class="comment">/* Option parameter values */</span>
<a name="l04312"></a>04312     MprList     *see;
<a name="l04313"></a>04313     MprList     *<span class="keywordflow">throws</span>;
<a name="l04314"></a>04314 
<a name="l04315"></a>04315     <a class="code" href="struct_ejs_trait.html" title="Property traits.">EjsTrait</a>    *trait;                             <span class="comment">/* Back pointer to trait */</span>
<a name="l04316"></a>04316 } EjsDoc;
<a name="l04317"></a>04317 
<a name="l04318"></a>04318 
<a name="l04319"></a>04319 <span class="comment">/*</span>
<a name="l04320"></a>04320 <span class="comment">    Loader flags</span>
<a name="l04321"></a>04321 <span class="comment"> */</span>
<a name="l04322"></a>04322 <span class="preprocessor">#define EJS_LOADER_STRICT     0x1</span>
<a name="l04323"></a>04323 <span class="preprocessor"></span><span class="preprocessor">#define EJS_LOADER_NO_INIT    0x2</span>
<a name="l04324"></a>04324 <span class="preprocessor"></span><span class="preprocessor">#define EJS_LOADER_ETERNAL    0x4                   </span><span class="comment">/* Make all types eternal */</span>
<a name="l04325"></a>04325 <span class="preprocessor">#define EJS_LOADER_BUILTIN    0x8                   </span><span class="comment">/* Loading builtins */</span>
<a name="l04326"></a>04326 <span class="preprocessor">#define EJS_LOADER_DEP        0x10                  </span><span class="comment">/* Loading a dependency */</span>
<a name="l04327"></a>04327 
<a name="l04328"></a>04328 
<a name="l04329"></a>04329 
<a name="l04330"></a>04330 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsAddNativeModule(MprCtx ctx, cchar *name, EjsNativeCallback callback, <span class="keywordtype">int</span> checksum, <span class="keywordtype">int</span> flags);
<a name="l04331"></a>04331 <span class="keyword">extern</span> EjsNativeModule *ejsLookupNativeModule(Ejs *ejs, cchar *name);
<a name="l04332"></a>04332 <span class="keyword">extern</span> EjsModule    *ejsCreateModule(<span class="keyword">struct</span> Ejs *ejs, cchar *name, <span class="keywordtype">int</span> version);
<a name="l04333"></a>04333 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsLoadModule(<span class="keyword">struct</span> Ejs *ejs, cchar *name, <span class="keywordtype">int</span> minVer, <span class="keywordtype">int</span> maxVer, <span class="keywordtype">int</span> flags);
<a name="l04334"></a>04334 <span class="keyword">extern</span> <span class="keywordtype">char</span>         *ejsSearchForModule(Ejs *ejs, cchar *name, <span class="keywordtype">int</span> minVer, <span class="keywordtype">int</span> maxVer);
<a name="l04335"></a>04335 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsModuleReadName(<span class="keyword">struct</span> Ejs *ejs, MprFile *file, <span class="keywordtype">char</span> **name, <span class="keywordtype">int</span> len);
<a name="l04336"></a>04336 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsModuleReadNumber(<span class="keyword">struct</span> Ejs *ejs, EjsModule *module, <span class="keywordtype">int</span> *number);
<a name="l04337"></a>04337 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsModuleReadByte(<span class="keyword">struct</span> Ejs *ejs, EjsModule *module, <span class="keywordtype">int</span> *number);
<a name="l04338"></a>04338 <span class="keyword">extern</span> <span class="keywordtype">char</span>         *ejsModuleReadString(<span class="keyword">struct</span> Ejs *ejs, EjsModule *module);
<a name="l04339"></a>04339 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsModuleReadType(<span class="keyword">struct</span> Ejs *ejs, EjsModule *module, EjsType **typeRef, EjsTypeFixup **fixup, 
<a name="l04340"></a>04340                         EjsName *typeName, <span class="keywordtype">int</span> *slotNum);
<a name="l04341"></a>04341 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsSetModuleConstants(<span class="keyword">struct</span> Ejs *ejs, EjsModule *mp, cchar *pool, <span class="keywordtype">int</span> poolSize);
<a name="l04342"></a>04342 <span class="keyword">extern</span> <span class="keywordtype">double</span>       ejsDecodeDouble(Ejs *ejs, uchar **pp);
<a name="l04343"></a>04343 <span class="keyword">extern</span> int64        ejsDecodeNum(uchar **pp);
<a name="l04344"></a>04344 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsDecodeWord(uchar **pp);
<a name="l04345"></a>04345 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsEncodeNum(uchar *pos, int64 number);
<a name="l04346"></a>04346 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsEncodeWord(uchar *pos, <span class="keywordtype">int</span> number);
<a name="l04347"></a>04347 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsEncodeDouble(Ejs *ejs, uchar *pos, <span class="keywordtype">double</span> number);
<a name="l04348"></a>04348 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsEncodeByteAtPos(uchar *pos, <span class="keywordtype">int</span> value);
<a name="l04349"></a>04349 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsEncodeUint(uchar *pos, uint number);
<a name="l04350"></a>04350 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsEncodeWordAtPos(uchar *pos, <span class="keywordtype">int</span> value);
<a name="l04351"></a>04351 
<a name="l04352"></a>04352 <span class="keyword">extern</span> <span class="keywordtype">char</span>         *ejsGetDocKey(<span class="keyword">struct</span> Ejs *ejs, EjsBlock *block, <span class="keywordtype">int</span> slotNum, <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> bufsize);
<a name="l04353"></a>04353 <span class="keyword">extern</span> EjsDoc       *ejsCreateDoc(<span class="keyword">struct</span> Ejs *ejs, <span class="keywordtype">void</span> *vp, <span class="keywordtype">int</span> slotNum, cchar *docString);
<a name="l04354"></a>04354 
<a name="l04355"></a>04355 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsAddModule(Ejs *ejs, <span class="keyword">struct</span> EjsModule *up);
<a name="l04356"></a>04356 <span class="keyword">extern</span> <span class="keyword">struct </span>EjsModule *ejsLookupModule(Ejs *ejs, cchar *name, <span class="keywordtype">int</span> minVersion, <span class="keywordtype">int</span> maxVersion);
<a name="l04357"></a>04357 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ejsRemoveModule(Ejs *ejs, <span class="keyword">struct</span> EjsModule *up);
<a name="l04358"></a>04358 
<a name="l04359"></a>04359 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l04360"></a>04360 <span class="preprocessor"></span>}
<a name="l04361"></a>04361 <span class="preprocessor">#endif</span>
<a name="l04362"></a>04362 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* _h_EJS_MODULE */</span>
<a name="l04363"></a>04363 
<a name="l04364"></a>04364 <span class="comment">/*</span>
<a name="l04365"></a>04365 <span class="comment">    @copy   default</span>
<a name="l04366"></a>04366 <span class="comment"></span>
<a name="l04367"></a>04367 <span class="comment">    Copyright (c) Embedthis Software LLC, 2003-2010. All Rights Reserved.</span>
<a name="l04368"></a>04368 <span class="comment">    Copyright (c) Michael O'Brien, 1993-2010. All Rights Reserved.</span>
<a name="l04369"></a>04369 <span class="comment"></span>
<a name="l04370"></a>04370 <span class="comment">    This software is distributed under commercial and open source licenses.</span>
<a name="l04371"></a>04371 <span class="comment">    You may use the GPL open source license described below or you may acquire</span>
<a name="l04372"></a>04372 <span class="comment">    a commercial license from Embedthis Software. You agree to be fully bound</span>
<a name="l04373"></a>04373 <span class="comment">    by the terms of either license. Consult the LICENSE.TXT distributed with</span>
<a name="l04374"></a>04374 <span class="comment">    this software for full details.</span>
<a name="l04375"></a>04375 <span class="comment"></span>
<a name="l04376"></a>04376 <span class="comment">    This software is open source; you can redistribute it and/or modify it</span>
<a name="l04377"></a>04377 <span class="comment">    under the terms of the GNU General Public License as published by the</span>
<a name="l04378"></a>04378 <span class="comment">    Free Software Foundation; either version 2 of the License, or (at your</span>
<a name="l04379"></a>04379 <span class="comment">    option) any later version. See the GNU General Public License for more</span>
<a name="l04380"></a>04380 <span class="comment">    details at: http://www.embedthis.com/downloads/gplLicense.html</span>
<a name="l04381"></a>04381 <span class="comment"></span>
<a name="l04382"></a>04382 <span class="comment">    This program is distributed WITHOUT ANY WARRANTY; without even the</span>
<a name="l04383"></a>04383 <span class="comment">    implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<a name="l04384"></a>04384 <span class="comment"></span>
<a name="l04385"></a>04385 <span class="comment">    This GPL license does NOT permit incorporating this software into</span>
<a name="l04386"></a>04386 <span class="comment">    proprietary programs. If you are unable to comply with the GPL, you must</span>
<a name="l04387"></a>04387 <span class="comment">    acquire a commercial license to use this software. Commercial licenses</span>
<a name="l04388"></a>04388 <span class="comment">    for this software and support services are available from Embedthis</span>
<a name="l04389"></a>04389 <span class="comment">    Software at http://www.embedthis.com</span>
<a name="l04390"></a>04390 <span class="comment"></span>
<a name="l04391"></a>04391 <span class="comment">    Local variables:
    tab-width: 4
    c-basic-offset: 4
    End:
    vim: sw=8 ts=8 expandtab

    @end</span>
<a name="l04392"></a>04392 <span class="comment"> */</span>
<a name="l04393"></a>04393 <span class="comment">/************************************************************************/</span>
<a name="l04394"></a>04394 <span class="comment">/*</span>
<a name="l04395"></a>04395 <span class="comment"> *  End of file "../../src/include/ejsModule.h"</span>
<a name="l04396"></a>04396 <span class="comment"> */</span>
<a name="l04397"></a>04397 <span class="comment">/************************************************************************/</span>
<a name="l04398"></a>04398 
<a name="l04399"></a>04399 
<a name="l04400"></a>04400 
<a name="l04401"></a>04401 <span class="comment">/************************************************************************/</span>
<a name="l04402"></a>04402 <span class="comment">/*</span>
<a name="l04403"></a>04403 <span class="comment"> *  Start of file "../../src/include/ejs.h"</span>
<a name="l04404"></a>04404 <span class="comment"> */</span>
<a name="l04405"></a>04405 <span class="comment">/************************************************************************/</span>
<a name="l04406"></a>04406 
<a name="l04407"></a>04407 <span class="comment">/*</span>
<a name="l04408"></a>04408 <span class="comment">    ejs.h - Ejscript top level header.</span>
<a name="l04409"></a>04409 <span class="comment"></span>
<a name="l04410"></a>04410 <span class="comment">    Copyright (c) All Rights Reserved. See details at the end of the file.</span>
<a name="l04411"></a>04411 <span class="comment"> */</span>
<a name="l04412"></a>04412 
<a name="l04413"></a>04413 
<a name="l04414"></a>04414 <span class="preprocessor">#ifndef _h_EJS_h</span>
<a name="l04415"></a>04415 <span class="preprocessor"></span><span class="preprocessor">#define _h_EJS_h 1</span>
<a name="l04416"></a>04416 <span class="preprocessor"></span>
<a name="l04417"></a>04417 <span class="preprocessor">#include    "mpr.h"</span>
<a name="l04418"></a>04418 
<a name="l04419"></a>04419 <span class="preprocessor">#endif </span><span class="comment">/* _h_EJS_h */</span>
<a name="l04420"></a>04420 
<a name="l04421"></a>04421 <span class="comment">/*</span>
<a name="l04422"></a>04422 <span class="comment">    @copy   default</span>
<a name="l04423"></a>04423 <span class="comment"></span>
<a name="l04424"></a>04424 <span class="comment">    Copyright (c) Embedthis Software LLC, 2003-2010. All Rights Reserved.</span>
<a name="l04425"></a>04425 <span class="comment">    Copyright (c) Michael O'Brien, 1993-2010. All Rights Reserved.</span>
<a name="l04426"></a>04426 <span class="comment"></span>
<a name="l04427"></a>04427 <span class="comment">    This software is distributed under commercial and open source licenses.</span>
<a name="l04428"></a>04428 <span class="comment">    You may use the GPL open source license described below or you may acquire</span>
<a name="l04429"></a>04429 <span class="comment">    a commercial license from Embedthis Software. You agree to be fully bound</span>
<a name="l04430"></a>04430 <span class="comment">    by the terms of either license. Consult the LICENSE.TXT distributed with</span>
<a name="l04431"></a>04431 <span class="comment">    this software for full details.</span>
<a name="l04432"></a>04432 <span class="comment"></span>
<a name="l04433"></a>04433 <span class="comment">    This software is open source; you can redistribute it and/or modify it</span>
<a name="l04434"></a>04434 <span class="comment">    under the terms of the GNU General Public License as published by the</span>
<a name="l04435"></a>04435 <span class="comment">    Free Software Foundation; either version 2 of the License, or (at your</span>
<a name="l04436"></a>04436 <span class="comment">    option) any later version. See the GNU General Public License for more</span>
<a name="l04437"></a>04437 <span class="comment">    details at: http://www.embedthis.com/downloads/gplLicense.html</span>
<a name="l04438"></a>04438 <span class="comment"></span>
<a name="l04439"></a>04439 <span class="comment">    This program is distributed WITHOUT ANY WARRANTY; without even the</span>
<a name="l04440"></a>04440 <span class="comment">    implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<a name="l04441"></a>04441 <span class="comment"></span>
<a name="l04442"></a>04442 <span class="comment">    This GPL license does NOT permit incorporating this software into</span>
<a name="l04443"></a>04443 <span class="comment">    proprietary programs. If you are unable to comply with the GPL, you must</span>
<a name="l04444"></a>04444 <span class="comment">    acquire a commercial license to use this software. Commercial licenses</span>
<a name="l04445"></a>04445 <span class="comment">    for this software and support services are available from Embedthis</span>
<a name="l04446"></a>04446 <span class="comment">    Software at http://www.embedthis.com</span>
<a name="l04447"></a>04447 <span class="comment"></span>
<a name="l04448"></a>04448 <span class="comment">    Local variables:
    tab-width: 4
    c-basic-offset: 4
    End:
    vim: sw=8 ts=8 expandtab

    @end</span>
<a name="l04449"></a>04449 <span class="comment"> */</span>
<a name="l04450"></a>04450 <span class="comment">/************************************************************************/</span>
<a name="l04451"></a>04451 <span class="comment">/*</span>
<a name="l04452"></a>04452 <span class="comment"> *  End of file "../../src/include/ejs.h"</span>
<a name="l04453"></a>04453 <span class="comment"> */</span>
<a name="l04454"></a>04454 <span class="comment">/************************************************************************/</span>
<a name="l04455"></a>04455 
<a name="l04456"></a>04456 
<a name="l04457"></a>04457 
<a name="l04458"></a>04458 <span class="comment">/************************************************************************/</span>
<a name="l04459"></a>04459 <span class="comment">/*</span>
<a name="l04460"></a>04460 <span class="comment"> *  Start of file "../../src/include/ejsWeb.h"</span>
<a name="l04461"></a>04461 <span class="comment"> */</span>
<a name="l04462"></a>04462 <span class="comment">/************************************************************************/</span>
<a name="l04463"></a>04463 <span class="comment"></span>
<a name="l04464"></a>04464 <span class="comment">/**</span>
<a name="l04465"></a>04465 <span class="comment">    ejsWeb.h -- Header for the Ejscript Web Framework</span>
<a name="l04466"></a>04466 <span class="comment">    Copyright (c) All Rights Reserved. See details at the end of the file.</span>
<a name="l04467"></a>04467 <span class="comment"> */</span>
<a name="l04468"></a>04468 
<a name="l04469"></a>04469 
<a name="l04470"></a>04470 <span class="preprocessor">#ifndef _h_EJS_WEB_h</span>
<a name="l04471"></a>04471 <span class="preprocessor"></span><span class="preprocessor">#define _h_EJS_WEB_h 1</span>
<a name="l04472"></a>04472 <span class="preprocessor"></span>
<a name="l04473"></a>04473 
<a name="l04474"></a>04474 
<a name="l04475"></a>04475 <span class="preprocessor">#define EJS_SESSION             "-ejs-session-"</span>
<a name="l04476"></a>04476 <span class="preprocessor"></span>
<a name="l04477"></a>04477 <span class="preprocessor">#ifdef  __cplusplus</span>
<a name="l04478"></a>04478 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
<a name="l04479"></a>04479 <span class="preprocessor">#endif</span>
<a name="l04480"></a>04480 <span class="preprocessor"></span>
<a name="l04481"></a>04481 
<a name="l04482"></a>04482 <span class="preprocessor">#ifndef EJS_HTTPSERVER_NAME</span>
<a name="l04483"></a>04483 <span class="preprocessor"></span><span class="preprocessor">#define EJS_HTTPSERVER_NAME "ejs-http/" BLD_VERSION</span>
<a name="l04484"></a>04484 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l04485"></a>04485 <span class="preprocessor"></span><span class="comment"></span>
<a name="l04486"></a>04486 <span class="comment">/** </span>
<a name="l04487"></a>04487 <span class="comment">    HttpServer Class</span>
<a name="l04488"></a>04488 <span class="comment">    @description</span>
<a name="l04489"></a>04489 <span class="comment">        HttpServer objects represents a Hypertext Transfer Protocol version 1.1 client connection and are used </span>
<a name="l04490"></a>04490 <span class="comment">        HTTP requests and capture responses. This class supports the HTTP/1.1 standard including methods for GET, POST, </span>
<a name="l04491"></a>04491 <span class="comment">        PUT, DELETE, OPTIONS, and TRACE. It also supports Keep-Alive and SSL connections. </span>
<a name="l04492"></a>04492 <span class="comment">    @stability Prototype</span>
<a name="l04493"></a>04493 <span class="comment">    @defgroup EjsHttpServer EjsHttpServer</span>
<a name="l04494"></a>04494 <span class="comment">    @see EjsHttpServer</span>
<a name="l04495"></a>04495 <span class="comment"> */</span>
<a name="l04496"></a>04496 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsHttpServer {
<a name="l04497"></a>04497     EjsObj          obj;                        <span class="comment">/**&lt; Extends Object */</span>
<a name="l04498"></a>04498     Ejs             *ejs;                       <span class="comment">/**&lt; Ejscript interpreter handle */</span>
<a name="l04499"></a>04499     EjsObj          *emitter;                   <span class="comment">/**&lt; Event emitter */</span>
<a name="l04500"></a>04500     EjsObj          *limits;                    <span class="comment">/**&lt; Limits object */</span>
<a name="l04501"></a>04501     HttpServer      *server;                    <span class="comment">/**&lt; Http server object */</span>
<a name="l04502"></a>04502     <span class="keyword">struct </span>MprSsl   *ssl;                       <span class="comment">/**&lt; SSL configuration */</span>
<a name="l04503"></a>04503     EjsArray        *incomingStages;            <span class="comment">/**&lt; Incoming Http pipeline stages */</span>
<a name="l04504"></a>04504     EjsArray        *outgoingStages;            <span class="comment">/**&lt; Outgoing Http pipeline stages */</span>
<a name="l04505"></a>04505     cchar           *connector;                 <span class="comment">/**&lt; Pipeline connector */</span>
<a name="l04506"></a>04506     cchar           *dir;                       <span class="comment">/**&lt; Directory containing web documents */</span>
<a name="l04507"></a>04507     <span class="keywordtype">char</span>            *keyFile;                   <span class="comment">/**&lt; SSL key file */</span>
<a name="l04508"></a>04508     <span class="keywordtype">char</span>            *certFile;                  <span class="comment">/**&lt; SSL certificate file */</span>
<a name="l04509"></a>04509     <span class="keywordtype">char</span>            *protocols;                 <span class="comment">/**&lt; SSL protocols */</span>
<a name="l04510"></a>04510     <span class="keywordtype">char</span>            *ciphers;                   <span class="comment">/**&lt; SSL ciphers */</span>
<a name="l04511"></a>04511     <span class="keywordtype">char</span>            *ip;                        <span class="comment">/**&lt; Listening address */</span>
<a name="l04512"></a>04512     <span class="keywordtype">char</span>            *name;                      <span class="comment">/**&lt; Server name */</span>
<a name="l04513"></a>04513     <span class="keywordtype">int</span>             port;                       <span class="comment">/**&lt; Listening port */</span>
<a name="l04514"></a>04514     <span class="keywordtype">int</span>             async;                      <span class="comment">/**&lt; Async mode */</span>
<a name="l04515"></a>04515 
<a name="l04516"></a>04516     <span class="keywordtype">int</span>             traceLevel;                 <span class="comment">/**&lt; Trace activation level */</span>
<a name="l04517"></a>04517     <span class="keywordtype">int</span>             traceMaxLength;             <span class="comment">/**&lt; Maximum trace file length (if known) */</span>
<a name="l04518"></a>04518     <span class="keywordtype">int</span>             traceMask;                  <span class="comment">/**&lt; Request/response trace mask */</span>
<a name="l04519"></a>04519     MprHashTable    *traceInclude;              <span class="comment">/**&lt; Extensions to include in trace */</span>
<a name="l04520"></a>04520     MprHashTable    *traceExclude;              <span class="comment">/**&lt; Extensions to exclude from trace */</span>
<a name="l04521"></a>04521 } EjsHttpServer;
<a name="l04522"></a>04522 
<a name="l04523"></a>04523 <span class="comment"></span>
<a name="l04524"></a>04524 <span class="comment">/** </span>
<a name="l04525"></a>04525 <span class="comment">    Request Class</span>
<a name="l04526"></a>04526 <span class="comment">    @description</span>
<a name="l04527"></a>04527 <span class="comment">        Request objects represent a single Http request.</span>
<a name="l04528"></a>04528 <span class="comment">    @stability Prototype</span>
<a name="l04529"></a>04529 <span class="comment">    @defgroup EjsRequest EjsRequest</span>
<a name="l04530"></a>04530 <span class="comment">    @see EjsRequest ejsCreateRequest</span>
<a name="l04531"></a>04531 <span class="comment"> */</span>
<a name="l04532"></a>04532 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsRequest {
<a name="l04533"></a>04533     EjsObj          obj;            <span class="comment">/**&lt; Base object storage */</span>
<a name="l04534"></a>04534     EjsObj          *cookies;       <span class="comment">/**&lt; Cached cookies */</span>
<a name="l04535"></a>04535     HttpConn        *conn;          <span class="comment">/**&lt; Underlying Http connection object */</span>
<a name="l04536"></a>04536     EjsHttpServer   *server;        <span class="comment">/**&lt; Owning server */</span>
<a name="l04537"></a>04537     EjsObj          *emitter;       <span class="comment">/**&lt; Event emitter */</span>
<a name="l04538"></a>04538     EjsPath         *dir;           <span class="comment">/**&lt; Home directory containing the application */</span>
<a name="l04539"></a>04539     EjsObj          *env;           <span class="comment">/**&lt; Request.env */</span>
<a name="l04540"></a>04540     EjsPath         *filename;      <span class="comment">/**&lt; Physical resource filename */</span>
<a name="l04541"></a>04541     EjsObj          *files;         <span class="comment">/**&lt; Files object */</span>
<a name="l04542"></a>04542     EjsObj          *headers;       <span class="comment">/**&lt; Headers object */</span>
<a name="l04543"></a>04543     EjsObj          *limits;        <span class="comment">/**&lt; Limits object */</span>
<a name="l04544"></a>04544     EjsObj          *params;        <span class="comment">/**&lt; Form variables */</span>
<a name="l04545"></a>04545     EjsUri          *uri;           <span class="comment">/**&lt; Complete uri */</span>
<a name="l04546"></a>04546     Ejs             *ejs;           <span class="comment">/**&lt; Ejscript interpreter handle */</span>
<a name="l04547"></a>04547     <span class="keyword">struct </span>EjsSession *session;     <span class="comment">/**&lt; Current session */</span>
<a name="l04548"></a>04548 
<a name="l04549"></a>04549     <span class="comment">//  MOB -- should these two be stored as EjsObj?</span>
<a name="l04550"></a>04550     cchar           *home;          <span class="comment">/**&lt; Relative URI to the home of the application from this request */</span>
<a name="l04551"></a>04551     cchar           *absHome;       <span class="comment">/**&lt; Absolute URI to the home of the application from this request */</span>
<a name="l04552"></a>04552 
<a name="l04553"></a>04553     <span class="keywordtype">int</span>             dontFinalize;   <span class="comment">/**&lt; Don't auto-finalize. Must call finalize(force) */</span>
<a name="l04554"></a>04554     <span class="keywordtype">int</span>             probedSession;  <span class="comment">/**&lt; Determined if a session exists */</span>
<a name="l04555"></a>04555     <span class="keywordtype">int</span>             closed;         <span class="comment">/**&lt; Request closed and "close" event has been issued */</span>
<a name="l04556"></a>04556     <span class="keywordtype">int</span>             error;          <span class="comment">/**&lt; Request errored and "error" event has been issued */</span>
<a name="l04557"></a>04557     <span class="keywordtype">int</span>             running;        <span class="comment">/**&lt; Request has started */</span>
<a name="l04558"></a>04558 } EjsRequest;
<a name="l04559"></a>04559 
<a name="l04560"></a>04560 <span class="comment"></span>
<a name="l04561"></a>04561 <span class="comment">/** </span>
<a name="l04562"></a>04562 <span class="comment">    Create a new request. Create a new request object associated with the given Http connection.</span>
<a name="l04563"></a>04563 <span class="comment">    @param ejs Ejs interpreter handle returned from $ejsCreate</span>
<a name="l04564"></a>04564 <span class="comment">    @param server EjsHttpServer owning this request</span>
<a name="l04565"></a>04565 <span class="comment">    @param conn Http connection object</span>
<a name="l04566"></a>04566 <span class="comment">    @param dir Default directory containing web documents</span>
<a name="l04567"></a>04567 <span class="comment">    @return A new request object.</span>
<a name="l04568"></a>04568 <span class="comment">*/</span>
<a name="l04569"></a>04569 <span class="keyword">extern</span> EjsRequest *ejsCreateRequest(Ejs *ejs, EjsHttpServer *server, HttpConn *conn, cchar *dir);
<a name="l04570"></a>04570 <span class="comment"></span>
<a name="l04571"></a>04571 <span class="comment">/** </span>
<a name="l04572"></a>04572 <span class="comment">    Clone a new request. This is used to clone a request from one interpreter into another.</span>
<a name="l04573"></a>04573 <span class="comment">    @param ejs Ejs interpreter handle returned from $ejsCreate</span>
<a name="l04574"></a>04574 <span class="comment">    @param req Original request to copy</span>
<a name="l04575"></a>04575 <span class="comment">    @param deep Ignored</span>
<a name="l04576"></a>04576 <span class="comment">    @return A new request object.</span>
<a name="l04577"></a>04577 <span class="comment">*/</span>
<a name="l04578"></a>04578 <span class="keyword">extern</span> EjsRequest *ejsCloneRequest(Ejs *ejs, EjsRequest *req, <span class="keywordtype">bool</span> deep);
<a name="l04579"></a>04579 <span class="comment"></span>
<a name="l04580"></a>04580 <span class="comment">/** </span>
<a name="l04581"></a>04581 <span class="comment">    Session Class</span>
<a name="l04582"></a>04582 <span class="comment">    @description</span>
<a name="l04583"></a>04583 <span class="comment">        Session objects represent a shared session state object into which Http Requests and store and retrieve data</span>
<a name="l04584"></a>04584 <span class="comment">        that persists beyond a single request.</span>
<a name="l04585"></a>04585 <span class="comment">    @stability Prototype</span>
<a name="l04586"></a>04586 <span class="comment">    @defgroup EjsSession EjsSession</span>
<a name="l04587"></a>04587 <span class="comment">    @see EjsSession ejsCreateSession ejsDestroySession</span>
<a name="l04588"></a>04588 <span class="comment"> */</span>
<a name="l04589"></a>04589 <span class="keyword">typedef</span> <span class="keyword">struct </span>EjsSession
<a name="l04590"></a>04590 {
<a name="l04591"></a>04591     EjsObj      obj;
<a name="l04592"></a>04592     MprTime     expire;             <span class="comment">/* When the session should expire */</span>
<a name="l04593"></a>04593     cchar       *id;                <span class="comment">/* Session ID */</span>
<a name="l04594"></a>04594     <span class="keywordtype">int</span>         timeout;            <span class="comment">/* Session inactivity lifespan */</span>
<a name="l04595"></a>04595     <span class="keywordtype">int</span>         index;              <span class="comment">/* Index in sesssions[] */</span>
<a name="l04596"></a>04596 } EjsSession;
<a name="l04597"></a>04597 <span class="comment"></span>
<a name="l04598"></a>04598 <span class="comment">/** </span>
<a name="l04599"></a>04599 <span class="comment">    Create a session object</span>
<a name="l04600"></a>04600 <span class="comment">    @param ejs Ejs interpreter handle returned from $ejsCreate</span>
<a name="l04601"></a>04601 <span class="comment">    @param req Request object creating the session</span>
<a name="l04602"></a>04602 <span class="comment">    @param timeout Timeout in milliseconds</span>
<a name="l04603"></a>04603 <span class="comment">    @param secure If the session is to be given a cookie that is designated as only for secure sessions (SSL)</span>
<a name="l04604"></a>04604 <span class="comment">    @returns A new session object.</span>
<a name="l04605"></a>04605 <span class="comment">*/</span>
<a name="l04606"></a>04606 <span class="keyword">extern</span> EjsSession *ejsCreateSession(Ejs *ejs, <span class="keyword">struct</span> EjsRequest *req, <span class="keywordtype">int</span> timeout, <span class="keywordtype">bool</span> secure);
<a name="l04607"></a>04607 <span class="keyword">extern</span> EjsSession *ejsGetSession(Ejs *ejs, <span class="keyword">struct</span> EjsRequest *req);
<a name="l04608"></a>04608 <span class="comment"></span>
<a name="l04609"></a>04609 <span class="comment">/** </span>
<a name="l04610"></a>04610 <span class="comment">    Destroy as session. This destroys the session object so that subsequent requests will need to establish a new session.</span>
<a name="l04611"></a>04611 <span class="comment">    @param ejs Ejs interpreter handle returned from $ejsCreate</span>
<a name="l04612"></a>04612 <span class="comment">    @param server Server object owning the session.</span>
<a name="l04613"></a>04613 <span class="comment">    @param session Session object created via ejsCreateSession()</span>
<a name="l04614"></a>04614 <span class="comment">*/</span>
<a name="l04615"></a>04615 <span class="keyword">extern</span> <span class="keywordtype">int</span> ejsDestroySession(Ejs *ejs, EjsHttpServer *server, EjsSession *session);
<a name="l04616"></a>04616 
<a name="l04617"></a>04617 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsSendRequestCloseEvent(Ejs *ejs, EjsRequest *req);
<a name="l04618"></a>04618 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsSendRequestErrorEvent(Ejs *ejs, EjsRequest *req);
<a name="l04619"></a>04619 
<a name="l04620"></a>04620 
<a name="l04621"></a>04621 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsConfigureHttpServerType(Ejs *ejs);
<a name="l04622"></a>04622 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsConfigureRequestType(Ejs *ejs);
<a name="l04623"></a>04623 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsConfigureSessionType(Ejs *ejs);
<a name="l04624"></a>04624 <span class="keyword">extern</span> <span class="keywordtype">void</span> ejsConfigureWebTypes(Ejs *ejs);
<a name="l04625"></a>04625 
<a name="l04626"></a>04626 <span class="preprocessor">#ifdef  __cplusplus</span>
<a name="l04627"></a>04627 <span class="preprocessor"></span>}
<a name="l04628"></a>04628 <span class="preprocessor">#endif</span>
<a name="l04629"></a>04629 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* _h_EJS_WEB_h */</span>
<a name="l04630"></a>04630 
<a name="l04631"></a>04631 <span class="comment">/*</span>
<a name="l04632"></a>04632 <span class="comment">    @copy   default</span>
<a name="l04633"></a>04633 <span class="comment"></span>
<a name="l04634"></a>04634 <span class="comment">    Copyright (c) Embedthis Software LLC, 2003-2010. All Rights Reserved.</span>
<a name="l04635"></a>04635 <span class="comment">    Copyright (c) Michael O'Brien, 1993-2010. All Rights Reserved.</span>
<a name="l04636"></a>04636 <span class="comment"></span>
<a name="l04637"></a>04637 <span class="comment">    This software is distributed under commercial and open source licenses.</span>
<a name="l04638"></a>04638 <span class="comment">    You may use the GPL open source license described below or you may acquire</span>
<a name="l04639"></a>04639 <span class="comment">    a commercial license from Embedthis Software. You agree to be fully bound</span>
<a name="l04640"></a>04640 <span class="comment">    by the terms of either license. Consult the LICENSE.TXT distributed with</span>
<a name="l04641"></a>04641 <span class="comment">    this software for full details.</span>
<a name="l04642"></a>04642 <span class="comment"></span>
<a name="l04643"></a>04643 <span class="comment">    This software is open source; you can redistribute it and/or modify it</span>
<a name="l04644"></a>04644 <span class="comment">    under the terms of the GNU General Public License as published by the</span>
<a name="l04645"></a>04645 <span class="comment">    Free Software Foundation; either version 2 of the License, or (at your</span>
<a name="l04646"></a>04646 <span class="comment">    option) any later version. See the GNU General Public License for more</span>
<a name="l04647"></a>04647 <span class="comment">    details at: http://www.embedthis.com/downloads/gplLicense.html</span>
<a name="l04648"></a>04648 <span class="comment"></span>
<a name="l04649"></a>04649 <span class="comment">    This program is distributed WITHOUT ANY WARRANTY; without even the</span>
<a name="l04650"></a>04650 <span class="comment">    implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<a name="l04651"></a>04651 <span class="comment"></span>
<a name="l04652"></a>04652 <span class="comment">    This GPL license does NOT permit incorporating this software into</span>
<a name="l04653"></a>04653 <span class="comment">    proprietary programs. If you are unable to comply with the GPL, you must</span>
<a name="l04654"></a>04654 <span class="comment">    acquire a commercial license to use this software. Commercial licenses</span>
<a name="l04655"></a>04655 <span class="comment">    for this software and support services are available from Embedthis</span>
<a name="l04656"></a>04656 <span class="comment">    Software at http://www.embedthis.com</span>
<a name="l04657"></a>04657 <span class="comment"></span>
<a name="l04658"></a>04658 <span class="comment">    Local variables:
    tab-width: 4
    c-basic-offset: 4
    End:
    vim: sw=8 ts=8 expandtab

    @end</span>
<a name="l04659"></a>04659 <span class="comment"> */</span>
<a name="l04660"></a>04660 <span class="comment">/************************************************************************/</span>
<a name="l04661"></a>04661 <span class="comment">/*</span>
<a name="l04662"></a>04662 <span class="comment"> *  End of file "../../src/include/ejsWeb.h"</span>
<a name="l04663"></a>04663 <span class="comment"> */</span>
<a name="l04664"></a>04664 <span class="comment">/************************************************************************/</span>
<a name="l04665"></a>04665 
<a name="l04666"></a>04666 
<a name="l04667"></a>04667 
<a name="l04668"></a>04668 <span class="comment">/************************************************************************/</span>
<a name="l04669"></a>04669 <span class="comment">/*</span>
<a name="l04670"></a>04670 <span class="comment"> *  Start of file "../../src/include/ecCompiler.h"</span>
<a name="l04671"></a>04671 <span class="comment"> */</span>
<a name="l04672"></a>04672 <span class="comment">/************************************************************************/</span>
<a name="l04673"></a>04673 
<a name="l04674"></a>04674 <span class="comment">/*</span>
<a name="l04675"></a>04675 <span class="comment">    ecCompiler.h - Internal compiler header.</span>
<a name="l04676"></a>04676 <span class="comment"></span>
<a name="l04677"></a>04677 <span class="comment">    Copyright (c) All Rights Reserved. See details at the end of the file.</span>
<a name="l04678"></a>04678 <span class="comment"> */</span>
<a name="l04679"></a>04679 
<a name="l04680"></a>04680 
<a name="l04681"></a>04681 <span class="preprocessor">#ifndef _h_EC_COMPILER</span>
<a name="l04682"></a>04682 <span class="preprocessor"></span><span class="preprocessor">#define _h_EC_COMPILER 1</span>
<a name="l04683"></a>04683 <span class="preprocessor"></span>
<a name="l04684"></a>04684 
<a name="l04685"></a>04685 <span class="comment">/*</span>
<a name="l04686"></a>04686 <span class="comment">    Compiler validation modes. From "use standard|strict"</span>
<a name="l04687"></a>04687 <span class="comment"> */</span>
<a name="l04688"></a>04688 <span class="preprocessor">#define PRAGMA_MODE_STANDARD    1               </span><span class="comment">/* Standard unstrict mode */</span>
<a name="l04689"></a>04689 <span class="preprocessor">#define PRAGMA_MODE_STRICT      2               </span><span class="comment">/* Strict mode */</span>
<a name="l04690"></a>04690 
<a name="l04691"></a>04691 <span class="preprocessor">#define STRICT_MODE(cp)         (cp-&gt;fileState-&gt;strict)</span>
<a name="l04692"></a>04692 <span class="preprocessor"></span>
<a name="l04693"></a>04693 <span class="comment">/*</span>
<a name="l04694"></a>04694 <span class="comment">    Variable Kind bits</span>
<a name="l04695"></a>04695 <span class="comment"> */</span>
<a name="l04696"></a>04696 <span class="preprocessor">#define KIND_CONST              0x1</span>
<a name="l04697"></a>04697 <span class="preprocessor"></span><span class="preprocessor">#define KIND_VAR                0x2</span>
<a name="l04698"></a>04698 <span class="preprocessor"></span><span class="preprocessor">#define KIND_LET                0x4</span>
<a name="l04699"></a>04699 <span class="preprocessor"></span>
<a name="l04700"></a>04700 <span class="comment">/*</span>
<a name="l04701"></a>04701 <span class="comment">    Phases for AST processing</span>
<a name="l04702"></a>04702 <span class="comment"> */</span>
<a name="l04703"></a>04703 <span class="preprocessor">#define EC_PHASE_DEFINE         0           </span><span class="comment">/* Define types, functions and properties in types */</span>
<a name="l04704"></a>04704 <span class="preprocessor">#define EC_PHASE_CONDITIONAL    1           </span><span class="comment">/* Do conditional processing, hoisting and then type fixups */</span>
<a name="l04705"></a>04705 <span class="preprocessor">#define EC_PHASE_FIXUP          2           </span><span class="comment">/* Fixup type references */</span>
<a name="l04706"></a>04706 <span class="preprocessor">#define EC_PHASE_BIND           3           </span><span class="comment">/* Bind var references to slots and property types */</span>
<a name="l04707"></a>04707 <span class="preprocessor">#define EC_AST_PHASES           4</span>
<a name="l04708"></a>04708 <span class="preprocessor"></span>
<a name="l04709"></a>04709 <span class="comment">/*</span>
<a name="l04710"></a>04710 <span class="comment">    Ast node define</span>
<a name="l04711"></a>04711 <span class="comment"> */</span>
<a name="l04712"></a>04712 <span class="preprocessor">#if !DOXYGEN</span>
<a name="l04713"></a>04713 <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">struct </span>EcNode   *Node;
<a name="l04714"></a>04714 <span class="preprocessor">#endif</span>
<a name="l04715"></a>04715 <span class="preprocessor"></span>
<a name="l04716"></a>04716 <span class="keyword">typedef</span> <span class="keyword">struct </span>EcNode {
<a name="l04717"></a>04717     <span class="comment">//  TODO - need consistency in naming. Nodes should have a node suffix. </span>
<a name="l04718"></a>04718     <span class="comment">//  References EjsObj should have a Ref suffix.</span>
<a name="l04719"></a>04719     <span class="comment">/*</span>
<a name="l04720"></a>04720 <span class="comment">        Ordered for debugging</span>
<a name="l04721"></a>04721 <span class="comment">     */</span>
<a name="l04722"></a>04722     <span class="keywordtype">char</span>                *kindName;          <span class="comment">/* Node kind string */</span>
<a name="l04723"></a>04723 
<a name="l04724"></a>04724     <span class="comment">/*</span>
<a name="l04725"></a>04725 <span class="comment">        TODO - optimize name+qualifier fields</span>
<a name="l04726"></a>04726 <span class="comment">     */</span>
<a name="l04727"></a>04727     EjsName             qname;
<a name="l04728"></a>04728     <span class="keywordtype">int</span>                 literalNamespace;   <span class="comment">/* Namespace is a literal */</span>
<a name="l04729"></a>04729 
<a name="l04730"></a>04730     cchar               *filename;          <span class="comment">/* File containing source code line */</span>
<a name="l04731"></a>04731     <span class="keywordtype">char</span>                *currentLine;       <span class="comment">/* Current source code line */</span>
<a name="l04732"></a>04732     <span class="keywordtype">int</span>                 lineNumber;
<a name="l04733"></a>04733 
<a name="l04734"></a>04734     Node                left;               <span class="comment">/* children[0] */</span>
<a name="l04735"></a>04735     Node                right;              <span class="comment">/* children[1] */</span>
<a name="l04736"></a>04736 
<a name="l04737"></a>04737     EjsBlock            *blockRef;          <span class="comment">/* Block scope */</span>
<a name="l04738"></a>04738     <span class="keywordtype">bool</span>                createBlockObject;  <span class="comment">/* Create the block object to contain let scope variables */</span>
<a name="l04739"></a>04739     <span class="keywordtype">bool</span>                blockCreated;       <span class="comment">/* Block object has been created */</span>
<a name="l04740"></a>04740     <a class="code" href="struct_ejs_lookup.html" title="Lookup State.">EjsLookup</a>           lookup;
<a name="l04741"></a>04741     <span class="keywordtype">int</span>                 attributes;         <span class="comment">/* Attributes applying to this node */</span>
<a name="l04742"></a>04742     <span class="keywordtype">bool</span>                specialNamespace;   <span class="comment">/* Using a public|private|protected|internal namespace */</span>
<a name="l04743"></a>04743     Node                typeNode;           <span class="comment">/* Type of name */</span>
<a name="l04744"></a>04744     Node                parent;             <span class="comment">/* Parent node */</span>
<a name="l04745"></a>04745     EjsNamespace        *namespaceRef;      <span class="comment">/* Namespace reference */</span>
<a name="l04746"></a>04746     MprList             *namespaces;        <span class="comment">/* Namespaces for hoisted variables */</span>
<a name="l04747"></a>04747 
<a name="l04748"></a>04748 <span class="preprocessor">    #define N_VALUE     1</span>
<a name="l04749"></a>04749 <span class="preprocessor"></span>
<a name="l04750"></a>04750 <span class="preprocessor">#if BLD_DEBUG</span>
<a name="l04751"></a>04751 <span class="preprocessor"></span>    <span class="keywordtype">char</span>                *tokenName;
<a name="l04752"></a>04752 <span class="preprocessor">#endif</span>
<a name="l04753"></a>04753 <span class="preprocessor"></span>
<a name="l04754"></a>04754     <span class="keywordtype">int</span>                 tokenId;            <span class="comment">/* Lex token */</span>
<a name="l04755"></a>04755     <span class="keywordtype">int</span>                 groupMask;          <span class="comment">/* Token group */</span>
<a name="l04756"></a>04756     <span class="keywordtype">int</span>                 subId;              <span class="comment">/* Sub token */</span>
<a name="l04757"></a>04757 
<a name="l04758"></a>04758     <span class="comment">/*</span>
<a name="l04759"></a>04759 <span class="comment">        MOB TODO - order in most useful order: name, type, function, binary</span>
<a name="l04760"></a>04760 <span class="comment">        MOB TODO - rename all with a Node suffix. ie. nameNode, importNode</span>
<a name="l04761"></a>04761 <span class="comment">     */</span>
<a name="l04762"></a>04762 
<a name="l04763"></a>04763     <span class="comment">//  MOB TODO - disable for now</span>
<a name="l04764"></a>04764 <span class="preprocessor">#if !BLD_DEBUG &amp;&amp; 0</span>
<a name="l04765"></a>04765 <span class="preprocessor"></span>    <span class="keyword">union </span>{
<a name="l04766"></a>04766 <span class="preprocessor">#endif</span>
<a name="l04767"></a>04767 <span class="preprocessor"></span>
<a name="l04768"></a>04768         <span class="comment">//  GROUPING ONLY</span>
<a name="l04769"></a>04769 <span class="preprocessor">        #define N_ATTRIBUTES 50</span>
<a name="l04770"></a>04770 <span class="preprocessor"></span>
<a name="l04771"></a>04771         <span class="comment">/*</span>
<a name="l04772"></a>04772 <span class="comment">            Name nodes hold a fully qualified name.</span>
<a name="l04773"></a>04773 <span class="comment">         */</span>
<a name="l04774"></a>04774 <span class="preprocessor">        #define N_QNAME  3</span>
<a name="l04775"></a>04775 <span class="preprocessor"></span><span class="preprocessor">        #define N_VAR 63</span>
<a name="l04776"></a>04776 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04777"></a>04777             Node        nameExpr;           <span class="comment">/* Name expression */</span>
<a name="l04778"></a>04778             Node        qualifierExpr;      <span class="comment">/* Qualifier expression */</span>
<a name="l04779"></a>04779             <span class="keywordtype">int</span>         isAttribute;        <span class="comment">/* Attribute identifier "@" */</span>
<a name="l04780"></a>04780             <span class="keywordtype">int</span>         isType;             <span class="comment">/* Name is a type */</span>
<a name="l04781"></a>04781             <span class="keywordtype">int</span>         isNamespace;        <span class="comment">/* Name is a namespace */</span>
<a name="l04782"></a>04782             <span class="keywordtype">int</span>         letScope;           <span class="comment">/* Variable is defined in let block scope */</span>
<a name="l04783"></a>04783             <span class="keywordtype">int</span>         instanceVar;        <span class="comment">/* Instance or static var (if defined in class) */</span>
<a name="l04784"></a>04784             <span class="keywordtype">int</span>         isRest;             <span class="comment">/* ... rest style args */</span>
<a name="l04785"></a>04785             <span class="keywordtype">int</span>         varKind;            <span class="comment">/* Variable definition kind */</span>
<a name="l04786"></a>04786             EjsObj      *nsvalue;           <span class="comment">/* Initialization value (MOB - remove) */</span>
<a name="l04787"></a>04787         } name;
<a name="l04788"></a>04788 
<a name="l04789"></a>04789         <span class="comment">/*</span>
<a name="l04790"></a>04790 <span class="comment">            cast, is, to</span>
<a name="l04791"></a>04791 <span class="comment">         */</span>
<a name="l04792"></a>04792 <span class="preprocessor">        #define N_BINARY_TYPE_OP  5</span>
<a name="l04793"></a>04793 <span class="preprocessor"></span>
<a name="l04794"></a>04794         <span class="comment">/*</span>
<a name="l04795"></a>04795 <span class="comment">           + - * / % &lt;&lt; &gt;&gt; &gt;&gt;&gt; &amp; | ^ &amp;&amp; || instanceof in == != ===</span>
<a name="l04796"></a>04796 <span class="comment">                !== &lt; &lt;= &gt; &gt;= , ]</span>
<a name="l04797"></a>04797 <span class="comment">         */</span>
<a name="l04798"></a>04798 <span class="preprocessor">        #define N_BINARY_OP  6</span>
<a name="l04799"></a>04799 <span class="preprocessor"></span><span class="preprocessor">        #define N_ASSIGN_OP  7</span>
<a name="l04800"></a>04800 <span class="preprocessor"></span>
<a name="l04801"></a>04801         <span class="keyword">struct </span>{
<a name="l04802"></a>04802             <span class="keyword">struct </span>EcCodeGen    *rightCode;
<a name="l04803"></a>04803         } binary;
<a name="l04804"></a>04804 
<a name="l04805"></a>04805 
<a name="l04806"></a>04806 <span class="preprocessor">        #define N_FOR_IN 33</span>
<a name="l04807"></a>04807 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04808"></a>04808             <span class="keywordtype">int</span>         each;                       <span class="comment">/* For each used */</span>
<a name="l04809"></a>04809             Node        iterVar;
<a name="l04810"></a>04810             Node        iterGet;
<a name="l04811"></a>04811             Node        iterNext;
<a name="l04812"></a>04812             Node        body;
<a name="l04813"></a>04813             <span class="keyword">struct </span>EcCodeGen    *initCode;
<a name="l04814"></a>04814             <span class="keyword">struct </span>EcCodeGen    *bodyCode;
<a name="l04815"></a>04815         } forInLoop;
<a name="l04816"></a>04816 
<a name="l04817"></a>04817 
<a name="l04818"></a>04818         <span class="comment">/*</span>
<a name="l04819"></a>04819 <span class="comment">            Used by for and while</span>
<a name="l04820"></a>04820 <span class="comment">         */</span>
<a name="l04821"></a>04821 <span class="preprocessor">        #define N_FOR   32</span>
<a name="l04822"></a>04822 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04823"></a>04823             Node        initializer;
<a name="l04824"></a>04824             Node        cond;
<a name="l04825"></a>04825             Node        perLoop;
<a name="l04826"></a>04826             Node        body;
<a name="l04827"></a>04827             <span class="keyword">struct </span>EcCodeGen    *condCode;
<a name="l04828"></a>04828             <span class="keyword">struct </span>EcCodeGen    *bodyCode;
<a name="l04829"></a>04829             <span class="keyword">struct </span>EcCodeGen    *perLoopCode;
<a name="l04830"></a>04830         } forLoop;
<a name="l04831"></a>04831 
<a name="l04832"></a>04832 
<a name="l04833"></a>04833 <span class="preprocessor">        #define N_DO    51</span>
<a name="l04834"></a>04834 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04835"></a>04835             Node        cond;
<a name="l04836"></a>04836             Node        body;
<a name="l04837"></a>04837             <span class="keyword">struct </span>EcCodeGen    *condCode;
<a name="l04838"></a>04838             <span class="keyword">struct </span>EcCodeGen    *bodyCode;
<a name="l04839"></a>04839         } doWhile;
<a name="l04840"></a>04840 
<a name="l04841"></a>04841 
<a name="l04842"></a>04842         <span class="comment">/*  OPT - convert to grouping  */</span>
<a name="l04843"></a>04843 <span class="preprocessor">        #define N_UNARY_OP  9</span>
<a name="l04844"></a>04844 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04845"></a>04845             <span class="keywordtype">int</span>         dummy;
<a name="l04846"></a>04846         } unary;
<a name="l04847"></a>04847 
<a name="l04848"></a>04848 
<a name="l04849"></a>04849 <span class="preprocessor">        #define N_IF  10</span>
<a name="l04850"></a>04850 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04851"></a>04851             Node                cond;
<a name="l04852"></a>04852             Node                thenBlock;
<a name="l04853"></a>04853             Node                elseBlock;
<a name="l04854"></a>04854             <span class="keyword">struct </span>EcCodeGen    *thenCode;
<a name="l04855"></a>04855             <span class="keyword">struct </span>EcCodeGen    *elseCode;
<a name="l04856"></a>04856         } tenary;
<a name="l04857"></a>04857 
<a name="l04858"></a>04858 
<a name="l04859"></a>04859 <span class="preprocessor">        #define N_HASH  55</span>
<a name="l04860"></a>04860 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04861"></a>04861             Node        expr;
<a name="l04862"></a>04862             Node        body;
<a name="l04863"></a>04863             <span class="keywordtype">bool</span>        disabled;
<a name="l04864"></a>04864         } hash;
<a name="l04865"></a>04865 
<a name="l04866"></a>04866 
<a name="l04867"></a>04867 <span class="preprocessor">        #define N_VAR_DEFINITION  11</span>
<a name="l04868"></a>04868 <span class="preprocessor"></span>        <span class="comment">/*</span>
<a name="l04869"></a>04869 <span class="comment">            Var definitions have one child per variable. Child nodes can</span>
<a name="l04870"></a>04870 <span class="comment">            be either N_NAME or N_ASSIGN_OP</span>
<a name="l04871"></a>04871 <span class="comment">         */</span>
<a name="l04872"></a>04872         <span class="keyword">struct </span>{
<a name="l04873"></a>04873             <span class="keywordtype">int</span>         varKind;            <span class="comment">/* Variable definition kind */</span>
<a name="l04874"></a>04874         } def;
<a name="l04875"></a>04875 
<a name="l04876"></a>04876 
<a name="l04877"></a>04877         <span class="comment">//  TODO - split apart into separate AST nodes.</span>
<a name="l04878"></a>04878         <span class="comment">/*</span>
<a name="l04879"></a>04879 <span class="comment">           Pragmas: use strict, use standard</span>
<a name="l04880"></a>04880 <span class="comment">         */</span>
<a name="l04881"></a>04881 <span class="preprocessor">        #define N_PRAGMA  12</span>
<a name="l04882"></a>04882 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04883"></a>04883             Node        decimalContext;     <span class="comment">/* use decimal expr */</span>
<a name="l04884"></a>04884             uint        strict;             <span class="comment">/* Strict mode */</span>
<a name="l04885"></a>04885             <span class="keywordtype">char</span>        *moduleName;        <span class="comment">/* Module name value */</span>
<a name="l04886"></a>04886         } pragma;
<a name="l04887"></a>04887 
<a name="l04888"></a>04888 
<a name="l04889"></a>04889         <span class="comment">/*</span>
<a name="l04890"></a>04890 <span class="comment">            Module defintions</span>
<a name="l04891"></a>04891 <span class="comment">         */</span>
<a name="l04892"></a>04892 <span class="preprocessor">        #define N_MODULE 52</span>
<a name="l04893"></a>04893 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04894"></a>04894             EjsModule   *ref;               <span class="comment">/* Module object */</span>
<a name="l04895"></a>04895             <span class="keywordtype">char</span>        *filename;          <span class="comment">/* Module file name */</span>
<a name="l04896"></a>04896             <span class="keywordtype">char</span>        *name;              <span class="comment">/* Module name */</span>
<a name="l04897"></a>04897             <span class="keywordtype">int</span>         version;
<a name="l04898"></a>04898         } module;
<a name="l04899"></a>04899 
<a name="l04900"></a>04900 
<a name="l04901"></a>04901         <span class="comment">/*</span>
<a name="l04902"></a>04902 <span class="comment">            Use module</span>
<a name="l04903"></a>04903 <span class="comment">         */</span>
<a name="l04904"></a>04904 <span class="preprocessor">        #define N_USE_MODULE 53</span>
<a name="l04905"></a>04905 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04906"></a>04906             <span class="keywordtype">int</span>         minVersion;
<a name="l04907"></a>04907             <span class="keywordtype">int</span>         maxVersion;
<a name="l04908"></a>04908         } useModule;
<a name="l04909"></a>04909 
<a name="l04910"></a>04910 
<a name="l04911"></a>04911         <span class="comment">/*</span>
<a name="l04912"></a>04912 <span class="comment">            use namespace, use default namespace</span>
<a name="l04913"></a>04913 <span class="comment">         */</span>
<a name="l04914"></a>04914 <span class="preprocessor">        #define N_USE_NAMESPACE  49</span>
<a name="l04915"></a>04915 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04916"></a>04916             <span class="keywordtype">int</span>         isDefault;          <span class="comment">/* "use default" */</span>
<a name="l04917"></a>04917             <span class="keywordtype">int</span>         isLiteral;          <span class="comment">/* use namespace "literal" */</span>
<a name="l04918"></a>04918             <span class="keywordtype">int</span>         isInternal;         <span class="comment">/* internal namespace */</span>
<a name="l04919"></a>04919         } useNamespace;
<a name="l04920"></a>04920 
<a name="l04921"></a>04921 
<a name="l04922"></a>04922 <span class="preprocessor">        #define N_FUNCTION 14</span>
<a name="l04923"></a>04923 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04924"></a>04924             uint        operatorFn : 1;     <span class="comment">/* operator function */</span>
<a name="l04925"></a>04925             uint        getter : 1;         <span class="comment">/* getter function */</span>
<a name="l04926"></a>04926             uint        setter : 1;         <span class="comment">/* setter function */</span>
<a name="l04927"></a>04927             uint        call : 1;           <span class="comment">/* */</span>
<a name="l04928"></a>04928             uint        has : 1;            <span class="comment">/* */</span>
<a name="l04929"></a>04929             uint        hasRest : 1;        <span class="comment">/* Has rest parameter */</span>
<a name="l04930"></a>04930             uint        hasReturn : 1;      <span class="comment">/* Has a return statement */</span>
<a name="l04931"></a>04931             uint        isMethod : 1;       <span class="comment">/* Is a class method */</span>
<a name="l04932"></a>04932             uint        isConstructor : 1;  <span class="comment">/* Is constructor method */</span>
<a name="l04933"></a>04933             uint        isDefaultConstructor : 1;<span class="comment">/* Is default constructor */</span>
<a name="l04934"></a>04934             Node        resultType;         <span class="comment">/* Function return type */</span>
<a name="l04935"></a>04935             Node        body;               <span class="comment">/* Function body */</span>
<a name="l04936"></a>04936             Node        parameters;         <span class="comment">/* Function formal parameters */</span>
<a name="l04937"></a>04937             Node        constructorSettings;<span class="comment">/* Constructor settings */</span>
<a name="l04938"></a>04938 
<a name="l04939"></a>04939             <span class="comment">/*</span>
<a name="l04940"></a>04940 <span class="comment">                Bound definition</span>
<a name="l04941"></a>04941 <span class="comment">             */</span>
<a name="l04942"></a>04942             EjsFunction *functionVar;       <span class="comment">/* Function variable */</span>
<a name="l04943"></a>04943             Node        expressionRef;      <span class="comment">/* Reference to the function expression name */</span>
<a name="l04944"></a>04944 
<a name="l04945"></a>04945         } function;
<a name="l04946"></a>04946 
<a name="l04947"></a>04947 <span class="preprocessor">        #define N_END_FUNCTION 40</span>
<a name="l04948"></a>04948 <span class="preprocessor"></span>
<a name="l04949"></a>04949 <span class="preprocessor">        #define N_PARAMETER 15</span>
<a name="l04950"></a>04950 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04951"></a>04951             <span class="keywordtype">char</span>        *type;              <span class="comment">/* Parameter type */</span>
<a name="l04952"></a>04952             <span class="keywordtype">char</span>        *value;             <span class="comment">/* Default value */</span>
<a name="l04953"></a>04953             <span class="keywordtype">int</span>         isRest : 1;         <span class="comment">/* Is rest parameter */</span>
<a name="l04954"></a>04954         } parameter;
<a name="l04955"></a>04955 
<a name="l04956"></a>04956 
<a name="l04957"></a>04957         <span class="comment">/*</span>
<a name="l04958"></a>04958 <span class="comment">            Body stored in the child node</span>
<a name="l04959"></a>04959 <span class="comment">         */</span>
<a name="l04960"></a>04960 <span class="preprocessor">        #define N_CLASS  16</span>
<a name="l04961"></a>04961 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04962"></a>04962             <span class="keywordtype">char</span>        *extends;           <span class="comment">/* Class base class */</span>
<a name="l04963"></a>04963             Node        implements;         <span class="comment">/* Implemented interfaces */</span>
<a name="l04964"></a>04964             MprList     *staticProperties;  <span class="comment">/* List of static properties */</span>
<a name="l04965"></a>04965             MprList     *instanceProperties;<span class="comment">/* Implemented interfaces */</span>
<a name="l04966"></a>04966             MprList     *classMethods;      <span class="comment">/* Static methods */</span>
<a name="l04967"></a>04967             MprList     *methods;           <span class="comment">/* Instance methods */</span>
<a name="l04968"></a>04968             Node        constructor;        <span class="comment">/* Class constructor */</span>
<a name="l04969"></a>04969             <span class="keywordtype">int</span>         isInterface;        <span class="comment">/* This is an interface */</span>
<a name="l04970"></a>04970 
<a name="l04971"></a>04971             EjsType     *ref;               <span class="comment">/* Type instance ref */</span>
<a name="l04972"></a>04972             EjsFunction *initializer;       <span class="comment">/* Initializer function */</span>
<a name="l04973"></a>04973 
<a name="l04974"></a>04974             EjsNamespace *publicSpace;
<a name="l04975"></a>04975             EjsNamespace *internalSpace;
<a name="l04976"></a>04976 
<a name="l04977"></a>04977         } klass;
<a name="l04978"></a>04978 
<a name="l04979"></a>04979 
<a name="l04980"></a>04980 <span class="preprocessor">        #define N_DIRECTIVES 18</span>
<a name="l04981"></a>04981 <span class="preprocessor"></span>
<a name="l04982"></a>04982 <span class="preprocessor">        #define N_SUPER 35</span>
<a name="l04983"></a>04983 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04984"></a>04984             <span class="keywordtype">int</span>         dummy;
<a name="l04985"></a>04985         } super;
<a name="l04986"></a>04986 
<a name="l04987"></a>04987 
<a name="l04988"></a>04988 <span class="preprocessor">        #define N_NEW 31</span>
<a name="l04989"></a>04989 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04990"></a>04990             <span class="keywordtype">int</span>         callConstructors;   <span class="comment">/* Bound type has a constructor */</span>
<a name="l04991"></a>04991         } newExpr;
<a name="l04992"></a>04992 
<a name="l04993"></a>04993 
<a name="l04994"></a>04994 <span class="preprocessor">        #define N_TRY 36</span>
<a name="l04995"></a>04995 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l04996"></a>04996             <span class="comment">/* Children are the catch clauses */</span>
<a name="l04997"></a>04997             Node        tryBlock;           <span class="comment">/* Try code */</span>
<a name="l04998"></a>04998             Node        catchClauses;       <span class="comment">/* Catch clauses */</span>
<a name="l04999"></a>04999             Node        finallyBlock;       <span class="comment">/* Finally code */</span>
<a name="l05000"></a>05000             <span class="keywordtype">int</span>         numBlocks;          <span class="comment">/* Count of open blocks in the try block */</span>
<a name="l05001"></a>05001         } exception;
<a name="l05002"></a>05002 
<a name="l05003"></a>05003 
<a name="l05004"></a>05004 <span class="preprocessor">        #define N_CATCH 37</span>
<a name="l05005"></a>05005 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l05006"></a>05006             Node        arg;                <span class="comment">/* Catch block argument */</span>
<a name="l05007"></a>05007         } catchBlock;
<a name="l05008"></a>05008 
<a name="l05009"></a>05009 
<a name="l05010"></a>05010 <span class="preprocessor">        #define N_CALL 28</span>
<a name="l05011"></a>05011 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l05012"></a>05012             <span class="keywordtype">int</span>         dummmy;
<a name="l05013"></a>05013         } call;
<a name="l05014"></a>05014 
<a name="l05015"></a>05015 
<a name="l05016"></a>05016 <span class="preprocessor">        #define N_PROGRAM 20</span>
<a name="l05017"></a>05017 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l05018"></a>05018             MprList     *dependencies;      <span class="comment">/* Accumulated list of dependent modules */</span>
<a name="l05019"></a>05019         } program;
<a name="l05020"></a>05020 
<a name="l05021"></a>05021 
<a name="l05022"></a>05022         <span class="comment">/*</span>
<a name="l05023"></a>05023 <span class="comment">            Block kinds</span>
<a name="l05024"></a>05024 <span class="comment">         */</span>
<a name="l05025"></a>05025 <span class="preprocessor">        #define EC_CLASS_BLOCK      1</span>
<a name="l05026"></a>05026 <span class="preprocessor"></span><span class="preprocessor">        #define EC_FUNCTION_BLOCK   2</span>
<a name="l05027"></a>05027 <span class="preprocessor"></span><span class="preprocessor">        #define EC_INTERFACE_BLOCK  3</span>
<a name="l05028"></a>05028 <span class="preprocessor"></span><span class="preprocessor">        #define EC_NESTED_BLOCK     4</span>
<a name="l05029"></a>05029 <span class="preprocessor"></span><span class="preprocessor">        #define EC_GLOBAL_BLOCK     5</span>
<a name="l05030"></a>05030 <span class="preprocessor"></span><span class="preprocessor">        #define EC_MODULE_BLOCK     6</span>
<a name="l05031"></a>05031 <span class="preprocessor"></span>
<a name="l05032"></a>05032 <span class="preprocessor">        #define N_BLOCK 25</span>
<a name="l05033"></a>05033 <span class="preprocessor"></span>
<a name="l05034"></a>05034         <span class="comment">//  MOB -- what does this actually do? - why not just use children?</span>
<a name="l05035"></a>05035 <span class="preprocessor">        #define N_REF 42</span>
<a name="l05036"></a>05036 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l05037"></a>05037             Node        node;               <span class="comment">/* Actual node reference */</span>
<a name="l05038"></a>05038         } ref;
<a name="l05039"></a>05039 
<a name="l05040"></a>05040 
<a name="l05041"></a>05041 <span class="preprocessor">        #define N_SWITCH 43</span>
<a name="l05042"></a>05042 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l05043"></a>05043             <span class="keywordtype">int</span>         dummy;
<a name="l05044"></a>05044         } switchNode;
<a name="l05045"></a>05045 
<a name="l05046"></a>05046 
<a name="l05047"></a>05047 <span class="preprocessor">        #define EC_SWITCH_KIND_CASE     1   </span><span class="comment">/* Case block */</span>
<a name="l05048"></a>05048 <span class="preprocessor">        #define EC_SWITCH_KIND_DEFAULT  2   </span><span class="comment">/* Default block */</span>
<a name="l05049"></a>05049 
<a name="l05050"></a>05050 <span class="preprocessor">        #define N_CASE_LABEL 44</span>
<a name="l05051"></a>05051 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l05052"></a>05052             Node                expression;
<a name="l05053"></a>05053             <span class="keywordtype">int</span>                 kind;
<a name="l05054"></a>05054             <span class="keyword">struct </span>EcCodeGen    *expressionCode;    <span class="comment">/* Code buffer for the case expression */</span>
<a name="l05055"></a>05055             <span class="keywordtype">int</span>                 nextCaseCode;       <span class="comment">/* Goto length to the next case statements */</span>
<a name="l05056"></a>05056         } caseLabel;
<a name="l05057"></a>05057 
<a name="l05058"></a>05058 <span class="preprocessor">        #define N_THIS 30</span>
<a name="l05059"></a>05059 <span class="preprocessor"></span>
<a name="l05060"></a>05060 <span class="preprocessor">        #define N_THIS_GENERATOR    1</span>
<a name="l05061"></a>05061 <span class="preprocessor"></span><span class="preprocessor">        #define N_THIS_CALLEE       2</span>
<a name="l05062"></a>05062 <span class="preprocessor"></span><span class="preprocessor">        #define N_THIS_TYPE         3</span>
<a name="l05063"></a>05063 <span class="preprocessor"></span><span class="preprocessor">        #define N_THIS_FUNCTION     4</span>
<a name="l05064"></a>05064 <span class="preprocessor"></span>
<a name="l05065"></a>05065         <span class="keyword">struct </span>{
<a name="l05066"></a>05066             <span class="keywordtype">int</span>                 thisKind;   <span class="comment">/* Kind of this. See N_THIS_ flags */</span>
<a name="l05067"></a>05067         } thisNode;
<a name="l05068"></a>05068 
<a name="l05069"></a>05069 <span class="preprocessor">        #define N_CASE_ELEMENTS 45</span>
<a name="l05070"></a>05070 <span class="preprocessor"></span><span class="preprocessor">        #define N_BREAK         46</span>
<a name="l05071"></a>05071 <span class="preprocessor"></span><span class="preprocessor">        #define N_CONTINUE      47</span>
<a name="l05072"></a>05072 <span class="preprocessor"></span><span class="preprocessor">        #define N_GOTO          48</span>
<a name="l05073"></a>05073 <span class="preprocessor"></span>
<a name="l05074"></a>05074 <span class="preprocessor">        #define N_LITERAL       2</span>
<a name="l05075"></a>05075 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l05076"></a>05076             EjsObj              *var;       <span class="comment">/* Special value */</span>
<a name="l05077"></a>05077             MprBuf              *data;      <span class="comment">/* XML data */</span>
<a name="l05078"></a>05078         } literal;
<a name="l05079"></a>05079 
<a name="l05080"></a>05080 <span class="preprocessor">        #define N_OBJECT_LITERAL    56      </span><span class="comment">/* Array or object literal */</span>
<a name="l05081"></a>05081 <span class="preprocessor">        #define N_DASSIGN 62                </span><span class="comment">/* Destructuring assignment */</span>
<a name="l05082"></a>05082         <span class="keyword">struct </span>{
<a name="l05083"></a>05083             Node                typeNode;   <span class="comment">/* Type of object */</span>
<a name="l05084"></a>05084             <span class="keywordtype">int</span>                 isArray;    <span class="comment">/* Array literal */</span>
<a name="l05085"></a>05085         } objectLiteral;
<a name="l05086"></a>05086 
<a name="l05087"></a>05087         <span class="comment">/*</span>
<a name="l05088"></a>05088 <span class="comment">            Object (and Array) literal field</span>
<a name="l05089"></a>05089 <span class="comment">         */</span>
<a name="l05090"></a>05090 <span class="preprocessor">        #define FIELD_KIND_VALUE        0x1</span>
<a name="l05091"></a>05091 <span class="preprocessor"></span><span class="preprocessor">        #define FIELD_KIND_FUNCTION     0x2</span>
<a name="l05092"></a>05092 <span class="preprocessor"></span>
<a name="l05093"></a>05093 <span class="preprocessor">        #define N_FIELD 57</span>
<a name="l05094"></a>05094 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l05095"></a>05095             <span class="keywordtype">int</span>                 fieldKind;  <span class="comment">/* value or function */</span>
<a name="l05096"></a>05096             <span class="keywordtype">int</span>                 varKind;    <span class="comment">/* Variable definition kind (const) */</span>
<a name="l05097"></a>05097             Node                expr;       <span class="comment">/* Field expression */</span>
<a name="l05098"></a>05098             Node                fieldName;  <span class="comment">/* Field element name for objects */</span>
<a name="l05099"></a>05099             <span class="keywordtype">int</span>                 index;      <span class="comment">/* Array index, set to -1 for objects */</span>
<a name="l05100"></a>05100         } field;
<a name="l05101"></a>05101 
<a name="l05102"></a>05102 <span class="preprocessor">        #define N_WITH 60</span>
<a name="l05103"></a>05103 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l05104"></a>05104             Node                object;
<a name="l05105"></a>05105             Node                statement;
<a name="l05106"></a>05106         } with;
<a name="l05107"></a>05107 
<a name="l05108"></a>05108 <span class="preprocessor">        #define N_RETURN 27</span>
<a name="l05109"></a>05109 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l05110"></a>05110             <span class="keywordtype">int</span>                 blockLess;  <span class="comment">/* Block-less function expression */</span>
<a name="l05111"></a>05111         } ret;
<a name="l05112"></a>05112 
<a name="l05113"></a>05113 <span class="preprocessor">        #define N_EXPRESSIONS 22</span>
<a name="l05114"></a>05114 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
<a name="l05115"></a>05115             <span class="keywordtype">char</span>                *space;      <span class="comment">/* Namespace qualifier */</span>
<a name="l05116"></a>05116         } expr;
<a name="l05117"></a>05117 <span class="preprocessor">#if !BLD_DEBUG &amp;&amp; 0</span>
<a name="l05118"></a>05118 <span class="preprocessor"></span>    };
<a name="l05119"></a>05119 <span class="preprocessor">#endif</span>
<a name="l05120"></a>05120 <span class="preprocessor"></span>
<a name="l05121"></a>05121     <span class="keywordtype">int</span>                 kind;               <span class="comment">/* Kind of node */</span>
<a name="l05122"></a>05122     MprList             *children;
<a name="l05123"></a>05123 
<a name="l05124"></a>05124     <span class="keyword">struct </span>EcCompiler   *cp;                <span class="comment">/* Compiler instance reference */</span>
<a name="l05125"></a>05125 
<a name="l05126"></a>05126     <span class="keywordtype">int</span>                 column;             <span class="comment">/* Column of token in currentLine */</span>
<a name="l05127"></a>05127 
<a name="l05128"></a>05128     <span class="comment">/*</span>
<a name="l05129"></a>05129 <span class="comment">        Bound definition. Applies to names and expression values.</span>
<a name="l05130"></a>05130 <span class="comment">     */</span>
<a name="l05131"></a>05131 
<a name="l05132"></a>05132     <span class="keywordtype">int</span>                 slotFixed;          <span class="comment">/* Slot fixup has been done */</span>
<a name="l05133"></a>05133     <span class="keywordtype">int</span>                 needThis;           <span class="comment">/* Need to push this object */</span>
<a name="l05134"></a>05134     <span class="keywordtype">int</span>                 needDupObj;         <span class="comment">/* Need to dup the object on stack (before) */</span>
<a name="l05135"></a>05135     <span class="keywordtype">int</span>                 needDup;            <span class="comment">/* Need to dup the result (after) */</span>
<a name="l05136"></a>05136     <span class="keywordtype">int</span>                 slotNum;            <span class="comment">/* Allocated slot for variable */</span>
<a name="l05137"></a>05137     <span class="keywordtype">int</span>                 enabled;            <span class="comment">/* Node is enabled via conditional definitions */</span>
<a name="l05138"></a>05138 
<a name="l05139"></a>05139     uchar               *patchAddress;      <span class="comment">/* For code patching */</span>
<a name="l05140"></a>05140     <span class="keyword">struct </span>EcCodeGen    *code;              <span class="comment">/* Code buffer */</span>
<a name="l05141"></a>05141     <span class="keywordtype">int</span>                 jumpLength;         <span class="comment">/* Goto length for exceptions */</span>
<a name="l05142"></a>05142 
<a name="l05143"></a>05143     <span class="keywordtype">int</span>                 seqno;              <span class="comment">/* Unique sequence number */</span>
<a name="l05144"></a>05144     EjsName             *globalProp;        <span class="comment">/* Set if this is a global property */</span>
<a name="l05145"></a>05145     <span class="keywordtype">char</span>                *doc;               <span class="comment">/* Documentation string */</span>
<a name="l05146"></a>05146 } EcNode;
<a name="l05147"></a>05147 
<a name="l05148"></a>05148 
<a name="l05149"></a>05149 <span class="comment">/*</span>
<a name="l05150"></a>05150 <span class="comment">    Grouping node types</span>
<a name="l05151"></a>05151 <span class="comment"> */</span>
<a name="l05152"></a>05152 <span class="comment">/* 21 - unused */</span>
<a name="l05153"></a>05153 <span class="preprocessor">#define N_PRAGMAS 23</span>
<a name="l05154"></a>05154 <span class="preprocessor"></span><span class="preprocessor">#define N_TYPE_IDENTIFIERS 24</span>
<a name="l05155"></a>05155 <span class="preprocessor"></span><span class="preprocessor">#define N_DOT 26</span>
<a name="l05156"></a>05156 <span class="preprocessor"></span><span class="preprocessor">#define N_ARGS 29</span>
<a name="l05157"></a>05157 <span class="preprocessor"></span><span class="comment">/* N_new 31 */</span>
<a name="l05158"></a>05158 <span class="comment">/* N_for 32 */</span>
<a name="l05159"></a>05159 <span class="comment">/* N_forIn 33 */</span>
<a name="l05160"></a>05160 <span class="preprocessor">#define N_POSTFIX_OP 34</span>
<a name="l05161"></a>05161 <span class="preprocessor"></span><span class="comment">/* N_try 36 */</span>
<a name="l05162"></a>05162 <span class="comment">/* N_catch 37 */</span>
<a name="l05163"></a>05163 <span class="preprocessor">#define N_CATCH_CLAUSES 38</span>
<a name="l05164"></a>05164 <span class="preprocessor"></span><span class="preprocessor">#define N_THROW 39</span>
<a name="l05165"></a>05165 <span class="preprocessor"></span><span class="preprocessor">#define N_NOP 41</span>
<a name="l05166"></a>05166 <span class="preprocessor"></span><span class="preprocessor">#define N_VOID 54</span>
<a name="l05167"></a>05167 <span class="preprocessor"></span><span class="comment">/* N_HASH 55 */</span>
<a name="l05168"></a>05168 <span class="comment">/* N_OBJECT_LITERAL 56 */</span>
<a name="l05169"></a>05169 <span class="comment">/* N_FIELD 57 */</span>
<a name="l05170"></a>05170 <span class="preprocessor">#define N_ARRAY_LITERAL_UNUSED 58</span>
<a name="l05171"></a>05171 <span class="preprocessor"></span><span class="preprocessor">#define N_CATCH_ARG 59</span>
<a name="l05172"></a>05172 <span class="preprocessor"></span><span class="preprocessor">#define N_WITH 60</span>
<a name="l05173"></a>05173 <span class="preprocessor"></span><span class="preprocessor">#define N_SPREAD 61</span>
<a name="l05174"></a>05174 <span class="preprocessor"></span><span class="comment">/* N_DASSIGN 62 */</span>
<a name="l05175"></a>05175 <span class="comment">/* N_VAR 63 */</span>
<a name="l05176"></a>05176 
<a name="l05177"></a>05177 <span class="preprocessor">#define EC_NUM_NODES                    8</span>
<a name="l05178"></a>05178 <span class="preprocessor"></span><span class="preprocessor">#define EC_TAB_WIDTH                    4</span>
<a name="l05179"></a>05179 <span class="preprocessor"></span>
<a name="l05180"></a>05180 <span class="comment">/*</span>
<a name="l05181"></a>05181 <span class="comment">    Fix clash with arpa/nameser.h</span>
<a name="l05182"></a>05182 <span class="comment"> */</span>
<a name="l05183"></a>05183 <span class="preprocessor">#undef T_NULL</span>
<a name="l05184"></a>05184 <span class="preprocessor"></span>
<a name="l05185"></a>05185 <span class="preprocessor">#if UNUSED &amp;&amp; MOVED</span>
<a name="l05186"></a>05186 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l05187"></a>05187 <span class="comment">    Flags for ecCompile()</span>
<a name="l05188"></a>05188 <span class="comment"> */</span>
<a name="l05189"></a>05189 <span class="preprocessor">#define EC_FLAGS_BIND            0x1                    </span><span class="comment">/* Bind global references and type/object properties */</span>
<a name="l05190"></a>05190 <span class="preprocessor">#define EC_FLAGS_DEBUG           0x2                    </span><span class="comment">/* Generate symbolic debugging information */</span>
<a name="l05191"></a>05191 <span class="preprocessor">#define EC_FLAGS_MERGE           0x8                    </span><span class="comment">/* Merge all output onto one output file */</span>
<a name="l05192"></a>05192 <span class="preprocessor">#define EC_FLAGS_NO_OUT          0x10                   </span><span class="comment">/* Don't generate any output file */</span>
<a name="l05193"></a>05193 <span class="preprocessor">#define EC_FLAGS_PARSE_ONLY      0x20                   </span><span class="comment">/* Just parse source. Don't generate code */</span>
<a name="l05194"></a>05194 <span class="preprocessor">#define EC_FLAGS_THROW           0x40                   </span><span class="comment">/* Throw errors when compiling. Used for eval() */</span>
<a name="l05195"></a>05195 <span class="preprocessor">#endif</span>
<a name="l05196"></a>05196 <span class="preprocessor"></span>
<a name="l05197"></a>05197 <span class="comment">/*</span>
<a name="l05198"></a>05198 <span class="comment">    Lexical tokens (must start at 1)</span>
<a name="l05199"></a>05199 <span class="comment">    ASSIGN tokens must be +1 compared to their non-assignment counterparts.</span>
<a name="l05200"></a>05200 <span class="comment"> */</span>
<a name="l05201"></a>05201 <span class="preprocessor">#define T_AS 1</span>
<a name="l05202"></a>05202 <span class="preprocessor"></span><span class="preprocessor">#define T_ASSIGN 2</span>
<a name="l05203"></a>05203 <span class="preprocessor"></span><span class="preprocessor">#define T_AT 3</span>
<a name="l05204"></a>05204 <span class="preprocessor"></span><span class="preprocessor">#define T_ATTRIBUTE 4</span>
<a name="l05205"></a>05205 <span class="preprocessor"></span><span class="preprocessor">#define T_BIT_AND 5</span>
<a name="l05206"></a>05206 <span class="preprocessor"></span><span class="preprocessor">#define T_BIT_AND_ASSIGN 6</span>
<a name="l05207"></a>05207 <span class="preprocessor"></span><span class="preprocessor">#define T_BIT_OR 7</span>
<a name="l05208"></a>05208 <span class="preprocessor"></span><span class="preprocessor">#define T_BIT_OR_ASSIGN 8</span>
<a name="l05209"></a>05209 <span class="preprocessor"></span><span class="preprocessor">#define T_BIT_XOR 9</span>
<a name="l05210"></a>05210 <span class="preprocessor"></span><span class="preprocessor">#define T_BIT_XOR_ASSIGN 10</span>
<a name="l05211"></a>05211 <span class="preprocessor"></span><span class="preprocessor">#define T_BREAK 11</span>
<a name="l05212"></a>05212 <span class="preprocessor"></span><span class="preprocessor">#define T_CALL 12</span>
<a name="l05213"></a>05213 <span class="preprocessor"></span><span class="preprocessor">#define T_CASE 13</span>
<a name="l05214"></a>05214 <span class="preprocessor"></span><span class="preprocessor">#define T_CAST 14</span>
<a name="l05215"></a>05215 <span class="preprocessor"></span><span class="preprocessor">#define T_CATCH 15</span>
<a name="l05216"></a>05216 <span class="preprocessor"></span><span class="preprocessor">#define T_CLASS 16</span>
<a name="l05217"></a>05217 <span class="preprocessor"></span><span class="comment">/* TODO - remove and resequence #define T_CLOSE_TAG 17 */</span>
<a name="l05218"></a>05218 <span class="preprocessor">#define T_COLON 18</span>
<a name="l05219"></a>05219 <span class="preprocessor"></span><span class="preprocessor">#define T_COLON_COLON 19</span>
<a name="l05220"></a>05220 <span class="preprocessor"></span><span class="preprocessor">#define T_COMMA 20</span>
<a name="l05221"></a>05221 <span class="preprocessor"></span><span class="preprocessor">#define T_CONST 21</span>
<a name="l05222"></a>05222 <span class="preprocessor"></span><span class="preprocessor">#define T_CONTEXT_RESERVED_ID 22</span>
<a name="l05223"></a>05223 <span class="preprocessor"></span><span class="preprocessor">#define T_CONTINUE 23</span>
<a name="l05224"></a>05224 <span class="preprocessor"></span><span class="preprocessor">#define T_DEBUGGER 24</span>
<a name="l05225"></a>05225 <span class="preprocessor"></span><span class="preprocessor">#define T_DECIMAL 25                    //  UNUSED</span>
<a name="l05226"></a>05226 <span class="preprocessor"></span><span class="preprocessor">#define T_DECREMENT 26</span>
<a name="l05227"></a>05227 <span class="preprocessor"></span><span class="preprocessor">#define T_DEFAULT 27</span>
<a name="l05228"></a>05228 <span class="preprocessor"></span><span class="preprocessor">#define T_DELETE 28</span>
<a name="l05229"></a>05229 <span class="preprocessor"></span><span class="preprocessor">#define T_DIV 29</span>
<a name="l05230"></a>05230 <span class="preprocessor"></span><span class="preprocessor">#define T_DIV_ASSIGN 30</span>
<a name="l05231"></a>05231 <span class="preprocessor"></span><span class="preprocessor">#define T_DO 31</span>
<a name="l05232"></a>05232 <span class="preprocessor"></span><span class="preprocessor">#define T_DOT 32</span>
<a name="l05233"></a>05233 <span class="preprocessor"></span><span class="preprocessor">#define T_DOT_DOT 33</span>
<a name="l05234"></a>05234 <span class="preprocessor"></span><span class="preprocessor">#define T_DOT_LESS 34</span>
<a name="l05235"></a>05235 <span class="preprocessor"></span><span class="preprocessor">#define T_DOUBLE 35</span>
<a name="l05236"></a>05236 <span class="preprocessor"></span><span class="preprocessor">#define T_DYNAMIC 36</span>
<a name="l05237"></a>05237 <span class="preprocessor"></span><span class="preprocessor">#define T_EACH 37</span>
<a name="l05238"></a>05238 <span class="preprocessor"></span><span class="preprocessor">#define T_ELIPSIS 38</span>
<a name="l05239"></a>05239 <span class="preprocessor"></span><span class="preprocessor">#define T_ELSE 39</span>
<a name="l05240"></a>05240 <span class="preprocessor"></span><span class="preprocessor">#define T_ENUMERABLE 40</span>
<a name="l05241"></a>05241 <span class="preprocessor"></span><span class="preprocessor">#define T_EOF 41</span>
<a name="l05242"></a>05242 <span class="preprocessor"></span><span class="preprocessor">#define T_EQ 42</span>
<a name="l05243"></a>05243 <span class="preprocessor"></span><span class="preprocessor">#define T_EXTENDS 43</span>
<a name="l05244"></a>05244 <span class="preprocessor"></span><span class="preprocessor">#define T_FALSE 44</span>
<a name="l05245"></a>05245 <span class="preprocessor"></span><span class="preprocessor">#define T_FINAL 45</span>
<a name="l05246"></a>05246 <span class="preprocessor"></span><span class="preprocessor">#define T_FINALLY 46</span>
<a name="l05247"></a>05247 <span class="preprocessor"></span><span class="preprocessor">#define T_FLOAT 47</span>
<a name="l05248"></a>05248 <span class="preprocessor"></span><span class="preprocessor">#define T_FOR 48</span>
<a name="l05249"></a>05249 <span class="preprocessor"></span><span class="preprocessor">#define T_FUNCTION 49</span>
<a name="l05250"></a>05250 <span class="preprocessor"></span><span class="preprocessor">#define T_GE 50</span>
<a name="l05251"></a>05251 <span class="preprocessor"></span><span class="preprocessor">#define T_GET 51</span>
<a name="l05252"></a>05252 <span class="preprocessor"></span><span class="preprocessor">#define T_GOTO 52</span>
<a name="l05253"></a>05253 <span class="preprocessor"></span><span class="preprocessor">#define T_GT 53</span>
<a name="l05254"></a>05254 <span class="preprocessor"></span><span class="preprocessor">#define T_ID 54</span>
<a name="l05255"></a>05255 <span class="preprocessor"></span><span class="preprocessor">#define T_IF 55</span>
<a name="l05256"></a>05256 <span class="preprocessor"></span><span class="preprocessor">#define T_IMPLEMENTS 56</span>
<a name="l05257"></a>05257 <span class="preprocessor"></span><span class="preprocessor">#define T_IMPORT 57</span>
<a name="l05258"></a>05258 <span class="preprocessor"></span><span class="preprocessor">#define T_IN 58</span>
<a name="l05259"></a>05259 <span class="preprocessor"></span><span class="preprocessor">#define T_INCLUDE 59</span>
<a name="l05260"></a>05260 <span class="preprocessor"></span><span class="preprocessor">#define T_INCREMENT 60</span>
<a name="l05261"></a>05261 <span class="preprocessor"></span><span class="preprocessor">#define T_INSTANCEOF 61</span>
<a name="l05262"></a>05262 <span class="preprocessor"></span><span class="preprocessor">#define T_INT 62</span>
<a name="l05263"></a>05263 <span class="preprocessor"></span><span class="preprocessor">#define T_INTERFACE 64</span>
<a name="l05264"></a>05264 <span class="preprocessor"></span><span class="preprocessor">#define T_INTERNAL 65</span>
<a name="l05265"></a>05265 <span class="preprocessor"></span><span class="preprocessor">#define T_INTRINSIC 66</span>
<a name="l05266"></a>05266 <span class="preprocessor"></span><span class="preprocessor">#define T_IS 67</span>
<a name="l05267"></a>05267 <span class="preprocessor"></span><span class="preprocessor">#define T_LBRACE 68</span>
<a name="l05268"></a>05268 <span class="preprocessor"></span><span class="preprocessor">#define T_LBRACKET 69</span>
<a name="l05269"></a>05269 <span class="preprocessor"></span><span class="preprocessor">#define T_LE 70</span>
<a name="l05270"></a>05270 <span class="preprocessor"></span><span class="preprocessor">#define T_LET 71</span>
<a name="l05271"></a>05271 <span class="preprocessor"></span><span class="preprocessor">#define T_LOGICAL_AND 72</span>
<a name="l05272"></a>05272 <span class="preprocessor"></span><span class="preprocessor">#define T_LOGICAL_AND_ASSIGN 73</span>
<a name="l05273"></a>05273 <span class="preprocessor"></span><span class="preprocessor">#define T_LOGICAL_NOT 74</span>
<a name="l05274"></a>05274 <span class="preprocessor"></span><span class="preprocessor">#define T_LOGICAL_OR 75</span>
<a name="l05275"></a>05275 <span class="preprocessor"></span><span class="preprocessor">#define T_LOGICAL_OR_ASSIGN 76</span>
<a name="l05276"></a>05276 <span class="preprocessor"></span><span class="preprocessor">#define T_LOGICAL_XOR 77</span>
<a name="l05277"></a>05277 <span class="preprocessor"></span><span class="preprocessor">#define T_LOGICAL_XOR_ASSIGN 78</span>
<a name="l05278"></a>05278 <span class="preprocessor"></span><span class="preprocessor">#define T_LPAREN 79</span>
<a name="l05279"></a>05279 <span class="preprocessor"></span><span class="preprocessor">#define T_LSH 80</span>
<a name="l05280"></a>05280 <span class="preprocessor"></span><span class="preprocessor">#define T_LSH_ASSIGN 81</span>
<a name="l05281"></a>05281 <span class="preprocessor"></span><span class="preprocessor">#define T_LT 82</span>
<a name="l05282"></a>05282 <span class="preprocessor"></span><span class="preprocessor">#define T_MINUS 83</span>
<a name="l05283"></a>05283 <span class="preprocessor"></span><span class="preprocessor">#define T_MINUS_ASSIGN 84</span>
<a name="l05284"></a>05284 <span class="preprocessor"></span><span class="preprocessor">#define T_MINUS_MINUS 85</span>
<a name="l05285"></a>05285 <span class="preprocessor"></span><span class="preprocessor">#define T_MOD 86</span>
<a name="l05286"></a>05286 <span class="preprocessor"></span><span class="preprocessor">#define T_MOD_ASSIGN 87</span>
<a name="l05287"></a>05287 <span class="preprocessor"></span><span class="preprocessor">#define T_MODULE 88</span>
<a name="l05288"></a>05288 <span class="preprocessor"></span><span class="preprocessor">#define T_MUL 89</span>
<a name="l05289"></a>05289 <span class="preprocessor"></span><span class="preprocessor">#define T_MUL_ASSIGN 90</span>
<a name="l05290"></a>05290 <span class="preprocessor"></span><span class="preprocessor">#define T_NAMESPACE 91</span>
<a name="l05291"></a>05291 <span class="preprocessor"></span><span class="preprocessor">#define T_NATIVE 92</span>
<a name="l05292"></a>05292 <span class="preprocessor"></span><span class="preprocessor">#define T_NE 93</span>
<a name="l05293"></a>05293 <span class="preprocessor"></span><span class="preprocessor">#define T_NEW 94</span>
<a name="l05294"></a>05294 <span class="preprocessor"></span><span class="preprocessor">#define T_NULL 95</span>
<a name="l05295"></a>05295 <span class="preprocessor"></span><span class="preprocessor">#define T_NUMBER 96</span>
<a name="l05296"></a>05296 <span class="preprocessor"></span><span class="comment">/* TODO - remove and resequence #define T_OPEN_TAG 97 */</span>
<a name="l05297"></a>05297 <span class="preprocessor">#define T_OVERRIDE 98</span>
<a name="l05298"></a>05298 <span class="preprocessor"></span><span class="comment">//  TODO #define    T_PACKAGE 99</span>
<a name="l05299"></a>05299 <span class="preprocessor">#define T_PLUS 100</span>
<a name="l05300"></a>05300 <span class="preprocessor"></span><span class="preprocessor">#define T_PLUS_ASSIGN 101</span>
<a name="l05301"></a>05301 <span class="preprocessor"></span><span class="preprocessor">#define T_PLUS_PLUS 102</span>
<a name="l05302"></a>05302 <span class="preprocessor"></span><span class="preprocessor">#define T_PRIVATE 103</span>
<a name="l05303"></a>05303 <span class="preprocessor"></span><span class="preprocessor">#define T_PROTECTED 104</span>
<a name="l05304"></a>05304 <span class="preprocessor"></span><span class="preprocessor">#define T_PROTOTYPE 105</span>
<a name="l05305"></a>05305 <span class="preprocessor"></span><span class="preprocessor">#define T_PUBLIC 106</span>
<a name="l05306"></a>05306 <span class="preprocessor"></span><span class="preprocessor">#define T_QUERY 107</span>
<a name="l05307"></a>05307 <span class="preprocessor"></span><span class="preprocessor">#define T_RBRACE 108</span>
<a name="l05308"></a>05308 <span class="preprocessor"></span><span class="preprocessor">#define T_RBRACKET 109</span>
<a name="l05309"></a>05309 <span class="preprocessor"></span><span class="preprocessor">#define T_READONLY 110</span>
<a name="l05310"></a>05310 <span class="preprocessor"></span><span class="preprocessor">#define T_RETURN 111</span>
<a name="l05311"></a>05311 <span class="preprocessor"></span><span class="preprocessor">#define T_ROUNDING 112</span>
<a name="l05312"></a>05312 <span class="preprocessor"></span><span class="preprocessor">#define T_RPAREN 113</span>
<a name="l05313"></a>05313 <span class="preprocessor"></span><span class="preprocessor">#define T_RSH 114</span>
<a name="l05314"></a>05314 <span class="preprocessor"></span><span class="preprocessor">#define T_RSH_ASSIGN 115</span>
<a name="l05315"></a>05315 <span class="preprocessor"></span><span class="preprocessor">#define T_RSH_ZERO 116</span>
<a name="l05316"></a>05316 <span class="preprocessor"></span><span class="preprocessor">#define T_RSH_ZERO_ASSIGN 117</span>
<a name="l05317"></a>05317 <span class="preprocessor"></span><span class="preprocessor">#define T_SEMICOLON 118</span>
<a name="l05318"></a>05318 <span class="preprocessor"></span><span class="preprocessor">#define T_SET 119</span>
<a name="l05319"></a>05319 <span class="preprocessor"></span><span class="preprocessor">#define T_RESERVED_NAMESPACE 120</span>
<a name="l05320"></a>05320 <span class="preprocessor"></span><span class="preprocessor">#define T_STANDARD 121</span>
<a name="l05321"></a>05321 <span class="preprocessor"></span><span class="preprocessor">#define T_STATIC 122</span>
<a name="l05322"></a>05322 <span class="preprocessor"></span><span class="preprocessor">#define T_STRICT 123</span>
<a name="l05323"></a>05323 <span class="preprocessor"></span><span class="preprocessor">#define T_STRICT_EQ 124</span>
<a name="l05324"></a>05324 <span class="preprocessor"></span><span class="preprocessor">#define T_STRICT_NE 125</span>
<a name="l05325"></a>05325 <span class="preprocessor"></span><span class="preprocessor">#define T_STRING 126</span>
<a name="l05326"></a>05326 <span class="preprocessor"></span><span class="preprocessor">#define T_SUPER 127</span>
<a name="l05327"></a>05327 <span class="preprocessor"></span><span class="preprocessor">#define T_SWITCH 128</span>
<a name="l05328"></a>05328 <span class="preprocessor"></span><span class="preprocessor">#define T_SYNCHRONIZED 129</span>
<a name="l05329"></a>05329 <span class="preprocessor"></span><span class="preprocessor">#define T_THIS 130</span>
<a name="l05330"></a>05330 <span class="preprocessor"></span><span class="preprocessor">#define T_THROW 131</span>
<a name="l05331"></a>05331 <span class="preprocessor"></span><span class="preprocessor">#define T_TILDE 132</span>
<a name="l05332"></a>05332 <span class="preprocessor"></span><span class="preprocessor">#define T_TO 133</span>
<a name="l05333"></a>05333 <span class="preprocessor"></span><span class="preprocessor">#define T_TRUE 134</span>
<a name="l05334"></a>05334 <span class="preprocessor"></span><span class="preprocessor">#define T_TRY 135</span>
<a name="l05335"></a>05335 <span class="preprocessor"></span><span class="preprocessor">#define T_TYPE 136</span>
<a name="l05336"></a>05336 <span class="preprocessor"></span><span class="preprocessor">#define T_TYPEOF 137</span>
<a name="l05337"></a>05337 <span class="preprocessor"></span><span class="preprocessor">#define T_UINT 138</span>
<a name="l05338"></a>05338 <span class="preprocessor"></span><span class="preprocessor">#define T_USE 139</span>
<a name="l05339"></a>05339 <span class="preprocessor"></span><span class="preprocessor">#define T_VAR 140</span>
<a name="l05340"></a>05340 <span class="preprocessor"></span><span class="preprocessor">#define T_VOID 141</span>
<a name="l05341"></a>05341 <span class="preprocessor"></span><span class="preprocessor">#define T_WHILE 142</span>
<a name="l05342"></a>05342 <span class="preprocessor"></span><span class="preprocessor">#define T_WITH 143</span>
<a name="l05343"></a>05343 <span class="preprocessor"></span><span class="preprocessor">#define T_XML 144</span>
<a name="l05344"></a>05344 <span class="preprocessor"></span><span class="preprocessor">#define T_YIELD 145</span>
<a name="l05345"></a>05345 <span class="preprocessor"></span><span class="preprocessor">#define T_EARLY_TODO_REMOVED 146</span>
<a name="l05346"></a>05346 <span class="preprocessor"></span><span class="preprocessor">#define T_ENUM 147</span>
<a name="l05347"></a>05347 <span class="preprocessor"></span><span class="preprocessor">#define T_HAS 148</span>
<a name="l05348"></a>05348 <span class="preprocessor"></span><span class="preprocessor">#define T_PRECISION 149</span>
<a name="l05349"></a>05349 <span class="preprocessor"></span><span class="preprocessor">#define T_UNDEFINED 150</span>
<a name="l05350"></a>05350 <span class="preprocessor"></span><span class="preprocessor">#define T_BOOLEAN 151</span>
<a name="l05351"></a>05351 <span class="preprocessor"></span><span class="preprocessor">#define T_LONG 152</span>
<a name="l05352"></a>05352 <span class="preprocessor"></span><span class="preprocessor">#define T_VOLATILE 153</span>
<a name="l05353"></a>05353 <span class="preprocessor"></span><span class="preprocessor">#define T_ULONG 154</span>
<a name="l05354"></a>05354 <span class="preprocessor"></span><span class="preprocessor">#define T_HASH 155</span>
<a name="l05355"></a>05355 <span class="preprocessor"></span><span class="preprocessor">#define T_ABSTRACT 156</span>
<a name="l05356"></a>05356 <span class="preprocessor"></span><span class="preprocessor">#define T_CALLEE 157</span>
<a name="l05357"></a>05357 <span class="preprocessor"></span><span class="preprocessor">#define T_GENERATOR 158</span>
<a name="l05358"></a>05358 <span class="preprocessor"></span><span class="preprocessor">#define T_NUMBER_WORD 159</span>
<a name="l05359"></a>05359 <span class="preprocessor"></span><span class="preprocessor">#define T_XML_COMMENT_START 161</span>
<a name="l05360"></a>05360 <span class="preprocessor"></span><span class="preprocessor">#define T_XML_COMMENT_END 162</span>
<a name="l05361"></a>05361 <span class="preprocessor"></span><span class="preprocessor">#define T_CDATA_START 163</span>
<a name="l05362"></a>05362 <span class="preprocessor"></span><span class="preprocessor">#define T_CDATA_END 164</span>
<a name="l05363"></a>05363 <span class="preprocessor"></span><span class="preprocessor">#define T_XML_PI_START 165</span>
<a name="l05364"></a>05364 <span class="preprocessor"></span><span class="preprocessor">#define T_XML_PI_END 166</span>
<a name="l05365"></a>05365 <span class="preprocessor"></span><span class="preprocessor">#define T_LT_SLASH 167</span>
<a name="l05366"></a>05366 <span class="preprocessor"></span><span class="preprocessor">#define T_SLASH_GT 168</span>
<a name="l05367"></a>05367 <span class="preprocessor"></span><span class="preprocessor">#define T_LIKE 169</span>
<a name="l05368"></a>05368 <span class="preprocessor"></span><span class="preprocessor">#define T_REGEXP 170</span>
<a name="l05369"></a>05369 <span class="preprocessor"></span><span class="preprocessor">#define T_REQUIRE 171</span>
<a name="l05370"></a>05370 <span class="preprocessor"></span><span class="preprocessor">#define T_SHARED 172</span>
<a name="l05371"></a>05371 <span class="preprocessor"></span><span class="preprocessor">#define T_NOP 174</span>
<a name="l05372"></a>05372 <span class="preprocessor"></span><span class="preprocessor">#define T_ERR 175</span>
<a name="l05373"></a>05373 <span class="preprocessor"></span>
<a name="l05374"></a>05374 <span class="comment">/*</span>
<a name="l05375"></a>05375 <span class="comment">    Group masks</span>
<a name="l05376"></a>05376 <span class="comment"> */</span>
<a name="l05377"></a>05377 <span class="preprocessor">#define G_RESERVED          0x1</span>
<a name="l05378"></a>05378 <span class="preprocessor"></span><span class="preprocessor">#define G_CONREV            0x2</span>
<a name="l05379"></a>05379 <span class="preprocessor"></span><span class="preprocessor">#define G_COMPOUND_ASSIGN   0x4                 </span><span class="comment">/* Eg. &lt;&lt;= */</span>
<a name="l05380"></a>05380 <span class="preprocessor">#define G_OPERATOR          0x8                 </span><span class="comment">/* Operator overload*/</span>
<a name="l05381"></a>05381 
<a name="l05382"></a>05382 <span class="comment">/*</span>
<a name="l05383"></a>05383 <span class="comment">    Attributes (including reserved namespaces)</span>
<a name="l05384"></a>05384 <span class="comment"> */</span>
<a name="l05385"></a>05385 <span class="preprocessor">#define A_FINAL         0x1</span>
<a name="l05386"></a>05386 <span class="preprocessor"></span><span class="preprocessor">#define A_OVERRIDE      0x2</span>
<a name="l05387"></a>05387 <span class="preprocessor"></span><span class="preprocessor">#define A_EARLY         0x4                     </span><span class="comment">/* Early binding */</span>
<a name="l05388"></a>05388 <span class="preprocessor">#define A_DYNAMIC       0x8</span>
<a name="l05389"></a>05389 <span class="preprocessor"></span><span class="preprocessor">#define A_NATIVE        0x10</span>
<a name="l05390"></a>05390 <span class="preprocessor"></span><span class="preprocessor">#define A_PROTOTYPE     0x20</span>
<a name="l05391"></a>05391 <span class="preprocessor"></span><span class="preprocessor">#define A_STATIC        0x40</span>
<a name="l05392"></a>05392 <span class="preprocessor"></span><span class="preprocessor">#define A_ENUMERABLE    0x40</span>
<a name="l05393"></a>05393 <span class="preprocessor"></span>
<a name="l05394"></a>05394 <span class="preprocessor">#define EC_INPUT_STREAM "__stdin__"</span>
<a name="l05395"></a>05395 <span class="preprocessor"></span>
<a name="l05396"></a>05396 <span class="keyword">struct </span>EcStream;
<a name="l05397"></a>05397 <span class="keyword">typedef</span> int (*EcStreamGet)(<span class="keyword">struct </span>EcStream *stream);
<a name="l05398"></a>05398 
<a name="l05399"></a>05399 <span class="comment">/*</span>
<a name="l05400"></a>05400 <span class="comment">    Stream flags</span>
<a name="l05401"></a>05401 <span class="comment"> */</span>
<a name="l05402"></a>05402 <span class="preprocessor">#define EC_STREAM_EOL       0x1                 </span><span class="comment">/* End of line */</span>
<a name="l05403"></a>05403 
<a name="l05404"></a>05404 
<a name="l05405"></a>05405 <span class="keyword">typedef</span> <span class="keyword">struct </span>EcStream {
<a name="l05406"></a>05406     <span class="keywordtype">char</span>        *name;                          <span class="comment">/* Stream name / filename */</span>
<a name="l05407"></a>05407 
<a name="l05408"></a>05408     <span class="keywordtype">char</span>        *currentLine;                   <span class="comment">/* Current input source line */</span>
<a name="l05409"></a>05409     <span class="keywordtype">int</span>         lineNumber;                     <span class="comment">/* Line number in source of current token */</span>
<a name="l05410"></a>05410     <span class="keywordtype">int</span>         column;                         <span class="comment">/* Current reading position */</span>
<a name="l05411"></a>05411 
<a name="l05412"></a>05412     <span class="keywordtype">char</span>        *lastLine;                      <span class="comment">/* Save last currentLine */</span>
<a name="l05413"></a>05413     <span class="keywordtype">int</span>         lastColumn;                     <span class="comment">/* Save last column length for putBack */</span>
<a name="l05414"></a>05414 
<a name="l05415"></a>05415     <span class="comment">/*</span>
<a name="l05416"></a>05416 <span class="comment">        In-memory copy if input source</span>
<a name="l05417"></a>05417 <span class="comment">     */</span>
<a name="l05418"></a>05418     <span class="keywordtype">char</span>        *buf;                           <span class="comment">/* Buffer holding source file */</span>
<a name="l05419"></a>05419     <span class="keywordtype">char</span>        *nextChar;                      <span class="comment">/* Ptr to next input char */</span>
<a name="l05420"></a>05420     <span class="keywordtype">char</span>        *end;                           <span class="comment">/* Ptr to one past end of buf */</span>
<a name="l05421"></a>05421 
<a name="l05422"></a>05422     <span class="keywordtype">bool</span>        eof;                            <span class="comment">/* At end of file */</span>
<a name="l05423"></a>05423 
<a name="l05424"></a>05424     <span class="keywordtype">int</span>         flags;                          <span class="comment">/* Input flags */</span>
<a name="l05425"></a>05425     EcStreamGet gets;                           <span class="comment">/* Stream get another characters */</span>
<a name="l05426"></a>05426 
<a name="l05427"></a>05427     <span class="keyword">struct </span>EcCompiler *compiler;                <span class="comment">/* Compiler back reference */</span>
<a name="l05428"></a>05428 
<a name="l05429"></a>05429 } EcStream;
<a name="l05430"></a>05430 
<a name="l05431"></a>05431 
<a name="l05432"></a>05432 <span class="comment">/*</span>
<a name="l05433"></a>05433 <span class="comment">    Parse source code from a file</span>
<a name="l05434"></a>05434 <span class="comment"> */</span>
<a name="l05435"></a>05435 <span class="keyword">typedef</span> <span class="keyword">struct </span>EcFileStream {
<a name="l05436"></a>05436     EcStream    stream;
<a name="l05437"></a>05437     MprFile     *file;
<a name="l05438"></a>05438 } EcFileStream;
<a name="l05439"></a>05439 
<a name="l05440"></a>05440 
<a name="l05441"></a>05441 
<a name="l05442"></a>05442 <span class="comment">/*</span>
<a name="l05443"></a>05443 <span class="comment">    Parse source code from a memory block</span>
<a name="l05444"></a>05444 <span class="comment"> */</span>
<a name="l05445"></a>05445 <span class="keyword">typedef</span> <span class="keyword">struct </span>EcMemStream {
<a name="l05446"></a>05446     EcStream    stream;
<a name="l05447"></a>05447 } EcMemStream;
<a name="l05448"></a>05448 
<a name="l05449"></a>05449 
<a name="l05450"></a>05450 
<a name="l05451"></a>05451 <span class="comment">/*</span>
<a name="l05452"></a>05452 <span class="comment">    Parse input from the console (or file if using ejsh)</span>
<a name="l05453"></a>05453 <span class="comment"> */</span>
<a name="l05454"></a>05454 <span class="keyword">typedef</span> <span class="keyword">struct </span>EcConsoleStream {
<a name="l05455"></a>05455     EcStream    stream;
<a name="l05456"></a>05456     MprBuf      *inputBuffer;                   <span class="comment">/* Stream input buffer */</span>
<a name="l05457"></a>05457 } EcConsoleStream;
<a name="l05458"></a>05458 
<a name="l05459"></a>05459 
<a name="l05460"></a>05460 
<a name="l05461"></a>05461 <span class="comment">/*</span>
<a name="l05462"></a>05462 <span class="comment">    Program input tokens</span>
<a name="l05463"></a>05463 <span class="comment"> */</span>
<a name="l05464"></a>05464 <span class="keyword">typedef</span> <span class="keyword">struct </span>EcToken {
<a name="l05465"></a>05465     <span class="keywordtype">int</span>         tokenId;
<a name="l05466"></a>05466     <span class="keywordtype">int</span>         subId;
<a name="l05467"></a>05467     <span class="keywordtype">int</span>         groupMask;
<a name="l05468"></a>05468 
<a name="l05469"></a>05469     <span class="comment">//  MOB -- convert from uchar</span>
<a name="l05470"></a>05470     uchar       *text;                          <span class="comment">/* Token text */</span>
<a name="l05471"></a>05471     <span class="keywordtype">int</span>         textLen;                        <span class="comment">/* Length of text */</span>
<a name="l05472"></a>05472     <span class="keywordtype">int</span>         textBufSize;                    <span class="comment">/* Size of text buffer */</span>
<a name="l05473"></a>05473 
<a name="l05474"></a>05474     EjsObj   *number;                        <span class="comment">/* Any numeric literals */</span>
<a name="l05475"></a>05475 
<a name="l05476"></a>05476     <span class="keywordtype">char</span>        *filename;
<a name="l05477"></a>05477     <span class="keywordtype">char</span>        *currentLine;
<a name="l05478"></a>05478     <span class="keywordtype">int</span>         lineNumber;
<a name="l05479"></a>05479     <span class="keywordtype">int</span>         column;
<a name="l05480"></a>05480     <span class="keywordtype">int</span>         eol;                            <span class="comment">/* At the end of the line */</span>
<a name="l05481"></a>05481 
<a name="l05482"></a>05482     EcStream    *stream;                        <span class="comment">/* Current input stream */</span>
<a name="l05483"></a>05483     <span class="keyword">struct </span>EcToken *next;                       <span class="comment">/* Putback linkage */</span>
<a name="l05484"></a>05484 } EcToken;
<a name="l05485"></a>05485 
<a name="l05486"></a>05486 
<a name="l05487"></a>05487 
<a name="l05488"></a>05488 <span class="comment">/*</span>
<a name="l05489"></a>05489 <span class="comment">    Input token parsing state. Includes putback stack for N lookahead.</span>
<a name="l05490"></a>05490 <span class="comment"> */</span>
<a name="l05491"></a>05491 <span class="keyword">typedef</span> <span class="keyword">struct </span>EcInput {
<a name="l05492"></a>05492     EcStream    *stream;
<a name="l05493"></a>05493 
<a name="l05494"></a>05494     <span class="keywordtype">int</span>         state;                  <span class="comment">/* Lexer state */</span>
<a name="l05495"></a>05495 
<a name="l05496"></a>05496     EcToken     *putBack;               <span class="comment">/* List of putback tokens */</span>
<a name="l05497"></a>05497     EcToken     *token;                 <span class="comment">/* Current token */</span>
<a name="l05498"></a>05498     EcToken     *freeTokens;            <span class="comment">/* Free list of tokens */</span>
<a name="l05499"></a>05499 
<a name="l05500"></a>05500     <span class="keywordtype">char</span>        *doc;                   <span class="comment">/* Last doc token */</span>
<a name="l05501"></a>05501 
<a name="l05502"></a>05502     <span class="keyword">struct </span>EcLexer *lexer;              <span class="comment">/* Owning lexer */</span>
<a name="l05503"></a>05503     <span class="keyword">struct </span>EcInput *next;               <span class="comment">/* List of input streams */</span>
<a name="l05504"></a>05504     <span class="keyword">struct </span>EcCompiler *compiler;        <span class="comment">/* Reference to compiler */</span>
<a name="l05505"></a>05505 } EcInput;
<a name="l05506"></a>05506 
<a name="l05507"></a>05507 
<a name="l05508"></a>05508 
<a name="l05509"></a>05509 <span class="keyword">typedef</span> <span class="keyword">struct </span>EcLexer {
<a name="l05510"></a>05510     MprHashTable        *keywords;
<a name="l05511"></a>05511     EcInput             *input;         <span class="comment">/* List of input streams */</span>
<a name="l05512"></a>05512     <span class="keyword">struct </span>EcCompiler   *compiler;      <span class="comment">/* Owning compiler */</span>
<a name="l05513"></a>05513 } EcLexer;
<a name="l05514"></a>05514 
<a name="l05515"></a>05515 
<a name="l05516"></a>05516 
<a name="l05517"></a>05517 <span class="comment">/*</span>
<a name="l05518"></a>05518 <span class="comment">    Jump types</span>
<a name="l05519"></a>05519 <span class="comment"> */</span>
<a name="l05520"></a>05520 <span class="preprocessor">#define EC_JUMP_BREAK       0x1</span>
<a name="l05521"></a>05521 <span class="preprocessor"></span><span class="preprocessor">#define EC_JUMP_CONTINUE    0x2</span>
<a name="l05522"></a>05522 <span class="preprocessor"></span><span class="preprocessor">#define EC_JUMP_GOTO        0x4</span>
<a name="l05523"></a>05523 <span class="preprocessor"></span>
<a name="l05524"></a>05524 <span class="keyword">typedef</span> <span class="keyword">struct </span>EcJump {
<a name="l05525"></a>05525     <span class="keywordtype">int</span>             kind;               <span class="comment">/* Break, continue */</span>
<a name="l05526"></a>05526     <span class="keywordtype">int</span>             offset;             <span class="comment">/* Code offset to patch */</span>
<a name="l05527"></a>05527     EcNode          *node;              <span class="comment">/* Owning node */</span>
<a name="l05528"></a>05528 } EcJump;
<a name="l05529"></a>05529 
<a name="l05530"></a>05530 
<a name="l05531"></a>05531 <span class="comment">/*</span>
<a name="l05532"></a>05532 <span class="comment">    Structure for code generation buffers</span>
<a name="l05533"></a>05533 <span class="comment"> */</span>
<a name="l05534"></a>05534 <span class="keyword">typedef</span> <span class="keyword">struct </span>EcCodeGen {
<a name="l05535"></a>05535     MprBuf      *buf;                   <span class="comment">/* Code generation buffer */</span>
<a name="l05536"></a>05536     MprList     *jumps;                 <span class="comment">/* Break/continues to patch for this code block */</span>
<a name="l05537"></a>05537     MprList     *exceptions;            <span class="comment">/* Exception handlers for this code block */</span>
<a name="l05538"></a>05538     <span class="keywordtype">int</span>         jumpKinds;              <span class="comment">/* Kinds of jumps allowed */</span>
<a name="l05539"></a>05539     <span class="keywordtype">int</span>         breakMark;              <span class="comment">/* Stack item counter for the target for break/continue stmts */</span>
<a name="l05540"></a>05540     <span class="keywordtype">int</span>         blockMark;              <span class="comment">/* Lexical block counter for the target for break/continue stmts */</span>
<a name="l05541"></a>05541     <span class="keywordtype">int</span>         stackCount;             <span class="comment">/* Current stack item counter */</span>
<a name="l05542"></a>05542     <span class="keywordtype">int</span>         blockCount;             <span class="comment">/* Current block counter */</span>
<a name="l05543"></a>05543 } EcCodeGen;
<a name="l05544"></a>05544 
<a name="l05545"></a>05545 
<a name="l05546"></a>05546 <span class="comment">/*</span>
<a name="l05547"></a>05547 <span class="comment">    Current parse state. Each non-terminal production has its own state.</span>
<a name="l05548"></a>05548 <span class="comment">    Some state fields are inherited. We keep a linked list from EcCompiler.</span>
<a name="l05549"></a>05549 <span class="comment"> */</span>
<a name="l05550"></a>05550 <span class="keyword">typedef</span> <span class="keyword">struct </span>EcState {
<a name="l05551"></a>05551     <span class="comment">/*</span>
<a name="l05552"></a>05552 <span class="comment">        TODO - group into EcInheritableState and EcPrivateState. Then can use structure assignment.</span>
<a name="l05553"></a>05553 <span class="comment">     */</span>
<a name="l05554"></a>05554     <span class="comment">/*</span>
<a name="l05555"></a>05555 <span class="comment">        Inherited fields. These are inherited by new states.</span>
<a name="l05556"></a>05556 <span class="comment">     */</span>
<a name="l05557"></a>05557     <span class="comment">//  OPT - compress into bit mask</span>
<a name="l05558"></a>05558     <span class="keywordtype">int</span>             inModule;               <span class="comment">/* Inside a module declaration */</span>
<a name="l05559"></a>05559     <span class="keywordtype">int</span>             inClass;                <span class="comment">/* Inside a class declaration */</span>
<a name="l05560"></a>05560     <span class="keywordtype">int</span>             inFunction;             <span class="comment">/* Inside a function declaration */</span>
<a name="l05561"></a>05561     <span class="keywordtype">int</span>             inMethod;               <span class="comment">/* Inside a method declaration */</span>
<a name="l05562"></a>05562     <span class="keywordtype">int</span>             captureBreak;           <span class="comment">/* Capture break/continue inside a catch/finally block */</span>
<a name="l05563"></a>05563     <span class="keywordtype">int</span>             captureFinally;         <span class="comment">/* Capture break/continue with a finally block */</span>
<a name="l05564"></a>05564     <span class="keywordtype">int</span>             blockIsMethod;          <span class="comment">/* Current function is a method */</span>
<a name="l05565"></a>05565     <span class="keywordtype">int</span>             inHashExpression;       <span class="comment">/* Inside a # expression */</span>
<a name="l05566"></a>05566     <span class="keywordtype">int</span>             inSettings;             <span class="comment">/* Inside constructor settings */</span>
<a name="l05567"></a>05567 
<a name="l05568"></a>05568     <span class="comment">/*</span>
<a name="l05569"></a>05569 <span class="comment">        These are used when parsing</span>
<a name="l05570"></a>05570 <span class="comment">     */</span>
<a name="l05571"></a>05571     EjsModule       *currentModule;         <span class="comment">/* Current open module definition */</span>
<a name="l05572"></a>05572     EjsName         currentClassName;       <span class="comment">/* Current open class name - Used only in ecParse */</span>
<a name="l05573"></a>05573     EcNode          *currentClassNode;      <span class="comment">/* Current open class */</span>
<a name="l05574"></a>05574     EcNode          *currentFunctionNode;   <span class="comment">/* Current open method */</span>
<a name="l05575"></a>05575     <span class="keywordtype">int</span>             noin;                   <span class="comment">/* Don't allow "in" */</span>
<a name="l05576"></a>05576     <span class="keywordtype">int</span>             checksumOffset;         <span class="comment">/* Location to write checksum when writing out modules */</span>
<a name="l05577"></a>05577 
<a name="l05578"></a>05578     <span class="comment">//  TODO - rename</span>
<a name="l05579"></a>05579     EcNode          *topVarBlockNode;       <span class="comment">/* Top var block node */</span>
<a name="l05580"></a>05580 
<a name="l05581"></a>05581     <span class="comment">/*</span>
<a name="l05582"></a>05582 <span class="comment">        These are used when doing AST processing and code generation</span>
<a name="l05583"></a>05583 <span class="comment">     */</span>
<a name="l05584"></a>05584     EjsType         *currentClass;          <span class="comment">/* Current open class */</span>
<a name="l05585"></a>05585 
<a name="l05586"></a>05586     <span class="comment">//  TODO - should be using frame-&gt;currentMethod</span>
<a name="l05587"></a>05587     EjsFunction     *currentFunction;       <span class="comment">/* Current open method */</span>
<a name="l05588"></a>05588 
<a name="l05589"></a>05589     <span class="comment">//  TODO - can this be derrived from currentMethod?</span>
<a name="l05590"></a>05590     cchar           *currentFunctionName;   <span class="comment">/* Current method name */</span>
<a name="l05591"></a>05591 
<a name="l05592"></a>05592     EjsObj          *letBlock;              <span class="comment">/* Block for local block scope declarations */</span>
<a name="l05593"></a>05593     EjsObj          *varBlock;              <span class="comment">/* Block for var declarations */</span>
<a name="l05594"></a>05594     EjsObj          *optimizedLetBlock;     <span class="comment">/* Optimized let block declarations - may equal ejs-&gt;global */</span>
<a name="l05595"></a>05595     EcNode          *letBlockNode;
<a name="l05596"></a>05596 
<a name="l05597"></a>05597     <span class="comment">/*</span>
<a name="l05598"></a>05598 <span class="comment">        The defaultNamespace comes from "use default namespace NAME" and is used for new declarations in the top level block</span>
<a name="l05599"></a>05599 <span class="comment">        where the pragma was defined. ie. it is not passed into classes or functions (1 level deep).</span>
<a name="l05600"></a>05600 <span class="comment">        If the defaultNamespace is not defined, then the namespace field is used.</span>
<a name="l05601"></a>05601 <span class="comment">     */</span>
<a name="l05602"></a>05602     cchar           *<span class="keyword">namespace</span>;             <span class="comment">/* Namespace for declarations */</span>
<a name="l05603"></a>05603     cchar           *defaultNamespace;      <span class="comment">/* Default namespace for new top level declarations. Does not propagate */</span>
<a name="l05604"></a>05604     <span class="keywordtype">int</span>             namespaceCount;         <span class="comment">/* Count of namespaces originally in block. Used to pop namespaces */</span>
<a name="l05605"></a>05605 
<a name="l05606"></a>05606     <span class="comment">//  TODO - should change this to include functions also</span>
<a name="l05607"></a>05607     EcNode          *currentObjectNode;     <span class="comment">/* Left object in "." or "[" */</span>
<a name="l05608"></a>05608 
<a name="l05609"></a>05609     <span class="keywordtype">int</span>             preserveStackCount;     <span class="comment">/* If reset needed, preserve this count of elements */</span>
<a name="l05610"></a>05610     <span class="keywordtype">int</span>             needsStackReset;        <span class="comment">/* Stack must be reset before jumping */</span>
<a name="l05611"></a>05611     <span class="keywordtype">int</span>             needsValue;             <span class="comment">/* Express must yield a value */</span>
<a name="l05612"></a>05612 
<a name="l05613"></a>05613     <span class="comment">//  MOB -- should rationalize and have only one of these. Parser needs onRight.</span>
<a name="l05614"></a>05614     <span class="keywordtype">int</span>             onLeft;                 <span class="comment">/* On the left of an assignment */</span>
<a name="l05615"></a>05615 
<a name="l05616"></a>05616     <span class="comment">//  MOB -- unused</span>
<a name="l05617"></a>05617     <span class="keywordtype">int</span>             onRight;                <span class="comment">/* On the right of an assignment */</span>
<a name="l05618"></a>05618     <span class="keywordtype">int</span>             dupLeft;                <span class="comment">/* Dup left side */</span>
<a name="l05619"></a>05619 
<a name="l05620"></a>05620     <span class="keywordtype">int</span>             saveOnLeft;             <span class="comment">/* Saved left of an assignment */</span>
<a name="l05621"></a>05621     <span class="keywordtype">int</span>             conditional;            <span class="comment">/* In branching conditional */</span>
<a name="l05622"></a>05622     <span class="keywordtype">int</span>             strict;                 <span class="comment">/* Compiler checking mode: Strict, standard*/</span>
<a name="l05623"></a>05623     <span class="keywordtype">int</span>             inheritedTraits;        <span class="comment">/* Inherited traits from current block */</span>
<a name="l05624"></a>05624     <span class="keywordtype">bool</span>            disabled;               <span class="comment">/* Disable nodes below this scope */</span>
<a name="l05625"></a>05625 
<a name="l05626"></a>05626     <span class="keyword">struct </span>EcCodeGen    *code;              <span class="comment">/* Global and function code buffer */</span>
<a name="l05627"></a>05627     <span class="keyword">struct </span>EcCodeGen    *staticCodeBuf;     <span class="comment">/* Class static level code generation buffer */</span>
<a name="l05628"></a>05628     <span class="keyword">struct </span>EcCodeGen    *instanceCodeBuf;   <span class="comment">/* Class instance level code generation buffer */</span>
<a name="l05629"></a>05629 
<a name="l05630"></a>05630     MprList         *namespaces;            <span class="comment">/* List of open namespaces */</span>
<a name="l05631"></a>05631 
<a name="l05632"></a>05632     <span class="comment">/*</span>
<a name="l05633"></a>05633 <span class="comment">        TODO refactor or source via some other way</span>
<a name="l05634"></a>05634 <span class="comment">     */</span>
<a name="l05635"></a>05635     <span class="keywordtype">int</span>             inInterface;            <span class="comment">/* Inside an interface */</span>
<a name="l05636"></a>05636     <span class="keywordtype">int</span>             instanceCode;           <span class="comment">/* Generating instance class code */</span>
<a name="l05637"></a>05637 
<a name="l05638"></a>05638     <span class="keyword">struct </span>EcState  *prev;                  <span class="comment">/* State stack */</span>
<a name="l05639"></a>05639     <span class="keyword">struct </span>EcState  *prevBlockState;        <span class="comment">/* Block state stack */</span>
<a name="l05640"></a>05640     <span class="keyword">struct </span>EcState  *breakState;            <span class="comment">/* State for breakable blocks */</span>
<a name="l05641"></a>05641     <span class="keyword">struct </span>EcState  *classState;            <span class="comment">/* State for current class */</span>
<a name="l05642"></a>05642     <span class="keywordtype">int</span>             blockNestCount;         <span class="comment">/* Count of blocks encountered. Used by ejs shell */</span>
<a name="l05643"></a>05643     <span class="keywordtype">int</span>             stateLevel;             <span class="comment">/* State level counter */</span>
<a name="l05644"></a>05644 } EcState;
<a name="l05645"></a>05645 
<a name="l05646"></a>05646 
<a name="l05647"></a>05647 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecEnterState(<span class="keyword">struct</span> EcCompiler *cp);
<a name="l05648"></a>05648 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ecLeaveState(<span class="keyword">struct</span> EcCompiler *cp);
<a name="l05649"></a>05649 <span class="keyword">extern</span> EcNode   *ecLeaveStateWithResult(<span class="keyword">struct</span> EcCompiler *cp,  <span class="keyword">struct</span> EcNode *np);
<a name="l05650"></a>05650 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecResetModule(<span class="keyword">struct</span> EcCompiler *cp, <span class="keyword">struct</span> EcNode *np);
<a name="l05651"></a>05651 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ecStartBreakableStatement(<span class="keyword">struct</span> EcCompiler *cp, <span class="keywordtype">int</span> kinds);
<a name="l05652"></a>05652 
<a name="l05653"></a>05653 
<a name="l05654"></a>05654 <span class="comment">/*</span>
<a name="l05655"></a>05655 <span class="comment">    Primary compiler control structure</span>
<a name="l05656"></a>05656 <span class="comment"> */</span>
<a name="l05657"></a>05657 <span class="keyword">typedef</span> <span class="keyword">struct </span>EcCompiler {
<a name="l05658"></a>05658     <span class="comment">/*</span>
<a name="l05659"></a>05659 <span class="comment">        Properties ordered to make debugging easier</span>
<a name="l05660"></a>05660 <span class="comment">     */</span>
<a name="l05661"></a>05661     <span class="keywordtype">int</span>         phase;                      <span class="comment">/* Ast processing phase */</span>
<a name="l05662"></a>05662     EcState     *state;                     <span class="comment">/* Current state */</span>
<a name="l05663"></a>05663 
<a name="l05664"></a>05664 <span class="preprocessor">#if BLD_DEBUG</span>
<a name="l05665"></a>05665 <span class="preprocessor"></span>    <span class="keywordtype">char</span>        *currentLine;               <span class="comment">/* Current input source code line */</span>
<a name="l05666"></a>05666 <span class="preprocessor">#endif</span>
<a name="l05667"></a>05667 <span class="preprocessor"></span>
<a name="l05668"></a>05668     EcToken     *peekToken;                 <span class="comment">/* Alias for peek ahead */</span>
<a name="l05669"></a>05669     EcToken     *token;                     <span class="comment">/* Alias for lexer-&gt;input-&gt;token */</span>
<a name="l05670"></a>05670 
<a name="l05671"></a>05671 <span class="preprocessor">#if BLD_DEBUG</span>
<a name="l05672"></a>05672 <span class="preprocessor"></span>    <span class="keywordtype">char</span>        *tokenName;                 <span class="comment">/* Name of last consumed token */</span>
<a name="l05673"></a>05673     <span class="keywordtype">char</span>        *peekTokenName;             <span class="comment">/* Name of lookahead token */</span>
<a name="l05674"></a>05674 <span class="preprocessor">#endif</span>
<a name="l05675"></a>05675 <span class="preprocessor"></span>
<a name="l05676"></a>05676     EcState     *fileState;                 <span class="comment">/* Top level state for the file */</span>
<a name="l05677"></a>05677 <span class="preprocessor">#if UNUSED</span>
<a name="l05678"></a>05678 <span class="preprocessor"></span>    EcState     *classState;                <span class="comment">/* State for the current class - used in parse */</span>
<a name="l05679"></a>05679 <span class="preprocessor">#endif</span>
<a name="l05680"></a>05680 <span class="preprocessor"></span><span class="comment">//  MOB -- these are risky and should be moved into state. A nested block, directive class etc willl modify</span>
<a name="l05681"></a>05681     EcState     *directiveState;            <span class="comment">/* State for the current directive - used in parse and CodeGen */</span>
<a name="l05682"></a>05682     EcState     *blockState;                <span class="comment">/* State for the current block */</span>
<a name="l05683"></a>05683 
<a name="l05684"></a>05684     <a class="code" href="struct_ejs_lookup.html" title="Lookup State.">EjsLookup</a>   lookup;                     <span class="comment">/* Lookup residuals */</span>
<a name="l05685"></a>05685 
<a name="l05686"></a>05686     <span class="keywordtype">int</span>         currentLineNumber;          <span class="comment">/* Current input source line number */</span>
<a name="l05687"></a>05687     cchar       *currentFilename;           <span class="comment">/* Current input file name */</span>
<a name="l05688"></a>05688 
<a name="l05689"></a>05689     EcLexer     *lexer;                     <span class="comment">/* Lexical analyser */</span>
<a name="l05690"></a>05690     EcInput     *input;                     <span class="comment">/* Alias for lexer-&gt;input */</span>
<a name="l05691"></a>05691     <a class="code" href="struct_ejs_service.html" title="Ejscript Service structure.">EjsService</a>  *vmService;                 <span class="comment">/* VM runtime */</span>
<a name="l05692"></a>05692     Ejs         *ejs;                       <span class="comment">/* Interpreter instance */</span>
<a name="l05693"></a>05693 
<a name="l05694"></a>05694     <span class="comment">/*</span>
<a name="l05695"></a>05695 <span class="comment">        Compiler command line options</span>
<a name="l05696"></a>05696 <span class="comment">     */</span>
<a name="l05697"></a>05697     <span class="keywordtype">char</span>        *certFile;                  <span class="comment">/* Certificate to sign the module file */</span>
<a name="l05698"></a>05698     <span class="keywordtype">bool</span>        debug;                      <span class="comment">/* Run in debug mode */</span>
<a name="l05699"></a>05699     <span class="keywordtype">bool</span>        doc;                        <span class="comment">/* Include documentation strings in output */</span>
<a name="l05700"></a>05700     <span class="keywordtype">char</span>        *extraFiles;                <span class="comment">/* Extra source files to compile */</span>
<a name="l05701"></a>05701     MprList     *require;                   <span class="comment">/* Required list of modules to pre-load */</span>
<a name="l05702"></a>05702     <span class="keywordtype">bool</span>        interactive;                <span class="comment">/* Interactive use (ejsh) */</span>
<a name="l05703"></a>05703     <span class="keywordtype">bool</span>        merge;                      <span class="comment">/* Merge all dependent modules */</span>
<a name="l05704"></a>05704     <span class="keywordtype">bool</span>        bind;                       <span class="comment">/* Don't bind properties to slots */</span>
<a name="l05705"></a>05705     <span class="keywordtype">bool</span>        noout;                      <span class="comment">/* Don't generate any module output files */</span>
<a name="l05706"></a>05706     <span class="keywordtype">bool</span>        visibleGlobals;             <span class="comment">/* Make globals visible (no namespace) */</span>
<a name="l05707"></a>05707     <span class="keywordtype">int</span>         optimizeLevel;              <span class="comment">/* Optimization factor (0-9) */</span>
<a name="l05708"></a>05708     <span class="keywordtype">bool</span>        shbang;                     <span class="comment">/* Observe #!/path as the first line of a script */</span>
<a name="l05709"></a>05709     <span class="keywordtype">int</span>         warnLevel;                  <span class="comment">/* Warning level factor (0-9) */</span>
<a name="l05710"></a>05710 
<a name="l05711"></a>05711     <span class="keywordtype">int</span>         strict;                     <span class="comment">/* Compiler default strict mode */</span>
<a name="l05712"></a>05712     <span class="keywordtype">int</span>         lang;                       <span class="comment">/* Language compliance level: ecma|plus|fixed */</span>
<a name="l05713"></a>05713     <span class="keywordtype">char</span>        *outputFile;                <span class="comment">/* Output module file name override */</span>
<a name="l05714"></a>05714     MprFile     *file;                      <span class="comment">/* Current output file handle */</span>
<a name="l05715"></a>05715 
<a name="l05716"></a>05716     <span class="keywordtype">int</span>         modver;                     <span class="comment">/* Default module version */</span>
<a name="l05717"></a>05717     <span class="keywordtype">int</span>         parseOnly;                  <span class="comment">/* Only parse the code */</span>
<a name="l05718"></a>05718     <span class="keywordtype">int</span>         strip;                      <span class="comment">/* Strip debug symbols */</span>
<a name="l05719"></a>05719     <span class="keywordtype">int</span>         tabWidth;                   <span class="comment">/* For error reporting "^" */</span>
<a name="l05720"></a>05720 
<a name="l05721"></a>05721     MprList     *modules;                   <span class="comment">/* List of modules to process */</span>
<a name="l05722"></a>05722     MprList     *fixups;                    <span class="comment">/* Type reference fixups */</span>
<a name="l05723"></a>05723 
<a name="l05724"></a>05724     <span class="keywordtype">char</span>        *errorMsg;                  <span class="comment">/* Aggregated error messages */</span>
<a name="l05725"></a>05725     <span class="keywordtype">int</span>         error;                      <span class="comment">/* Unresolved parse error */</span>
<a name="l05726"></a>05726     <span class="keywordtype">int</span>         fatalError;                 <span class="comment">/* Any a fatal error - Can't continue */</span>
<a name="l05727"></a>05727     <span class="keywordtype">int</span>         memError;                   <span class="comment">/* Memory error */</span>
<a name="l05728"></a>05728     <span class="keywordtype">int</span>         errorCount;                 <span class="comment">/* Count of all errors */</span>
<a name="l05729"></a>05729     <span class="keywordtype">int</span>         warningCount;               <span class="comment">/* Count of all warnings */</span>
<a name="l05730"></a>05730     <span class="keywordtype">int</span>         nextSeqno;                  <span class="comment">/* Node sequence numbers */</span>
<a name="l05731"></a>05731     <span class="keywordtype">int</span>         blockLevel;                 <span class="comment">/* Level of nest in blocks */</span>
<a name="l05732"></a>05732 
<a name="l05733"></a>05733     <span class="comment">/*</span>
<a name="l05734"></a>05734 <span class="comment">        TODO - aggregate these into flags</span>
<a name="l05735"></a>05735 <span class="comment">     */</span>
<a name="l05736"></a>05736     <span class="keywordtype">int</span>         peeking;                    <span class="comment">/* Parser is doing peek() */</span>
<a name="l05737"></a>05737     <span class="keywordtype">int</span>         lastOpcode;                 <span class="comment">/* Last opcode encoded */</span>
<a name="l05738"></a>05738     <span class="keywordtype">int</span>         uid;                        <span class="comment">/* Unique identifier generator */</span>
<a name="l05739"></a>05739 } EcCompiler;
<a name="l05740"></a>05740 
<a name="l05741"></a>05741 
<a name="l05742"></a>05742 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecAddModule(EcCompiler *cp, EjsModule *mp);
<a name="l05743"></a>05743 <span class="keyword">extern</span> EcNode       *ecAppendNode(EcNode *np, EcNode *child);
<a name="l05744"></a>05744 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecAstFixup(EcCompiler *cp, <span class="keyword">struct</span> EcNode *np);
<a name="l05745"></a>05745 <span class="keyword">extern</span> EcNode       *ecChangeNode(EcNode *np, EcNode *oldNode, EcNode *newNode);
<a name="l05746"></a>05746 <span class="keyword">extern</span> <span class="keywordtype">void</span>         ecGenConditionalCode(EcCompiler *cp, EcNode *np, EjsModule *up);
<a name="l05747"></a>05747 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecCodeGen(EcCompiler *cp, <span class="keywordtype">int</span> argc, <span class="keyword">struct</span> EcNode **nodes);
<a name="l05748"></a>05748 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecCompile(EcCompiler *cp, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **path);
<a name="l05749"></a>05749 <span class="keyword">extern</span> EcLexer      *ecCreateLexer(EcCompiler *cp);
<a name="l05750"></a>05750 <span class="keyword">extern</span> <span class="keywordtype">void</span>         ecDestroyLexer(EcCompiler *cp);
<a name="l05751"></a>05751 EcCompiler          *ecCreateCompiler(<span class="keyword">struct</span> Ejs *ejs, <span class="keywordtype">int</span> flags);
<a name="l05752"></a>05752 <span class="keyword">extern</span> EcNode       *ecCreateNode(EcCompiler *cp, <span class="keywordtype">int</span> kind);
<a name="l05753"></a>05753 <span class="keyword">extern</span> <span class="keywordtype">void</span>         ecFreeToken(EcInput *input, EcToken *token);
<a name="l05754"></a>05754 <span class="keyword">extern</span> <span class="keywordtype">char</span>         *ecGetErrorMessage(EcCompiler *cp);
<a name="l05755"></a>05755 <span class="keyword">extern</span> <span class="keywordtype">char</span>         *ecGetInputStreamName(EcLexer *lp);
<a name="l05756"></a>05756 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecGetToken(EcInput *input);
<a name="l05757"></a>05757 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecGetRegExpToken(EcInput *input);
<a name="l05758"></a>05758 <span class="keyword">extern</span> EcNode       *ecLinkNode(EcNode *np, EcNode *child);
<a name="l05759"></a>05759 <span class="keyword">extern</span> EjsModule    *ecLookupModule(EcCompiler *cp, cchar *name, <span class="keywordtype">int</span> minVersion, <span class="keywordtype">int</span> maxVersion);
<a name="l05760"></a>05760 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecLookupScope(EcCompiler *cp, EjsName *name);
<a name="l05761"></a>05761 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecLookupVar(EcCompiler *cp, EjsObj *vp, EjsName *name);
<a name="l05762"></a>05762 <span class="keyword">extern</span> EcNode       *ecParseWarning(EcCompiler *cp, <span class="keywordtype">char</span> *fmt, ...);
<a name="l05763"></a>05763 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecPeekToken(EcCompiler *cp);
<a name="l05764"></a>05764 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecPutSpecificToken(EcInput *input, EcToken *token);
<a name="l05765"></a>05765 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecPutToken(EcInput *input);
<a name="l05766"></a>05766 <span class="keyword">extern</span> <span class="keywordtype">void</span>         ecSetError(EcCompiler *cp, cchar *severity, cchar *filename, <span class="keywordtype">int</span> lineNumber,
<a name="l05767"></a>05767                         <span class="keywordtype">char</span> *currentLine, <span class="keywordtype">int</span> column, <span class="keywordtype">char</span> *msg);
<a name="l05768"></a>05768 <span class="keyword">extern</span> <span class="keywordtype">void</span>         ecResetInput(EcCompiler *cp);
<a name="l05769"></a>05769 <span class="keyword">extern</span> EcNode       *ecResetError(EcCompiler *cp, EcNode *np, <span class="keywordtype">bool</span> eatInput);
<a name="l05770"></a>05770 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecRemoveModule(EcCompiler *cp, EjsModule *mp);
<a name="l05771"></a>05771 <span class="keyword">extern</span> <span class="keywordtype">void</span>         ecResetParser(EcCompiler *cp);
<a name="l05772"></a>05772 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecResetModuleList(EcCompiler *cp);
<a name="l05773"></a>05773 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecOpenConsoleStream(EcLexer *lp, EcStreamGet gets);
<a name="l05774"></a>05774 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecOpenFileStream(EcLexer *input, cchar *path);
<a name="l05775"></a>05775 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecOpenMemoryStream(EcLexer *input, <span class="keyword">const</span> uchar *buf, <span class="keywordtype">int</span> len);
<a name="l05776"></a>05776 <span class="keyword">extern</span> <span class="keywordtype">void</span>         ecCloseStream(EcLexer *input);
<a name="l05777"></a>05777 <span class="keyword">extern</span> <span class="keywordtype">void</span>         ecSetOptimizeLevel(EcCompiler *cp, <span class="keywordtype">int</span> level);
<a name="l05778"></a>05778 <span class="keyword">extern</span> <span class="keywordtype">void</span>         ecSetWarnLevel(EcCompiler *cp, <span class="keywordtype">int</span> level);
<a name="l05779"></a>05779 <span class="keyword">extern</span> <span class="keywordtype">void</span>         ecSetStrictMode(EcCompiler *cp, <span class="keywordtype">int</span> on);
<a name="l05780"></a>05780 <span class="keyword">extern</span> <span class="keywordtype">void</span>         ecSetTabWidth(EcCompiler *cp, <span class="keywordtype">int</span> width);
<a name="l05781"></a>05781 <span class="keyword">extern</span> <span class="keywordtype">void</span>         ecSetOutputFile(EcCompiler *cp, cchar *outputFile);
<a name="l05782"></a>05782 <span class="keyword">extern</span> <span class="keywordtype">void</span>         ecSetCertFile(EcCompiler *cp, cchar *certFile);
<a name="l05783"></a>05783 <span class="keyword">extern</span> EcToken      *ecTakeToken(EcInput *input);
<a name="l05784"></a>05784 <span class="keyword">extern</span> <span class="keywordtype">int</span>          ecAstProcess(<span class="keyword">struct</span> EcCompiler *cp, <span class="keywordtype">int</span> argc,  <span class="keyword">struct</span> EcNode **nodes);
<a name="l05785"></a>05785 
<a name="l05786"></a>05786 <span class="comment">/*</span>
<a name="l05787"></a>05787 <span class="comment">    Module file creation routines.</span>
<a name="l05788"></a>05788 <span class="comment"> */</span>
<a name="l05789"></a>05789 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ecAddFunctionConstants(EcCompiler *cp, EjsObj *obj, <span class="keywordtype">int</span> slotNum);
<a name="l05790"></a>05790 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ecAddConstants(EcCompiler *cp, EjsObj *obj);
<a name="l05791"></a>05791 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecAddConstant(EcCompiler *cp, cchar *str);
<a name="l05792"></a>05792 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecAddNameConstant(EcCompiler *cp, EjsName *qname);
<a name="l05793"></a>05793 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecAddDocConstant(EcCompiler *cp, <span class="keywordtype">void</span> *vp, <span class="keywordtype">int</span> slotNum);
<a name="l05794"></a>05794 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecAddModuleConstant(EcCompiler *cp, EjsModule *up, cchar *str);
<a name="l05795"></a>05795 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecCreateModuleHeader(EcCompiler *cp);
<a name="l05796"></a>05796 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecCreateModuleSection(EcCompiler *cp);
<a name="l05797"></a>05797 
<a name="l05798"></a>05798 
<a name="l05799"></a>05799 <span class="comment">/*</span>
<a name="l05800"></a>05800 <span class="comment">    Encoding emitter routines</span>
<a name="l05801"></a>05801 <span class="comment"> */</span>
<a name="l05802"></a>05802 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecEncodeBlock(EcCompiler *cp, uchar *buf, <span class="keywordtype">int</span> len);
<a name="l05803"></a>05803 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecEncodeByte(EcCompiler *cp, <span class="keywordtype">int</span> value);
<a name="l05804"></a>05804 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecEncodeUint(EcCompiler *cp, <span class="keywordtype">int</span> number);
<a name="l05805"></a>05805 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecEncodeNumber(EcCompiler *cp, int64 number);
<a name="l05806"></a>05806 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecEncodeName(EcCompiler *cp, EjsName *qname);
<a name="l05807"></a>05807 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecEncodeOpcode(EcCompiler *cp, <span class="keywordtype">int</span> value);
<a name="l05808"></a>05808 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecEncodeString(EcCompiler *cp, cchar *str);
<a name="l05809"></a>05809 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecEncodeGlobal(EcCompiler *cp, EjsObj *obj, EjsName *qname);
<a name="l05810"></a>05810 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecEncodeWord(EcCompiler *cp, <span class="keywordtype">int</span> value);
<a name="l05811"></a>05811 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecEncodeDouble(EcCompiler *cp, <span class="keywordtype">double</span> value);
<a name="l05812"></a>05812 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecEncodeByteAtPos(EcCompiler *cp, uchar *pos, <span class="keywordtype">int</span> value);
<a name="l05813"></a>05813 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecEncodeWordAtPos(EcCompiler *cp, uchar *pos, <span class="keywordtype">int</span> value);
<a name="l05814"></a>05814 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ecCopyCode(EcCompiler *cp, uchar *pos, <span class="keywordtype">int</span> size, <span class="keywordtype">int</span> dist);
<a name="l05815"></a>05815 <span class="keyword">extern</span> uint     ecGetCodeOffset(EcCompiler *cp);
<a name="l05816"></a>05816 <span class="keyword">extern</span> <span class="keywordtype">int</span>      ecGetCodeLen(EcCompiler *cp, uchar *mark);
<a name="l05817"></a>05817 <span class="keyword">extern</span> <span class="keywordtype">void</span>     ecAdjustCodeLength(EcCompiler *cp, <span class="keywordtype">int</span> adj);
<a name="l05818"></a>05818 
<a name="l05819"></a>05819 <span class="preprocessor">#endif </span><span class="comment">/* _h_EC_COMPILER */</span>
<a name="l05820"></a>05820 
<a name="l05821"></a>05821 <span class="comment">/*</span>
<a name="l05822"></a>05822 <span class="comment">    @copy   default</span>
<a name="l05823"></a>05823 <span class="comment"></span>
<a name="l05824"></a>05824 <span class="comment">    Copyright (c) Embedthis Software LLC, 2003-2010. All Rights Reserved.</span>
<a name="l05825"></a>05825 <span class="comment">    Copyright (c) Michael O'Brien, 1993-2010. All Rights Reserved.</span>
<a name="l05826"></a>05826 <span class="comment"></span>
<a name="l05827"></a>05827 <span class="comment">    This software is distributed under commercial and open source licenses.</span>
<a name="l05828"></a>05828 <span class="comment">    You may use the GPL open source license described below or you may acquire</span>
<a name="l05829"></a>05829 <span class="comment">    a commercial license from Embedthis Software. You agree to be fully bound</span>
<a name="l05830"></a>05830 <span class="comment">    by the terms of either license. Consult the LICENSE.TXT distributed with</span>
<a name="l05831"></a>05831 <span class="comment">    this software for full details.</span>
<a name="l05832"></a>05832 <span class="comment"></span>
<a name="l05833"></a>05833 <span class="comment">    This software is open source; you can redistribute it and/or modify it</span>
<a name="l05834"></a>05834 <span class="comment">    under the terms of the GNU General Public License as published by the</span>
<a name="l05835"></a>05835 <span class="comment">    Free Software Foundation; either version 2 of the License, or (at your</span>
<a name="l05836"></a>05836 <span class="comment">    option) any later version. See the GNU General Public License for more</span>
<a name="l05837"></a>05837 <span class="comment">    details at: http://www.embedthis.com/downloads/gplLicense.html</span>
<a name="l05838"></a>05838 <span class="comment"></span>
<a name="l05839"></a>05839 <span class="comment">    This program is distributed WITHOUT ANY WARRANTY; without even the</span>
<a name="l05840"></a>05840 <span class="comment">    implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<a name="l05841"></a>05841 <span class="comment"></span>
<a name="l05842"></a>05842 <span class="comment">    This GPL license does NOT permit incorporating this software into</span>
<a name="l05843"></a>05843 <span class="comment">    proprietary programs. If you are unable to comply with the GPL, you must</span>
<a name="l05844"></a>05844 <span class="comment">    acquire a commercial license to use this software. Commercial licenses</span>
<a name="l05845"></a>05845 <span class="comment">    for this software and support services are available from Embedthis</span>
<a name="l05846"></a>05846 <span class="comment">    Software at http://www.embedthis.com</span>
<a name="l05847"></a>05847 <span class="comment"></span>
<a name="l05848"></a>05848 <span class="comment">    Local variables:
    tab-width: 4
    c-basic-offset: 4
    End:
    vim: sw=8 ts=8 expandtab

    @end</span>
<a name="l05849"></a>05849 <span class="comment"> */</span>
<a name="l05850"></a>05850 <span class="comment">/************************************************************************/</span>
<a name="l05851"></a>05851 <span class="comment">/*</span>
<a name="l05852"></a>05852 <span class="comment"> *  End of file "../../src/include/ecCompiler.h"</span>
<a name="l05853"></a>05853 <span class="comment"> */</span>
<a name="l05854"></a>05854 <span class="comment">/************************************************************************/</span>
<a name="l05855"></a>05855 
<a name="l05856"></a>05856 <span class="preprocessor">#include "ejs.slots.h"</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jul 26 08:37:06 2010 for ejs by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
