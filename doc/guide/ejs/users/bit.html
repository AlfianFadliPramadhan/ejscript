<!-- BeginDsi "dsi/head.html" -->
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Embedthis Ejscript 2.0.0 Documentation</title>
    <meta name="keywords" content="Ejscript, JavaScript, ECMAScript, Server-Side JavaScript, Dynamic languages, 
        Embedded, AJAX, language"/>
	<meta name="description" content="Ejscript -- Embedded Server-Side JavaScript Language."/>
	<meta name="robots" content="index,follow" />
    <link href="http://www.google.com/cse/style/look/default.css" type="text/css" rel="stylesheet" />
	<link href="../../../doc.css" rel="stylesheet" type="text/css" />
	<link href="../../../print.css" rel="stylesheet" type="text/css" media="print"/>
    <!--[if IE]>
    <link href="../../../iehacks.css" rel="stylesheet" type="text/css" />
    </![endif]-->
</head>

<body>
    <div class="top">
        <a class="logo"  href="http://ejscript.org/">&nbsp;</a>
        <div class="topRight">
            <div class="search">
                <div id="cse-search-form">Loading</div>
                <div class='version'>Embedthis Ejscript 2.0.0</div>
            </div>
        </div>
        <div class="crumbs">
            <a href="../../../product/index.html">Home</a>
<!-- EndDsi -->
             &gt;<a href="index.html">User Guide</a>&gt; <b>Bit</b>
        </div>
    </div>
    <div class="content">
        <div class="contentRight">
            
<!-- BeginDsi "dsi/ejsLanguageSeeAlso.html" -->
		        <h1>See Also</h1>
		        <ul>
		          <li><a href="../../../guide/ejs/overview.html">Overview</a></li>
		          <li><a href="../../../guide/ejs/features.html">Language Features</a></li>
		          <li><a href="../../../guide/ejs/language/modes.html">Language Modes</a></li>
		          <li><a href="../../../guide/ejs/language/syntax.html">Language Syntax</a></li>
		          <li><a href="../../../guide/ejs/language/statements.html">Statements</a></li>
		          <li><a href="../../../guide/ejs/language/expressions.html">Expressions</a></li>
		          <li><a href="../../../guide/ejs/language/objects.html">Objects and Arrays</a></li>
		          <li><a href="../../../guide/ejs/language/functions.html">Functions and Methods</a></li>
		          <li><a href="../../../guide/ejs/language/core.html">Core Language Types</a></li>
		          <li><a href="../../../guide/ejs/language/types.html">Types and Declarations</a></li>
		          <li><a href="../../../guide/ejs/language/classes.html">Classes</a></li>
		          <li><a href="../../../guide/ejs/language/modules.html">Modules</a></li>
		          <li><a href="../../../guide/ejs/language/library.html">System Library</a></li>
		          <li><a href="../../../guide/ejs/language/events.html">Events and Timers</a></li>
		          <li><a href="../../../guide/ejs/language/globals.html">Globals</a></li>

		          <li><a href="../../../guide/ejs/users/compiler.html">Using the Compiler</a></li>
		          <li><a href="../../../guide/ejs/users/compiler.html">Using the Compiler</a></li>
		          <li><a href="../../../guide/ejs/users/shell.html">Command Shell</a></li>
		        </ul>
<!-- EndDsi -->
        </div>
        <div class="contentLeft">
            <h1>Building with Bit</h1>
            <p>Bit means for <em>Build It</em>, and it is a modern replacement for the venerable 
            <a href="http://en.wikipedia.org/wiki/Make_(software)">make</a> and not so popular 
            <a href="http://en.wikipedia.org/wiki/Autoconf">autoconf</a> utilities. Bit manages the building of
            programs and products by simply and efficiently determining which pieces have been updated and thus which components
            need to be rebuilt. It easily handles the direct compilation and generation of projects.</p>

        <h2>Overview</h2>
        <p>Bit parses bit files that have a <em>.bit</em> extension. Bit files are  are JavaScript files that 
            load a JavaScript literal that describes what to build. Arbitrary JavaScript is permitted in bit files, but 
            typically little script code is needed.</p>
        <p>Bit files specify targets to build. These can be libraries, executables or other actions to be run. Bit has
        built-in rules to compile source code, build libraries, executables, copy files, build packages and generate IDE
        projects. So you need to type very little to do the common tasks of building.</p>

        <p>Bit files can intelligently inherit global settings for a project and can override or augment values
        locally. Bit files run with a current directory set to that of the bit file itself, so it can reference
        easily reference local resources. Bit projects are fully relocatable and avoid absolute directory
        references.</p>
        <p>Bit searches for required and optional tools and supports a "configure" phase for building. Bit supports
        cross-platform building by determining the required compiler switches, file extensions and installation
        directories.</p>

        <h2>Why Bit?</h2>
        <p>Many projects rely on autoconf to configure products and make to build. But autoconf is a baroque maze of
        scripts and make is provides too little support for easily building executable and libraries in a cross platform
        manner. Further, neither of these tools work well for Windows and embedded platforms like VxWorks. 
        Consequently, creating portable Makefiles and autoconf scripts that will work on a variety of platforms
        and support cross compilation is an exercise in patience. Often the result is slow, fragile build
        systems, especially on Windows.</p>

        <p>Bit replaces both autoconf and make with a single utility: <em>bit</em>. Bit provides a higher level of
        abstraction to easily specify the targets to build (libraries and executables). It can build directly on Linux,
        Mac or Windows and cross compile for other platforms. It will generate native projects for Visual Studio,
        XCode, Make, Nmake and shell scripts. Bit builds fast without the complexity of autoconf and
        make.</p>

        <p>Bit was initiated after evaluating Make, CMake and GYP for use by Appweb and Ejscript in an embedded,
        cross compilation environment. While all three can be made to work, we were expending a large percentage of
        time on the build system and less on the actual product. Our design goals were:</p>
        <ul>
            <li>Easily manage cross-compilation and cross-compilers</li>
            <li>Support discovery, configuration and integration of external third-party packages</li>
            <li>Generate native projects for IDE integration</li>
            <li>Build quickly on windows without relying on Cygwin</li>
            <li>Support for the entire build cycle: C dependencies, compilation, test and packaging</li>
            <li>Be hackable and extendable</li>
        </ul>

        <h2>Features</h2>
        <p>Bit is implemented primarily as a single Ejscript of some 3K lines and is very hackable. It has the
        following major features:</p>
        <ul>
            <li>Configuration and component discovery (replaces autoconf)</li>
            <li>Compiler capability sleuthing</li>
            <li>Generation of a configuration source header (bit.h)</li>
            <li>Generation of Xcode, Visual Studio, Make, Nmake and shell script projects</li>
            <li>Automatic C/C++ source code dependencies</li>
            <li>Cross platform. Easily handles Windows, Linux and Mac builds</li>
            <li>Easy cross-compilation</li>
            <li>Building outside source tree for read-only file systems</li>
            <li>Bit files are JavaScript source and are easily modified and extened</li>
            <li>Multiple build profiles (debug, release, ...)</li>
            <li>Very fast configuration and building times, even on windows</li>
       </ul>

       <h2>Nice Bits</h2>
       <p>While Bit has a strong feature set, there are some characteristics that make building with Bit especially
       nice:</p>
       <ul>
           <li>Unified project view. No "make" style recursion required.</li>
           <li>Bit configuration may be comprised by multiple bit files</li>
           <li>Bit file targets and scripts are relative to their own directory</li>
           <li>Targets can be named symbolically not just by the target path.</li>
           <li>Bit provides a "why" option (bit --why) to display why a target was or was not rebuilt</li>
           <li>Bit files and targets intelligently inherit of outer project properties</li>
           <li>Bit scripts run using the working directory of the bit file</li>
        </ul>

        <h2>Simple Bit File</h2>
        <p>A bit file is a JavaScript file with a <em>.bit</em> extension that invokes Bit.load() to process a set of build
        instructions. The build instructions are expressed as a JavaScript object literal that is supplied via
        the Bit.load() call.</p>
        <pre>
Bit({
    targets: {
        /* Build the rocket executable */
        rocket: {
            type: 'exe',
            sources: ['*.c'],
        },
    }, 
})
</pre>

        <p>To build the rocket, enter:</p>
        <pre>bit rocket</pre>

        <h2>Invocation</h2>
        <p>When bit is invoked, it searches for a <em>start.bit</em> file in the current directory. If one if not found, it
        searches up the parent directory chain for one. Bit then loads this start.bit file and commences processing
        its build instuctions. A start.bit file may in turn load other bit files.</p>

        <h2>Styles of Use</h2>
        <p>There are two styles of use for Bit:</p>
        <ul>
            <li>Standalone Use</li>
            <li>Configured Use</li>
        </ul>

        <h3>Standalone Use</h3>
        <p>A standalone start.bit file may be used to express simple build targets that do not requiring any prior
        configuration step. The start.bit file contains targets that specify the recipies to build those targets.</p>

        <h3>Configured Use</h3>
        <p>Some products/projects require a configuration phase prior to building with Bit. Configuration involves discovering
        the tools and components available on the current system and the available compiler tool chain support. For
        configured products, Bit is first invoked with a <em>configure</em> target. Bit then reads a <em>main.bit</em> file which
        describes the project, and generates a start.bit and platform bit file that describes the system.  Configured
        use also supports cross-compilation and project file generation for use in IDEs.</p>

        <h2>Targets</h2>
        <p>Bit is typically invoked with zero or more targets on the command line to build. If invoked with zero
        targets, Bit will build all the out-of-date targets. If a one or more targets are specified, only those targets
        will be brought up to date.</p>
        <p>To build all targets: </p>
            <pre>bit</pre>

        <p>To build several named targets:</p>
        <pre>bit libengine librocket space-program</pre>

        <p>Bit pre-defines several special targets:</p>
        <ul>
            <li>configure &mdash; To configure prior to building</li>
            <li>build &mdash; To build all targets</li>
            <li>compile &mdash; Same as 'build'</li>
            <li>clean &mdash; To clean built targets and prepare for rebuilding</li>
            <li>rebuild &mdash; Clean and build</li>
        </ul>

        <h2>Configuring</h2>
        <p>To configure a product before building, run Bit using the <em>configure</em> target or alternatively use the
        <em>--config</em> switch. When configuring, Bit will load a <em>main.bit</em> file and use the details from the
        <em>settings</em> properties in main.bit to tailor the configuration. The settings provide the product name,
        title, company, version number and a list of required and optional extension packages that should be discovered.</p>

        <p>For example, this is a typical <em>settings</em> configuration:</p>
<pre>
settings: {
    product: 'mpr',
    title: 'Multithreaded Portable Runtime',
    company: 'Embedthis',
    version: '4.0.5',
    buildNumber: '4',
    '+required': [ 'utest' ],
    '+optional':  [ 'doxygen', 'man', 'man2html', 'md5', 'openssl', 'ssl' ],
},
</pre>

        <p>The <em>required</em> property defines the extensions that are required to be present on the system to build. The
        plus symbol (+) before these properties indicates that these values should be added to pre-defined values. The buildNumber is a
        build patch number.</p>

        <h2>Cross-Compiling</h2>
        <p>To build a product for platform different to that of the local system is called cross compiling.
        Sometimes this cross compiling is just for a different instruction set (say x64 instead of x86). Other times
        it is for a completely different operating system and/or CPU architecture. In such cases a cross-compiler
        may be required to build for the target platform.</p>

        <p>Bit supports cross compiling via the <em>bit --platform OS-ARCH configure</em> switch. This adds a platform to the
        list of platforms to be made when building. Multiple platforms may be specified and the <em>local</em> platform alias
        may be used for the local development platform.</p>

       <p>Some products require local building to make tools that are required to build for any platform. These
       products add a "platforms: ['local']" property to their settings collection in the main.bit file. This
       automatically adds the local platform to the platforms list and is the same as adding <em>--platform local</em> on the
       command line when configuring.</p>

            <pre>bit --platform windows-x64 -configure .</pre>

       <p>This will create a windows-x64.bit configuration file and a start.es that references it. The platform
       switch does not need to be respecified after configuration.</p>

        <h2>Project Generation</h2>
        <p>Bit can generate generate complete project files for building using: make, nmake, Visual Studio, Xcode or
        plain shell scripts. Bit uses the <em>--gen</em> command line switch to specify the projects to build. Bit is capable of
        cross-generating projects for non-native platforms. For example: you can generate an Xcode project for Mac OS
        X on a Windows system.</p>

            <pre>bit --continue --platform macosx-x64 configure -gen xcode,make,sh</pre>

        <p>This will generate Xcode, make and shell script projects for a Mac OS X 64-bit. The <em>--continue</em> switch indicates
        that generation should continue even if the required compilers and build tools are not present on the development system.</p>

        <h2>Dependencies</h2>
        <p>Bit targets can depend on other targets that must be built first. Bit targets have a name which may be
        depended upon by another target. For example:</p>
<pre>
targets {
    first: {
        build: "print('Build First')",
    },
    second: {
        depends: ['first'],
        build: "print('Build Second')",
    }, 
}
</pre>

        <p>Before Bit begins building, it parses the entire bit file configuration and determines which targets depend
        on what. It then builds the targets in the required build order. It successfully detects and handles dependency
        loops.</p>

        <h2>Defaults</h2>
        <p>Often targets need very similar configuration. Bit provides a <em>defaults</em> collection of properties that are inherited
        by all targets. It also provides an <em>internal</em> collection of properties that are inherited by only the targets in the
        same bit file. For example:</p>
<pre>
defaults: {
    '+defines': [ '-DTUNE=SPEED ],
    '+libraries': [ 'math' ],
}
</pre>
        <p>This will use the <em>TUNE=SPEED</em> compiler definition when compiling all source files, and the
        <em>math</em> library when
        linking executables (and libraries on some systems).</p>

        <h2>Debugging</h2>
        <p>With Make and other build tools, it is difficult to determine why a target is or is not being built. Bit
        provides a <em>--why</em> command line switch to diagnose problematic build sequences. This switch displays the reason why each
        target was or was not built.</p>

        <p>In a complex project containing many Bit files, it can be helpful to see the entire bit configuration in one
        file. Use the <em>--dump</em> switch to save a copy of the entire configuration. In the dump, build defaults are fully
        expanded to each target contains the expanded configuration that will be used to build the target.</p>

        <p>By default, Bit builds relativley quietly and stops on the first build error. To see the commands Bit is
        issuing, use the <em>--show</em> switch. To build totally quietly, use the <em>--quiet</em> switch. To continue building
        despite build errors, use the <em>--continue</em> switch.</p>

        <h2>Options</h2>
        <table>
            <thead>
            <tr><th>Option</th><th>Description</th></tr>
            </thead>
            <tbody>
                <tr>
                    <td>--benchmark</td>
                    <td>Measure the elapsed time to run bit.</td>
                </tr>

                <tr>
                    <td>--configure path-to-source</td>
                    <td><p>Configure the project to prepare for building. This configures Bit for building the project
                        based on the instructions specified in a <em>'main.bit</em> located in the specified path source tree.
                        When run, bit will create a platform configuration bit file, a build output directory and
                        bit.h header. The configuration directory is of the form: OS-ARCH-PROFILE where OS may be
                        freebsd, linux, macosx, solaris, vxworks, windows and ARCH is arm, mips, ppc, x64 or x86.
                        PROFILE is typically set to debug or release. For example: <em>macosx-x86_64-debug</em> The
                        configuration bit file omits the PROFILE. For example: <em>linux-x86.bit</em>.</p>

                        <p>Bit will use the settings.required and settings.optional properties in the main.bit for a
                        list of packages to use. When configuring, bit will search for these packages and will
                        create definitions in the configuration bit file for later use.</p></td>
                </tr>
                    <tr><td>--continue</td>
                        <td>Continue to build despite any build errors. Normal operation is to stop building if any
                            build errors are encountered.</td>
                </tr>

                <tr>
                    <td>--debug</td>
                    <td>Same as --profile debug</td>
                </tr>

                <tr>
                    <td>--diagnose</td>
                    <td>Run bit with stack backtrace display on errors.</td>
                </tr>

                <tr>
                    <td>--dump </td>
                    <td>Dump the aggregate bit configuration into a single dump bit file.</td>
                </tr>

                <tr>
                    <td>--file bitfile</td>
                    <td>Use the alternate named bit file instead of start.bit or main.bit.</td>
                </tr>

                <tr>
                    <td>--force</td>
                    <td>Override warnings and proceed with the operation.</td>
                </tr>

                <tr>
                    <td nowrap="nowrap">--gen [make|nmake|sh|vs|xcode]</td>
                    <td>Generate project files for the current platform. This will generate project files under
                        the <em>projects</em> directory. The projects are based on the current configuration. If
                        cross-generating projects, you will typically need to also use -configure.</td>
                </tr>

                <tr>
                    <td>--keep </td>
                    <td>Keep some intermediate build files. This is currently used by some documentation generation
                        targets.</td> </tr>

                <tr>
                    <td>--log logName[:logLevel]</td>
                    <td>Specify a file to log internal execution messages. Bit will log execution related trace to the
                        log file. The log level specifies the desired verbosity of output. Level 0 is the least verbose
                        and level 9 is the most. The <em>-v</em> switch is an alias for <em>--log stderr:2</em>.</td>
                </tr>

                <tr>
                    <td>--nocross</td>
                    <td>Don't cross-build, rather build natively for the development system. This is useful when
                        configuring for a platform that can build and run natively on the development system. For
                        example: Linux 64-bit systems can run 32-bit applications, so <br/>
                        <em>bit --nocross --platform linux-x86 configure</em> <br/>
                        can directly target the 32-bit platform without cross-building.</td>
                </tr>

                <tr>
                    <td>--out path</td>
                    <td>Save Bit trace output to a file instead of displaying to the console.</td>
                </tr>

                <tr>
                    <td>--platform os-arch</td>
                    <td>Add a platform to build for cross-compilation. Multiple platforms can be added. You may use
                        <em>local</em> for the local platform. Options specified after the platform apply to the prior
                        platform. For example:</p>

                        <p>bit --platform linux-x86 --without all --platform linux-arm --with ejscript configure</p></td>
                </tr>

                <tr>
                    <td nowrap="nowrap">--profile [debug|release|...]</td>
                    <td>Use the specified profile when building. This options is provided once when configuring and the
                        result is saved in the plat- form.profile property in the configuration bit file. Custom
                        profiles can be added to the main.bit or start.bit files.</td> 
                </tr>

                <tr>
                    <td>--quiet</td>
                    <td>Quiet operation. Suppresses output trace.</td>
                </tr>

                <tr>
                    <td>--set key=value</td>
                    <td>Set a settings property to a given value. For example: <em>bit -set version=1.0</em> will update the
                        settings.version property. Use this when running <em>bit configure</em> to persist your changes in the
                        configuration bit file.</td>
                </tr>

                <tr>
                    <td>--show </td>
                    <td>Show the actual commands executed by bit.</td>
                </tr>
                <tr>
                    <td>--rebuild</td>
                    <td>Rebuild the specified targets. Can also use <em>bit rebuild</em>.</td>
                </tr>

                <tr>
                    <td>--release</td>
                    <td>Select the release profile. Same as --profile release.</td>
                </tr>

                <tr>
                    <td>--unset key=value</td>
                    <td>Clear a settings property. Use this when running <em>bit configure</em> to persist your changes in the
                        configuration bit file.</td> 
                </tr>

                <tr>
                    <td>--version</td>
                    <td>Print the ejs command version and exit.</td>
                </tr>

                <tr>
                    <td>--verbose</td>
                    <td>Run in verbose mode with more trace about Bit activities.</td>
                </tr>

                <tr>
                    <td>--with PACK[=path]</td>
                    <td>Build with the named pack located at the optional path. If the path is ommitted, a search is
                        performed for the pack at default locations. Packs must have a pack description file installed
                        under <em>bits/packs</em> in the bit installation.</td>
                </tr>

                <tr>
                    <td>--without PACK</td>
                    <td>Build without the named pack.</td>
                </tr>

            </tbody>
        </table>
<pre>
Examples
Properties
- Bit.html
    - Need a commented main.bit
    - Need a commented *.dmp

    - See GYP doc and how it is 
    - Inheritance of properties
        +, -, 
    - Current directory is that of the bit file
    - Don't have to be in the directory
        - Just say bit in any directory
    - See NI emails general Bit tips
    - document properties in bit files
    - Env vars are only for cross compilation configuration
    - order of platform and -without
    - Can use '--' or '-'
    - Properties
        - customize
        - defaults
        - internal
    - Token expansion
    - Blending
    - Scripts
        - when to invoke
    - Generation
        - sh, nmake, name, xcode
    - Cross compilation
        start.bit - platforms
    - Configuration
        - platform bit file
        - Platform output directory
    - globals
    - Standard types
        - lib, exe, obj
            - compiler, libraries, libpaths, defines, includes
        - Sources expansion
    - Dependency generation
    - rules
    - Settings
        - product, title, version, buildNumber, optional, required, without-all
</pre>
        </div>
    </div>
<!-- BeginDsi "dsi/bottom.html" -->
	<div class="bottom">
		<p class="footnote"> 
            <a href="../../../product/copyright.html" >&copy; Embedthis Software LLC, 2003-2012. 
            All rights reserved. Embedthis, Ejscript and Appweb are trademarks of Embedthis Software LLC.</a>
		</p>
	</div>
</body>
<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script type="text/javascript"> 
  google.load('search', '1', {language : 'en'});
  google.setOnLoadCallback(function() {
    var customSearchControl = new google.search.CustomSearchControl(
      'partner-pub-9935546676162772:ysvxxv4n9rx');

    customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
    var options = new google.search.DrawOptions();
    options.enableSearchboxOnly("http://ejscript.org/search.html");
    customSearchControl.draw('cse-search-form', options);
  }, true);
</script>
</html>
<!-- EndDsi -->
